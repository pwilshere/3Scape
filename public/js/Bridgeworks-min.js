/*                   Bridgeworks(tm) Runtime Engine
                       Trial License Agreement


NOTICE
This is a contract between End User ("You") and Bridgeborn, Inc. ("Bridgeborn, Inc").
Please read the following terms and conditions carefully before installing or
using the Bridgeworks(tm) Runtime Engine ("software").  By installing the software,
You acknowledge that You have read and understood this license agreement and
agree to be bound by its terms and conditions.

I.  Use of the Software
Subject to the terms and conditions set forth in this Agreement,
Bridgeborn, Inc grants to You, and You accept, a limited, non-exclusive
license to use the accompanying computer program in object code form and any
documentation related to the Software, for use in the bundled sample
application.

II.  Intellectual Property
Except as stated elsewhere, this Agreement does not confer upon You any
intellectual property rights in the Software. Use of this product shall be
conducted in accordance with accepted trademark, patent, and copyright
practice. Bridgeworks is covered by U.S. Patent No. 7,681,114.

III.  Copyright
This Software, its code, and all documentation are owned by Bridgeborn, Inc.
Its organization, structure, and code are valuable trade secrets of
Bridgeborn, Inc.  This Software, its code, and all supporting documentation
are protected by U.S. Copyright law and International Treaty provisions.
You may not, in whole or in part, copy, photocopy, reproduce, translate,
adapt, modify, or create derivative works, or reduce to any electronic
medium or machine readable format, this Software, its code, or its
documentation, except as set forth elsewhere in this Agreement, without the
prior written consent of Bridgeborn, Inc.  You also may not reverse engineer,
decompose, disassemble, or otherwise attempt to discover or alter the source
code of the Software.

IV.  Transfer
This Software and its documentation may not be rented, leased, or
sublicensed by You to a third party.  You may, however, transfer all rights
to use the Software to another person or legal entity, subject to the
acceptance by such person or legal entity of all of the terms of this
Agreement.  Except as provided by this Agreement, any attempt to lease,
sublicense, assign, or transfer any of the rights, duties, or obligations
under this Agreement shall be void.


V.  Governing Law and General Provision
This Agreement shall be governed by the laws of the Commonwealth of Virginia.
This Agreement shall not be governed by the United Nations Convention on
Contracts for the International Sale of Goods, the application of which is
expressly excluded.  Should any portion of this Agreement be found void and
unenforceable, it shall not affect the validity of the other portions of
this Agreement, which shall remain valid and enforceable according to its
terms.  You agree that the Software will not be shipped, transported,
transferred, or exported in violation of the United States Export
Administration Act or any other export laws, restrictions, or regulations.
This Agreement may only be modified in writing, signed by an authorized
officer of Bridgeborn, Inc.
*/
function Base(){this.userData="";this.className=""}function Allocator(){}function loadBinaryResource(e){var t=new XMLHttpRequest;t.open("GET",e,false);t.overrideMimeType("text/plain; charset=x-user-defined");t.send();if(t.status!=200){return null}return t.responseText}function loadXMLResource(e){var t=new XMLHttpRequest;t.open("GET",e,false);t.overrideMimeType("text/plain; charset=x-user-defined");t.send();if(t.status!=200){return null}return t.responseText}function loadTextResource(e){var t=new XMLHttpRequest;t.open("GET",e,false);t.overrideMimeType("text/plain; charset=x-user-defined");t.send();if(t.status!=200){return null}return t.responseText}function isLower(e){var t=e.charCodeAt(0);return t>96&&t<123}function isUpper(e){var t=e.charCodeAt(0);return t>64&&t<91}function isSpace(e){if(e==" "||e=="\f"||e=="\n"||e=="\r"||e=="	"||e=="")return true;return false}function getObjectClassName(e){if(e&&e.constructor&&e.constructor.toString){var t=e.constructor.toString().match(/function\s*(\w+)/);if(t&&t.length==2){return t[1]}t=e.constructor.toString().split(" ");if(t&&t.length==2){return t[1].substring(0,t[1].length-1)}}return undefined}function formatPath(e){var t=[];var n="";var r="";try{$.ajax({url:e,type:"HEAD",async:false,error:function(){console.debug(e+" does not exist.");var t=document.location.href;n=t.substring(0,t.lastIndexOf("/"))+"/"+bridgeworks.contentDir+"/"+e;console.debug("Trying: "+n);var i=n.lastIndexOf("objects/");if(i==-1)i=n.lastIndexOf("motions/");if(i==-1)i=n.lastIndexOf("envelopes/");if(i==-1)i=n.lastIndexOf("scenes/");r=n.substring(0,i);console.debug("With contentDir: "+r)},success:function(){n=e;var t=n.lastIndexOf("objects/");if(t==-1)t=n.lastIndexOf("motions/");if(t==-1)t=n.lastIndexOf("envelopes/");if(t==-1)t=n.lastIndexOf("scenes/");r=n.substring(0,t);console.debug("File found: "+n)}});t[0]=n;t[1]=r}catch(i){}return t}function isFullPath(e){var t=false;var n=e.length;if(n>=2){if((e[0]=="\\"||e[0]=="/")&&(e[1]=="\\"||e[1]=="/")){t=true}}if(t||e.indexOf(":")>=0){return true}return false}function formFullPath(e,t){var n=new String;if(!e||!t){return null}if(isFullPath(e)){n=e}else{n=t;if(n.length>0){var r=n.charAt(n.length-1);if(r!="/"&&r!="\\"){n+="/"}}if(e[0]=="/"||e[0]=="\\"){n+=e.slice(1)}else{n+=e}}return n}function getFileExtension(e){var t=null;var n=e.lastIndexOf(".");if(n!=-1){var t="";t=e.substr(n+1);return t}return t}function getBrowserName(){var e=new String(navigator.userAgent);if(e.indexOf("Chrome")>=0)return"Chrome";if(e.indexOf("Firefox")>=0)return"Firefox";return undefined}function OutputDebugMsg(e){var t=document.getElementById("DebugOutput").innerHTML;t+="&gt; "+e+"<br>";document.getElementById("DebugOutput").innerHTML=t}function addSlashAfterDriveSpecifier(e){var t=e.indexOf(":");if(t==-1)return e;e=e.slice(0,t+1)+"\\"+e.slice(t+1);return e}function hexStrToULong(e){var t=e.length-1;var n=0;var r=0;var i=0;for(;t>=0;t--,i++){switch(e.charAt(t)){case"0":r=0;break;case"1":r=1;break;case"2":r=2;break;case"3":r=3;break;case"4":r=4;break;case"5":r=5;break;case"6":r=6;break;case"7":r=7;break;case"8":r=8;break;case"9":r=9;break;case"a":case"A":r=10;break;case"b":case"B":r=11;break;case"c":case"C":r=12;break;case"d":case"D":r=13;break;case"e":case"E":r=14;break;case"f":case"F":r=15;break;default:r=0;break}n+=r*Math.pow(16,i)}return n}function Color(e,t,n,r){this.r=e||0;this.g=t||0;this.b=n||0;this.a=r||0}function Pair(e,t){this.first=e;this.second=t}function Rect(e,t,n,r){this.left=e||0;this.top=t||0;this.right=n||0;this.bottom=r||0}function Viewport(){this.x=0;this.y=0;this.width=0;this.height=0;this.equals=function(e){return this.x==e.x&&this.y==e.y&&this.width==e.width&&this.height==e.height}}function Stack(e){this.stack=new Array;this.maxLength=0;if(e){this.stack.push(e)}}function Queue(e){this.queue=new Array;this.maxLength=0;if(e){this.queue.push(e)}}function setAttributeBin(e){gAttributeBin=e}function setAttributePairs(e){gAttributePairs=e}function deserializeAttributeContainer(e,t){for(var n=0;n<t.length;n++){var r=e.getAttribute(t[n][0]);if(r){deserializeAttribute(r,t[n][1])}}e.flagDeserializedFromXML()}function deserializeComplexAttribute(e,t){var n=[];for(var r=0;r<t.length;r++){n.push(t[r][1])}if(n.length>0){if(!gAttributeBin){setAttributeValue(e,n)}else{gAttributeBin.push(new Pair(e,n))}}e.flagDeserializedFromXML()}function deserializeAttribute(e,t){if(!gAttributeBin){setAttributeValue(e,t)}else{gAttributeBin.push(new Pair(e,t))}e.flagDeserializedFromXML()}function resolveAttributeContainerReference(e,t,n){if(t.length>0){if(t[0][0]=="ref"){var r=n.find(t[0][1]);if(r){e.synchronize(r,true);return true}}}return false}function resolveComplexAttributeReference(e,t){if(t.length>0){if(t[0][0]=="ref"){return resolvePrimitiveAttributeReference(e,t[0][1])}}return false}function resolvePrimitiveAttributeReference(e,t){return false}function resolveAttributeReference(e,t){if(!gAttributePairs){t.copyValue(e)}else{gAttributePairs.push(new Pair(e,t))}}function isEmpty(e){return e==null||e.length==0}function trim(e,t,n){if(isEmpty(e)){return""}if(t==null){t=true}if(n==null){n=true}var r=0;var i=0;var s=0;var o=0;if(t==true){while(s<e.length&&whitespace.indexOf(e.charAt(s++))!=-1){r++}}if(n==true){o=e.length-1;while(o>=r&&whitespace.indexOf(e.charAt(o--))!=-1){i++}}return e.substring(r,e.length-i)}function __escapeString(e){var t=/&/g;var n=/</g;var r=/>/g;var i=/"/g;var s=/'/g;e=e.replace(t,"&");e=e.replace(n,"&lt;");e=e.replace(r,"&gt;");e=e.replace(i,"&quot;");e=e.replace(s,"&apos;");return e}function __unescapeString(e){var t=/&/g;var n=/&lt;/g;var r=/&gt;/g;var i=/&quot;/g;var s=/&apos;/g;e=e.replace(t,"&");e=e.replace(n,"<");e=e.replace(r,">");e=e.replace(i,'"');e=e.replace(s,"'");return e}function showTagInfo(e){var t;var n;t=trim(xmlTextArray[e]);if(t==""||t==null){t="No text value for this node"}n=trim(xmlCDataArray[e]);if(n==""||n==null){n="No CDATA value for this node"}var r="Text:\n "+t+"\n\n"+"CDATA:\n "+n+"\n\n";if(xmlAttrArray[e]){var s=xmlAttrArray[e];var o="";for(i in s){o+=i+"="+s[i]+"\n"}r+="Attributes:\n "+o}alert(e+"\n\n"+r)}function startParser(){var e=document.getElementById("xmldata").value;var t,n="",r=new SAXDriver;var s=new xmlHandler;r.setDocumentHandler(s);r.setErrorHandler(s);r.setLexicalHandler(s);r.parse(e);var o="\n"+s.getError();xmlTextArray=s.getText_Array();xmlCDataArray=s.getCDATA_Array();xmlAttrArray=s.getAttr_Array();t=s.getPath_Array();for(i=0;i<t.length;i++){n+='<a href="javascript:void(null)" onclick="showTagInfo(\''+t[i]+"')\">"+t[i]+"</a>\n"}if(document.all){document.all.divout.innerHTML="Parsing completed  | Click on the links below for more info:<br><pre>"+n+"</pre>"}else if(document.getElementById){document.getElementById("divout").innerHTML="Parsing completed | Click on the links below for more info:<br><pre>"+n+"</pre>"}else{alert("Requires a DOM compatible browser for this test")}}function Timer(){this.startTime=null;this.stopTime=null}function __getIEVersion(){var e=-1;if(navigator.appName=="Microsoft Internet Explorer"){var t=navigator.userAgent;var n=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");if(n.exec(t)!=null)e=parseFloat(RegExp.$1)}return e}function __getOperaVersion(){var e=0;if(window.opera){var t=window.opera.version();e=parseFloat(t)}return e}function __parseBorderWidth(e){var t=0;if(typeof e=="string"&&e!=null&&e!=""){var n=e.indexOf("px");if(n>=0){t=parseInt(e.substring(0,n))}else{t=1}}return t}function __getBorderWidth(e){var t=new Object;t.left=0;t.top=0;t.right=0;t.bottom=0;if(window.getComputedStyle){var n=window.getComputedStyle(e,null);t.left=parseInt(n.borderLeftWidth.slice(0,-2));t.top=parseInt(n.borderTopWidth.slice(0,-2));t.right=parseInt(n.borderRightWidth.slice(0,-2));t.bottom=parseInt(n.borderBottomWidth.slice(0,-2))}else{t.left=__parseBorderWidth(e.style.borderLeftWidth);t.top=__parseBorderWidth(e.style.borderTopWidth);t.right=__parseBorderWidth(e.style.borderRightWidth);t.bottom=__parseBorderWidth(e.style.borderBottomWidth)}return t}function getElementAbsolutePos(e){var t=new Object;t.x=0;t.y=0;if(e!==null){if(e.getBoundingClientRect){var n=document.documentElement;var r=e.getBoundingClientRect();var i=n.scrollLeft;var s=n.scrollTop;t.x=r.left+i;t.y=r.top+s}else{t.x=e.offsetLeft;t.y=e.offsetTop;var o=e.parentNode;var u=null;while(offsetParent!=null){t.x+=offsetParent.offsetLeft;t.y+=offsetParent.offsetTop;var a=offsetParent.tagName.toLowerCase();if(__isIEOld&&a!="table"||(__isFireFoxNew||__isChrome)&&a=="td"){u=kGetBorderWidth(offsetParent);t.x+=u.left;t.y+=u.top}if(offsetParent!=document.body&&offsetParent!=document.documentElement){t.x-=offsetParent.scrollLeft;t.y-=offsetParent.scrollTop}if(!__isIE&&!__isOperaOld||__isIENew){while(offsetParent!=o&&o!==null){t.x-=o.scrollLeft;t.y-=o.scrollTop;if(__isFireFoxOld||__isWebKit){u=kGetBorderWidth(o);t.x+=u.left;t.y+=u.top}o=o.parentNode}}o=offsetParent.parentNode;offsetParent=offsetParent.offsetParent}}}return t}function min3(e,t,n){return Math.min(e,Math.min(t,n))}function max3(e,t,n){return Math.max(e,Math.max(t,n))}function toRadians(e){return e*Math.PI/180}function toDegrees(e){return e*180/Math.PI}function magnitude(e,t,n){return Math.sqrt(e*e+t*t+n*n)}function clamp(e,t,n){if(e<t)return t;if(e>n)return n;return e}function degreeNormalize(e){while(e<0){e+=360}while(e>=360){e-=360}return e}function epsilonEqual(e,t,n){if(Math.abs(e-t)<n){return true}return false}function determinant2x2(e,t,n,r){return e*r-t*n}function determinant3x3(e,t,n,r,i,s,o,u,a){var f=determinant2x2(i,s,u,a);var l=determinant2x2(r,s,o,a);var c=determinant2x2(r,i,o,u);return e*f-t*l+n*c}function determinant4x4(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){var m=determinant3x3(s,o,u,f,l,c,p,d,v);var g=determinant3x3(i,o,u,a,l,c,h,d,v);var y=determinant3x3(i,s,u,a,f,c,h,p,v);var b=determinant3x3(i,s,o,a,f,l,h,p,d);return e*m-t*g+n*y-r*b}function modf(e){var t=e<0?Math.ceil(e):Math.floor(e);var n=e-t;return{integerPart:t,fractionalPart:n}}function XYZtoH(e,t,n){var r=0;if(e==0){if(n>=0){r=0}else{r=Math.PI}}else if(n==0){if(e>=0){r=3*HALFPI}else{r=HALFPI}}else{if(e>0&&n>0){r=TWOPI-Math.atan(e/n)}else if(e<0&&n>0){r=-Math.atan(e/n)}else if(e<0&&n<0){r=HALFPI+Math.atan(n/e)}else{r=3*HALFPI+Math.atan(n/e)}}return r}function XYZtoHP(e,t,n){var r=0;var i=0;if(e==0&&n==0){r=0;if(t!=0){i=t<0?-HALFPI:HALFPI}else{i=0}}else{if(n==0){r=e>0?HALFPI:-HALFPI}else if(n<0){r=-Math.atan(e/n)+Math.PI}else{r=-Math.atan(e/n)}e=Math.sqrt(e*e+n*n);if(e==0){i=t<0?-HALFPI:HALFPI}else{i=Math.atan(t/e)}}return{heading:r,pitch:i}}function rectContainsPoint(e,t,n){if(e>=n.left&&t>=n.top&&e<=n.right&&t<=n.bottom)return true;return false}function Vector2D(e,t){this.x=e||0;this.y=t||0}function Vector3D(e,t,n){this.x=e||0;this.y=t||0;this.z=n||0;this.equals=function(e){return this.x==e.x&&this.y==e.y&&this.z==e.z}}function dotProduct(e,t){return e.x*t.x+e.y*t.y+e.z*t.z}function crossProduct(e,t){var n=new Vector3D;n.x=e.y*t.z-e.z*t.y;n.y=e.z*t.x-e.x*t.z;n.z=e.x*t.y-e.y*t.x;return n}function cosineAngleBetween(e,t){var n=magnitude(e.x,e.y,e.z)*magnitude(t.x,t.y,t.z);if(n!=0){var r=dotProduct(e,t)/n;if(r>1)r=1;else if(r<-1)r=-1;return r}return 1}function midpoint(e,t){var n=new Vector3D;n.x=(e.x+t.x)/2;n.y=(e.y+t.y)/2;n.z=(e.z+t.z)/2;return n}function distanceBetween(e,t){return Math.sqrt((e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y)+(e.z-t.z)*(e.z-t.z))}function subtract3D(e,t){var n=new Vector3D(e.x,e.y,e.z);n.subtractVector(t);return n}function Vector4D(e,t,n,r){this.x=e||0;this.y=t||0;this.z=n||0;this.w=r||0}function Matrix4x4(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){this._11=e||1;this._12=t||0;this._13=n||0;this._14=r||0;this._21=i||0;this._22=s||1;this._23=o||0;this._24=u||0;this._31=a||0;this._32=f||0;this._33=l||1;this._34=c||0;this._41=h||0;this._42=p||0;this._43=d||0;this._44=v||1}function MatrixStack(e){Stack.call(this,e)}function Quaternion(){this.w=1;this.x=0;this.y=0;this.z=0}function Line(e,t){this.point=new Vector3D(e.x,e.y,e.z);this.dir=new Vector3D(t.x,t.y,t.z)}function Plane(e,t){this.point=new Vector3D;this.normal=new Vector3D;this.dot=0;if(e&&t){this.point.copy(e);this.normal.copy(t);this.dot=dotProduct(this.point,this.normal)}}function Plane2(e,t,n){var r;if(e&&t&&n){var i=new Vector3D(n.x-t.x,n.y-t.y,n.z-t.z);var s=new Vector3D(e.x-t.x,e.y-t.y,e.z-t.z);r=crossProduct(i,s);r.normalize()}Plane.call(this,e,r)}function pointOnPlane(e,t,n){return Math.abs(dotProduct(e,t.normal)-t.dot)<n?true:false}function pointOnPositiveSideOfPlane(e,t){return dotProduct(e,t.normal)-t.dot>0?true:false}function pointOnNegativeSideOfPlane(e,t){return dotProduct(e,t.normal)-t.dot<0?true:false}function lineIntersectsPlane(e,t){var n=new Vector3D;var r;var i=t.normal.x*e.dir.x+t.normal.y*e.dir.y+t.normal.z*e.dir.z;if(i==0){if(pointOnPlane(e.point,t,FLT_EPSILON)){n.copy(e.point);r=2}r=0}else{var s=t.dot-(t.normal.x*e.point.x+t.normal.y*e.point.y+t.normal.z*e.point.z);var o=s/i;n.x=o*e.dir.x+e.point.x;n.y=o*e.dir.y+e.point.y;n.z=o*e.dir.z+e.point.z;r=1}return{result:r,point:n}}function lineSegmentPlaneIntersection(e,t,n){var r=new Vector3D(t.x-e.x,t.y-e.y,t.z-e.z);var i=e.x;var s=e.y;var o=e.z;var u=r.x;var a=r.y;var f=r.z;var l=n.normal.x*u+n.normal.y*a+n.normal.z*f;if(l==0){if(pointOnPlane(e,n,FLT_EPSILON)){var c=new Vector3D(e);return{count:2,point:c}}return{count:0}}var h=n.dot-(n.normal.x*i+n.normal.y*s+n.normal.z*o);var p=h/l;if(p<0||p>1){return{count:0}}var c=new Vector3D;c.x=p*u+i;c.y=p*a+s;c.z=p*f+o;return{count:1,point:c}}function coplanar(e,t){return(e.normal==t.normal||e.normal==-t.normal)&&pointOnPlane(e.point,t)?true:false}function planesIntersect(e,t){var n=new Vector3D(0,0,0);if(crossProduct(e.normal,t.normal).equals(n)){return false}return true}function distanceBetweenPlanes(e,t){if(coplanar(e,t)){return 0}if(!planesIntersect(e,t)){var n=lineIntersectsPlane(new Line(e.point,e.normal),t);if(n.result){return distanceBetween(e.point,t.point)}else{return 0}}return 0}function ViewVolume(){this.left=null;this.right=null;this.top=null;this.bottom=null;this.near=null;this.far=null}function SIGN3(e){e.x<0?4:0|e.y<0?2:0|e.z<0?1:0}function solveQuadraticEquation(e,t,n){if(e==0){return{count:0}}var r=t*t-4*e*n;if(r<0){return{count:0}}if(r==0){var i=-t/(2*e);return{count:1,root1:i}}r=Math.sqrt(r);var i=(-t+r)/(2*e);var s=(-t-r)/(2*e);return{count:2,root1:i,root2:s}}function rayTriangleIntersection(e,t,n,r,i,s,o){var u=new Vector3D(t.x,t.y,t.z);u.normalize();var a=new Vector3D(r.x-n.x,r.y-n.y,r.z-n.z);var f=new Vector3D(i.x-n.x,i.y-n.y,i.z-n.z);var l=crossProduct(u,f);var c=dotProduct(a,l);if(-EPSILON<c&&c<EPSILON){return{result:false}}if(s&&c>0){return{result:false}}if(o&&c<0){return{result:false}}var h=1/c;var p=new Vector3D(e.x-n.x,e.y-n.y,e.z-n.z);var d=dotProduct(p,l)*h;if(d<0||d>1){return{result:false}}var v=crossProduct(p,a);var m=dotProduct(u,v)*h;if(m<0||d+m>1){return{result:false}}var g=dotProduct(f,v)*h;return{result:true,t:g,u:d,v:m}}function raySphereIntersection(e,t,n,r){var i=new Vector3D(t.x,t.y,t.z);i.normalize();var s=new Vector3D(e.x+i.x,e.y+i.y,e.z+i.z);var o=s.x-e.x;var u=s.y-e.y;var a=s.z-e.z;var f=2*(o*(e.x-n.x)+u*(e.y-n.y)+a*(e.z-n.z));var l=(e.x-n.x)*(e.x-n.x)+(e.y-n.y)*(e.x-n.y)+(e.z-n.z)*(e.z-n.z)-r*r;return solveQuadraticEquation(1,f,l)}function triangleContainsPoint(e,t,n,r){var i=SIGN3(crossProduct(subtract3D(e,t),subtract3D(e,r)));var s=SIGN3(crossProduct(subtract3D(t,n),subtract3D(t,r)));var o=SIGN3(crossProduct(subtract3D(n,e),subtract3D(n,r)));if(i==s&&s==o){return true}return false}function triangleOnPositiveSideOfPlane(e,t,n,r){return pointOnPositiveSideOfPlane(e,r)&&pointOnPositiveSideOfPlane(t,r)&&pointOnPositiveSideOfPlane(n,r)}function lineSegmentTriangleIntersection(e,t,n,r,i){var s=lineSegmentPlaneIntersection(e,t,new Plane2(n,r,i));if(s.count==0){return{result:false}}if(s.point.x<min3(n.x,r.x,i.x)||s.point.y<min3(n.y,r.y,i.y)||s.point.z<min3(n.z,r.z,i.z)||s.point.x>max3(n.x,r.x,i.x)||s.point.y>max3(n.y,r.y,i.y)||s.point.z>max3(n.z,r.z,i.z)){return{result:false}}if(triangleContainsPoint(n,r,i,s.point)){return{result:true,point:s.point}}return{result:false}}function planeProject(e,t){return crossProduct(t.normal,crossProduct(e,t.normal))}function distanceBetweenLineSegmentAndPoint(e,t,n){if(e.equals(t)){return distanceBetween(e,n)}var r=magnitude(t.x-e.x,t.y-e.y,t.z-e.z);var i=((n.x-e.x)*(t.x-e.x)+(n.y-e.y)*(t.y-e.y)+(n.z-e.z)*(t.z-e.z))/(r*r);if(i<0){return distanceBetween(e,n)}else if(i>1){return distanceBetween(t,n)}else{return distanceBetween(new Vector3D(e.x+(t.x-e.x)*i,e.y+(t.y-e.y)*i,e.z+(t.z-e.z)*i),n)}}function enumerateAttributeTypes(){var e=0;for(var t in eAttrType){if(eAttrType[t]==0)eAttrType[t]=e++}}function enumerateAttributeElementTypes(){var e=0;for(var t in eAttrElemType){if(eAttrElemType[t]==0)eAttrElemType[t]=e++}}function AttributeTargetDesc(e,t,n,r,i){this.target=e||null;this.sourceElementIndex=t||-1;this.targetElementIndex=n||-1;this.op=r||eAttrSetOp.Replace;this.converter=i||null}function AttributeSourceDesc(e,t,n,r,i){this.source=e||null;this.sourceElementIndex=t||-1;this.targetElementIndex=n||-1;this.op=r||eAttrSetOp.Replace;this.converter=i||null}function AttributeGetParams(e,t){this.elementIndex=e;this.valueElementIndex=t}function AttributeSetParams(e,t,n,r,i,s){this.elementIndex=e||-1;this.valueElementIndex=t||-1;this.op=n||eAttrSetOp.Replace;this.updateTargets=r!=undefined?r:true;this.alertModifiedCBs=i!=undefined?i:true;this.caller=s!=undefined?s:null}function Attribute(){Base.call(this);this.className="Attribute";this.attrType=eAttrType.Attribute;this.attrElemType=eAttrElemType.Attribute;this.native=true;this.transient=false;this.persistent=false;this.deserialized=false;this.values=[];this.lastValues=[];this.modifiedCBs=[];this.modifiedCBsData=[];this.targets=[];this.sources=[];this.container=null;this.registry=null}function AttributeContainer(){Attribute.call(this);this.className="AttributeContainer";this.attrType=eAttrType.AttributeContainer;this.attrNameMap=[];this.attrModifiedCountMap=[]}function AttributeContainer_AttributeModifiedCB(e,t){for(var n=0;n<t.modifiedCBs.length;n++){t.modifiedCBs[n](t,t.modifiedCBsData[n])}}function AttributeContainer_AttributeModifiedCounterCB(e,t){t.incrementAttributeModificationCount(e)}function AttributeRegistry(){AttributeContainer.call(this);this.className="AttributeRegistry";this.attrType=eAttrType.AttributeRegistry;this.objectCount=0;this.typeRegistry=[];this.nameRegistry=[];this.uniqueAttributes=[]}function AttributeRegistry_AttributeContainerNameModifiedCB(e,t){t.updateName(e.getContainer(),e.getValueDirect().join(""))}function BooleanAttr(e){Attribute.call(this);this.className="BooleanAttr";this.attrType=eAttrType.BooleanAttr;this.setValue(e||false)}function ColorAttr(e,t,n,r){Attribute.call(this);this.className="ColorAttr";this.attrType=eAttrType.ColorAttr;var i=[e||0,t||0,n||0,r||0];this.setValue(i)}function Matrix4x4Attr(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){Attribute.call(this);this.className="Matrix4x4Attr";this.attrType=eAttrType.Matrix4x4Attr;var m=[e||1,t||0,n||0,r||0,i||0,s||1,o||0,u||0,a||0,f||0,l||1,c||0,h||0,p||0,d||0,v||1];this.setValue(m)}function NumberArrayAttr(){Attribute.call(this);this.className="NumberArrayAttr";this.attrType=eAttrType.NumberArrayAttr}function NumberAttr(e){Attribute.call(this);this.className="NumberAttr";this.attrType=eAttrType.NumberAttr;this.setValue(e||0)}function PulseAttr(){BooleanAttr.call(this);this.className="PulseAttr";this.attrType=eAttrType.PulseAttr;this.setTransient(true)}function QuaternionAttr(e,t,n,r){Attribute.call(this);this.className="QuaternionAttr";this.attrType=eAttrType.QuaternionAttr;var i=[e||1,t||0,n||0,r||0];this.setValue(i)}function ReferenceAttr(e){Attribute.call(this);this.className="ReferenceAttr";this.attrType=eAttrType.ReferenceAttr;this.setValue(e||null)}function StringAttr(e){Attribute.call(this);this.className="StringAttr";this.attrType=eAttrType.StringAttr;this.setValue(e||"")}function TernaryAttr(e){NumberAttr.call(this,e);this.className="TernaryAttr";this.attrType=eAttrType.TernaryAttr}function Vector2DAttr(e,t){Attribute.call(this);this.className="Vector2DAttr";this.attrType=eAttrType.Vector2DAttr;var n=[e||0,t||0];this.setValue(n)}function Vector3DAttr(e,t,n){Attribute.call(this);this.className="Vector3DAttr";this.attrType=eAttrType.Vector3DAttr;var r=[e||0,t||0,n||0];this.setValue(r)}function ViewportAttr(e,t,n,r){Attribute.call(this);this.className="ViewportAttr";this.attrType=eAttrType.ViewportAttr;var i=[e||0,t||0,n||0,r||0];this.setValue(i)}function AttributeVector(e){AttributeContainer.call(this);this.className="AttributeVector";this.attrType=eAttrType.AttributeVector;this.vector=[];this.allocator=e;this.size=new NumberAttr(0);this.baseName=new StringAttr("item");this.appendParsedElements=new BooleanAttr(false);this.elementModified=new PulseAttr;this.size.addModifiedCB(AttributeVector_SizeModifiedCB,this);this.baseName.addModifiedCB(AttributeVector_BaseNameModifiedCB,this);this.registerAttribute(this.size,"size");this.registerAttribute(this.baseName,"baseName");this.registerAttribute(this.appendParsedElements,"appendParsedElements");this.registerAttribute(this.elementModified,"elementModified")}function AttributeVector_SizeModifiedCB(e,t){t.sizeModified()}function AttributeVector_BaseNameModifiedCB(e,t){}function StyleAttr(){AttributeContainer.call(this);this.className="StyleAttr";this.attrType=eAttrType.StyleAttr;this.setOp=new NumberAttr(eAttrSetOp.Replace);this.styleUrl=new StringAttr;this.styleUrl.addModifiedCB(StyleAttr_StyleUrlModifiedCB,this);this.registerAttribute(this.setOp,"setOp");this.registerAttribute(this.styleUrl,"styleUrl")}function StyleAttr_StyleUrlModifiedCB(e,t){t.styleUrlModified()}function StylesAttr(){AttributeVector.call(this);this.className="StylesAttr";this.attrType=eAttrType.StylesAttr;this.registeredCBs=[];this.registeredCBsData=[];this.enabled=new BooleanAttr(true);this.registerAttribute(this.enabled,"enabled")}function StyleMapAttr(){AttributeContainer.call(this);this.className="StyleMapAttr";this.attrType=eAttrType.StyleMapAttr;this.eventType=eEventType.Unknown;this.targetContainer=null;this.event=new StringAttr;this.styles=new StylesAttr;this.styleUrl=new StringAttr;this.target=new StringAttr;this.event.addModifiedCB(StyleMapAttr_EventModifiedCB,this);this.styleUrl.addModifiedCB(StyleMapAttr_styleUrlModifiedCB,this);this.target.addModifiedCB(StyleMapAttr_TargetModifiedCB,this);this.registerAttribute(this.event,"event");this.registerAttribute(this.styleUrl,"styleUrl");this.registerAttribute(this.target,"target")}function StyleMapAttr_EventModifiedCB(e,t){t.eventModified()}function StyleMapAttr_styleUrlModifiedCB(e,t){t.styleUrlModified()}function StyleMapAttr_TargetModifiedCB(e,t){t.targetModified()}function StyleMapAttrAllocator(){}function StylesMapAttr(){AttributeVector.call(this,new StyleMapAttrAllocator);this.className="StylesMapAttr";this.attrType=eAttrType.StylesMapAttr;this.stylesEnabledMap=[];this.size.addModifiedCB(StylesMapAttr_SizeModifiedCB,this);this.appendParsedElements.setValueDirect(true)}function StylesMapAttr_SizeModifiedCB(e,t){t.StylesMapAttr_SizeModified()}function KeyframeAttr(){AttributeContainer.call(this);this.className="KeyframeAttr";this.attrType=eAttrType.KeyframeAttr;this.time=new NumberAttr;this.value=new NumberAttr;this.shape=new NumberAttr;this.params=new AttributeVector;for(var e=0;e<6;e++){this.params.push_back(new NumberAttr(0))}this.registerAttribute(this.time,"time");this.registerAttribute(this.value,"value");this.registerAttribute(this.shape,"shape");this.registerAttribute(this.params,"params");this.getTime=function(){return this.time.getValueDirect()};this.getValue=function(){return this.value.getValueDirect()};this.getShape=function(){return this.shape.getValueDirect()};this.getParams=function(e){return this.params.getAt(e).getValueDirect()}}function KeyframesAttr(){AttributeVector.call(this);this.className="KeyframesAttr";this.attrType=eAttrType.KeyframesAttr}function BBoxAttr(){AttributeContainer.call(this);this.className="BBoxAttr";this.attrType=eAttrType.BBoxAttr;this.min=new Vector3DAttr;this.max=new Vector3DAttr;this.registerAttribute(this.min,"min");this.registerAttribute(this.max,"max")}function ImageAttr(){AttributeContainer.call(this);this.className="ImageAttr";this.attrType=eAttrType.ImageAttr;this.width=new NumberAttr(0);this.height=new NumberAttr(0);this.byteAlignment=new NumberAttr(0);this.pixelFormat=new NumberAttr(ePixelFormat.Unknown);this.pixels=new NumberArrayAttr;this.registerAttribute(this.width,"width");this.registerAttribute(this.height,"height");this.registerAttribute(this.byteAlignment,"byteAlignment");this.registerAttribute(this.pixelFormat,"pixelFormat");this.registerAttribute(this.pixels,"pixels")}function RectAttr(){AttributeContainer.call(this);this.className="RectAttr";this.attrType=eAttrType.RectAttr;this.left=new NumberAttr(0);this.top=new NumberAttr(0);this.right=new NumberAttr(0);this.bottom=new NumberAttr(0);this.registerAttribute(this.left,"left");this.registerAttribute(this.top,"top");this.registerAttribute(this.right,"right");this.registerAttribute(this.bottom,"bottom")}function FontStyleAttr(){StyleAttr.call(this);this.className="FontStyleAttr";this.attrType=eAttrType.FontStyleAttr;this.antialiasType=new NumberAttr(eImageAntialiasOp.EightPass);this.borderColor=new ColorAttr(0,0,0,1);this.borderWidth=new NumberAttr(2);this.color=new ColorAttr(1,1,1,1);this.effects=new StringAttr;this.font=new StringAttr("Arial");this.opacity=new NumberAttr(1);this.size=new NumberAttr(18);this.style=new StringAttr("Bold");this.registerAttribute(this.antialiasType,"antialiasType");this.registerAttribute(this.borderColor,"borderColor");this.registerAttribute(this.borderWidth,"borderWidth");this.registerAttribute(this.color,"color");this.registerAttribute(this.effects,"effects");this.registerAttribute(this.font,"font");this.registerAttribute(this.opacity,"opacity");this.registerAttribute(this.size,"size");this.registerAttribute(this.style,"style")}function LabelStyleAttr(){StyleAttr.call(this);this.className="LabelStyleAttr";this.attrType=eAttrType.LabelStyleAttr;this.angle=new NumberAttr(0);this.backgroundColor=new ColorAttr(0,0,0,1);this.backgroundOpacity=new NumberAttr(0);this.fontStyle=new FontStyleAttr;this.format=new StringAttr("left");this.height=new NumberAttr(0);this.offset=new Vector2DAttr(0,0);this.padding=new NumberAttr(0);this.scale=new Vector3DAttr(1,1,1);this.textAlign=new StringAttr("middleRight");this.width=new NumberAttr(0);this.registerAttribute(this.angle,"angle");this.registerAttribute(this.backgroundColor,"backgroundColor");this.registerAttribute(this.backgroundOpacity,"backgroundOpacity");this.registerAttribute(this.fontStyle,"fontStyle");this.registerAttribute(this.format,"format");this.registerAttribute(this.height,"height");this.registerAttribute(this.offset,"offset");this.registerAttribute(this.padding,"padding");this.registerAttribute(this.scale,"scale");this.registerAttribute(this.textAlign,"textAlign");this.registerAttribute(this.width,"width")}function IconStyleAttr(){StyleAttr.call(this);this.className="IconStyleAttr";this.attrType=eAttrType.IconStyleAttr;this.alphaUrl=new StringAttr("");this.color=new ColorAttr(1,1,1,1);this.opacity=new NumberAttr(1);this.scale=new Vector3DAttr(1,1,1);this.url=new StringAttr("");this.registerAttribute(this.alphaUrl,"alphaUrl");this.registerAttribute(this.color,"color");this.registerAttribute(this.opacity,"opacity");this.registerAttribute(this.scale,"scale");this.registerAttribute(this.url,"url")}function HTMLLabelStyleAttr(){StyleAttr.call(this);this.className="HTMLLabelStyleAttr";this.attrType=eAttrType.HTMLLabelStyleAttr;this.bgColor=new ColorAttr(1,1,1,1);this.height=new NumberAttr(0);this.html=new StringAttr;this.left=new NumberAttr(0);this.top=new NumberAttr(0);this.url=new StringAttr;this.width=new NumberAttr(0);this.registerAttribute(this.bgColor,"bgColor");this.registerAttribute(this.height,"height");this.registerAttribute(this.html,"html");this.registerAttribute(this.html,"userData");this.registerAttribute(this.left,"left");this.registerAttribute(this.top,"top");this.registerAttribute(this.url,"url");this.registerAttribute(this.width,"width")}function BalloonTipLabelStyleAttr(){StyleAttr.call(this);this.className="BalloonTipLabelStyleAttr";this.attrType=eAttrType.BalloonTipLabelStyleAttr;this.balloonOffset=new NumberAttr(100);this.bgColor=new ColorAttr(1,1,1,1);this.displayMode=new StringAttr("default");this.htmlLabelStyle=new HTMLLabelStyleAttr;this.text=new StringAttr;this.textColor=new ColorAttr(0,0,0,1);this.registerAttribute(this.balloonOffset,"balloonOffset");this.registerAttribute(this.bgColor,"bgColor");this.registerAttribute(this.displayMode,"displayMode");this.registerAttribute(this.htmlLabelStyle,"htmlLabelStyle");this.registerAttribute(this.text,"text");this.registerAttribute(this.textColor,"textColor")}function RenderableElementStyleAttr(){StyleAttr.call(this);this.className="RenderableElementStyleAttr";this.attrType=eAttrType.RenderableElementStyleAttr;this.hasFocus=new TernaryAttr(0);this.selected=new TernaryAttr(0);this.registerAttribute(this.hasFocus,"hasFocus");this.registerAttribute(this.selected,"selected")}function PlaneAttr(){AttributeContainer.call(this);this.className="PlaneAttr";this.attrType=eAttrType.PlaneAttr;this.point=new Vector3DAttr(0,0,0);this.normal=new Vector3DAttr(0,0,1);this.dot=new NumberAttr(0);this.registerAttribute(this.point,"point");this.registerAttribute(this.normal,"normal");this.registerAttribute(this.dot,"dot")}function ViewVolumeAttr(){AttributeContainer.call(this);this.className="ViewVolumeAttr";this.attrType=eAttrType.ViewVolumeAttr;this.left=new PlaneAttr;this.right=new PlaneAttr;this.top=new PlaneAttr;this.bottom=new PlaneAttr;this.near=new PlaneAttr;this.far=new PlaneAttr;this.registerAttribute(this.left,"left");this.registerAttribute(this.right,"right");this.registerAttribute(this.top,"top");this.registerAttribute(this.bottom,"bottom");this.registerAttribute(this.near,"near");this.registerAttribute(this.far,"far")}function SphereAttr(){AttributeContainer.call(this);this.className="SphereAttr";this.attrType=eAttrType.SphereAttr;this.sphere=new Sphere;this.center=new Vector3DAttr(0,0,0);this.radius=new NumberAttr(0);this.center.addModifiedCB(SphereAttr_CenterModifiedCB,this);this.radius.addModifiedCB(SphereAttr_RadiusModifiedCB,this);this.registerAttribute(this.center,"center");this.registerAttribute(this.radius,"radius")}function SphereAttr_CenterModifiedCB(e,t){t.sphere.center=e.getValueDirect()}function SphereAttr_RadiusModifiedCB(e,t){t.sphere.radius=e.getValueDirect()}function setAttributeValue(e,t){switch(e.attrType){case eAttrType.BooleanAttr:{if(t=="false"||t=="0")e.setValueDirect(false);else e.setValueDirect(true)}break;case eAttrType.ColorAttr:case eAttrType.Matrix4x4Attr:case eAttrType.NumberArrayAttr:case eAttrType.Vector2DAttr:case eAttrType.Vector3DAttr:case eAttrType.ViewportAttr:{for(var n=0;n<t.length;n++){t[n]=parseFloat(t[n])}e.setValue(t)}break;case eAttrType.NumberAttr:{e.setValueDirect(parseFloat(t))}break;default:{e.setValue(t)}break}}function Agent(){AttributeContainer.call(this);this.className="Agent";this.running=false;this.name=new StringAttr("");this.enabled=new BooleanAttr(true);this.registerAttribute(this.name,"name");this.registerAttribute(this.enabled,"enabled")}function RayIntersectRecord(){this.distance=Infinity;this.pointModel=new Vector3D;this.pointWorld=new Vector3D;this.pointView=new Vector3D;this.triIndex=0}function RayIntersectParams(e,t,n,r,i,s,o,u,a){this.rayOrigin=e||new Vector3D;this.rayDir=t||new Vector3D;this.nearDistance=n||0;this.farDistance=r||0;this.worldMatrix=i||new Matrix4x4;this.viewMatrix=s||new Matrix4x4;this.worldViewMatrix=this.worldMatrix.multiply(this.viewMatrix);this.scale=o||0;this.doubleSided=u||false;this.clipPlanes=a||new Array;this.intersects=false;this.intersectRecord=new RayIntersectRecord}function Triangle(e,t,n,r,i,s,o,u,a){this.v0=new Vector3D(e,t,n);this.v1=new Vector3D(r,i,s);this.v2=new Vector3D(o,u,a)}function Sphere(){this.center=new Vector3D;this.radius=0;this.xcenter=new Vector3D;this.xradius=0}function Region(e,t,n,r,i,s){this.min=new Vector3D(e,t,n);this.max=new Vector3D(r,i,s);this.xpos=new Plane;this.xneg=new Plane;this.ypos=new Plane;this.yneg=new Plane;this.zpos=new Plane;this.zneg=new Plane;this.xpos_ypos_zpos=new Plane;this.xpos_ypos_zneg=new Plane;this.xpos_yneg_zpos=new Plane;this.xpos_yneg_zneg=new Plane;this.xneg_ypos_zpos=new Plane;this.xneg_ypos_zneg=new Plane;this.xneg_yneg_zpos=new Plane;this.xneg_yneg_zneg=new Plane;this.setPlanes()}function SphereTreeNode(){this.sphere=new Sphere;this.level=0;this.parent=null;this.children=[];this.triIndices=[]}function SphereHitRec(){this.target=null;this.testList=[]}function BoundingTree(){this.root=null;this.min=new Vector3D;this.max=new Vector3D;this.tris=[];this.visited=[]}function SphereTree(){BoundingTree.call(this)}function Octree(){SphereTree.call(this)}function rayPick(e,t,n,r,i,s,o,u,a,f){var l=new RayIntersectParams(t,n,r,i,s,o,u,a,f);e.rayIntersectsTree(l);if(l.intersects==true){return l.intersectRecord}return null}function Context(){this.clear()}function RenderContextMethodDesc(e,t){this.method=e;this.params=t}function DisplayListObj(e){this.renderContext=e;this.displayList=[]}function DL_ADD_METHOD_DESC(e,t,n){if(e){e.addMethodDesc(new RenderContextMethodDesc(t,n))}}function LightDesc(){this.type="";this.validMembersMask=0;this.position=new Vector3D;this.direction=new Vector3D;this.ambient=new Color;this.diffuse=new Color;this.specular=new Color;this.constantAttenuation=0;this.linearAttenuation=0;this.quadraticAttenuation=0;this.range=0;this.outerConeDegrees=0;this.innerConeDegrees=0;this.coneFalloff=0}function MaterialDesc(){this.validMembersMask=0;this.ambient=new Color;this.diffuse=new Color;this.specular=new Color;this.emissive=new Color;this.glossiness=0;this.copy=function(e){if(e){this.validMembersMask=e.validMembersMask;this.ambient.copy(e.ambient);this.diffuse.copy(e.diffuse);this.specular.copy(e.specular);this.emissive.copy(e.emissive);this.glossiness=e.glossiness}}}function RenderContext(e,t){this.valid=false;this.canvas=e;this.background=t;this.projectionMatrixStack=new MatrixStack(new Matrix4x4);this.modelViewMatrixStack=new MatrixStack(new Matrix4x4);this.matrixMode=RC_MODELVIEW;this.frontMaterial=new MaterialDesc;this.displayListObj=null;this.getDisplayList=function(){return this.displayListObj};this.setDisplayList=function(e){this.displayListObj=e};this.getFrontMaterial=function(){var e=new MaterialDesc;e.copy(this.frontMaterial);return e};this.setBackgroundImage=function(e,t,n){if(this.background){this.background.src=e;this.background.width=t;this.background.height=n}};this.setMatrixMode=function(e){if(this.displayListObj)DL_ADD_METHOD_DESC(this.displayListObj,eRenderContextMethod.SetMatrixMode,[e]);this.matrixMode=e};this.pushMatrix=function(){if(this.displayListObj)DL_ADD_METHOD_DESC(this.displayListObj,eRenderContextMethod.PushMatrix,null);switch(this.matrixMode){case RC_MODELVIEW:{this.modelViewMatrixStack.push()}break;case RC_PROJECTION:{this.projectionMatrixStack.push()}break}};this.popMatrix=function(){if(this.displayListObj)DL_ADD_METHOD_DESC(this.displayListObj,eRenderContextMethod.PopMatrix,null);switch(this.matrixMode){case RC_MODELVIEW:{this.modelViewMatrixStack.pop()}break;case RC_PROJECTION:{this.projectionMatrixStack.pop()}break}};this.loadMatrix=function(e){if(this.displayListObj)DL_ADD_METHOD_DESC(this.displayListObj,eRenderContextMethod.LoadMatrix,[e]);switch(this.matrixMode){case RC_MODELVIEW:{this.modelViewMatrixStack.loadMatrix(e)}break;case RC_PROJECTION:{this.projectionMatrixStack.loadMatrix(e)}break}};this.leftMultMatrix=function(e){if(this.displayListObj)DL_ADD_METHOD_DESC(this.displayListObj,eRenderContextMethod.LeftMultMatrix,[e]);switch(this.matrixMode){case RC_MODELVIEW:{this.modelViewMatrixStack.leftMultiply(e)}break;case RC_PROJECTION:{this.projectionMatrixStack.leftMultiply(e)}break}};this.rightMultMatrix=function(e){if(this.displayListObj)DL_ADD_METHOD_DESC(this.displayListObj,eRenderContextMethod.RightMultMatrix,[e]);switch(this.matrixMode){case RC_MODELVIEW:{this.modelViewMatrixStack.rightMultiply(e)}break;case RC_PROJECTION:{this.projectionMatrixStack.rightMultiply(e)}break}};this.setEnabled=function(e,t){if(t){this.enable(e)}else{this.disable(e)}}}function newRenderContext(e,t,n){var r=null;switch(e){case"webgl":{r=new webglRC(t,n)}break}return r.valid?r:null}function RenderStateRec(){this.projMatrix=new Matrix4x4;this.worldViewMatrix=new Matrix4x4;this.lightIndices=[];this.lightStates=[];this.lightMatrices=[];this.lightingEnabled=false;this.materialDesc=new MaterialDesc;this.fogEnabled=false;this.clipPlaneIndices=[];this.clipPlanes=[];this.clipPlaneMatrices=[];this.zBufferEnabled=false;this.zBufferWriteEnabled=false}function RenderState(e){this.renderContext=e;this.stateStack=new Stack;this.push=function(e){var t=this.getState(e);this.stateStack.push(t)};this.pop=function(e){if(this.stateStack.empty())return;var t=this.stateStack.top();this.setState(e,t);this.stateStack.pop()};this.getState=function(e){var t=new RenderStateRec;if(e&RENDERSTATE_TRANSFORM_BIT){t.projMatrix=this.renderContext.projectionMatrixStack.top();t.worldViewMatrix=this.renderContext.modelViewMatrixStack.top()}if(e&RENDERSTATE_LIGHTING_BIT){t.lightIndices=this.renderContext.getEnabledLights();for(var n=0;n<t.lightIndices.length;n++){var r=this.renderContext.getLight(t.lightIndices[n]);t.lightStates[n]=r.desc;t.lightMatrices[n]=r.matrix}t.lightingEnabled=this.renderContext.enabled(eRenderMode.Lighting)}if(e&RENDERSTATE_MATERIAL_BIT){t.materialDesc=this.renderContext.getFrontMaterial()}if(e&RENDERSTATE_FOG_BIT){}if(e&RENDERSTATE_CLIP_PLANE_BIT){}if(e&RENDERSTATE_ZBUFFER_BIT){t.zBufferEnabled=this.renderContext.enabled(eRenderMode.DepthTest);t.zBufferWriteEnabled=this.renderContext.enabled(eRenderMode.DepthBufferWrite)}return t};this.setState=function(e,t){if(e&RENDERSTATE_TRANSFORM_BIT){this.renderContext.projectionMatrixStack.loadMatrix(t.projMatrix);this.renderContext.applyProjectionTransform();this.renderContext.modelViewMatrixStack.loadMatrix(t.worldViewMatrix);this.renderContext.applyModelViewTransform()}if(e&RENDERSTATE_LIGHTING_BIT){for(var n=0;n<t.lightIndices.length;n++){this.renderContext.modelViewMatrixStack.push(t.lightMatrices[n]);this.renderContext.setLight(t.lightIndices[n],t.lightStates[n]);this.renderContext.modelViewMatrixStack.pop()}this.renderContext.setEnabledLights(t.lightIndices);if(t.lightingEnabled){this.renderContext.enable(eRenderMode.Lighting)}else{this.renderContext.disable(eRenderMode.Lighting)}}if(e&RENDERSTATE_MATERIAL_BIT){this.renderContext.setFrontMaterial(t.materialDesc)}if(e&RENDERSTATE_FOG_BIT){}if(e&RENDERSTATE_CLIP_PLANE_BIT){}if(e&RENDERSTATE_ZBUFFER_BIT){if(t.zBufferEnabled){this.renderContext.enable(eRenderMode.DepthTest)}else{this.renderContext.disable(eRenderMode.depthTest)}if(t.zBufferWriteEnabled){this.renderContext.enable(eRenderMode.DepthBufferWrite)}else{this.renderContext.disable(eRenderMode.DepthBufferWrite)}}}}function VertexBuffer(){this.vertices=new Array;this.normals=new Array;this.colors=new Array;this.vertexCount=0;this.numVerticesPerPrimitive=0}function TextureObject(){}function gl_LightSourceParameters(){var e;var t;var n;var r;var i;var s;var o;var u;var a;var f;var l}function gl_MaterialParameters(){var e;var t;var n;var r;var i}function webglRC(e,t){RenderContext.call(this,e,t);var n=getWebGLContext(e,false);if(!n)return;n.clearColor(0,0,0,t?0:1);n.clearDepth(1);n.clearStencil(0);n.enable(n.DEPTH_TEST);n.depthFunc(n.LEQUAL);n.disable(n.STENCIL_TEST);n.frontFace(n.CW);n.viewport(0,0,e.width,e.height);n.enable(n.CULL_FACE);n.cullFace(n.BACK);var r=getShaders(n,eShaderType.VertexLighting);if(!r.vertex||!r.fragment)return;var i=getProgram(n,r.vertex,r.fragment);if(!i)return;this.valid=true;var s=[];var o=[];var u=[];this.applyModelViewTransform=function(){if(this.displayListObj)DL_ADD_METHOD_DESC(this.displayListObj,eRenderContextMethod.ApplyModelViewTransform,null);n.uniformMatrix4fv(i.modelViewMatrix,false,new Float32Array(this.modelViewMatrixStack.top().flatten()));var e=new Matrix4x4;e.loadMatrix(this.modelViewMatrixStack.top());e.invert();e.transpose();n.uniformMatrix4fv(i.normalMatrix,false,new Float32Array(e.flatten()))};this.applyProjectionTransform=function(){if(this.displayListObj)DL_ADD_METHOD_DESC(this.displayListObj,eRenderContextMethod.ApplyProjectionTransform,null);n.uniformMatrix4fv(i.projectionMatrix,false,new Float32Array(this.projectionMatrixStack.top().flatten()))};this.clear=function(e){e=e||RC_COLOR_BUFFER_BIT|RC_DEPTH_BUFFER_BIT;if(this.displayListObj)DL_ADD_METHOD_DESC(this.displayListObj,eRenderContextMethod.Clear,[e]);n.clear((e&RC_COLOR_BUFFER_BIT?n.COLOR_BUFFER_BIT:0)|(e&RC_DEPTH_BUFFER_BIT?n.DEPTH_BUFFER_BIT:0)|(e&RC_STENCIL_BUFFER_BIT?n.STENCIL_BUFFER_BIT:0))};this.clearColor=function(e,t,r,i){if(this.displayListObj)DL_ADD_METHOD_DESC(this.displayListObj,eRenderContextMethod.ClearColor,[e,t,r,i]);n.clearColor(e,t,r,i)};this.clearDepth=function(e){if(this.displayListObj)DL_ADD_METHOD_DESC(this.displayListObj,eRenderContextMethod.ClearDepth,[e]);n.clearDepth(e)};this.clearStencil=function(e){if(this.displayListObj)DL_ADD_METHOD_DESC(this.displayListObj,eRenderContextMethod.ClearStencil,[e]);n.clearStencil(e)};this.createVertexBuffer=function(e){if(this.displayListObj)DL_ADD_METHOD_DESC(this.displayListObj,eRenderContextMethod.CreateVertexBuffer,[e]);return new webglVB(this,n,i,e)};this.createTextureObject=function(){if(this.displayListObj)DL_ADD_METHOD_DESC(this.displayListObj,eRenderContextMethod.CreateTextureObject,null);return new webglTO(this,n,i)};this.disable=function(e){if(this.displayListObj)DL_ADD_METHOD_DESC(this.displayListObj,eRenderContextMethod.Disable,[e]);switch(e){case eRenderMode.AlphaBlend:n.disable(n.BLEND);break;case eRenderMode.CullBackFace:n.disable(n.CULL_FACE);break;case eRenderMode.DepthBufferWrite:n.depthMask(false);break;case eRenderMode.DepthTest:n.disable(n.DEPTH_TEST);break;case eRenderMode.Lighting:n.uniform1i(i.lightingEnabled,false);break;case eRenderMode.StencilTest:n.disable(n.STENCIL_TEST);break}};this.enable=function(e){if(this.displayListObj)DL_ADD_METHOD_DESC(this.displayListObj,eRenderContextMethod.Enable,[e]);switch(e){case eRenderMode.AlphaBlend:n.enable(n.BLEND);break;case eRenderMode.CullBackFace:n.enable(n.CULL_FACE);break;case eRenderMode.DepthBufferWrite:n.depthMask(true);break;case eRenderMode.DepthTest:n.enable(n.DEPTH_TEST);break;case eRenderMode.Lighting:n.uniform1i(i.lightingEnabled,true);break;case eRenderMode.StencilTest:n.enable(n.STENCIL_TEST);break}};this.enabled=function(e){if(this.displayListObj)DL_ADD_METHOD_DESC(this.displayListObj,eRenderContextMethod.Enabled,[e]);var t=false;switch(e){case eRenderMode.AlphaBlend:t=n.getParameter(n.BLEND);break;case eRenderMode.CullBackFace:t=n.getParameter(n.CULL_FACE);break;case eRenderMode.DepthBufferWrite:t=n.getParameter(n.DEPTH_WRITEMASK);break;case eRenderMode.DepthTest:t=n.getParameter(n.DEPTH_TEST);break;case eRenderMode.Lighting:t=n.getUniform(i,i.lightingEnabled);break;case eRenderMode.StencilTest:t=n.getParameter(n.STENCIL_TEST);break}return t};this.enableLight=function(e,t){if(this.displayListObj)DL_ADD_METHOD_DESC(this.displayListObj,eRenderContextMethod.EnableLight,[e,t]);n.uniform1i(i.lightSource[e].enabled,t);u[e]=t};this.enableTextureStage=function(e,t){if(this.displayListObj)DL_ADD_METHOD_DESC(this.displayListObj,eRenderContextMethod.EnableTextureStage,[e,t]);n.uniform1i(i.textureStageEnabled[e],t)};this.finish=function(){if(this.displayListObj)DL_ADD_METHOD_DESC(this.displayListObj,eRenderContextMethod.Finish,null);n.finish()};this.getEnabledLights=function(){if(this.displayListObj)DL_ADD_METHOD_DESC(this.displayListObj,eRenderContextMethod.GetEnabledLights,null);var e=[];for(var t=0;t<u.length;t++){if(u[t]){e.push(t)}}return e};this.getGlobalIllumination=function(){if(this.displayListObj)DL_ADD_METHOD_DESC(this.displayListObj,eRenderContextMethod.GetGlobalIllumination,null);var e=n.getUniform(i,i.globalAmbientLight);return{r:e[0],g:e[1],b:e[2],a:e[3]}};this.getLight=function(e){if(this.displayListObj)DL_ADD_METHOD_DESC(this.displayListObj,eRenderContextMethod.GetLight,[e]);return{desc:s[e],matrix:o[e]}};this.getMaxLightCount=function(){if(this.displayListObj)DL_ADD_METHOD_DESC(this.displayListObj,eRenderContextMethod.GetMaxLightCount,null);return gl_MaxLights};this.getMaxTextureStages=function(){if(this.displayListObj)DL_ADD_METHOD_DESC(this.displayListObj,eRenderContextMethod.GetMaxTextureStages,null);return gl_MaxTextureStages};this.perspectiveMatrixLH=function(e,t,n,r,i,s){if(this.displayListObj)DL_ADD_METHOD_DESC(this.displayListObj,eRenderContextMethod.PerspectiveMatrixLH,[e,t,n,r,i,s]);var o=new Matrix4x4;var u=(t+e)/(t-e);var a=(n+r)/(n-r);var f=(s+i)/(s-i);var l=2*s*i/(s-i);o._11=2*i/(t-e);o._13=u;o._22=2*i/(n-r);o._23=a;o._33=f;o._34=1;o._43=-l;o._44=0;return o};this.orthographicMatrixLH=function(e,t,n,r,i,s){if(this.displayListObj)DL_ADD_METHOD_DESC(this.displayListObj,eRenderContextMethod.OrthographicMatrixLH,[e,t,n,r,i,s]);var o=new Matrix4x4;o._11=2/(t-e);o._22=2/(n-r);o._33=-2/(s-i);o._41=-((t+e)/(t-e));o._42=-((n+r)/(n-r));o._43=-((s+i)/(s-i))/2;return o};this.readFrameBuffer=function(e,t,r,i){var s=new Uint8Array(r*i*4);n.readPixels(e,t,r,i,n.RGBA,n.UNSIGNED_BYTE,s);return s};this.setBlendColor=function(e,t,r,i){if(this.displayListObj)DL_ADD_METHOD_DESC(this.displayListObj,eRenderContextMethod.SetBlendColor,[e,t,r,i]);n.blendColor(e,t,r,i)};this.setBlendFactor=function(e,t){if(this.displayListObj)DL_ADD_METHOD_DESC(this.displayListObj,eRenderContextMethod.SetBlendFactor,[e,t]);var r;switch(e){case RC_ZERO:r=n.ZERO;break;case RC_ONE:r=n.ONE;break;case RC_SRC_COLOR:r=n.SRC_COLOR;break;case RC_SRC_ALPHA:r=n.SRC_ALPHA;break;case RC_ONE_MINUS_SRC_COLOR:r=n.ONE_MINUS_SRC_COLOR;break;case RC_ONE_MINUS_SRC_ALPHA:r=n.ONE_MINUS_SRC_ALPHA;break;case RC_DEST_COLOR:r=n.DEST_COLOR;break;case RC_DEST_ALPHA:r=n.DEST_ALPHA;break;case RC_ONE_MINUS_DEST_COLOR:r=n.ONE_MINUS_DEST_COLOR;break;case RC_ONE_MINUS_DEST_ALPHA:r=n.ONE_MINUS_DEST_ALPHA;break}var i;switch(t){case RC_ZERO:i=n.ZERO;break;case RC_ONE:i=n.ONE;break;case RC_SRC_COLOR:i=n.SRC_COLOR;break;case RC_SRC_ALPHA:i=n.SRC_ALPHA;break;case RC_ONE_MINUS_SRC_COLOR:i=n.ONE_MINUS_SRC_COLOR;break;case RC_ONE_MINUS_SRC_ALPHA:i=n.ONE_MINUS_SRC_ALPHA;break;case RC_DEST_COLOR:i=n.DEST_COLOR;break;case RC_DEST_ALPHA:i=n.DEST_ALPHA;break;case RC_ONE_MINUS_DEST_COLOR:i=n.ONE_MINUS_DEST_COLOR;break;case RC_ONE_MINUS_DEST_ALPHA:i=n.ONE_MINUS_DEST_ALPHA;break}n.blendFunc(r,i)};this.setDepthFunc=function(e){if(this.displayListObj)DL_ADD_METHOD_DESC(this.displayListObj,eRenderContextMethod.SetDepthFunc,[e]);var t;switch(e){case eDepthFunc.Never:t=n.NEVER;break;case eDepthFunc.Less:t=n.LESS;break;case eDepthFunc.LessEqual:t=n.LEQUAL;break;case eDepthFunc.Equal:t=n.EQUAL;break;case eDepthFunc.NotEqual:t=n.NOTEQUAL;break;case eDepthFunc.GreaterEqual:t=n.GEQUAL;break;case eDepthFunc.Greater:t=n.GREATER;break;case eDepthFunc.Always:t=n.ALWAYS;break}n.depthFunc(t)};this.setEnabledLights=function(e){if(this.displayListObj)if(this.displayListObj)DL_ADD_METHOD_DESC(this.displayListObj,eRenderContextMethod.SetEnabledLights,[e]);for(var t=0;t<u.length;t++){if(u[t]){this.enableLight(t,false)}}for(var t=0;t<e.length;t++){this.enableLight(e[t],true)}};this.setFrontMaterial=function(e){if(this.displayListObj)DL_ADD_METHOD_DESC(this.displayListObj,eRenderContextMethod.SetFrontMaterial,[e]);if(e.validMembersMask&MATERIALDESC_AMBIENT_BIT){n.uniform4fv(i.frontMaterial.ambient,new Float32Array(e.ambient.v()));this.frontMaterial.ambient=e.ambient}if(e.validMembersMask&MATERIALDESC_DIFFUSE_BIT){n.uniform4fv(i.frontMaterial.diffuse,new Float32Array(e.diffuse.v()));this.frontMaterial.diffuse=e.diffuse}if(e.validMembersMask&MATERIALDESC_SPECULAR_BIT){n.uniform4fv(i.frontMaterial.specular,new Float32Array(e.specular.v()));this.frontMaterial.specular=e.specular}if(e.validMembersMask&MATERIALDESC_EMISSIVE_BIT){this.frontMaterial.emissive=e.emissive}if(e.validMembersMask&MATERIALDESC_GLOSSINESS_BIT){n.uniform1f(i.frontMaterial.shininess,clamp(e.glossiness*128,5,128));this.frontMaterial.glossiness=e.glossiness}this.frontMaterial.validMembersMask|=e.validMembersMask};this.setGlobalIllumination=function(e){if(this.displayListObj)DL_ADD_METHOD_DESC(this.displayListObj,eRenderContextMethod.SetGlobalIllumination,[e]);var t=[e.r,e.g,e.b,e.a];n.uniform4fv(i.globalAmbientLight,new Float32Array(t))};this.setLight=function(e,t){if(this.displayListObj)DL_ADD_METHOD_DESC(this.displayListObj,eRenderContextMethod.SetLight,[e,t]);var r=this.modelViewMatrixStack.top();if(t.validMembersMask&LIGHTDESC_POSITION_BIT){var u=r.transformw(t.position.x,t.position.y,t.position.z,1);var a=[u.x,u.y,u.z,u.w];n.uniform4fv(i.lightSource[e].position,new Float32Array(a))}if(t.validMembersMask&LIGHTDESC_DIRECTION_BIT){var f=r.transform(t.direction.x,t.direction.y,t.direction.z,0);var a=[f.x,f.y,f.z,0];switch(t.type){case"directional":{a[0]*=-1;a[1]*=-1;a[2]*=-1;n.uniform4fv(i.lightSource[e].position,new Float32Array(a))}break;case"spot":{n.uniform4fv(i.lightSource[e].spotDirection,new Float32Array(a))}break}}if(t.validMembersMask&LIGHTDESC_AMBIENT_BIT){n.uniform4fv(i.lightSource[e].ambient,new Float32Array(t.ambient.v()))}if(t.validMembersMask&LIGHTDESC_DIFFUSE_BIT){n.uniform4fv(i.lightSource[e].diffuse,new Float32Array(t.diffuse.v()))}if(t.validMembersMask&LIGHTDESC_SPECULAR_BIT){n.uniform4fv(i.lightSource[e].specular,new Float32Array(t.specular.v()))}if(t.validMembersMask&LIGHTDESC_CONSTANT_ATT_BIT){n.uniform1f(i.lightSource[e].constantAttenuation,t.constantAttenuation)}if(t.validMembersMask&LIGHTDESC_LINEAR_ATT_BIT){n.uniform1f(i.lightSource[e].linearAttenuation,t.linearAttenuation)}if(t.validMembersMask&LIGHTDESC_QUADRATIC_ATT_BIT){n.uniform1f(i.lightSource[e].quadraticAttenuation,t.quadraticAttenuation)}if(t.validMembersMask&LIGHTDESC_RANGE_BIT){}if(t.validMembersMask&LIGHTDESC_OUTER_CONE_DEG_BIT){var l=t.outerConeDegrees;if(l>90){l=180}n.uniform1f(i.lightSource[e].spotCutoff,l);n.uniform1f(i.lightSource[e].spotExponent,0)}if(t.validMembersMask&LIGHTDESC_INNER_CONE_DEG_BIT){}if(t.validMembersMask&LIGHTDESC_CONE_FALLOFF_BIT){}s[e]=t;o[e]=r};this.setShadeModel=function(e){if(this.displayListObj)DL_ADD_METHOD_DESC(this.displayListObj,eRenderContextMethod.SetShadeModel,[e])};this.setStencilFunc=function(e,t,r){if(this.displayListObj)DL_ADD_METHOD_DESC(this.displayListObj,eRenderContextMethod.SetStencilFunc,[e,t,r]);var i;switch(e){case eDepthFunc.Never:i=n.NEVER;break;case eDepthFunc.Less:i=n.LESS;break;case eDepthFunc.LessEqual:i=n.LEQUAL;break;case eDepthFunc.Equal:i=n.EQUAL;break;case eDepthFunc.NotEqual:i=n.NOTEQUAL;break;case eDepthFunc.GreaterEqual:i=n.GEQUAL;break;case eDepthFunc.Greater:i=n.GREATER;break;case eDepthFunc.Always:i=n.ALWAYS;break}n.stencilFunc(i,t,r)};this.setStencilMask=function(e){if(this.displayListObj)DL_ADD_METHOD_DESC(this.displayListObj,eRenderContextMethod.SetStencilMask,[e]);n.stencilMask(e)};this.setStencilOp=function(e,t,r){if(this.displayListObj)DL_ADD_METHOD_DESC(this.displayListObj,eRenderContextMethod.SetStencilOp,[e,t,r]);var i;switch(e){case eStencilOp.Keep:i=n.KEEP;break;case eStencilOp.Replace:i=n.REPLACE;break;case eStencilOp.Increment:i=n.INCR;break;case eStencilOp.Decrement:i=n.DECR;break;case eStencilOp.Invert:i=n.INVERT;break;case eStencilOp.Zero:i=n.ZERO;break}switch(t){case eStencilOp.Keep:gl_ZFail=n.KEEP;break;case eStencilOp.Replace:gl_ZFail=n.REPLACE;break;case eStencilOp.Increment:gl_ZFail=n.INCR;break;case eStencilOp.Decrement:gl_ZFail=n.DECR;break;case eStencilOp.Invert:gl_ZFail=n.INVERT;break;case eStencilOp.Zero:gl_ZFail=n.ZERO;break}switch(r){case eStencilOp.Keep:gl_ZPass=n.KEEP;break;case eStencilOp.Replace:gl_ZPass=n.REPLACE;break;case eStencilOp.Increment:gl_ZPass=n.INCR;break;case eStencilOp.Decrement:gl_ZPass=n.DECR;break;case eStencilOp.Invert:gl_ZPass=n.INVERT;break;case eStencilOp.Zero:gl_ZPass=n.ZERO;break}n.stencilOp(i,gl_ZFail,gl_ZPass)};this.setTextureBlendFactor=function(e){if(this.displayListObj)DL_ADD_METHOD_DESC(this.displayListObj,eRenderContextMethod.SetTextureBlendFactor,[e]);var t=[this.frontMaterial.diffuse.r,this.frontMaterial.diffuse.g,this.frontMaterial.diffuse.b,e];n.uniform4fv(i.frontMaterial.diffuse,new Float32Array(t))};this.setTextureBlendOp=function(e){if(this.displayListObj)DL_ADD_METHOD_DESC(this.displayListObj,eRenderContextMethod.SetTextureBlendOp,[e]);n.uniform1i(i.textureBlendOp,e)};this.setTextureColorMask=function(e,t,r,s){if(this.displayListObj)DL_ADD_METHOD_DESC(this.displayListObj,eRenderContextMethod.SetTextureColorMask,[e,t,r,s]);var o=[e,t,r,s];n.uniform4fv(i.textureColorMask,new Float32Array(o))};this.setViewport=function(e,t,r,i){if(this.displayListObj)DL_ADD_METHOD_DESC(this.displayListObj,eRenderContextMethod.SetViewport,[e,t,r,i]);n.viewport(e,t,r,i)}}function getWebGLContext(e,t){var n=null;try{if(t){n=WebGLDebugUtils.makeDebugContext(e.getContext("experimental-webgl",{stencil:true,antialias:false,preserveDrawingBuffer:true}))}else{n=e.getContext("webgl",{stencil:true,antialias:true,preserveDrawingBuffer:true})||e.getContext("experimental-webgl",{stencil:true,antialias:true,preserveDrawingBuffer:true})}}catch(r){}if(!n){var i=document.createElement("div");i.innerHTML="This demo requires a WebGL-enabled browser.";var s=e.parentNode;s.replaceChild(i,e)}var o=n.getParameter(n.STENCIL_BITS);return n}function getProgram(e,t,n){var r=e.createProgram();if(!r)return null;e.attachShader(r,t);e.attachShader(r,n);e.linkProgram(r);if(!e.getProgramParameter(r,e.LINK_STATUS)){alert(e.getProgramInfoLog(r));return null}e.useProgram(r);r.vertexPositionAttribute=e.getAttribLocation(r,"aVertexPosition");e.enableVertexAttribArray(r.vertexPositionAttribute);r.vertexNormalAttribute=e.getAttribLocation(r,"aVertexNormal");e.enableVertexAttribArray(r.vertexNormalAttribute);r.vertexColorAttribute=e.getAttribLocation(r,"aVertexColor");e.enableVertexAttribArray(r.vertexColorAttribute);r.textureCoordAttribute=new Array(gl_MaxTextureStages);for(var i=0;i<gl_MaxTextureStages;i++){r.textureCoordAttribute[i]=e.getAttribLocation(r,"aTextureCoord"+i);e.enableVertexAttribArray(r.textureCoordAttribute[i])}r.projectionMatrix=e.getUniformLocation(r,"uProjectionMatrix");r.modelViewMatrix=e.getUniformLocation(r,"uModelViewMatrix");r.normalMatrix=e.getUniformLocation(r,"uNormalMatrix");r.globalAmbientLight=e.getUniformLocation(r,"uGlobalAmbientLight");r.lightSource=new Array(gl_MaxLights);for(var i=0;i<gl_MaxLights;i++){r.lightSource[i]=new gl_LightSourceParameters;r.lightSource[i].enabled=e.getUniformLocation(r,"uLightSource_enabled["+i+"]");r.lightSource[i].ambient=e.getUniformLocation(r,"uLightSource_ambient["+i+"]");r.lightSource[i].diffuse=e.getUniformLocation(r,"uLightSource_diffuse["+i+"]");r.lightSource[i].specular=e.getUniformLocation(r,"uLightSource_specular["+i+"]");r.lightSource[i].position=e.getUniformLocation(r,"uLightSource_position["+i+"]");r.lightSource[i].spotDirection=e.getUniformLocation(r,"uLightSource_spotDirection["+i+"]");r.lightSource[i].spotExponent=e.getUniformLocation(r,"uLightSource_spotExponent["+i+"]");r.lightSource[i].spotCutoff=e.getUniformLocation(r,"uLightSource_spotCutoff["+i+"]");r.lightSource[i].constantAttenuation=e.getUniformLocation(r,"uLightSource_constantAttenuation["+i+"]");r.lightSource[i].linearAttenuation=e.getUniformLocation(r,"uLightSource_linearAttenuation["+i+"]");r.lightSource[i].quadraticAttenuation=e.getUniformLocation(r,"uLightSource_quadraticAttenuation["+i+"]");e.uniform1i(r.lightSource[i].enabled,0)}r.frontMaterial=new gl_MaterialParameters;r.frontMaterial.ambient=e.getUniformLocation(r,"uFrontMaterial_ambient");r.frontMaterial.diffuse=e.getUniformLocation(r,"uFrontMaterial_diffuse");r.frontMaterial.specular=e.getUniformLocation(r,"uFrontMaterial_specular");r.frontMaterial.emission=e.getUniformLocation(r,"uFrontMaterial_emission");r.frontMaterial.shininess=e.getUniformLocation(r,"uFrontMaterial_shininess");r.textureSamplerColor=new Array(gl_MaxTextureStages);r.textureSamplerAlpha=new Array(gl_MaxTextureStages);r.textureStageEnabled=new Array(gl_MaxTextureStages);for(var i=0;i<gl_MaxTextureStages;i++){r.textureSamplerColor[i]=e.getUniformLocation(r,"uTextureSamplerColor["+i+"]");r.textureSamplerAlpha[i]=e.getUniformLocation(r,"uTextureSamplerAlpha["+i+"]");r.textureStageEnabled[i]=e.getUniformLocation(r,"uTextureStageEnabled["+i+"]")}r.textureBlendOp=e.getUniformLocation(r,"uTextureBlendOp");r.textureColorMask=e.getUniformLocation(r,"uTextureColorMask");var s=[2,2,2,2];e.uniform4fv(r.textureColorMask,new Float32Array(s));r.lightingEnabled=e.getUniformLocation(r,"uLightingEnabled");r.texturesEnabled=e.getUniformLocation(r,"uTexturesEnabled");e.uniform1i(r.lightingEnabled,1);e.uniform1i(r.texturesEnabled,1);e.uniform1i(r.textureStageEnabled[0],0);e.uniform1i(r.textureStageEnabled[1],0);return r}function webglVB_uvb(e,t){this.buffer=e;this.coords=t}function webglVB(e,t,n,r){VertexBuffer.call(this);this.numVerticesPerPrimitive=r;var e=e;var t=t;var n=n;var i=t.createBuffer();var s=null;var o=null;var u=t.createBuffer();var a=new Array(gl_MaxTextureStages);var f=t.createBuffer();var l=[];var c=0;this.setPrimitiveType=function(n){if(e.displayListObj)DL_ADD_METHOD_DESC(e.displayListObj,eRenderContextMethod.VB_SetPrimitiveType,[this,n]);switch(n){case RC_POINTS:c=t.POINTS;break;case RC_LINES:c=t.LINES;break;case RC_LINE_LOOP:c=t.LINE_LOOP;break;case RC_LINE_STRIP:c=t.LINE_STRIP;break;case RC_TRIANGLES:c=t.TRIANGLES;break;case RC_TRIANGLE_STRIP:c=t.TRIANGLE_STRIP;break;case RC_TRIANGLE_FAN:c=t.TRIANGLE_FAN;break}};this.setVertices=function(n){if(e.displayListObj)DL_ADD_METHOD_DESC(e.displayListObj,eRenderContextMethod.VB_SetVertices,[this,n]);if(n.length){t.bindBuffer(t.ARRAY_BUFFER,i);t.bufferData(t.ARRAY_BUFFER,new Float32Array(n),t.STATIC_DRAW);this.vertexCount=n.length/this.numVerticesPerPrimitive;t.bindBuffer(t.ARRAY_BUFFER,u);t.bufferData(t.ARRAY_BUFFER,new Float32Array(this.vertexCount*4),t.STATIC_DRAW);t.bindBuffer(t.ARRAY_BUFFER,f);t.bufferData(t.ARRAY_BUFFER,new Float32Array(new Array(this.vertexCount*2)),t.STATIC_DRAW)}this.vertices=n};this.setNormals=function(n){if(e.displayListObj)DL_ADD_METHOD_DESC(e.displayListObj,eRenderContextMethod.VB_SetNormals,[this,n]);if(n.length){if(s==null){s=t.createBuffer()}t.bindBuffer(t.ARRAY_BUFFER,s);t.bufferData(t.ARRAY_BUFFER,new Float32Array(n),t.STATIC_DRAW)}this.normals=n};this.setColors=function(n){if(e.displayListObj)DL_ADD_METHOD_DESC(e.displayListObj,eRenderContextMethod.VB_SetColors,[this,n]);if(n.length){if(o==null){o=t.createBuffer()}t.bindBuffer(t.ARRAY_BUFFER,o);t.bufferData(t.ARRAY_BUFFER,new Float32Array(n),t.STATIC_DRAW)}this.colors=n};this.setUVCoords=function(n,r){if(e.displayListObj)DL_ADD_METHOD_DESC(e.displayListObj,eRenderContextMethod.VB_SetUVCoords,[this,n,r]);l[n]=new webglVB_uvb(t.createBuffer(),r.slice());for(var i=1;i<l[n].coords.length;i+=2){l[n].coords[i]=1-l[n].coords[i]}};this.setTextureStage=function(r,i,s,o,u,f){if(e.displayListObj)DL_ADD_METHOD_DESC(e.displayListObj,eRenderContextMethod.VB_SetTextureStage,[this,r,i,s,o,u,f]);switch(r){case 0:t.activeTexture(t.TEXTURE0);break;case 1:t.activeTexture(t.TEXTURE1);break}t.bindTexture(t.TEXTURE_2D,i.texture);t.uniform1i(n.textureSamplerColor[r],r);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,s);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,o);if(l[i]){t.bindBuffer(t.ARRAY_BUFFER,l[i].buffer);t.bufferData(t.ARRAY_BUFFER,new Float32Array(l[i].coords),t.STATIC_DRAW);a[r]=l[i].buffer}};this.draw=function(){if(e.displayListObj)DL_ADD_METHOD_DESC(e.displayListObj,eRenderContextMethod.VB_Draw,[this]);if(this.vertices.length){t.bindBuffer(t.ARRAY_BUFFER,i);t.vertexAttribPointer(n.vertexPositionAttribute,this.numVerticesPerPrimitive,t.FLOAT,false,0,0);if(s){t.bindBuffer(t.ARRAY_BUFFER,s);t.vertexAttribPointer(n.vertexNormalAttribute,3,t.FLOAT,false,0,0)}if(o)t.bindBuffer(t.ARRAY_BUFFER,o);else t.bindBuffer(t.ARRAY_BUFFER,u);t.vertexAttribPointer(n.vertexColorAttribute,4,t.FLOAT,false,0,0);for(var r=0;r<gl_MaxTextureStages;r++){if(a[r])t.bindBuffer(t.ARRAY_BUFFER,a[r]);else t.bindBuffer(t.ARRAY_BUFFER,f);t.vertexAttribPointer(n.textureCoordAttribute[r],2,t.FLOAT,false,0,0)}t.drawArrays(c,0,this.vertexCount)}}}function webglTO(e,t,n){TextureObject.call(this);var e=e;var t=t;var n=n;this.texture=t.createTexture();this.setImage=function(n,r,i){if(e.displayListObj)DL_ADD_METHOD_DESC(e.displayListObj,eRenderContextMethod.TO_SetImage,[this,n,r,i]);var s;switch(r){case ePixelFormat.R8G8B8:case ePixelFormat.B8G8R8:case ePixelFormat.X8G8R8:s=t.RGB;break;case ePixelFormat.R8G8B8A8:case ePixelFormat.B8G8R8A8:case ePixelFormat.A8R8G8B8:case ePixelFormat.A8B8G8R8:case ePixelFormat.X8X8X8X8:s=t.RGBA;break;case ePixelFormat.A8:s=t.ALPHA;break;default:return;break}var o;switch(i){case eImageFormat.RGB:o=t.RGB;break;case eImageFormat.RGBA:o=t.RGBA;break;case eImageFormat.Alpha:o=t.ALPHA;break;case eImageFormat.Luminance:o=t.LUMINANCE;break;case eImageFormat.Luminance_Alpha:o=t.LUMINANCE_ALPHA;break;default:return;break}if(!isPowerOfTwo(n.width)||!isPowerOfTwo(n.height)){var u=document.createElement("canvas");u.width=nextHighestPowerOfTwo(n.width);u.height=nextHighestPowerOfTwo(n.height);var a=u.getContext("2d");a.drawImage(n,0,0,n.width,n.height,0,0,u.width,u.height);n=u}t.bindTexture(t.TEXTURE_2D,this.texture);t.texImage2D(t.TEXTURE_2D,0,s,o,t.UNSIGNED_BYTE,n);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_LINEAR);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR);t.generateMipmap(t.TEXTURE_2D);t.bindTexture(t.TEXTURE_2D,null)};this.setImageData=function(n,r,i,s,o){if(e.displayListObj)DL_ADD_METHOD_DESC(e.displayListObj,eRenderContextMethod.TO_SetImageData,[this,n,r,i,s,o]);var u;switch(i){case ePixelFormat.R8G8B8:case ePixelFormat.B8G8R8:case ePixelFormat.X8G8R8:u=t.RGB;break;case ePixelFormat.R8G8B8A8:case ePixelFormat.B8G8R8A8:case ePixelFormat.A8R8G8B8:case ePixelFormat.A8B8G8R8:case ePixelFormat.X8X8X8X8:u=t.RGBA;break;case ePixelFormat.A8:u=t.ALPHA;break;default:return;break}var a;switch(s){case eImageFormat.RGB:a=t.RGB;break;case eImageFormat.RGBA:a=t.RGBA;break;case eImageFormat.Alpha:a=t.ALPHA;break;case eImageFormat.Luminance:a=t.LUMINANCE;break;case eImageFormat.Luminance_Alpha:a=t.LUMINANCE_ALPHA;break;default:return;break}t.bindTexture(t.TEXTURE_2D,this.texture);t.texImage2D(t.TEXTURE_2D,0,u,n,r,0,a,t.UNSIGNED_BYTE,new Uint8Array(o));t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_LINEAR);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR);t.generateMipmap(t.TEXTURE_2D);t.bindTexture(t.TEXTURE_2D,null)};this.setImageWithCanvas=function(e){var n=e;if(!isPowerOfTwo(e.width)||!isPowerOfTwo(e.height)){n=document.createElement("canvas");n.width=nextHighestPowerOfTwo(e.width);n.height=nextHighestPowerOfTwo(e.height);var r=n.getContext("2d");r.drawImage(e,0,0,e.width,e.height,0,0,n.width,n.height)}t.bindTexture(t.TEXTURE_2D,this.texture);t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR);t.generateMipmap(t.TEXTURE_2D);t.bindTexture(t.TEXTURE_2D,null)};this.setVideo=function(n){if(e.displayListObj)DL_ADD_METHOD_DESC(e.displayListObj,eRenderContextMethod.TO_SetVideo,[this,n]);t.bindTexture(t.TEXTURE_2D,this.texture);switch(getBrowserName()){case"Chrome":case"Firefox":t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n);break;default:t.texImage2D(t.TEXTURE_2D,0,n,false);break}t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST);t.bindTexture(t.TEXTURE_2D,null)}}function isPowerOfTwo(e){return(e&e-1)==0}function nextHighestPowerOfTwo(e){--e;for(var t=1;t<32;t<<=1){e=e|e>>t}return e+1}function getShaders(e,t){var n=null;var r=null;switch(t){case eShaderType.VertexLighting:{n=["#ifdef GL_ES","precision highp float;","#endif","","vec4 gAmbient;","vec4 gDiffuse;","vec4 gSpecular;","","attribute vec3 aVertexPosition;","attribute vec3 aVertexNormal;","attribute vec4 aVertexColor;","attribute vec2 aTextureCoord0;","attribute vec2 aTextureCoord1;","","uniform mat4 uProjectionMatrix;","uniform mat4 uModelViewMatrix;","uniform mat4 uNormalMatrix;","","uniform vec4 uGlobalAmbientLight;","","uniform int uLightSource_enabled["+gl_MaxLights+"];","uniform vec4 uLightSource_ambient["+gl_MaxLights+"];","uniform vec4 uLightSource_diffuse["+gl_MaxLights+"];","uniform vec4 uLightSource_specular["+gl_MaxLights+"];","uniform vec4 uLightSource_position["+gl_MaxLights+"];","uniform vec4 uLightSource_halfVector["+gl_MaxLights+"];","uniform vec4 uLightSource_spotDirection["+gl_MaxLights+"];","uniform float uLightSource_spotExponent["+gl_MaxLights+"];","uniform float uLightSource_spotCutoff["+gl_MaxLights+"];","uniform float uLightSource_spotCosCutoff["+gl_MaxLights+"];","uniform float uLightSource_constantAttenuation["+gl_MaxLights+"];","uniform float uLightSource_linearAttenuation["+gl_MaxLights+"];","uniform float uLightSource_quadraticAttenuation["+gl_MaxLights+"];","","uniform vec4 uFrontMaterial_ambient;","uniform vec4 uFrontMaterial_diffuse;","uniform vec4 uFrontMaterial_specular;","uniform vec4 uFrontMaterial_emission;","uniform float uFrontMaterial_shininess;","","uniform int uLightingEnabled;","","varying vec4 vLightingFactor;","varying vec2 vTextureCoord["+gl_MaxTextureStages+"];","","void directionalLight(vec4 position, vec4 ambient, vec4 diffuse, vec4 specular, vec3 normal, vec3 halfVector)","{","   vec3 lightDir;","   float nDotL;","   float nDotHV;","   float pf;","","   lightDir = normalize(vec3(position));","","   nDotL = max(dot(normal, lightDir), 0.0);","   if (nDotL == 0.0)","   {","       pf = 0.0;","   }","   else","   {","       nDotHV = max(0.0, dot(normal, halfVector));","       pf = pow(nDotHV, uFrontMaterial_shininess);","   }","","   gAmbient  += ambient * uFrontMaterial_ambient;","   gDiffuse  += diffuse * uFrontMaterial_diffuse * nDotL;","   gSpecular += specular * uFrontMaterial_specular * pf;","}","","void pointLight(vec4 position, float constantAttenuation, float linearAttenuation, float quadraticAttenuation,","                vec4 ambient, vec4 diffuse, vec4 specular, vec3 normal, vec3 eye, vec3 vPosition)","{","   float nDotL;","   float nDotHV;","   float pf;","   float attenuation;","   float d;","   vec3  L;","   vec3  halfVector;","","","   L = vec3(position) - vPosition;","","","   d = length(L);","","","   L = normalize(L);","","","   attenuation = 1.0 / (constantAttenuation +","      linearAttenuation * d +","      quadraticAttenuation * d * d);","","   nDotL = max(0.0, dot(normal, L));","   nDotHV = max(0.0, dot(normal, normalize(L + eye)));","","   if (nDotL == 0.0)","   {","       pf = 0.0;","   }","   else","   {","       pf = pow(nDotHV, uFrontMaterial_shininess);","   }","","   gAmbient  += ambient * uFrontMaterial_ambient * attenuation;","   gDiffuse  += diffuse * uFrontMaterial_diffuse * nDotL * attenuation;","   gSpecular += specular * uFrontMaterial_specular * pf * attenuation;","}","","void main()","{","   vec4 vertexPosition;","   vec4 transformedNormal;","   vec4 viewPosition;","   vec4 viewDirection;","","   vertexPosition = uModelViewMatrix * vec4(aVertexPosition, 1);","","   if (uLightingEnabled != 0)","   {","       transformedNormal = normalize(uNormalMatrix * vec4(aVertexNormal, 0));","       viewPosition = uModelViewMatrix * vec4(0, 0, 0, 1);","       viewDirection = normalize(-viewPosition);","       gAmbient = vec4(0, 0, 0, 0);","       gDiffuse = vec4(0, 0, 0, 0);","       gSpecular = vec4(0, 0, 0, 0);","","       for (int i=0; i < "+gl_MaxLights+"; i++)","       {","           if (uLightSource_enabled[i] != 0)","           {","               if (uLightSource_position[i][3] == 0.0)","               {","                   directionalLight(uLightSource_position[i], uLightSource_ambient[i],","                       uLightSource_diffuse[i], uLightSource_specular[i],","                       normalize(vec3(transformedNormal)),","                       normalize(vec3(viewDirection) + vec3(uLightSource_position[i])));","               }","               else if (uLightSource_spotCutoff[i] > 90.0)","               {","                   pointLight(uLightSource_position[i], uLightSource_constantAttenuation[i],","                       uLightSource_linearAttenuation[i], uLightSource_quadraticAttenuation[i],","                       uLightSource_ambient[i], uLightSource_diffuse[i], uLightSource_specular[i],","                       normalize(vec3(transformedNormal)),","                       vec3(viewDirection), vec3(vertexPosition));","               }","               else","               {","               }","           }","       }","","       vLightingFactor  = uGlobalAmbientLight * uFrontMaterial_ambient;","       vLightingFactor += gAmbient + gDiffuse + gSpecular;","       vLightingFactor.a = uFrontMaterial_ambient.a / 3.0 + ","                           uFrontMaterial_diffuse.a / 3.0 + ","                           uFrontMaterial_specular.a / 3.0;","   }","   else","   {","       vLightingFactor = aVertexColor;","   }","","   vTextureCoord[0] = aTextureCoord0;","   vTextureCoord[1] = aTextureCoord1;","   gl_Position = uProjectionMatrix * vertexPosition;","}"].join("\n");r=["#ifdef GL_ES","precision highp float;","#endif","","uniform int uTexturesEnabled;","uniform int uTextureStageEnabled["+gl_MaxTextureStages+"];","uniform sampler2D uTextureSamplerColor["+gl_MaxTextureStages+"];","uniform sampler2D uTextureSamplerAlpha["+gl_MaxTextureStages+"];","uniform int uTextureBlendOp;","uniform vec4 uTextureColorMask;","","varying vec4 vLightingFactor;","varying vec2 vTextureCoord["+gl_MaxTextureStages+"];","","void main()","{","   vec4 fragmentColor;","   vec4 fragmentColor1;","   vec4 fragmentColor2;","   if (uTexturesEnabled == 1 && uTextureStageEnabled[0] == 1 && uTextureStageEnabled[1] == 0)","   {","       fragmentColor = texture2D(uTextureSamplerColor[0], vec2(vTextureCoord[0].s, vTextureCoord[0].t));","       if (fragmentColor.r == uTextureColorMask.r && fragmentColor.g == uTextureColorMask.g && fragmentColor.b == uTextureColorMask.b && fragmentColor.a == uTextureColorMask.a) discard;","       if (uTextureBlendOp == "+RC_MODULATE+")","       {","           if (fragmentColor.a == 0.0) discard;","           else gl_FragColor = fragmentColor * vLightingFactor;","       }","       else if (uTextureBlendOp == "+RC_REPLACE+")","       {","           gl_FragColor = fragmentColor;","       }","       else","       {","           gl_FragColor = vLightingFactor;","       }","   }","   else if (uTexturesEnabled == 1 && uTextureStageEnabled[0] == 1 && uTextureStageEnabled[1] == 1)","   {","       fragmentColor1 = texture2D(uTextureSamplerColor[0], vec2(vTextureCoord[0].s, vTextureCoord[0].t));","       fragmentColor2 = texture2D(uTextureSamplerColor[1], vec2(vTextureCoord[1].s, vTextureCoord[1].t));","       if (uTextureBlendOp == "+RC_MODULATE+")","       {","           fragmentColor1.a = fragmentColor2.a;","           if (fragmentColor1.a == 0.0) discard;","           else gl_FragColor = fragmentColor1 * vLightingFactor;","       }","       else if (uTextureBlendOp == "+RC_REPLACE+")","       {","           gl_FragColor = fragmentColor1 * fragmentColor2;","       }","       else","       {","           gl_FragColor = vLightingFactor;","       }","   }","   else","   {","       gl_FragColor = vLightingFactor;","   }","}"].join("\n")}break;case eShaderType.FragmentLighting:{n=["attribute vec3 aVertexPosition;","attribute vec3 aVertexNormal;","attribute vec4 aVertexColor;","attribute vec2 aTextureCoord0;","attribute vec2 aTextureCoord1;","","uniform mat4 uProjectionMatrix;","uniform mat4 uModelViewMatrix;","uniform mat4 uNormalMatrix;","","varying vec4 vVertexPosition;","varying vec4 vTransformedNormal;","varying vec4 vVertexColor;","varying vec4 vViewPosition;","varying vec4 vViewDirection;","varying vec2 vTextureCoord["+gl_MaxTextureStages+"];","","void main()","{","   vVertexPosition = uModelViewMatrix * vec4(aVertexPosition, 1);","   vTransformedNormal = normalize(uNormalMatrix * vec4(aVertexNormal, 0));","   vVertexColor = aVertexColor;","   vViewPosition = uModelViewMatrix * vec4(0, 0, 0, 1);","   vViewDirection = normalize(-vViewPosition);","   vTextureCoord[0] = aTextureCoord0;","   vTextureCoord[1] = aTextureCoord1;","   gl_Position = uProjectionMatrix * vVertexPosition;","}"].join("\n");r=["#ifdef GL_ES","precision highp float;","#endif","","vec4 gAmbient;","vec4 gDiffuse;","vec4 gSpecular;","","uniform vec4 uGlobalAmbientLight;","","","uniform int uLightSource_enabled["+gl_MaxLights+"];","uniform vec4 uLightSource_ambient["+gl_MaxLights+"];","uniform vec4 uLightSource_diffuse["+gl_MaxLights+"];","uniform vec4 uLightSource_specular["+gl_MaxLights+"];","uniform vec4 uLightSource_position["+gl_MaxLights+"];","uniform vec4 uLightSource_halfVector["+gl_MaxLights+"];","uniform vec4 uLightSource_spotDirection["+gl_MaxLights+"];","uniform float uLightSource_spotExponent["+gl_MaxLights+"];","uniform float uLightSource_spotCutoff["+gl_MaxLights+"];","uniform float uLightSource_spotCosCutoff["+gl_MaxLights+"];","uniform float uLightSource_constantAttenuation["+gl_MaxLights+"];","uniform float uLightSource_linearAttenuation["+gl_MaxLights+"];","uniform float uLightSource_quadraticAttenuation["+gl_MaxLights+"];","","uniform vec4 uFrontMaterial_ambient;","uniform vec4 uFrontMaterial_diffuse;","uniform vec4 uFrontMaterial_specular;","uniform vec4 uFrontMaterial_emission;","uniform float uFrontMaterial_shininess;","","uniform int uLightingEnabled;","uniform int uTexturesEnabled;","uniform int uTextureStageEnabled["+gl_MaxTextureStages+"];","uniform sampler2D uTextureSamplerColor["+gl_MaxTextureStages+"];","uniform sampler2D uTextureSamplerAlpha["+gl_MaxTextureStages+"];","uniform int uTextureBlendOp;","uniform vec4 uTextureColorMask;","","varying vec4 vVertexPosition;","varying vec4 vTransformedNormal;","varying vec4 vVertexColor;","varying vec4 vViewPosition;","varying vec4 vViewDirection;","varying vec2 vTextureCoord["+gl_MaxTextureStages+"];","","void directionalLight(vec4 position, vec4 ambient, vec4 diffuse, vec4 specular, vec3 normal, vec3 halfVector)","{","   vec3 lightDir;","   float nDotL;","   float nDotHV;","   float pf;","","   lightDir = normalize(vec3(position));","","   nDotL = max(dot(normal, lightDir), 0.0);","   if (nDotL == 0.0)","   {","       pf = 0.0;","   }","   else","   {","       nDotHV = max(0.0, dot(normal, halfVector));","       pf = pow(nDotHV, uFrontMaterial_shininess);","   }","","   gAmbient  += ambient * uFrontMaterial_ambient;","   gDiffuse  += diffuse * uFrontMaterial_diffuse * nDotL;","   gSpecular += specular * uFrontMaterial_specular * pf;","}","","void pointLight(vec4 position, float constantAttenuation, float linearAttenuation, float quadraticAttenuation,","                vec4 ambient, vec4 diffuse, vec4 specular, vec3 normal, vec3 eye, vec3 vPosition)","{","   float nDotL;","   float nDotHV;","   float pf;","   float attenuation;","   float d;","   vec3  L;","   vec3  halfVector;","","","   L = vec3(position) - vPosition;","","","   d = length(L);","","","   L = normalize(L);","","","   attenuation = 1.0 / (constantAttenuation +","      linearAttenuation * d +","      quadraticAttenuation * d * d);","","   nDotL = max(0.0, dot(normal, L));","   nDotHV = max(0.0, dot(normal, normalize(L + eye)));","","   if (nDotL == 0.0)","   {","       pf = 0.0;","   }","   else","   {","       pf = pow(nDotHV, uFrontMaterial_shininess);","   }","","   gAmbient  += ambient * uFrontMaterial_ambient * attenuation;","   gDiffuse  += diffuse * uFrontMaterial_diffuse * nDotL * attenuation;","   gSpecular += specular * uFrontMaterial_specular * pf * attenuation;","}","","void main()","{","   vec4 lightingFactor;","   if (uLightingEnabled != 0)","   {","       gAmbient = vec4(0, 0, 0, 0);","       gDiffuse = vec4(0, 0, 0, 0);","       gSpecular = vec4(0, 0, 0, 0);","","       for (int i=0; i < "+gl_MaxLights+"; i++)","       {","           if (uLightSource_enabled[i] != 0)","           {","               if (uLightSource_position[i][3] == 0.0)","               {","                   directionalLight(uLightSource_position[i], uLightSource_ambient[i],","                       uLightSource_diffuse[i], uLightSource_specular[i],","                       normalize(vec3(vTransformedNormal)),","                       normalize(vec3(vViewDirection) + vec3(uLightSource_position[i])));","               }","               else if (uLightSource_spotCutoff[i] > 90.0)","               {","                   pointLight(uLightSource_position[i], uLightSource_constantAttenuation[i],","                       uLightSource_linearAttenuation[i], uLightSource_quadraticAttenuation[i],","                       uLightSource_ambient[i], uLightSource_diffuse[i], uLightSource_specular[i],","                       normalize(vec3(vTransformedNormal)),","                       vec3(vViewDirection), vec3(vVertexPosition));","               }","               else","               {","               }","           }","       }","","       lightingFactor  = uGlobalAmbientLight * uFrontMaterial_ambient;","       lightingFactor += gAmbient + gDiffuse + gSpecular;","       lightingFactor.a  = uFrontMaterial_ambient.a / 3.0 + ","                           uFrontMaterial_diffuse.a / 3.0 + ","                           uFrontMaterial_specular.a / 3.0;","   }","   else","   {","       lightingFactor = vVertexColor;","   }","","   vec4 fragmentColor;","   vec4 fragmentColor1;","   vec4 fragmentColor2;","   if (uTexturesEnabled == 1 && uTextureStageEnabled[0] == 1 && uTextureStageEnabled[1] == 0)","   {","       fragmentColor = texture2D(uTextureSamplerColor[0], vec2(vTextureCoord[0].s, vTextureCoord[0].t));","       if (fragmentColor.r == uTextureColorMask.r && fragmentColor.g == uTextureColorMask.g && fragmentColor.b == uTextureColorMask.b && fragmentColor.a == uTextureColorMask.a) discard;","       if (uTextureBlendOp == "+RC_MODULATE+")","       {","           if (fragmentColor.a == 0.0) discard;","           else gl_FragColor = fragmentColor * lightingFactor;","       }","       else if (uTextureBlendOp == "+RC_REPLACE+")","       {","           gl_FragColor = fragmentColor;","       }","       else","       {","           gl_FragColor = lightingFactor;","       }","   }","   else if (uTexturesEnabled == 1 && uTextureStageEnabled[0] == 1 && uTextureStageEnabled[1] == 1)","   {","       fragmentColor1 = texture2D(uTextureSamplerColor[0], vec2(vTextureCoord[0].s, vTextureCoord[0].t));","       fragmentColor2 = texture2D(uTextureSamplerColor[1], vec2(vTextureCoord[1].s, vTextureCoord[1].t));","       if (uTextureBlendOp == "+RC_MODULATE+")","       {","           fragmentColor1.a = fragmentColor2.a;","           if (fragmentColor1.a == 0.0) discard;","           else gl_FragColor = fragmentColor1 * lightingFactor;","       }","       else if (uTextureBlendOp == "+RC_REPLACE+")","       {","           gl_FragColor = fragmentColor1 * fragmentColor2;","       }","       else","       {","           gl_FragColor = lightingFactor;","       }","   }","   else","   {","       gl_FragColor = lightingFactor;","   }","}"].join("\n")}break;default:return{vertex:null,fragment:null};break}var i=e.createShader(e.VERTEX_SHADER);if(i){e.shaderSource(i,n);e.compileShader(i);if(!e.getShaderParameter(i,e.COMPILE_STATUS)){alert(e.getShaderInfoLog(i))}}var s=e.createShader(e.FRAGMENT_SHADER);if(s){e.shaderSource(s,r);e.compileShader(s);if(!e.getShaderParameter(s,e.COMPILE_STATUS)){alert(e.getShaderInfoLog(s))}}return{vertex:i,fragment:s}}function ContentHandler(){AttributeContainer.call(this);this.className="ContentHandler";this.contentDirectory=new StringAttr("");this.url=new StringAttr("");this.registerAttribute(this.contentDirectory,"contentDirectory");this.registerAttribute(this.url,"url")}function ContentBuilder(){AttributeContainer.call(this);this.className="ContentBuilder";this.factory=null;this.cameras=[];this.lights=[];this.models=[];this.evaluators=[];this.layer=0;this.invertAlpha=new BooleanAttr(false);this.registerAttribute(this.invertAlpha,"invertAlpha")}function BinaryParser(e,t){this.stream=e;this.bigEndian=t;this.readUInt8=function(){return this.decodeInt(8,false)};this.readUInt16=function(){return this.decodeInt(16,false)};this.readUInt32=function(){return this.decodeInt(32,false)};this.readInt8=function(){return this.decodeInt(8,true)};this.readInt16=function(){return this.decodeInt(16,true)};this.readInt32=function(){return this.decodeInt(32,true)};this.readFloat32=function(){return this.decodeFloat32()};var n=0;this.decodeInt=function(e,t){var r=0;var i=e/8;var s=0;for(var o=0;o<i;o++){s=this.bigEndian?this.stream.charCodeAt(n+o):this.stream.charCodeAt(n+(i-o-1));for(var u=7;u>=0;u--){r=r*2+(1<<u&s?1:0)}}if(t){max=Math.pow(2,e);r=r>=max/2?r-max:r}n+=i;return r};this.decodeFloat32=function(){var e=0;var t=4;var r=new Array(t);for(var i=0;i<t;i++){this.bigEndian?r[i]=this.stream.charCodeAt(n+i):r[i]=this.stream.charCodeAt(n+(t-i-1))}var s=r[0]&128;var o=0;for(var u=6;u>=0;u--){o=o*2+(1<<u&r[0]?1:0)}o=o*2+(128&r[1]?1:0);var a=0;for(var f=6;f>=0;f--){a=a*2+(1<<f&r[1]?1:0)}for(var i=2;i<=3;i++){for(var f=7;f>=0;f--){a=a*2+(1<<f&r[i]?1:0)}}var l=o-127;var c=1;var h=1;for(var f=23;f>=0;f--){c=c+(1<<f&a?h:0);h/=2}e=c*Math.pow(2,l)*(s?-1:1);n+=t;return e}}function TextParser(e){this.stream=e;var t=0;this.readCharacter=function(){if(t>=this.stream.length)return null;return this.stream[t++]};this.readToken=function(){var e;var n="";if(t>=this.stream.length)return null;do{e=this.stream[t++]}while(t<=this.stream.length&&isSpace(e));do{n+=e;e=this.stream[t++]}while(t<=this.stream.length&&!isSpace(e));return n.length>0?n:null};this.readLine=function(){var e="";if(t>=this.stream.length)return null;while(t<this.stream.length&&this.stream[t]!="\n"){e+=this.stream[t++]}t++;return e};this.readLineTokens=function(){var e;var t=0;var n="";var r=[];var i=this.readLine();if(i==null)return null;while(t<i.length){do{e=i[t++]}while(t<=i.length&&isSpace(e));do{n+=e;e=i[t++]}while(t<=i.length&&!isSpace(e));r.push(n);n=""}return r}}function XMLParser(e,t,n){this.factory=e;this.registry=t;this.contentDir=n;this.attributeStack=new Stack;this.collectionCountStack=new Stack}function Serializer(){AttributeContainer.call(this);this.className="Serializer";this.pbMixed=null;this.bMixed=false;this.DOM=null;this.RootElement=null;this.elementStack=new Stack;this.format=new StringAttr("xml");this.serializeMinimum=new BooleanAttr(false);this.serializeChildren=new BooleanAttr(false);this.registerAttribute(this.format,"format");this.registerAttribute(this.serializeMinimum,"serializeMinimum");this.registerAttribute(this.serializeChildren,"serializeChildren")}function BytesPerPixel(e){switch(e){case ePixelFormat.R8G8B8:case ePixelFormat.B8G8R8:case ePixelFormat.X8X8X8:return 3;case ePixelFormat.R8G8B8A8:case ePixelFormat.B8G8R8A8:case ePixelFormat.A8R8G8B8:case ePixelFormat.A8B8G8R8:case ePixelFormat.X8X8X8X8:return 4;case ePixelFormat.A8:return 1;default:return 0}}function TPixel(e,t,n,r){var i=e||0;var s=t||0;var o=n||0;var u=r||0}function ScaleImage(e,t,n,r,i,s,o,u,a){if(e!=ePixelFormat.R8G8B8A8){return false}var f=document.createElement("canvas");f.width=t;f.height=n;var l=f.getContext("2d");var c=l.createImageData(t,n);var h=0;for(var p=0;p<n;p++){for(var d=0;d<t;d++){for(var v=0;v<4;v++,h++){c.data[h]=i[h]}}}l.putImageData(c,0,0);var m=document.createElement("canvas");m.width=s;m.height=o;var g=m.getContext("2d");g.drawImage(f,0,0,f.width,f.height,0,0,m.width,m.height);var y=g.getImageData(0,0,s,o);h=0;for(var p=0;p<o;p++){for(var d=0;d<s;d++){for(var v=0;v<4;v++,h++){a[h]=y.data[h]}}}return true}function MediaPlayback(e,t){this.container=e;this.onload=t;this.url=null;this.video=false;this.ready=false;this.alphaPlayback=null;this.frameRetrieved=false;this.htmlImageElement=null;this.imageWidth=0;this.imageHeight=0;this.imagePitch=0;this.imagePixels=null}function MediaPlayback_OnImageLoad(){this.container.onImageLoad()}function TextureArray(e){this.textures=new Array(eTextureType.EnumCount);for(var t=0;t<this.textures.length;t++){if(e){this.textures[t]=e.textures[t].slice()}else{this.textures[t]=[]}}}function StyleMgr(){AttributeContainer.call(this);this.className="StyleMgr"}function GraphMgr(){AttributeContainer.call(this);this.className="GraphMgr";this.renderContext=null;this.renderState=null;this.lightIndex=0;this.material=null;this.dissolve=null;this.balloonTipLabel=null;this.drawTextures=true;this.textureArrayStack=new Stack(new TextureArray);this.projectionTextureArrayStack=new Stack(new TextureArray);this.labelIndex=1;this.balloonTipLabelIndex=1;this.styleMgr=new StyleMgr;this.name=new StringAttr("GraphMgr");this.registerAttribute(this.name,"name")}function Node(){AttributeContainer.call(this);this.className="Node";this.attrType=eAttrType.Node;this.children=[];this.parents=[];this.modificationCount=0;this.thisModified=false;this.childModified=false;this.childrenModified=[];this.name=new StringAttr("");this.enabled=new BooleanAttr(true);this.orphan=new BooleanAttr(false);this.registerAttribute(this.name,"name");this.registerAttribute(this.enabled,"enabled");this.registerAttribute(this.orphan,"orphan")}function SGNode(){Node.call(this);this.className="SGNode";this.graphMgr=null;this.recordDisplayList=false;this.disableDisplayLists=false;this.displayListObj=null;this.enableDisplayList=new BooleanAttr(false);this.autoDisplayList=new BooleanAttr(false);this.updateDisplayList=new PulseAttr;this.registerAttribute(this.enableDisplayList,"enableDisplayList");this.registerAttribute(this.autoDisplayList,"autoDisplayList");this.registerAttribute(this.updateDisplayList,"updateDisplayList")}function SGNode_EnableDisplayListModifiedCB(e,t){t.enableDisplayListModified()}function SGNode_AutoDisplayListModifiedCB(e,t){}function SGNode_UpdateDisplayListModifiedCB(e,t){t.disableDisplayLists=true}function RenderableElement(){SGNode.call(this);this.className="RenderableElement";this.attrType=eAttrType.RenderableElement;this.bbox=new BBoxAttr;this.renderSequenceSlot=new NumberAttr(0);this.hasFocus=new TernaryAttr(0);this.selected=new TernaryAttr(0);this.styles=new StylesAttr;this.stylesMap=new StylesMapAttr;this.renderableElementStyle=new RenderableElementStyleAttr;this.renderedSlot=new NumberAttr(0);this.registerAttribute(this.bbox,"bbox");this.registerAttribute(this.renderSequenceSlot,"renderSequenceSlot");this.registerAttribute(this.hasFocus,"hasFocus");this.registerAttribute(this.selected,"selected");this.registerAttribute(this.styles,"styles");this.registerAttribute(this.stylesMap,"stylesMap");this.registerAttribute(this.renderableElementStyle,"renderableElementStyle");this.registerAttribute(this.renderedSlot,"renderedSlot")}function ParentableMotionElement(){RenderableElement.call(this);this.className="ParentableMotionElement";this.attrType=eAttrType.ParentableMotionElement;this.translationMatrix=new Matrix4x4;this.rotationQuat=new Quaternion;this.rotationMatrix=new Matrix4x4;this.scaleMatrix=new Matrix4x4;this.pivotMatrix=new Matrix4x4;this.sectorTranslationMatrix=new Matrix4x4;this.stackMatrix=new Matrix4x4;this.transformSimple=new Matrix4x4;this.transformCompound=new Matrix4x4;this.sectorTransformSimple=new Matrix4x4;this.sectorTransformCompound=new Matrix4x4;this.updatePosition=false;this.updateScale=false;this.updatePivot=false;this.updateSectorPosition=false;this.updateInheritance=false;this.inheritsPosition=true;this.inheritsRotation=true;this.inheritsScale=true;this.inheritsPivot=true;this.nonZeroVelocity=false;this.motionParent=null;this.position=new Vector3DAttr(0,0,0);this.rotation=new Vector3DAttr(0,0,0);this.scale=new Vector3DAttr(1,1,1);this.pivot=new Vector3DAttr(0,0,0);this.center=new Vector3DAttr(0,0,0);this.worldCenter=new Vector3DAttr(0,0,0);this.worldPosition=new Vector3DAttr(0,0,0);this.worldRotation=new Vector3DAttr(0,0,0);this.worldScale=new Vector3DAttr(1,1,1);this.screenPosition=new Vector3DAttr(0,0,0);this.sectorOrigin=new Vector3DAttr(0,0,0);this.sectorPosition=new Vector3DAttr(0,0,0);this.sectorWorldCenter=new Vector3DAttr(0,0,0);this.sectorWorldPosition=new Vector3DAttr(0,0,0);this.panVelocity=new Vector3DAttr(0,0,0);this.linearVelocity=new Vector3DAttr(0,0,0);this.linearVelocity_affectPosition_Y=new BooleanAttr(true);this.angularVelocity=new Vector3DAttr(0,0,0);this.scalarVelocity=new Vector3DAttr(0,0,0);this.worldTransform=new Matrix4x4Attr(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);this.sectorWorldTransform=new Matrix4x4Attr(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);this.parent=new StringAttr("");this.inheritPosition_X=new BooleanAttr(true);this.inheritPosition_Y=new BooleanAttr(true);this.inheritPosition_Z=new BooleanAttr(true);this.inheritRotation_X=new BooleanAttr(true);this.inheritRotation_Y=new BooleanAttr(true);this.inheritRotation_Z=new BooleanAttr(true);this.inheritScale_X=new BooleanAttr(true);this.inheritScale_Y=new BooleanAttr(true);this.inheritScale_Z=new BooleanAttr(true);this.inheritPivot_X=new BooleanAttr(true);this.inheritPivot_Y=new BooleanAttr(true);this.inheritPivot_Z=new BooleanAttr(true);this.transformModified=new PulseAttr;this.position.addModifiedCB(ParentableMotionElement_PositionModifiedCB,this);this.rotation.addModifiedCB(ParentableMotionElement_RotationModifiedCB,this);this.scale.addModifiedCB(ParentableMotionElement_ScaleModifiedCB,this);this.pivot.addModifiedCB(ParentableMotionElement_PivotModifiedCB,this);this.sectorOrigin.addModifiedCB(ParentableMotionElement_SectorOriginModifiedCB,this);this.sectorPosition.addModifiedCB(ParentableMotionElement_SectorPositionModifiedCB,this);this.parent.addModifiedCB(ParentableMotionElement_ParentModifiedCB,this);this.inheritPosition_X.addModifiedCB(ParentableMotionElement_InheritanceModifiedCB,this);this.inheritPosition_Y.addModifiedCB(ParentableMotionElement_InheritanceModifiedCB,this);this.inheritPosition_Z.addModifiedCB(ParentableMotionElement_InheritanceModifiedCB,this);this.inheritRotation_X.addModifiedCB(ParentableMotionElement_InheritanceModifiedCB,this);this.inheritRotation_Y.addModifiedCB(ParentableMotionElement_InheritanceModifiedCB,this);this.inheritRotation_Z.addModifiedCB(ParentableMotionElement_InheritanceModifiedCB,this);this.inheritScale_X.addModifiedCB(ParentableMotionElement_InheritanceModifiedCB,this);this.inheritScale_Y.addModifiedCB(ParentableMotionElement_InheritanceModifiedCB,this);this.inheritScale_Z.addModifiedCB(ParentableMotionElement_InheritanceModifiedCB,this);this.inheritPivot_X.addModifiedCB(ParentableMotionElement_InheritanceModifiedCB,this);this.inheritPivot_Y.addModifiedCB(ParentableMotionElement_InheritanceModifiedCB,this);this.inheritPivot_Z.addModifiedCB(ParentableMotionElement_InheritanceModifiedCB,this);this.panVelocity.addModifiedCB(ParentableMotionElement_VelocityModifiedCB,this);this.linearVelocity.addModifiedCB(ParentableMotionElement_VelocityModifiedCB,this);this.angularVelocity.addModifiedCB(ParentableMotionElement_VelocityModifiedCB,this);this.scalarVelocity.addModifiedCB(ParentableMotionElement_VelocityModifiedCB,this);this.registerAttribute(this.position,"position");this.registerAttribute(this.rotation,"rotation");this.registerAttribute(this.scale,"scale");this.registerAttribute(this.pivot,"pivot");this.registerAttribute(this.center,"center");this.registerAttribute(this.worldCenter,"worldCenter");this.registerAttribute(this.worldPosition,"worldPosition");this.registerAttribute(this.worldRotation,"worldRotation");this.registerAttribute(this.worldScale,"worldScale");this.registerAttribute(this.screenPosition,"screenPosition");this.registerAttribute(this.sectorOrigin,"sectorOrigin");this.registerAttribute(this.sectorPosition,"sectorPosition");this.registerAttribute(this.sectorWorldCenter,"sectorWorldCenter");this.registerAttribute(this.sectorWorldPosition,"sectorWorldPosition");this.registerAttribute(this.worldTransform,"worldTransform");this.registerAttribute(this.sectorWorldTransform,"sectorWorldTransform");this.registerAttribute(this.panVelocity,"panVelocity");this.registerAttribute(this.linearVelocity,"linearVelocity");this.registerAttribute(this.linearVelocity_affectPosition_Y,"linearVelocity_affectPosition_Y");this.registerAttribute(this.angularVelocity,"angularVelocity");this.registerAttribute(this.scalarVelocity,"scalarVelocity");this.registerAttribute(this.parent,"parent");this.registerAttribute(this.inheritPosition_X,"inheritPosition_X");this.registerAttribute(this.inheritPosition_Y,"inheritPosition_Y");this.registerAttribute(this.inheritPosition_Z,"inheritPosition_Z");this.registerAttribute(this.inheritRotation_X,"inheritRotation_X");this.registerAttribute(this.inheritRotation_Y,"inheritRotation_Y");this.registerAttribute(this.inheritRotation_Z,"inheritRotation_Z");this.registerAttribute(this.inheritScale_X,"inheritScale_X");this.registerAttribute(this.inheritScale_Y,"inheritScale_Y");this.registerAttribute(this.inheritScale_Z,"inheritScale_Z");this.registerAttribute(this.inheritPivot_X,"inheritPivot_X");this.registerAttribute(this.inheritPivot_X,"inheritPivot_Y");this.registerAttribute(this.inheritPivot_X,"inheritPivot_Z");this.registerAttribute(this.transformModified,"transformModified")}function ParentableMotionElement_PositionModifiedCB(e,t){t.updatePosition=true;t.synchronizeSectorPosition();t.incrementModificationCount()}function ParentableMotionElement_RotationModifiedCB(e,t){t.updateRotation=true;t.incrementModificationCount()}function ParentableMotionElement_ScaleModifiedCB(e,t){t.updateScale=true;t.incrementModificationCount()}function ParentableMotionElement_PivotModifiedCB(e,t){t.updatePivot=true;t.incrementModificationCount()}function ParentableMotionElement_SectorOriginModifiedCB(e,t){t.synchronizeSectorPosition();t.incrementModificationCount()}function ParentableMotionElement_SectorPositionModifiedCB(e,t){t.updateSectorPosition=true;t.synchronizePosition();t.incrementModificationCount()}function ParentableMotionElement_ParentModifiedCB(e,t){t.setMotionParent(t.registry.find(e.getValueDirect().join("")))}function ParentableMotionElement_VelocityModifiedCB(e,t){t.velocityModified();t.incrementModificationCount()}function ParentableMotionElement_InheritanceModifiedCB(e,t){t.updateInheritance=true;t.incrementModificationCount()}function DirectiveParams(){this.directive=null;this.path=null;this.pathIndex=0;this.currentNodePath=new Stack;this.userData=null}function Directive(){AttributeContainer.call(this);this.className="Directive";this.attrType=eAttrType.Directive;this.name=new StringAttr("");this.enabled=new BooleanAttr(true);this.rootNode=new ReferenceAttr(null);this.registerAttribute(this.name,"name");this.registerAttribute(this.enabled,"enabled");this.registerAttribute(this.rootNode,"rootNode")}function SGDirective(){Directive.call(this);this.className="SGDirective";this.graphMgr=null}function UpdateParams(){DirectiveParams.call(this);this.pass=0;this.timeIncrement=0;this.visited=[];this.nextPass=[];this.displayListObj=null;this.disableDisplayLists=false}function UpdateDirective(){SGDirective.call(this);this.className="UpdateDirective";this.attrType=eAttrType.UpdateDirective;this.name.setValueDirect("UpdateDirective");this.timeIncrement=new NumberAttr(0);this.registerAttribute(this.timeIncrement,"timeIncrement")}function Camera(){ParentableMotionElement.call(this);this.className="Camera";this.attrType=eAttrType.Camera;this.projectionMatrix=new Matrix4x4;this.viewport=new Viewport;this.updateNearDistance=false;this.updateFarDistance=false;this.updateClipPlanes=true;this.near=0;this.far=0;this.nearDistance=new NumberAttr(0);this.farDistance=new NumberAttr(0);this.viewVolume=new ViewVolumeAttr;this.sectorOriginUpdatesEnabled=new BooleanAttr(false);this.nearDistance.addModifiedCB(Camera_NearDistanceModifiedCB,this);this.farDistance.addModifiedCB(Camera_FarDistanceModifiedCB,this);this.registerAttribute(this.nearDistance,"nearDistance");this.registerAttribute(this.farDistance,"farDistance");this.registerAttribute(this.viewVolume,"viewVolume")}function Camera_NearDistanceModifiedCB(e,t){t.updateNearDistance=true;t.incrementModificationCount()}function Camera_FarDistanceModifiedCB(e,t){t.updateFarDistance=true;t.incrementModificationCount()}function OrthographicCamera(){Camera.call(this);this.className="OrthographicCamera";this.attrType=eAttrType.OrthographicCamera;this.updateWidth=false;this.width=new NumberAttr(2);this.width.addModifiedCB(OrthographicCamera_WidthModifiedCB,this);this.registerAttribute(this.width,"width")}function OrthographicCamera_WidthModifiedCB(e,t){t.updateWidth=true;t.incrementModificationCount()}function PerspectiveCamera(){Camera.call(this);this.className="PerspectiveCamera";this.attrType=eAttrType.PerspectiveCamera;this.updateZoom=false;this.fovyRadians=0;this.left=0;this.right=0;this.top=0;this.bottom=0;this.zoom=new NumberAttr(0);this.zoom.addModifiedCB(PerspectiveCamera_ZoomModifiedCB,this);this.registerAttribute(this.zoom,"zoom")}function PerspectiveCamera_ZoomModifiedCB(e,t){t.updateZoom=true;t.incrementModificationCount()}function Light(){ParentableMotionElement.call(this);this.className="Light";this.attrType=eAttrType.Light;this.updateAmbient=true;this.updateDiffuse=true;this.updateSpecular=true;this.updateConstantAttenuation=true;this.updateLinearAttenuation=true;this.updateQuadraticAttenuation=true;this.lightDesc=new LightDesc;this.lightDesc.validMembersMask=0;this.lightIndex=0;this.setLightDesc=false;this.ambient=new ColorAttr(0,0,0,1);this.diffuse=new ColorAttr(1,1,1,1);this.specular=new ColorAttr(1,1,1,1);this.constantAttenuation=new NumberAttr(1);this.linearAttenuation=new NumberAttr(0);this.quadraticAttenuation=new NumberAttr(0);this.shadowCaster=new BooleanAttr(false);this.ambient.addModifiedCB(Light_AmbientModifiedCB,this);this.diffuse.addModifiedCB(Light_DiffuseModifiedCB,this);this.specular.addModifiedCB(Light_SpecularModifiedCB,this);this.constantAttenuation.addModifiedCB(Light_ConstantAttenuationModifiedCB,this);this.linearAttenuation.addModifiedCB(Light_LinearAttenuationModifiedCB,this);this.quadraticAttenuation.addModifiedCB(Light_QuadraticAttenuationModifiedCB,this);this.registerAttribute(this.ambient,"ambient");this.registerAttribute(this.diffuse,"diffuse");this.registerAttribute(this.specular,"specular");this.registerAttribute(this.constantAttenuation,"constantAttenuation");this.registerAttribute(this.linearAttenuation,"linearAttenuation");this.registerAttribute(this.quadraticAttenuation,"quadraticAttenuation");this.registerAttribute(this.shadowCaster,"shadowCaster")}function Light_AmbientModifiedCB(e,t){t.updateAmbient=true;t.incrementModificationCount()}function Light_DiffuseModifiedCB(e,t){t.updateDiffuse=true;t.incrementModificationCount()}function Light_SpecularModifiedCB(e,t){t.updateSpecular=true;t.incrementModificationCount()}function Light_ConstantAttenuationModifiedCB(e,t){t.updateConstantAttenuation=true;t.incrementModificationCount()}function Light_LinearAttenuationModifiedCB(e,t){t.updateLinearAttenuation=true;t.incrementModificationCount()}function Light_QuadraticAttenuationModifiedCB(e,t){t.updateQuadraticAttenuation=true;t.incrementModificationCount()}function DirectionalLight(){Light.call(this);this.className="DirectionalLight";this.attrType=eAttrType.DirectionalLight;this.lightDesc.type="directional"}function PointLight(){Light.call(this);this.className="PointLight";this.attrType=eAttrType.PointLight;this.lightDesc.type="point";this.updateRange=false;this.range=new NumberAttr;this.range.addModifiedCB(PointLight_RangeModifiedCB,this);this.registerAttribute(this.range,"range")}function PointLight_RangeModifiedCB(e,t){t.updateRange=true;t.incrementModificationCount()}function GlobalIllumination(){SGNode.call(this);this.className="GlobalIllumination";this.attrType=eAttrType.GlobalIllumination;this.updateAmbient=true;this.setGlobalIllumination=false;this.ambient=new ColorAttr(0,0,0,1);this.ambient.addModifiedCB(GlobalIllumination_AmbientModifiedCB,this);this.registerAttribute(this.ambient,"ambient")}function GlobalIllumination_AmbientModifiedCB(e,t){t.updateAmbient=true;t.incrementModificationCount()}function Group(){SGNode.call(this);this.className="Group";this.attrType=eAttrType.Group;this.proxyChildAttrs=new BooleanAttr(false);this.proxyChildAttrs.addModifiedCB(Group_ProxyChildAttrsModifiedCB,this);this.registerAttribute(this.proxyChildAttrs,"proxyChildAttrs");this.enableDisplayList.addModifiedCB(Group_EnableDisplayListModifiedCB,this);this.autoDisplayList.setValueDirect(true);this.autoDisplayList.addModifiedCB(Group_AutoDisplayListModifiedCB,this)}function Group_ProxyChildAttrsModifiedCB(e,t){t.proxyChildAttrsModified()}function Group_ProxiedAttrModifiedCB(e,t){t.group.proxiedAttrModified(t.proxiedNodeTypeString,e,t.proxiedAttrName)}function Group_EnableDisplayListModifiedCB(e,t){var n=e.getValueDirect()}function Group_AutoDisplayListModifiedCB(e,t){var n=e.getValueDirect();if(!n&&t){if(t.enableDisplayList.getValueDirect()==true){t.enableDisplayList.setValueDirect(e.getValueDirect())}}}function Group_ChildAutoDisplayListModifiedCB(e,t){t.childAutoDisplayListModified()}function Isolator(){Group.call(this);this.className="Isolator";this.attrType=eAttrType.Isolator;this.updateIsolateTransforms=true;this.updateIsolateLights=true;this.updateIsolateMaterials=true;this.updateIsolateTextures=true;this.updateIsolateFog=true;this.updateIsolateClipPlanes=true;this.isolateTransforms=new BooleanAttr(false);this.isolateLights=new BooleanAttr(false);this.isolateMaterials=new BooleanAttr(false);this.isolateTextures=new BooleanAttr(false);this.isolateDissolves=new BooleanAttr(false);this.isolateGlobalIlluminations=new BooleanAttr(false);this.isolateLightModels=new BooleanAttr(false);this.isolateFog=new BooleanAttr(false);this.isolateClipPlanes=new BooleanAttr(false);this.isolateRenderModes=new BooleanAttr(false);this.isolateTransforms.addModifiedCB(Isolator_IsolateTransformsModifiedCB,this);this.isolateLights.addModifiedCB(Isolator_IsolateLightsModifiedCB,this);this.isolateMaterials.addModifiedCB(Isolator_IsolateMaterialsModifiedCB,this);this.isolateTextures.addModifiedCB(Isolator_IsolateTexturesModifiedCB,this);this.isolateFog.addModifiedCB(Isolator_IsolateFogModifiedCB,this);this.isolateClipPlanes.addModifiedCB(Isolator_IsolateClipPlanesModifiedCB,this);this.registerAttribute(this.isolateTransforms,"isolateTransforms");this.registerAttribute(this.isolateLights,"isolateLights");this.registerAttribute(this.isolateMaterials,"isolateMaterials");this.registerAttribute(this.isolateTextures,"isolateTextures");this.registerAttribute(this.isolateDissolves,"isolateDissolves");this.registerAttribute(this.isolateGlobalIlluminations,"isolateGlobalIlluminations");this.registerAttribute(this.isolateLightModels,"isolateLightModels");this.registerAttribute(this.isolateFog,"isolateFog");this.registerAttribute(this.isolateClipPlanes,"isolateClipPlanes");this.registerAttribute(this.isolateRenderModes,"isolateRenderModes")}function Isolator_IsolateTransformsModifiedCB(e,t){t.updateIsolateTransforms=true;t.incrementModificationCount()}function Isolator_IsolateLightsModifiedCB(e,t){t.updateIsolateLights=true;t.incrementModificationCount()}function Isolator_IsolateMaterialsModifiedCB(e,t){t.updateIsolateMaterials=true;t.incrementModificationCount()}function Isolator_IsolateTexturesModifiedCB(e,t){t.updateIsolateTextures=true;t.incrementModificationCount()}function Isolator_IsolateFogModifiedCB(e,t){t.updateIsolateFog=true;t.incrementModificationCount()}function Isolator_IsolateClipPlanesModifiedCB(e,t){t.updateIsolateClipPlanes=true;t.incrementModificationCount()}function Selector(){Group.call(this);this.className="Selector";this.attrType=eAttrType.Selector;this.selectee=new NumberAttr(0);this.registerAttribute(this.selectee,"selectee")}function Dissolve(){SGNode.call(this);this.className="Dissolve";this.attrType=eAttrType.Dissolve;this.lastDissolve=0;this.dissolve=new NumberAttr(0);this.dissolve.addModifiedCB(Dissolve_DissolveModifiedCB,this);this.registerAttribute(this.dissolve,"dissolve")}function Dissolve_DissolveModifiedCB(e,t){t.incrementModificationCount()}function RenderParams(){DirectiveParams.call(this);this.viewport=new Viewport;this.projMatrix=new Matrix4x4;this.viewMatrix=new Matrix4x4;this.worldMatrix=new Matrix4x4;this.dissolve=0;this.opacity=1;this.distanceSortAgent=null;this.drawTextures=true;this.displayListObj=null;this.disableDisplayLists=false;this.resetDisplayLists=false}function RenderDirective(){SGDirective.call(this);this.className="RenderDirective";this.attrType=eAttrType.RenderDirective;this.name.setValueDirect("RenderDirective");this.backgroundImageSet=false;this.viewport=new ViewportAttr;this.backgroundColor=new ColorAttr(1,1,1,1);this.backgroundImageFilename=new StringAttr("");this.foregroundImageFilename=new StringAttr("");this.foregroundAlphaFilename=new StringAttr("");this.foregroundFadeEnabled=new BooleanAttr(false);this.texturesEnabled=new BooleanAttr(true);this.timeIncrement=new NumberAttr(0);this.highlightType=new NumberAttr(eHighlightType.None);this.viewport.addModifiedCB(RenderDirective_ViewportModifiedCB,this);this.backgroundColor.addModifiedCB(RenderDirective_BackgroundColorModifiedCB,this);this.backgroundImageFilename.addModifiedCB(RenderDirective_BackgroundImageFilenameModifiedCB,this);this.registerAttribute(this.viewport,"viewport");this.registerAttribute(this.backgroundColor,"backgroundColor");this.registerAttribute(this.backgroundImageFilename,"backgroundImageFilename");this.registerAttribute(this.foregroundImageFilename,"foregroundImageFilename");this.registerAttribute(this.foregroundAlphaFilename,"foregroundAlphaFilename");this.registerAttribute(this.foregroundFadeEnabled,"foregroundFadeEnabled");this.registerAttribute(this.texturesEnabled,"texturesEnabled");this.registerAttribute(this.timeIncrement,"timeIncrement");this.registerAttribute(this.highlightType,"highlightType");this.updateDirective=new UpdateDirective;this.timeIncrement.addTarget(this.updateDirective.getAttribute("timeIncrement"));this.resetDisplayLists=false;this.distanceSortAgent=new DistanceSortAgent;this.collideDirective=new CollideDirective;this.highlightDirective=new HighlightDirective;this.highlightType.addTarget(this.highlightDirective.getAttribute("highlightType"));this.backgroundScreen=new Isolator;this.backgroundScreen.isolateTextures.setValueDirect(true);this.backgroundTexture=new MediaTexture;this.backgroundScreen.addChild(this.backgroundTexture);this.backgroundScreenRect=new ScreenRect;this.backgroundScreenRect.setTexture(this.backgroundTexture);this.backgroundScreen.addChild(this.backgroundScreenRect)}function RenderDirective_ViewportModifiedCB(e,t){var n=t.viewport.getValueDirect();var r=t.backgroundImageFilename.getValueDirect().join("");t.graphMgr.renderContext.setBackgroundImage(r,n.width,n.height)}function RenderDirective_BackgroundColorModifiedCB(e,t){t.backgroundColorModified()}function RenderDirective_BackgroundImageFilenameModifiedCB(e,t){var n=t.viewport.getValueDirect();var r=formatPath(t.backgroundImageFilename.getValueDirect().join(""));t.backgroundImageFilename.removeModifiedCB(RenderDirective_BackgroundImageFilenameModifiedCB,t);t.backgroundImageFilename.setValueDirect(r[0]);t.backgroundImageFilename.addModifiedCB(RenderDirective_BackgroundImageFilenameModifiedCB,t);t.backgroundTexture.imageFilename.setValueDirect(r[0]);t.backgroundImageSet=true}function RayPickParams(){DirectiveParams.call(this);this.camera=null;this.currentCamera=null;this.viewport=new Viewport;this.clickPoint=new Vector2D;this.rayOrigin=new Vector3D;this.rayDir=new Vector3D;this.nearDistance=0;this.farDistance=0;this.viewMatrix=new Matrix4x4;this.worldMatrix=new Matrix4x4;this.sectorOrigin=new Vector3D;this.doubleSided=false;this.opacity=0;this.dissolve=0;this.clipPlanes=[]}function RayPickRecord(e,t,n){this.path=e.copy();this.intersectRecord=t;this.camera=n}function RayPickDirective(){SGDirective.call(this);this.className="RayPickDirective";this.attrType=eAttrType.RayPickDirective;this.name.setValueDirect("RayPickDirective");this.picked=[];this.viewport=new ViewportAttr;this.camera=new ReferenceAttr(null);this.clickPoint=new Vector2DAttr;this.registerAttribute(this.viewport,"viewport");this.registerAttribute(this.camera,"camera");this.registerAttribute(this.clickPoint,"clickPoint")}function BBoxParams(){DirectiveParams.call(this);this.viewSpace=false;this.viewMatrix=new Matrix4x4;this.worldMatrix=new Matrix4x4;this.minPoint=new Vector3D;this.maxPoint=new Vector3D;this.minMaxSet=false}function BBoxDirective(){SGDirective.call(this);this.className="BBoxDirective";this.attrType=eAttrType.BBoxDirective;this.min=new Vector3D;this.max=new Vector3D;this.name.setValueDirect("BBoxDirective");this.viewSpace=new BooleanAttr(false);this.viewTransform=new Matrix4x4Attr(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);this.registerAttribute(this.viewSpace,"viewSpace");this.registerAttribute(this.viewTransform,"viewTransform")}function Geometry(){RenderableElement.call(this);this.className="Geometry";this.attrType=eAttrType.Geometry;this.boundingTree=new Octree;this.updateBoundingTree=false;this.selectable=new BooleanAttr(true);this.cullable=new BooleanAttr(true);this.show=new BooleanAttr(true);this.approximationLevels=new NumberAttr(1);this.sortPolygons=new BooleanAttr(false);this.flipPolygons=new BooleanAttr(false);this.shadowCaster=new BooleanAttr(false);this.shadowTarget=new BooleanAttr(true);this.highlight=new BooleanAttr(false);this.selectable.addModifiedCB(Geometry_SelectableModifiedCB,this);this.show.addModifiedCB(Geometry_ShowModifiedCB,this);this.approximationLevels.addModifiedCB(Geometry_ApproximationLevelsModifiedCB,this);this.registerAttribute(this.selectable,"selectable");this.registerAttribute(this.cullable,"cullable");this.registerAttribute(this.show,"show");this.registerAttribute(this.approximationLevels,"approximationLevels");this.registerAttribute(this.sortPolygons,"sortPolygons");this.registerAttribute(this.flipPolygons,"flipPolygons");this.registerAttribute(this.shadowCaster,"shadowCaster");this.registerAttribute(this.shadowTarget,"shadowTarget");this.registerAttribute(this.highlight,"highlight")}function Geometry_SelectableModifiedCB(e,t){}function Geometry_ShowModifiedCB(e,t){t.incrementModificationCount()}function Geometry_ApproximationLevelsModifiedCB(e,t){t.updateBoundingTree=true;t.incrementModificationCount()}function VertexGeometry(){Geometry.call(this);this.className="VertexGeometry";this.attrType=eAttrType.VertexGeometry;this.updateVertices=false;this.updateColors=false;this.updateUVCoords=[];this.uvCoords=[];this.vertexBuffer=null;this.vertices=new NumberArrayAttr;this.colors=new NumberArrayAttr;this.vertices.addModifiedCB(VertexGeometry_VerticesModifiedCB,this);this.colors.addModifiedCB(VertexGeometry_ColorsModifiedCB,this);this.registerAttribute(this.vertices,"vertices");this.registerAttribute(this.colors,"colors")}function VertexGeometry_VerticesModifiedCB(e,t){t.updateVertices=true;t.incrementModificationCount()}function VertexGeometry_ColorsModifiedCB(e,t){t.updateColors=true;t.incrementModificationCount()}function VertexGeometry_UVCoordsModifiedCB(e,t){t.updateUVCoords.push(e);t.incrementModificationCount()}function TriList(){VertexGeometry.call(this);this.className="TriList";this.attrType=eAttrType.TriList;this.primitiveType=RC_TRIANGLES;this.updateNormals=false;this.normals=new NumberArrayAttr;this.vertices.addModifiedCB(TriList_NormalsModifiedCB,this);this.normals.addModifiedCB(TriList_NormalsModifiedCB,this);this.registerAttribute(this.normals,"normals")}function TriList_NormalsModifiedCB(e,t){t.updateNormals=true;t.incrementModificationCount()}function Material(){SGNode.call(this);this.className="Material";this.attrType=eAttrType.Material;this.updateColor=false;this.updateAmbientLevel=false;this.updateDiffuseLevel=false;this.updateSpecularLevel=false;this.updateEmissiveLevel=false;this.updateAmbient=true;this.updateDiffuse=true;this.updateSpecular=true;this.updateEmissive=true;this.updateGlossiness=true;this.updateOpacity=true;this.lastOpacity=0;this.lastDoubleSided=false;this.materialDesc=new MaterialDesc;this.materialDesc.validMembersMask=MATERIALDESC_ALL_BITS;this.color=new ColorAttr(1,1,1,1);this.ambientLevel=new NumberAttr(1);this.diffuseLevel=new NumberAttr(1);this.specularLevel=new NumberAttr(1);this.emissiveLevel=new NumberAttr(0);this.ambient=new ColorAttr(.2,.2,.2,1);this.diffuse=new ColorAttr(.8,.8,.8,1);this.specular=new ColorAttr(0,0,0,1);this.emissive=new ColorAttr(0,0,0,1);this.glossiness=new NumberAttr(0);this.opacity=new NumberAttr(1);this.doubleSided=new BooleanAttr(false);this.color.addModifiedCB(Material_ColorModifiedCB,this);this.ambientLevel.addModifiedCB(Material_AmbientLevelModifiedCB,this);this.diffuseLevel.addModifiedCB(Material_DiffuseLevelModifiedCB,this);this.specularLevel.addModifiedCB(Material_SpecularLevelModifiedCB,this);this.emissiveLevel.addModifiedCB(Material_EmissiveLevelModifiedCB,this);this.ambient.addModifiedCB(Material_AmbientModifiedCB,this);this.diffuse.addModifiedCB(Material_DiffuseModifiedCB,this);this.specular.addModifiedCB(Material_SpecularModifiedCB,this);this.emissive.addModifiedCB(Material_EmissiveModifiedCB,this);this.glossiness.addModifiedCB(Material_GlossinessModifiedCB,this);this.opacity.addModifiedCB(Material_OpacityModifiedCB,this);this.doubleSided.addModifiedCB(Material_DoubleSidedModifiedCB,this);this.registerAttribute(this.color,"color");this.registerAttribute(this.ambientLevel,"ambientLevel");this.registerAttribute(this.diffuseLevel,"diffuseLevel");this.registerAttribute(this.specularLevel,"specularLevel");this.registerAttribute(this.emissiveLevel,"emissiveLevel");this.registerAttribute(this.ambient,"ambient");this.registerAttribute(this.diffuse,"diffuse");this.registerAttribute(this.specular,"specular");this.registerAttribute(this.emissive,"emissive");this.registerAttribute(this.glossiness,"glossiness");this.registerAttribute(this.opacity,"opacity");this.registerAttribute(this.doubleSided,"doubleSided")}function Material_ColorModifiedCB(e,t){t.updateColor=true;t.incrementModificationCount()}function Material_AmbientLevelModifiedCB(e,t){t.updateAmbientLevel=true;t.incrementModificationCount()}function Material_DiffuseLevelModifiedCB(e,t){t.updateDiffuseLevel=true;t.incrementModificationCount()}function Material_SpecularLevelModifiedCB(e,t){t.updateSpecularLevel=true;t.incrementModificationCount()}function Material_EmissiveLevelModifiedCB(e,t){t.updateEmissiveLevel=true;t.incrementModificationCount()}function Material_AmbientModifiedCB(e,t){t.updateAmbient=true;t.incrementModificationCount()}function Material_DiffuseModifiedCB(e,t){t.updateDiffuse=true;t.incrementModificationCount()}function Material_SpecularModifiedCB(e,t){t.updateSpecular=true;t.incrementModificationCount()}function Material_EmissiveModifiedCB(e,t){t.updateEmissive=true;t.incrementModificationCount()}function Material_GlossinessModifiedCB(e,t){t.updateGlosiness=true;t.incrementModificationCount()}function Material_OpacityModifiedCB(e,t){t.updateOpacity=true;t.incrementModificationCount()}function Material_DoubleSidedModifiedCB(e,t){t.incrementModificationCount()}function Surface(){Isolator.call(this);this.className="Surface";this.attrType=eAttrType.Surface;this.color=new ColorAttr(1,1,1,1);this.ambientLevel=new NumberAttr(1);this.diffuseLevel=new NumberAttr(1);this.specularLevel=new NumberAttr(1);this.emissiveLevel=new NumberAttr(0);this.ambient=new ColorAttr(.8,.8,.8,1);this.diffuse=new ColorAttr(.2,.2,.2,1);this.specular=new ColorAttr(0,0,0,1);this.emissive=new ColorAttr(0,0,0,1);this.glossiness=new NumberAttr(0);this.opacity=new NumberAttr(1);this.doubleSided=new BooleanAttr(false);this.texturesEnabled=new BooleanAttr(true);this.colorTexturesPresent=new BooleanAttr(true);this.diffuseTexturesPresent=new BooleanAttr(true);this.luminosityTexturesPresent=new BooleanAttr(true);this.specularityTexturesPresent=new BooleanAttr(true);this.transparencyTexturesPresent=new BooleanAttr(true);this.numColorTextures=new NumberAttr(0);this.numDiffuseTextures=new NumberAttr(0);this.numLuminosityTextures=new NumberAttr(0);this.numSpecularityTextures=new NumberAttr(0);this.numTransparencyTextures=new NumberAttr(0);this.colorTexturesPresent.addModifiedCB(Surface_TexturesPresentModifiedCB,this);this.diffuseTexturesPresent.addModifiedCB(Surface_TexturesPresentModifiedCB,this);this.luminosityTexturesPresent.addModifiedCB(Surface_TexturesPresentModifiedCB,this);this.specularityTexturesPresent.addModifiedCB(Surface_TexturesPresentModifiedCB,this);this.transparencyTexturesPresent.addModifiedCB(Surface_TexturesPresentModifiedCB,this);this.registerAttribute(this.color,"color");this.registerAttribute(this.ambientLevel,"ambientLevel");this.registerAttribute(this.diffuseLevel,"diffuseLevel");this.registerAttribute(this.specularLevel,"specularLevel");this.registerAttribute(this.emissiveLevel,"emissiveLevel");this.registerAttribute(this.ambient,"ambient");this.registerAttribute(this.diffuse,"diffuse");this.registerAttribute(this.specular,"specular");this.registerAttribute(this.emissive,"emissive");this.registerAttribute(this.glossiness,"glossiness");this.registerAttribute(this.opacity,"opacity");this.registerAttribute(this.doubleSided,"doubleSided");this.registerAttribute(this.texturesEnabled,"texturesEnabled");this.registerAttribute(this.colorTexturesPresent,"colorTexturesPresent");this.registerAttribute(this.diffuseTexturesPresent,"diffuseTexturesPresent");this.registerAttribute(this.luminosityTexturesPresent,"luminosityTexturesPresent");this.registerAttribute(this.specularityTexturesPresent,"specularityTexturesPresent");this.registerAttribute(this.transparencyTexturesPresent,"transparencyTexturesPresent");this.registerAttribute(this.numColorTextures,"numColorTextures");this.registerAttribute(this.numDiffuseTextures,"numDiffuseTextures");this.registerAttribute(this.numLuminosityTextures,"numLuminosityTextures");this.registerAttribute(this.numSpecularityTextures,"numSpecularityTextures");this.registerAttribute(this.numTransparencyTextures,"numTransparencyTextures");this.isolateTextures.setValueDirect(true);this.materialNode=new Material;this.materialNode.getAttribute("name").setValueDirect("Material");this.addChild(this.materialNode);this.colorTexturesNode=new Group;this.colorTexturesNode.getAttribute("name").setValueDirect("Color Textures");this.addChild(this.colorTexturesNode);this.diffuseTexturesNode=new Group;this.diffuseTexturesNode.getAttribute("name").setValueDirect("Diffuse Textures");this.addChild(this.diffuseTexturesNode);this.luminosityTexturesNode=new Group;this.luminosityTexturesNode.getAttribute("name").setValueDirect("Luminosity Textures");this.addChild(this.luminosityTexturesNode);this.specularityTexturesNode=new Group;this.specularityTexturesNode.getAttribute("name").setValueDirect("Specularity Textures");this.addChild(this.specularityTexturesNode);this.transparencyTexturesNode=new Group;this.transparencyTexturesNode.getAttribute("name").setValueDirect("Transparency Textures");this.addChild(this.transparencyTexturesNode);this.connectMaterialAttributes(this.materialNode)}function Surface_TexturesPresentModifiedCB(e,t){}function Model(){ParentableMotionElement.call(this);this.className="Model";this.attrType=eAttrType.Model;this.geometry=[];this.geometryIndices=[];this.geometryBBoxesMap=[];this.geometryAttrConnections=[];this.surfaceAttrConnections=[];this.boundingTree=new Octree;this.updateBoundingTree=false;this.bones=[];this.url=new StringAttr("");this.layer=new NumberAttr(0);this.selectable=new BooleanAttr(true);this.moveable=new BooleanAttr(true);this.cullable=new BooleanAttr(true);this.show=new BooleanAttr(true);this.approximationLevels=new NumberAttr(2);this.showApproximationLevel=new NumberAttr(-1);this.sortPolygons=new BooleanAttr(false);this.flipPolygons=new BooleanAttr(false);this.shadowCaster=new BooleanAttr(false);this.shadowTarget=new BooleanAttr(true);this.indexedGeometry=new BooleanAttr(true);this.enableSharing=new BooleanAttr(true);this.vertices=new NumberArrayAttr;this.dissolve=new NumberAttr(0);this.color=new ColorAttr(1,1,1,1);this.ambientLevel=new NumberAttr(1);this.diffuseLevel=new NumberAttr(1);this.specularLevel=new NumberAttr(1);this.emissiveLevel=new NumberAttr(0);this.ambient=new ColorAttr(.8,.8,.8,1);this.diffuse=new ColorAttr(.2,.2,.2,1);this.specular=new ColorAttr(0,0,0,1);this.emissive=new ColorAttr(0,0,0,1);this.glossiness=new NumberAttr(0);this.opacity=new NumberAttr(1);this.textureOpacity=new NumberAttr(1);this.doubleSided=new BooleanAttr(false);this.texturesEnabled=new BooleanAttr(true);this.pivotAboutGeometricCenter=new BooleanAttr(true);this.screenScaleEnabled=new BooleanAttr(false);this.screenScalePixels=new Vector3DAttr(0,0,0);this.detectCollision=new BooleanAttr(false);this.collisionDetected=new BooleanAttr(false);this.collisionList=new AttributeVector;this.obstructionDetected=new BooleanAttr(false);this.obstructionList=new AttributeVector;this.highlight=new BooleanAttr(false);this.highlightColor=new ColorAttr(1,1,0,1);this.highlightWidth=new NumberAttr(5);this.disableOnDissolve=new BooleanAttr(true);this.socketConnectors=new SocketConnectors;this.plugConnectors=new PlugConnectors;this.show.addTarget(this.enabled);this.selectable.addModifiedCB(Model_GeometryAttrModifiedCB,this);this.cullable.addModifiedCB(Model_GeometryAttrModifiedCB,this);this.show.addModifiedCB(Model_GeometryAttrModifiedCB,this);this.approximationLevels.addModifiedCB(Model_GeometryAttrModifiedCB,this);this.sortPolygons.addModifiedCB(Model_GeometryAttrModifiedCB,this);this.sortPolygons.addModifiedCB(Model_SortPolygonsModifiedCB,this);this.flipPolygons.addModifiedCB(Model_GeometryAttrModifiedCB,this);this.shadowCaster.addModifiedCB(Model_GeometryAttrModifiedCB,this);this.shadowTarget.addModifiedCB(Model_GeometryAttrModifiedCB,this);this.renderSequenceSlot.addModifiedCB(Model_GeometryAttrModifiedCB,this);this.renderSequenceSlot.addModifiedCB(Model_RenderSequenceSlotModifiedCB,this);this.dissolve.addModifiedCB(Model_DissolveModifiedCB,this);this.color.addModifiedCB(Model_SurfaceAttrModifiedCB,this);this.ambientLevel.addModifiedCB(Model_SurfaceAttrModifiedCB,this);this.diffuseLevel.addModifiedCB(Model_SurfaceAttrModifiedCB,this);this.specularLevel.addModifiedCB(Model_SurfaceAttrModifiedCB,this);this.emissiveLevel.addModifiedCB(Model_SurfaceAttrModifiedCB,this);this.ambient.addModifiedCB(Model_SurfaceAttrModifiedCB,this);this.diffuse.addModifiedCB(Model_SurfaceAttrModifiedCB,this);this.specular.addModifiedCB(Model_SurfaceAttrModifiedCB,this);this.emissive.addModifiedCB(Model_SurfaceAttrModifiedCB,this);this.glossiness.addModifiedCB(Model_SurfaceAttrModifiedCB,this);this.opacity.addModifiedCB(Model_SurfaceAttrModifiedCB,this);this.opacity.addModifiedCB(Model_OpacityModifiedCB,this);this.textureOpacity.addModifiedCB(Model_TextureOpacityModifiedCB,this);this.doubleSided.addModifiedCB(Model_SurfaceAttrModifiedCB,this);this.texturesEnabled.addModifiedCB(Model_SurfaceAttrModifiedCB,this);this.detectCollision.addModifiedCB(Model_DetectCollisionModifiedCB,this);this.collisionDetected.addModifiedCB(Model_CollisionDetectedModifiedCB,this);this.vertices.addModifiedCB(Model_VerticesModifiedCB,this);this.registerAttribute(this.url,"url");this.registerAttribute(this.layer,"layer");this.registerAttribute(this.selectable,"selectable");this.registerAttribute(this.moveable,"moveable");this.registerAttribute(this.cullable,"cullable");this.registerAttribute(this.show,"show");this.registerAttribute(this.approximationLevels,"approximationLevels");this.registerAttribute(this.showApproximationLevel,"showApproximationLevel");this.registerAttribute(this.sortPolygons,"sortPolygons");this.registerAttribute(this.flipPolygons,"flipPolygons");this.registerAttribute(this.shadowCaster,"shadowCaster");this.registerAttribute(this.shadowTarget,"shadowTarget");this.registerAttribute(this.indexedGeometry,"indexedGeometry");this.registerAttribute(this.enableSharing,"enableSharing");this.registerAttribute(this.vertices,"vertices");this.registerAttribute(this.dissolve,"dissolve");this.registerAttribute(this.color,"color");this.registerAttribute(this.ambientLevel,"ambientLevel");this.registerAttribute(this.diffuseLevel,"diffuseLevel");this.registerAttribute(this.specularLevel,"specularLevel");this.registerAttribute(this.emissiveLevel,"emissiveLevel");this.registerAttribute(this.ambient,"ambient");this.registerAttribute(this.diffuse,"diffuse");this.registerAttribute(this.specular,"specular");this.registerAttribute(this.emissive,"emissive");this.registerAttribute(this.glossiness,"glossiness");this.registerAttribute(this.opacity,"opacity");this.registerAttribute(this.textureOpacity,"textureOpacity");this.registerAttribute(this.doubleSided,"doubleSided");this.registerAttribute(this.texturesEnabled,"texturesEnabled");this.registerAttribute(this.pivotAboutGeometricCenter,"pivotAboutGeometricCenter");this.registerAttribute(this.screenScaleEnabled,"screenScaleEnabled");this.registerAttribute(this.screenScalePixels,"screenScalePixels");this.registerAttribute(this.detectCollision,"detectCollision");this.registerAttribute(this.collisionDetected,"collisionDetected");this.registerAttribute(this.collisionList,"collisionList");this.registerAttribute(this.obstructionDetected,"obstructionDetected");this.registerAttribute(this.obstructionList,"obstructionList");this.registerAttribute(this.highlight,"highlight");this.registerAttribute(this.highlightColor,"highlightColor");this.registerAttribute(this.highlightWidth,"highlightWidth");this.registerAttribute(this.disableOnDissolve,"disableOnDissolve");this.registerAttribute(this.socketConnectors,"socketConnectors");this.registerAttribute(this.plugConnectors,"plugConnectors");this.isolatorNode=new Isolator;this.isolatorNode.getAttribute("name").setValueDirect("Isolator");this.isolatorNode.getAttribute("isolateDissolves").setValueDirect(true);this.addChild(this.isolatorNode);this.dissolveNode=new Dissolve;this.dissolveNode.getAttribute("name").setValueDirect("Dissolve");this.addChild(this.dissolveNode);this.dissolve.addTarget(this.dissolveNode.getAttribute("dissolve"));this.surfacesNode=new Group;this.surfacesNode.getAttribute("name").setValueDirect("Surfaces");this.addChild(this.surfacesNode);this.autoDisplayList.setValueDirect(true);this.autoDisplayList.addModifiedCB(Model_AutoDisplayListModifiedCB,this)}function Model_AutoDisplayListModifiedCB(e,t){t.autoDisplayListModified()}function Model_SortPolygonsModifiedCB(e,t){}function Model_RenderSequenceSlotModifiedCB(e,t){var n=e.getValueDirect();if(n>0){t.autoDisplayList.setValueDirect(false);t.enableDisplayList.setValueDirect(false)}}function Model_DissolveModifiedCB(e,t){var n=e.getValueDirect();if(n>0){t.autoDisplayList.setValueDirect(false);t.enableDisplayList.setValueDirect(false)}}function Model_OpacityModifiedCB(e,t){var n=e.getValueDirect();if(n<1){t.autoDisplayList.setValueDirect(false);t.enableDisplayList.setValueDirect(false)}}function Model_TextureOpacityModifiedCB(e,t){}function Model_Surface_NumTransparencyTexturesModifiedCB(e,t){var n=e.getValueDirect();if(n>0){t.autoDisplayList.setValueDirect(false);t.enableDisplayList.setValueDirect(false)}}function Model_GeometryBBoxModifiedCB(e,t){t.updateGeometryBBox(e.getContainer().getContainer())}function Model_SurfaceAttrModifiedCB(e,t){}function Model_GeometryAttrModifiedCB(e,t){}function Model_DetectCollisionModifiedCB(e,t){var n=e.getValueDirect();if(n){t.autoDisplayList.setValueDirect(false);t.enableDisplayList.setValueDirect(false)}}function Model_CollisionDetectedModifiedCB(e,t){}function Model_VerticesModifiedCB(e,t){}function Texture(){ParentableMotionElement.call(this);this.className="Texture";this.attrType=eAttrType.Texture;this.updateImage=false;this.updateMipmappingEnabled=false;this.setImage=false;this.imageSet=false;this.textureObj=null;this.pitch=0;this.image=new ImageAttr;this.opacity=new NumberAttr(1);this.textureType=new NumberAttr(eTextureType.Color);this.widthWrap=new NumberAttr(eTextureWrap.None);this.heightWrap=new NumberAttr(eTextureWrap.None);this.mipmappingEnabled=new BooleanAttr(false);this.blendOp=new NumberAttr(RC_MODULATE);this.image.setTransient(true);this.image.getAttribute("width").addModifiedCB(Texture_ImageModifiedCB,this);this.image.getAttribute("height").addModifiedCB(Texture_ImageModifiedCB,this);this.image.getAttribute("byteAlignment").addModifiedCB(Texture_ImageModifiedCB,this);this.image.getAttribute("pixelFormat").addModifiedCB(Texture_ImageModifiedCB,this);this.image.getAttribute("pixels").addModifiedCB(Texture_ImagePixelsModifiedCB,this);this.textureType.addModifiedCB(Texture_TextureTypeModifiedCB,this);this.opacity.addModifiedCB(Texture_OpacityModifiedCB,this);this.widthWrap.addModifiedCB(Texture_WrapModifiedCB,this);this.heightWrap.addModifiedCB(Texture_WrapModifiedCB,this);this.mipmappingEnabled.addModifiedCB(Texture_MipmappingEnabledModifiedCB,this);this.registerAttribute(this.image,"image");this.registerAttribute(this.opacity,"opacity");this.registerAttribute(this.textureType,"textureType");this.registerAttribute(this.widthWrap,"widthWrap");this.registerAttribute(this.heightWrap,"heightWrap");this.registerAttribute(this.mipmappingEnabled,"mipmappingEnabled");this.registerAttribute(this.blendOp,"blendOp")}function Texture_ImageModifiedCB(e,t){t.updateImage=true;t.incrementModificationCount()}function Texture_ImagePixelsModifiedCB(e,t){t.updateImage=true;t.incrementModificationCount()}function Texture_OpacityModifiedCB(e,t){t.incrementModificationCount()}function Texture_TextureTypeModifiedCB(e,t){switch(e.getValueDirect()){case eTextureType.Color:op=RC_MODULATE;break;case eTextureType.Diffuse:case eTextureType.Luminosity:case eTextureType.Specularity:op=RC_REPLACE;break;case eTextureType.Transparency:op=RC_MODULATE;break;default:return}t.blendOp.setValueDirect(op);t.incrementModificationCount()}function Texture_WrapModifiedCB(e,t){t.incrementModificationCount()}function Texture_MipmappingEnabledModifiedCB(e,t){t.updateMipmappingEnabled=true;t.incrementModificationCount()}function MediaTexture(){Texture.call(this);this.className="MediaTexture";this.attrType=eAttrType.MediaTexture;this.updateImageFilename=false;this.updateAlphaFilename=false;this.updateNegateImage=false;this.updateNegateAlpha=false;this.imagePlayback=null;this.alphaPlayback=null;this.pixelMap=ePixelMap.Default;this.forceImageUpdate=false;this.imageFilename=new StringAttr("");this.alphaFilename=new StringAttr("");this.negateImage=new BooleanAttr(false);this.negateAlpha=new BooleanAttr(false);this.frame=new NumberAttr(-1);this.frameRetrieved=new NumberAttr(-1);this.imageFilename.addModifiedCB(MediaTexture_ImageFilenameModifiedCB,this);this.alphaFilename.addModifiedCB(MediaTexture_AlphaFilenameModifiedCB,this);this.negateImage.addModifiedCB(MediaTexture_NegateImageModifiedCB,this);this.negateAlpha.addModifiedCB(MediaTexture_NegateAlphaModifiedCB,this);this.registerAttribute(this.imageFilename,"imageFilename");this.registerAttribute(this.alphaFilename,"alphaFilename");this.registerAttribute(this.negateImage,"negateImage");this.registerAttribute(this.negateAlpha,"negateAlpha");this.registerAttribute(this.frame,"frame");this.registerAttribute(this.frameRetrieved,"frameRetrieved")}function MediaTexture_OnImageLoad(){this.container.onImageLoad()}function MediaTexture_OnAlphaLoad(){this.container.onAlphaLoad()}function MediaTexture_OnVideoLoad(){alert("MediaTexture_OnVideoLoad");this.container.onVideoLoad()}function MediaTexture_ImageFilenameModifiedCB(e,t){t.updateImageFilename=true;t.incrementModificationCount()}function MediaTexture_AlphaFilenameModifiedCB(e,t){t.updateAlphaFilename=true;t.incrementModificationCount()}function MediaTexture_NegateImageModifiedCB(e,t){t.updateNegateImage=true;t.incrementModificationCount()}function MediaTexture_NegateAlphaModifiedCB(e,t){t.updateNegateAlpha=true;t.incrementModificationCount()}function Evaluator(){Node.call(this);this.className="Evaluator";this.attrType=eAttrType.Evaluator;this.expired=new BooleanAttr(false);this.registerAttribute(this.expired,"expired");this.registerAttribute(this.enabled,"evaluate")}function SceneInspector(){Evaluator.call(this);this.className="SceneInspector";this.attrType=eAttrType.SceneInspector;this.camera=null;this.viewPosition=new Vector3DAttr(0,0,0);this.viewRotation=new Vector3DAttr(0,0,0);this.translationDelta=new Vector3DAttr(0,0,0);this.panDelta=new Vector3DAttr(0,0,0);this.trackDelta=new Vector3DAttr(0,0,0);this.rotationDelta=new Vector3DAttr(0,0,0);this.viewRelativeXAxisRotation=new BooleanAttr(false);this.viewRelativeYAxisRotation=new BooleanAttr(false);this.viewRelativeZAxisRotation=new BooleanAttr(false);this.pivotDistance=new NumberAttr(0);this.pivotPointWorld=new Vector3DAttr(0,0,0);this.resultPosition=new Vector3DAttr(0,0,0);this.resultRotation=new Vector3DAttr(0,0,0);this.upVector=new Vector3DAttr(0,0,0);this.rightVector=new Vector3DAttr(0,0,0);this.forwardVector=new Vector3DAttr(0,0,0);this.affectPosition_X=new BooleanAttr(true);this.affectPosition_Y=new BooleanAttr(true);this.affectPosition_Z=new BooleanAttr(true);this.affectRotation_X=new BooleanAttr(true);this.affectRotation_Y=new BooleanAttr(true);this.affectRotation_Z=new BooleanAttr(true);this.registerAttribute(this.viewPosition,"viewPosition");this.registerAttribute(this.viewRotation,"viewRotation");this.registerAttribute(this.translationDelta,"translationDelta");this.registerAttribute(this.panDelta,"panDelta");this.registerAttribute(this.trackDelta,"trackDelta");this.registerAttribute(this.rotationDelta,"rotationDelta");this.registerAttribute(this.viewRelativeXAxisRotation,"viewRelativeXAxisRotation");this.registerAttribute(this.viewRelativeYAxisRotation,"viewRelativeYAxisRotation");this.registerAttribute(this.viewRelativeZAxisRotation,"viewRelativeZAxisRotation");this.registerAttribute(this.pivotDistance,"pivotDistance");this.registerAttribute(this.pivotPointWorld,"pivotPointWorld");this.registerAttribute(this.resultPosition,"resultPosition");this.registerAttribute(this.resultRotation,"resultRotation");this.registerAttribute(this.upVector,"upVector");this.registerAttribute(this.rightVector,"rightVector");this.registerAttribute(this.forwardVector,"forwardVector");this.registerAttribute(this.affectPosition_X,"affectPosition_X");this.registerAttribute(this.affectPosition_Y,"affectPosition_Y");this.registerAttribute(this.affectPosition_Z,"affectPosition_Z");this.registerAttribute(this.affectRotation_X,"affectRotation_X");this.registerAttribute(this.affectRotation_Y,"affectRotation_Y");this.registerAttribute(this.affectRotation_Z,"affectRotation_Z")}function ArcballInspector(){Evaluator.call(this);this.className="ArcballInspector";this.attrType=eAttrType.ArcballInspector;this.sphereCenter=new Vector3DAttr(0,0,0);this.sphereRadius=new NumberAttr(0);this.mouseDown=new Vector2DAttr(0,0);this.mouseNow=new Vector2DAttr(0,0);this.quatAtMouseDown=new QuaternionAttr(1,0,0,0);this.viewport=new ViewportAttr(0,0,0,0);this.worldTransform=new Matrix4x4Attr;this.viewTransform=new Matrix4x4Attr;this.constrainToAxis=new BooleanAttr(false);this.constraintAxis=new Vector3DAttr(0,0,0);this.resultQuat=new QuaternionAttr(1,0,0,0);this.registerAttribute(this.sphereCenter,"sphereCenter");this.registerAttribute(this.sphereRadius,"sphereRadius");this.registerAttribute(this.mouseDown,"mouseDown");this.registerAttribute(this.mouseNow,"mouseNow");this.registerAttribute(this.quatAtMouseDown,"quatAtMouseDown");this.registerAttribute(this.viewport,"viewport");this.registerAttribute(this.worldTransform,"worldTransform");this.registerAttribute(this.viewTransform,"viewTransform");this.registerAttribute(this.constrainToAxis,"constrainToAxis");this.registerAttribute(this.constraintAxis,"constraintAxis");this.registerAttribute(this.resultQuat,"resultQuat")}function ArcballInspector_ViewTransformModifiedCB(e,t){}function EndState(){this.initialized=false;this.startKeyIts=[];this.endKeyIts=[];this.startTime=-FLT_MAX;this.endTime=FLT_MAX}function KeyframeInterpolator(){Evaluator.call(this);this.className="KeyframeInterpolator";this.attrType=eAttrType.KeyframeInterpolator;this.lastTime=0;this.evaluated=false;this.endState=new EndState;this.time=new NumberAttr(0);this.channels=new AttributeVector;this.startKeys=new AttributeVector;this.endKeys=new AttributeVector;this.preBehaviors=new AttributeVector;this.postBehaviors=new AttributeVector;this.resultValues=new AttributeVector;this.time.addModifiedCB(KeyframeInterpolator_TimeModifiedCB,this);this.registerAttribute(this.time,"time");this.registerAttribute(this.channels,"channels");this.registerAttribute(this.startKeys,"startKeys");this.registerAttribute(this.endKeys,"endKeys");this.registerAttribute(this.preBehaviors,"preBehaviors");this.registerAttribute(this.postBehaviors,"postBehaviors");this.registerAttribute(this.resultValues,"resultValues")}function KeyframeInterpolator_TimeModifiedCB(e,t){t.timeModified()}function KeyframeInterpolator_EndStateModifiedCB(e,t){t.updateEndState()}function BBoxLocator(){Evaluator.call(this);this.className="BBoxLocator";this.attrType=eAttrType.BBoxLocator;this.viewPosition=new Vector3DAttr(0,0,0);this.viewTransform=new Matrix4x4Attr(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);this.viewVolume=new ViewVolumeAttr;this.viewport=new ViewportAttr(0,0,0,0);this.nearDistance=new NumberAttr(0);this.bbox=new BBoxAttr;this.bboxView=new BBoxAttr;this.closeness=new NumberAttr(.5);this.resultPosition=new Vector3DAttr(0,0,0);this.resultWidth=new NumberAttr(0);this.resultFarDistance=new NumberAttr(0);this.resultPivotDistance=new NumberAttr(0);this.registerAttribute(this.viewPosition,"viewPosition");this.registerAttribute(this.viewTransform,"viewTransform");this.registerAttribute(this.viewVolume,"viewVolume");this.registerAttribute(this.viewport,"viewport");this.registerAttribute(this.nearDistance,"nearDistance");this.registerAttribute(this.bbox,"bbox");this.registerAttribute(this.bboxView,"bboxView");this.registerAttribute(this.closeness,"closeness");this.registerAttribute(this.resultPosition,"resultPosition");this.registerAttribute(this.resultWidth,"resultWidth");this.registerAttribute(this.resultFarDistance,"resultFarDistance");this.registerAttribute(this.resultPivotDistance,"resultPivotDistance")}function worldUnitsPerPixelPersp(e,t,n){var r=2*Math.atan2(1,t);var i=2*Math.atan(e.width/e.height*Math.tan(r/2));var s=Math.tan(i/2)*n*2;var o=Math.tan(r/2)*n*2;var u=s/e.width;var a=o/e.height;return{x:u,y:a}}function worldUnitsPerPixelOrtho(e,t){var n=t*(e.height/e.width);var r=t/e.width;var i=n/e.height;return{x:r,y:i}}function toScreenSpace(e,t,n,r){var i=t.transformw(e.x,e.y,e.z,1);i=n.transformw(i.x,i.y,i.z,i.w);if(i.w==0){return{x:-Infinity,y:-Infinity,z:-Infinity}}i.x/=i.w;i.y/=i.w;i.x=r.x+r.width-(-i.x+1)*r.width/2;i.y=r.y+r.height-(i.y+1)*r.height/2;i.z=0;return{x:i.x,y:i.y,z:i.z}}function RasterComponent(){ParentableMotionElement.call(this);this.className="RasterComponent";this.attrType=eAttrType.RasterComponent;this.rcEventListener=null;this.opacity=new NumberAttr(1);this.anchor=new Vector2DAttr(0,0);this.origin=new StringAttr("bottomLeft");this.show=new BooleanAttr(true);this.selectable=new BooleanAttr(true);this.cullable=new BooleanAttr(true);this.clampToViewport=new BooleanAttr(false);this.rasterPosition=new Vector3DAttr;this.inspectionOffset=new Vector3DAttr;this.componentRect=new RectAttr;this.screenRect=new RectAttr;this.stylesMap.size.addModifiedCB(RasterComponent_StylesMapSizeModifiedCB,this);this.show.addModifiedCB(RasterComponent_ShowModifiedCB,this);this.registerAttribute(this.opacity,"opacity");this.registerAttribute(this.anchor,"anchor");this.registerAttribute(this.origin,"origin");this.registerAttribute(this.show,"show");this.registerAttribute(this.selectable,"selectable");this.registerAttribute(this.cullable,"cullable");this.registerAttribute(this.rasterPosition,"rasterPosition");this.registerAttribute(this.inspectionOffset,"inspectionOffset");this.registerAttribute(this.clampToViewport,"clampToViewport");this.registerAttribute(this.componentRect,"componentRect");this.registerAttribute(this.screenRect,"screenRect");this.renderSequenceSlot.setValueDirect(65535)}function RasterComponent_StylesMapSizeModifiedCB(e,t){t.stylesMapSizeModified()}function RasterComponent_StylesMapElementEventModifiedCB(e,t){t.stylesMapElementEventModified(e.getValueDirect().join(""))}function RasterComponent_ShowModifiedCB(e,t){t.showModified()}function Label(){RasterComponent.call(this);this.className="Label";this.attrType=eAttrType.Label;this.iconRect=new Rect(0,0,0,0);this.labelRect=new Rect(0,0,0,0);this.text=new StringAttr("");this.description=new StringAttr("");this.depthShadingEnabled=new BooleanAttr(true);this.labelStyle=new LabelStyleAttr;this.iconStyle=new IconStyleAttr;this.balloonTipLabelStyle=new BalloonTipLabelStyleAttr;this.text.addModifiedCB(Label_TextModifiedCB,this);this.description.addModifiedCB(Label_DescriptionModifiedCB,this);this.labelStyle.backgroundColor.addModifiedCB(Label_LabelStyleBackgroundColorModifiedCB,this);this.labelStyle.backgroundOpacity.addModifiedCB(Label_LabelStyleBackgroundOpacityModifiedCB,this);this.labelStyle.fontStyle.borderColor.addModifiedCB(Label_LabelStyleFontBorderModifiedCB,this);this.labelStyle.fontStyle.borderWidth.addModifiedCB(Label_LabelStyleFontBorderModifiedCB,this);this.labelStyle.fontStyle.color.addModifiedCB(Label_LabelStyleFontStyleColorModifiedCB,this);this.labelStyle.fontStyle.font.addModifiedCB(Label_LabelStyleFontStyleFontModifiedCB,this);this.labelStyle.fontStyle.opacity.addModifiedCB(Label_LabelStyleFontStyleOpacityModifiedCB,this);this.labelStyle.fontStyle.size.addModifiedCB(Label_LabelStyleFontStyleSizeModifiedCB,this);this.labelStyle.fontStyle.style.addModifiedCB(Label_LabelStyleFontStyleStyleModifiedCB,this);this.labelStyle.format.addModifiedCB(Label_LabelStyleFormatModifiedCB,this);this.labelStyle.padding.addModifiedCB(Label_LabelStylePaddingModifiedCB,this);this.iconStyle.url.addModifiedCB(Label_IconStyleUrlModifiedCB,this);this.balloonTipLabelStyle.addModifiedCB(Label_BalloonTipLabelStyleModifiedCB,this);this.registerAttribute(this.text,"text");this.registerAttribute(this.description,"description");this.registerAttribute(this.depthShadingEnabled,"depthShadingEnabled");this.registerAttribute(this.labelStyle,"labelStyle");this.registerAttribute(this.iconStyle,"iconStyle");this.registerAttribute(this.balloonTipLabelStyle,"balloonTipLabelStyle");this.styles.registerStyle(this.iconStyle,"iconStyle");this.styles.registerStyle(this.labelStyle,"labelStyle");this.styles.registerStyle(this.balloonTipLabelStyle,"balloonTipLabelStyle")}function CreateHTMLLabel(e,t,n){var r=null;var i=null;var s=null;var o=null;if(bridgeworks.rasterComponents){r=document.createElement("div");if(r){r.setAttribute("id",e);i=document.createElement("span");if(i){i.setAttribute("id",t);i.setAttribute("class","labelText");i.style.visibility="hidden";i.style.position="absolute";i.style.zIndex=3;i.onmousedown=function(){};i.onmouseup=function(){};i.onmousemove=function(){};i.onselectstart=new Function("return false");r.appendChild(i)}o=document.createElement("div");if(o){o.setAttribute("id",n);o.style.position="absolute";o.style.zIndex=3;s=document.createElement("img");if(s){s.setAttribute("class","labelIcon");s.style.visibility="hidden";s.src="BwContent/images/1x1.png";s.onmouseup=function(){};s.onmousemove=function(){};s.onmousedown=function(){return false};o.appendChild(s)}r.appendChild(o)}bridgeworks.rasterComponents.appendChild(r)}}return{div:r,label:i,iconDiv:o,iconImg:s}}function Label_TextModifiedCB(e,t){t.htmlLabel.innerHTML=e.getValueDirect().join("")}function Label_DescriptionModifiedCB(e,t){var n=e.getValueDirect().join("");if(n.length>0){var r=t.balloonTipLabelStyle.htmlLabelStyle.width.getValueDirect();var i=t.balloonTipLabelStyle.htmlLabelStyle.height.getValueDirect();if(r==0||i==0){var s=t.registry.find("ViewportMgr");if(r==0)r=s.getAttribute("width").getValueDirect()*.5;if(i==0)i=s.getAttribute("height").getValueDirect()*.5}var o="#"+t.iconId;n="<div class='gmap' style='"+"width:"+(r+12)+"px;"+"height:12px;'>"+"<a href='javascript:void($(\""+o+"\").btOff());'><img src='libs/jquery/bt/close.gif' alt='close' width='12' height='12' class='gmap-close' /></a> "+"</div>"+"<div style='"+"width:"+(r+12)+"px;"+"height:"+i+"px;"+"overflow:auto;'>"+n+"</div>";var u=t.balloonTipLabelStyle.bgColor.getValueDirect();var a="rgba("+u.r*255+","+u.g*255+","+u.b*255+","+u.a*255+")";$(o).bt(n,{trigger:"click",width:r+12+"px",height:i+12+"px",shrinkToFit:r==0&&i==0?true:false,centerPointX:.9,spikeLength:t.balloonTipLabelStyle.balloonOffset.getValueDirect(),spikeGirth:30,padding:15,cornerRadius:25,fill:a,strokeStyle:"#ABABAB",strokeWidth:1,shadow:true,shadowOffsetX:3,shadowOffsetY:3,shadowBlur:8,shadowColor:"rgba(0,0,0,.9)",shadowOverlap:false,noShadowOpts:{strokeStyle:"#999",strokeWidth:2}})}else{var o="#"+t.iconId;$(o).bt("",{trigger:"click"})}}function Label_LabelStyleBackgroundColorModifiedCB(e,t){var n=e.getValueDirect();n.a*=e.getContainer().getAttribute("backgroundOpacity").getValueDirect();t.htmlLabel.style.backgroundColor="rgba("+n.r*255+","+n.g*255+","+n.b*255+","+n.a+")"}function Label_LabelStyleBackgroundOpacityModifiedCB(e,t){Label_LabelStyleBackgroundColorModifiedCB(t.labelStyle.backgroundColor,t)}function Label_LabelStyleFontBorderModifiedCB(e,t){t.labelStyleFontBorderModified()}function Label_LabelStyleFontStyleColorModifiedCB(e,t){var n=e.getValueDirect();n.a*=e.getContainer().getAttribute("opacity").getValueDirect();t.htmlLabel.style.color="rgba("+n.r*255+","+n.g*255+","+n.b*255+","+n.a+")"}function Label_LabelStyleFontStyleFontModifiedCB(e,t){t.htmlLabel.style.fontFamily=e.getValueDirect().join("")}function Label_LabelStyleFontStyleOpacityModifiedCB(e,t){Label_LabelStyleFontStyleColorModifiedCB(t.labelStyle.fontStyle.color,t);Label_LabelStyleFontBorderModifiedCB(null,t)}function Label_LabelStyleFontStyleSizeModifiedCB(e,t){t.htmlLabel.style.fontSize=e.getValueDirect()+"pt"}function Label_LabelStyleFontStyleStyleModifiedCB(e,t){switch(e.getValueDirect().join("")){case"Bold":t.htmlLabel.style.fontWeight="bold";break;case"Heavy":t.htmlLabel.style.fontWeight="bolder";break;case"Normal":t.htmlLabel.style.fontWeight="normal";break;case"Thin":t.htmlLabel.style.fontWeight="lighter";break}}function Label_LabelStyleFormatModifiedCB(e,t){var n=e.getValueDirect().join("")}function Label_LabelStylePaddingModifiedCB(e,t){var n=e.getValueDirect()+"px";t.htmlLabel.style.paddingLeft=n;t.htmlLabel.style.paddingRight=n;t.htmlLabel.style.paddingTop=n;t.htmlLabel.style.paddingBottom=n}function Label_IconStyleUrlModifiedCB(e,t){var n=e.getValueDirect().join("");switch(n){case"":break;default:t.htmlIconImg.src=document.location.href+"/../BwContent/"+n;break}}function Label_BalloonTipLabelStyleModifiedCB(e,t){Label_DescriptionModifiedCB(t.description,t)}function BalloonTipLabel(){RasterComponent.call(this);this.className="BallonTipLabel";this.attrType=eAttrType.BalloonTipLabel;this.qtip=null;this.qtip_api=null;this.labelRect=new Rect(0,0,0,0);this.balloonTipLabelStyle=new BalloonTipLabelStyleAttr;this.labelWidth=new NumberAttr(0);this.labelHeight=new NumberAttr(0);this.balloonTipLabelStyle.bgColor.addModifiedCB(BalloonTipLabel_balloonTipLabelStyleBgColorModifiedCB,this);this.balloonTipLabelStyle.htmlLabelStyle.addModifiedCB(BalloonTipLabel_BalloonTipLabelStyleHTMLLabelStyleModifiedCB,this);this.balloonTipLabelStyle.displayMode.addModifiedCB(BalloonTipLabel_balloonTipLabelStyleDisplayModeModifiedCB,this);this.show.addModifiedCB(BalloonTipLabel_showModifiedCB,this);this.renderSequenceSlot.addModifiedCB(BalloonTipLabel_renderSequenceSlotModifiedCB,this);this.registerAttribute(this.balloonTipLabelStyle,"balloonTipLabelStyle");this.registerAttribute(this.labelWidth,"labelWidth");this.registerAttribute(this.labelHeight,"labelHeight");this.styles.registerStyle(this.balloonTipLabelStyle,"balloonTipLabelStyle")}function CreateHTMLBalloonTipLabel(e){var t=null;if(bridgeworks.rasterComponents){t=document.createElement("a");if(t){t.setAttribute("id",e);t.style.visibility="hidden";t.style.position="absolute";bridgeworks.rasterComponents.appendChild(t)}}var e="a[id="+e+"]";var n=$(e).qtip({style:{classes:"qtip-bootstrap qtip-rounded qtip-shadow qtip-close"},content:{text:"",button:true},hide:{event:false}});return{label:t,qtip:n}}function BalloonTipLabel_balloonTipLabelStyleModifiedCB(e,t){t.balloonTipLabelStyleModified()}function BalloonTipLabel_balloonTipLabelStyleBgColorModifiedCB(e,t){}function BalloonTipLabel_balloonTipLabelStyleDisplayModeModifiedCB(e,t){t.balloonTipLabelStyleDisplayModeModified(e.getValueDirect().join(""))}function BalloonTipLabel_BalloonTipLabelStyleHTMLLabelStyleModifiedCB(e,t){t.balloonTipLabelStyleHtmlLabelStyleModified()}function BalloonTipLabel_HTMLLabel_PageDimensionsModifiedCB(e,t){}function BalloonTipLabel_showModifiedCB(e,t){t.showModified(e.getValueDirect())}function BalloonTipLabel_renderSequenceSlotModifiedCB(e,t){}function LineList(){VertexGeometry.call(this);this.className="LineList";this.attrType=eAttrType.LineList;this.width=1}function PointList(){VertexGeometry.call(this);this.className="PointList";this.attrType=eAttrType.PointList;this.width=1}function range(e,t,n){var r,i=n-t;if(i==0){return{value:t,i:0}}r=e-i*Math.floor((e-t)/i);return{value:r,i:-Math.floor((r-e)/i+(r>e?.5:-.5))}}function hermite(e){var t,n;t=e*e;n=e*t;var r=3*t-n-n;var i=1-r;var s=n-t;var o=s-t+e;return{h1:i,h2:r,h3:o,h4:s}}function bezier(e,t,n,r,i){var s,o,u,a,f;a=i*i;f=a*i;u=3*(t-e);o=3*(n-t)-u;s=r-e-u-o;return s*f+o*a+u*i+e}function bez2_time(e,t,n,r,i,s,o){var u,a;a=s+(o-s)*.5;u=bezier(e,t,n,r,a);if(Math.abs(i-u)>1e-4){if(u>i)o=a;else s=a;return bez2_time(e,t,n,r,i,s,o)}else return a}function bez2(e,t,n){var r,i,s,o=0,u=1;if(e.getShape()==eKeyframeShape_Bezier2D)r=e.getTime()+e.getParams(2);else r=e.getTime()+(t.getTime()-e.getTime())/3;s=bez2_time(e.getTime(),r,t.getTime()+t.getParams(0),t.getTime(),n,o,u);if(e.getShape()==eKeyframeShape_Bezier2D)i=e.getValue()+e.getParams(3);else i=e.getValue()+e.getParams(1)/3;return bezier(e.getValue(),i,t.getParams(1)+t.getValue(),t.getValue(),s)}function outgoing(e,t,n,r){var i,s,o,u,a;switch(t.getShape()){case eKeyframeShape.TCB:i=(1-t.getParams(0))*(1+t.getParams(1))*(1+t.getParams(2));s=(1-t.getParams(0))*(1-t.getParams(1))*(1-t.getParams(2));o=n.getValue()-t.getValue();if(t!=r){u=(n.getTime()-t.getTime())/(n.getTime()-e.prev(t).getTime());a=u*(i*(t.getValue()-e.prev(t).getValue())+s*o)}else a=s*o;break;case eKeyframeShape.Linear:o=n.getValue()-t.getValue();if(t!=r){u=(n.getTime()-t.getTime())/(n.getTime()-e.prev(t).getTime());a=u*(t.getValue()-e.prev(t).getValue()+o)}else a=o;break;case eKeyframeShape.Bezier1D:a=t.getParams(1);if(t!=r)a*=(n.getTime()-t.getTime())/(n.getTime()-e.prev(t).getTime());break;case eKeyframeShape.Bezier2D:a=t.getParams(3)*(n.getTime()-t.getTime());if(Math.abs(t.getParams(2))>1e-5)a/=t.getParams(2);else a*=1e5;break;case eKeyframeShape.Stepped:default:a=0;break}return a}function incoming(e,t,n,r){var i,s,o,u,a;switch(n.getShape()){case eKeyframeShape.Linear:o=n.getValue()-t.getValue();if(n!=r){u=(n.getTime()-t.getTime())/(e.next(n).getTime()-t.getTime());a=u*(e.next(n).getValue()-n.getValue()+o)}else a=o;break;case eKeyframeShape.TCB:i=(1-n.getParams(0))*(1-n.getParams(1))*(1+n.getParams(2));s=(1-n.getParams(0))*(1+n.getParams(1))*(1-n.getParams(2));o=n.getValue()-t.getValue();if(n!=r){u=(n.getTime()-t.getTime())/(e.next(n).getTime()-t.getTime());a=u*(s*(e.next(n).getValue()-n.getValue())+i*o)}else a=i*o;break;case eKeyframeShape.Bezier1D:a=n.getParams(0);if(n!=r)a*=(n.getTime()-t.getTime())/(e.next(n).getTime()-t.getTime());break;return a;case eKeyframeShape.Bezier2D:a=n.getParams(1)*(n.getTime()-t.getTime());if(Math.abs(n.getParams(0))>1e-5)a/=n.getParams(0);else a*=1e5;break;case eKeyframeShape.Stepped:default:a=0;break}return a}function interpolate(e,t,n,r,i,s){if(t.length==0){return 0}if(t.length==1){return n.getValue()}var o=0;var u=0;var a=0;var f=0;var l;if(e<n.getTime()){switch(i){case eEndBehavior.Reset:return 0;case eEndBehavior.Constant:return n.getValue();case eEndBehavior.Repeat:l=range(e,n.getTime(),r.getTime());e=l.value;break;case eEndBehavior.Oscillate:l=range(e,n.getTime(),r.getTime());e=l.value;o=l.i;if(o%2){e=r.getTime()-n.getTime()-e}break;case eEndBehavior.OffsetRepeat:l=range(e,n.getTime(),r.getTime());e=l.value;o=l.i;f=o*(r.getValue()-n.getValue());break;case eEndBehavior.Linear:a=outgoing(t,n,t.next(n),n)/(t.next(n).getTime()-n.getTime());return a*(e-n.getTime())+n.getValue()}}else if(e>r.getTime()){switch(s){case eEndBehavior.Reset:return 0;case eEndBehavior.Constant:return r.getValue();case eEndBehavior.Repeat:l=range(e,n.getTime(),r.getTime());e=l.value;break;case eEndBehavior.Oscillate:l=range(e,n.getTime(),r.getTime());e=l.value;o=l.i;if(o%2){e=r.getTime()-n.getTime()-e}break;case eEndBehavior.OffsetRepeat:l=range(e,n.getTime(),r.getTime());e=l.value;o=l.i;f=o*(r.getValue()-n.getValue());break;case eEndBehavior.Linear:u=incoming(t,t.prev(r),r,r)/(r.getTime()-t.prev(r).getTime());return u*(e-r.getTime())+r.getValue()}}var c=n;while(t.next(c)&&e>t.next(c).getTime()){c=t.next(c)}var h=t.next(c);if(e==c.getTime()){return c.getValue()+f}else if(e==h.getTime()){return h.getValue()+f}var p=(e-c.getTime())/(h.getTime()-c.getTime());switch(h.getShape()){case eKeyframeShape.TCB:case eKeyframeShape.Bezier1D:{a=outgoing(t,c,h,n);u=incoming(t,c,h,r);var l=hermite(p);return l.h1*c.getValue()+l.h2*h.getValue()+l.h3*a+l.h4*u+f};case eKeyframeShape.Bezier2D:return bez2(c,h,e)+f;case eKeyframeShape.Linear:return c.getValue()+p*(h.getValue()-c.getValue())+f;case eKeyframeShape.Stepped:return c.getValue()+f;default:return 0}}function StateRec(){this.material=null;this.renderStateRec=null;this.cullBackFace=false;this.textures=null;this.projectionTextures=null;this.globalIllumination=new Color}function GetCurrentState(e){var t=new StateRec;t.material=e.getCurrentMaterial();t.renderStateRec=e.renderState.getState(RENDERSTATE_ALL_BITS);t.cullBackFace=e.renderContext.enabled(eRenderMode.CullBackFace);t.textures=e.textureArrayStack.top();t.projectionTextures=e.projectionTextureArrayStack.top();t.globalIllumination.copy(e.renderContext.getGlobalIllumination());return t}function SetCurrentState(e,t){e.setCurrentMaterial(t.material);e.renderState.setState(RENDERSTATE_ALL_BITS,t.renderStateRec);if(t.cullBackFace){e.renderContext.enable(eRenderMode.CullBackFace)}else{e.renderContext.disable(eRenderMode.CullBackFace)}e.textureArrayStack.load(t.textures);e.projectionTextureArrayStack.load(t.projectionTextures);e.renderContext.setGlobalIllumination(t.globalIllumination)}function DistanceSortRec(e,t,n){this.distance=e||0;this.geometry=t||null;this.dissolve=n||0;this.stateRec=null}function DistanceSortAgent(){Agent.call(this);this.className="DistanceSortAgent";this.graphMgr=null;this.sortRecs=[]}function DistanceSortAgent_CompareSortRecs(e,t){return t.distance-e.distance}function MapProjectionCalculator(){Evaluator.call(this);this.className="MapProjectionCalculator";this.attrType=eAttrType.MapProjectionCalculator;this.unitsMultiplier=1;this.positionCalculators=[];this.geoPositionCalculators=[];this.mapProjection=new StringAttr("equalArc");this.elevationModel=new StringAttr;this.center2D=new Vector2DAttr(0,0);this.units=new StringAttr("kilometers");this.geoPosition=new Vector3DAttr(0,0,0);this.pointWorld=new Vector3DAttr;this.resultPosition=new Vector3DAttr;this.resultGeoPosition=new Vector3DAttr;this.units.addModifiedCB(MapProjectionCalculator_UnitsModifiedCB,this);this.pointWorld.addModifiedCB(MapProjectionCalculator_PointWorldModifiedCB,this);this.registerAttribute(this.mapProjection,"mapProjection");this.registerAttribute(this.elevationModel,"elevationModel");this.registerAttribute(this.center2D,"center2d");this.registerAttribute(this.units,"units");this.registerAttribute(this.geoPosition,"geoPosition");this.registerAttribute(this.geoPosition,"position");this.registerAttribute(this.pointWorld,"pointWorld");this.registerAttribute(this.resultPosition,"resultPosition");this.registerAttribute(this.resultGeoPosition,"resultGeoPosition");this.registerAttribute(this.resultGeoPosition,"resultGeoLocation");this.positionCalculators["equalArc"]=ComputeEqualArc3DPosition;this.geoPositionCalculators["equalArc"]=ComputeEqualArcGeoPosition;this.units.setValueDirect("meters")}function MapProjectionCalculator_UnitsModifiedCB(e,t){switch(e.getValueDirect().join("")){case"kilometers":{t.unitsMultiplier=1}break;case"meters":{t.unitsMultiplier=1e3}break}}function MapProjectionCalculator_PointWorldModifiedCB(e,t){}function ComputeEqualArc3DPosition(e,t,n,r,i,s){if(n>90||n<-90||e>180||e<-180){return undefined}var o=(e-r)*EQ_ARC_ONE_DEG_LON_KM*s;var u=t;var a=(n-i)*EQ_ARC_ONE_DEG_LAT_KM*s;return{x:o,y:u,z:a}}function ComputeEqualArcGeoPosition(e,t,n,r,i,s){var o=e/s/EQ_ARC_ONE_DEG_LON_KM+r;var u=t;var a=n/s/EQ_ARC_ONE_DEG_LAT_KM+i;return{lon:o,alt:u,lat:a}}function NullObject(){ParentableMotionElement.call(this);this.className="NullObject";this.attrType=eAttrType.NullObject}function Transform(){SGNode.call(this);this.className="Transform";this.attrType=eAttrType.Transform;this.matrix=new Matrix4x4Attr(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);this.matrixTransform=this.matrix.getValueDirect();this.updateMatrix=true;this.matrix.addModifiedCB(Transform_MatrixModifiedCB,this);this.registerAttribute(this.matrix,"matrix")}function Transform_MatrixModifiedCB(e,t){t.updateMatrix=true;t.incrementModificationCount()}function QuaternionRotate(){Transform.call(this);this.className="QuaternionRotate";this.attrType=eAttrType.QuaternionRotate;this.rotationQuat=new QuaternionAttr(1,0,0,0);this.rotation=new Vector3DAttr(0,0,0);this.updateRotationQuat=true;this.rotationQuat.addModifiedCB(QuaternionRotate_RotationQuatModifiedCB,this);this.registerAttribute(this.rotationQuat,"rotationQuat");this.registerAttribute(this.rotation,"rotation")}function QuaternionRotate_RotationQuatModifiedCB(e,t){t.updateRotationQuat=true;t.incrementModificationCount()}function Rotate(){Transform.call(this);this.className="Rotate";this.attrType=eAttrType.Rotate;this.rotation=new Vector3DAttr(0,0,0);this.updateRotation=true;this.rotation.addModifiedCB(Rotate_RotationModifiedCB,this);this.registerAttribute(this.rotation,"rotation")}function Rotate_RotationModifiedCB(e,t){t.updateRotation=true;t.incrementModificationCount()}function Scale(){Transform.call(this);this.className="Scale";this.attrType=eAttrType.Scale;this.scale=new Vector3DAttr(1,1,1);this.updateScale=true;this.scale.addModifiedCB(Scale_ScaleModifiedCB,this);this.registerAttribute(this.scale,"scale")}function Scale_ScaleModifiedCB(e,t){t.updateScale=true;t.incrementModificationCount()}function Translate(){Transform.call(this);this.className="Translate";this.attrType=eAttrType.Translate;this.translation=new Vector3DAttr(0,0,0);this.updateTranslation=true;this.translation.addModifiedCB(Translate_TranslationModifiedCB,this);this.registerAttribute(this.translation,"translation")}function Translate_TranslationModifiedCB(e,t){t.updateTranslation=true;t.incrementModificationCount()}function MultiTargetObserver(){Evaluator.call(this);this.className="MultiTargetObserver";this.attrType=eAttrType.MultiTargetObserver;this.targetPosition=[];this.targets=new NumberAttr(0);this.position=new Vector3DAttr(0,0,0);this.distanceFromFirstTarget=new NumberAttr(0);this.affectPitch=new BooleanAttr(true);this.affectHeading=new BooleanAttr(true);this.resultPosition=new Vector3DAttr(0,0,0);this.resultPitch=new NumberAttr(0);this.resultHeading=new NumberAttr(0);this.registerAttribute(this.targets,"targets");this.registerAttribute(this.position,"position");this.registerAttribute(this.distanceFromFirstTarget,"distanceFromFirstTarget");this.registerAttribute(this.affectPitch,"affectPitch");this.registerAttribute(this.affectHeading,"affectHeading");this.registerAttribute(this.resultPosition,"resultPosition");this.registerAttribute(this.resultPitch,"resultPitch");this.registerAttribute(this.resultHeading,"resultHeading")}function SerializeParams(){DirectiveParams.call(this);this.serialized=null}function SerializeDirective(){SGDirective.call(this);this.className="SerializeDirective";this.attrType=eAttrType.SerializeDirective;this.serialized=null}function CollideParams(){DirectiveParams.call(this);this.viewSpace=false;this.viewMatrix=new Matrix4x4;this.worldMatrix=new Matrix4x4;this.detectCollisions=new Array}function CollideRec(e,t,n){this.model=e;this.tree=t;this.worldMatrix=new Matrix4x4;this.worldMatrix.loadMatrix(n)}function CollideDirective(){SGDirective.call(this);this.className="CollideDirective";this.attrType=eAttrType.CollideDirective;this.name.setValueDirect("CollideDirective")}function HighlightTarget(){this.projMatrix=new Matrix4x4;this.viewMatrix=new Matrix4x4;this.worldMatrix=new Matrix4x4;this.camera=null;this.viewport=new Viewport;this.geometries=new Array;this.center=new Vector3D;this.highlightColor_r=0;this.highlightColor_g=0;this.highlightColor_b=0;this.highlightColor_a=0;this.highlightWidth=0}function HighlightParams(){DirectiveParams.call(this);this.projMatrix=new Matrix4x4;this.viewMatrix=new Matrix4x4;this.worldMatrix=new Matrix4x4;this.camera=null;this.viewport=new Viewport;this.targets=new Array}function HighlightDirective(){SGDirective.call(this);this.className="HighlightDirective";this.attrType=eAttrType.HighlightDirective;this.vertexBuffer=null;this.name.setValueDirect("HighlightDirective");this.highlightType=new NumberAttr(eHighlightType.None);this.highlightColor=new ColorAttr(1,1,0,1);this.highlightWidth=new NumberAttr(5);this.highlightColor.addModifiedCB(HighlightDirective_HighlightColorModifiedCB,this);this.registerAttribute(this.highlightType,"highlightType");this.registerAttribute(this.highlightColor,"highlightColor");this.registerAttribute(this.highlightWidth,"highlightWidth")}function HighlightDirective_HighlightColorModifiedCB(e,t){t.highlightColorModified()}function ObjectMotionDesc(){this.validMembersMask=OBJECTMOTION_ALL_BITS;this.panVelocity=new Vector3D(0,0,0);this.linearVelocity=new Vector3D(0,0,0);this.angularVelocity=new Vector3D(0,0,0);this.scalarVelocity=new Vector3D(0,0,0);this.duration=0;this.stopOnCollision=true}function ObjectMover(){Evaluator.call(this);this.className="ObjectMover";this.attrType=eAttrType.ObjectMover;this.targetObject=null;this.motionQueue=new Queue;this.activeMotion=null;this.activeDuration=0;this.lastCollisionDetected=false;this.target=new StringAttr("");this.timeIncrement=new NumberAttr(0);this.linearSpeed=new NumberAttr(0);this.angularSpeed=new NumberAttr(0);this.panVelocity=new Vector3DAttr;this.linearVelocity=new Vector3DAttr;this.angularVelocity=new Vector3DAttr;this.scalarVelocity=new Vector3DAttr;this.enabled.addModifiedCB(ObjectMover_EnabledModifiedCB,this);this.target.addModifiedCB(ObjectMover_TargetModifiedCB,this);this.registerAttribute(this.target,"target");this.registerAttribute(this.timeIncrement,"timeIncrement");this.registerAttribute(this.linearSpeed,"linearSpeed");this.registerAttribute(this.angularSpeed,"angularSpeed")}function ObjectMover_EnabledModifiedCB(e,t){var n=e.getValueDirect();if(!n){t.motionQueue.clear();t.panVelocity.setValueDirect(0,0,0);t.linearVelocity.setValueDirect(0,0,0);t.angularVelocity.setValueDirect(0,0,0);t.scalarVelocity.setValueDirect(0,0,0)}}function ObjectMover_TargetModifiedCB(e,t){var n=e.getValueDirect().join("");var r=t.registry.find(n);if(r){t.connectTarget(r)}}function ObjectMover_TargetCollisionDetectedModifiedCB(e,t){var n=e.getValueDirect();var r=e.getContainer().getAttribute("collisionList");t.collisionDetected(r);t.lastCollisionDetected=r.Size()>0?true:false}function ObjectMover_TargetObstructionDetectedModifiedCB(e,t){var n=e.getValueDirect();var r=e.getContainer().getAttribute("obstructionList");t.obstructionDetected(r)}function AnimalMover(){ObjectMover.call(this);this.className="AnimalMover";this.attrType=eAttrType.AnimalMover;this.linearDirection=null}function WalkSimulator(){SceneInspector.call(this);this.className="WalkSimulator";this.attrType=eAttrType.WalkSimulator;this.sceneInspector_pivotDistanceValue=0;this.selector_computePivotDistanceValue=0;this.groundPlane=new PlaneAttr;this.linearDelta=new Vector3DAttr(0,0,0);this.angularDelta=new Vector3DAttr(0,0,0);this.linearSensitivity=new Vector3DAttr(1,1,1);this.angularSensitivity=new Vector3DAttr(1,1,1);this.resultLinear=new Vector3DAttr;this.resultAngular=new Vector3DAttr;this.enabled.addModifiedCB(WalkSimulator_EnabledModifiedCB,this);this.linearDelta.addModifiedCB(WalkSimulator_LinearDeltaModifiedCB,this);this.angularDelta.addModifiedCB(WalkSimulator_AngularDeltaModifiedCB,this);this.registerAttribute(this.groundPlane,"groundPlane");this.registerAttribute(this.linearDelta,"linearDelta");this.registerAttribute(this.angularDelta,"angularDelta");this.registerAttribute(this.linearSensitivity,"linearSensitivity");this.registerAttribute(this.angularSensitivity,"angularSensitivity");this.registerAttribute(this.resultLinear,"resultLinear");this.registerAttribute(this.resultAngular,"resultAngular");this.viewRelativeXAxisRotation.setValueDirect(true);this.viewRelativeYAxisRotation.setValueDirect(true);this.viewRelativeZAxisRotation.setValueDirect(true);this.groundPlane.normal.setValueDirect(0,1,0)}function WalkSimulator_EnabledModifiedCB(e,t){t.enabledModified()}function WalkSimulator_LinearDeltaModifiedCB(e,t){{t.evaluate()}}function WalkSimulator_AngularDeltaModifiedCB(e,t){{t.evaluate()}}function Cube(){TriList.call(this);this.className="Cube";this.attrType=eAttrType.Cube;this.updateTriList=true;this.transform=new Matrix4x4;this.updateTransform=false;this.materialNode=new Material;this.updateMaterial=false;this.color=new ColorAttr(1,1,1,1);this.opacity=new NumberAttr(1);this.position=new Vector3DAttr(0,0,0);this.rotation=new Vector3DAttr(0,0,0);this.scale=new Vector3DAttr(1,1,1);this.color.addModifiedCB(Cube_MaterialModifiedCB,this);this.opacity.addModifiedCB(Cube_MaterialModifiedCB,this);this.position.addModifiedCB(Cube_PositionModifiedCB,this);this.rotation.addModifiedCB(Cube_RotationModifiedCB,this);this.scale.addModifiedCB(Cube_ScaleModifiedCB,this);this.registerAttribute(this.color,"color");this.registerAttribute(this.opacity,"opacity");this.registerAttribute(this.position,"position");this.registerAttribute(this.rotation,"rotation");this.registerAttribute(this.scale,"scale");var e=[-.25,-.25,.25,-.25,.25,.25,-.25,.25,-.25,-.25,-.25,-.25,-.25,-.25,.25,-.25,.25,-.25,.25,-.25,-.25,.25,-.25,.25,-.25,-.25,.25,-.25,-.25,-.25,.25,-.25,-.25,-.25,-.25,.25,.25,-.25,-.25,-.25,.25,-.25,.25,.25,-.25,.25,-.25,-.25,-.25,-.25,-.25,-.25,.25,-.25,.25,-.25,.25,.25,.25,-.25,.25,.25,.25,.25,-.25,-.25,.25,.25,-.25,.25,-.25,.25,.25,.25,-.25,-.25,.25,.25,.25,.25,.25,.25,.25,-.25,-.25,.25,-.25,-.25,.25,.25,.25,-.25,.25,.25,.25,.25,-.25,.25,.25,-.25,-.25,.25,.25,-.25,.25,-.25,.25,.25];var t=[-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1];this.vertices.setValue(e);this.normals.setValue(t);this.color.addTarget(this.materialNode.getAttribute("color"));this.opacity.addTarget(this.materialNode.getAttribute("opacity"))}function Cube_PositionModifiedCB(e,t){t.updateTransform=true}function Cube_RotationModifiedCB(e,t){t.updateTransform=true}function Cube_ScaleModifiedCB(e,t){t.updateTransform=true}function Cube_MaterialModifiedCB(e,t){t.updateMaterial=true}function ScreenRect(){TriList.call(this);this.className="ScreenRect";this.attrType=eAttrType.ScreenRect;this.primitiveType=RC_TRIANGLE_STRIP;this.textureColorMask=new ColorAttr(0,0,0,1);this.registerAttribute(this.textureColorMask,"textureColorMask");var e=[-1,-1,1,-1,1,1,1,-1,1,1,1,1];var t=[0,0,-1,0,0,-1,0,0,-1,0,0,-1];var n=[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1];this.vertices.setValueDirect(e);this.normals.setValueDirect(t);this.colors.setValueDirect(n)}function MorphEffector(){Evaluator.call(this);this.className="MorphEffector";this.attrType=eAttrType.MorphEffector;this.morphAmt=new NumberAttr(0);this.morphIncr=new NumberAttr(0);this.sourceVertices=new NumberArrayAttr;this.targetVertices=new NumberArrayAttr;this.resultVertices=new NumberArrayAttr;this.registerAttribute(this.morphAmt,"morphAmt");this.registerAttribute(this.morphIncr,"morphIncr");this.registerAttribute(this.sourceVertices,"sourceVertices");this.registerAttribute(this.targetVertices,"targetVertices");this.registerAttribute(this.resultVertices,"resultVertices")}function Bone(){AttributeContainer.call(this);this.className="Bone";this.attrType=eAttrType.Bone;this.parent=null;this.children=[];this.translationMatrix=new Matrix4x4;this.rotationMatrix=new Matrix4x4;this.rotationQuat=new Quaternion;this.scaleMatrix=new Matrix4x4;this.pivotMatrix=new Matrix4x4;this.matrix=new Matrix4x4;this.restMatrix=new Matrix4x4;this.restMatrixInv=new Matrix4x4;this.parentMatrix=new Matrix4x4;this.boneMatrix=new Matrix4x4;this.updatePosition=false;this.updateRotation=false;this.updateScale=false;this.updatePivot=false;this.updateRestPosition=false;this.updateRestRotation=false;this.updateRestLength=false;this.updateFalloffType=false;this.updateParentTransform=false;this.updateParentRestTransform=false;this.name=new StringAttr("");this.position=new Vector3DAttr(0,0,0);this.rotation=new Vector3DAttr(0,0,0);this.scale=new Vector3DAttr(1,1,1);this.pivot=new Vector3DAttr(0,0,0);this.restPosition=new Vector3DAttr(0,0,0);this.restRotation=new Vector3DAttr(0,0,0);this.restLength=new NumberAttr(0);this.strength=new NumberAttr(0);this.falloffType=new NumberAttr(eBoneFalloffType.InverseDistance);this.scaleBoneStrength=new BooleanAttr(false);this.transform=new Matrix4x4Attr(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);this.parentTransform=new Matrix4x4Attr(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);this.restTransform=new Matrix4x4Attr(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);this.parentRestTransform=new Matrix4x4Attr(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);this.position.addModifiedCB(Bone_PositionModifiedCB,this);this.rotation.addModifiedCB(Bone_RotationModifiedCB,this);this.scale.addModifiedCB(Bone_ScaleModifiedCB,this);this.pivot.addModifiedCB(Bone_PivotModifiedCB,this);this.restPosition.addModifiedCB(Bone_RestPositionModifiedCB,this);this.restRotation.addModifiedCB(Bone_RestRotationModifiedCB,this);this.restLength.addModifiedCB(Bone_RestLengthModifiedCB,this);this.falloffType.addModifiedCB(Bone_FalloffTypeModifiedCB,this);this.parentTransform.addModifiedCB(Bone_ParentTransformModifiedCB,this);this.parentRestTransform.addModifiedCB(Bone_ParentRestTransformModifiedCB,this);this.registerAttribute(this.name,"name");this.registerAttribute(this.position,"position");this.registerAttribute(this.rotation,"rotation");this.registerAttribute(this.scale,"scale");this.registerAttribute(this.pivot,"pivot");this.registerAttribute(this.restPosition,"restPosition");this.registerAttribute(this.restRotation,"restRotation");this.registerAttribute(this.restLength,"restLength");this.registerAttribute(this.strength,"strength");this.registerAttribute(this.falloffType,"falloffType");this.registerAttribute(this.scaleBoneStrength,"scaleBoneStrength")}function Bone_PositionModifiedCB(e,t){t.updatePosition=true}function Bone_RotationModifiedCB(e,t){t.updateRotation=true}function Bone_ScaleModifiedCB(e,t){t.updateScale=true}function Bone_PivotModifiedCB(e,t){t.updatePivot=true}function Bone_RestPositionModifiedCB(e,t){t.updateRestPosition=true}function Bone_RestRotationModifiedCB(e,t){t.updateRestRotation=true}function Bone_RestLengthModifiedCB(e,t){t.updateRestLength=true}function Bone_FalloffTypeModifiedCB(e,t){t.updateFalloffType=true}function Bone_ParentTransformModifiedCB(e,t){t.updateParentTransform=true}function Bone_ParentRestTransformModifiedCB(e,t){t.updateParentRestTransform=true}function BoneEffector(){Evaluator.call(this);this.className="BoneEffector";this.attrType=eAttrType.BoneEffector;this.bones=[];this.verticesArray=[];this.normalsArray=[];this.resultVerticesArray=[];this.resultNormalsArray=[];this.boneFalloffValuesMap=[];this.falloffSums=[];this.updateVertices=false;this.updateNormals=false;this.vertices=new NumberArrayAttr;this.normals=new NumberArrayAttr;this.resultVertices=new NumberArrayAttr;this.resultNormals=new NumberArrayAttr;this.vertices.addModifiedCB(BoneEffector_VerticesModifiedCB,this);this.normals.addModifiedCB(BoneEffector_NormalsModifiedCB,this);this.registerAttribute(this.vertices,"vertices");this.registerAttribute(this.normals,"normals");this.registerAttribute(this.resultVertices,"resultVertices");this.registerAttribute(this.resultNormals,"resultNormals")}function BoneEffector_VerticesModifiedCB(e,t){t.updateVertices=true}function BoneEffector_NormalsModifiedCB(e,t){t.updateNormals=true}function SnapConnector(){AttributeContainer.call(this);this.className="SnapConnector";this.attrType=eAttrType.SnapConnector;this.type=new StringAttr("");this.normal=new Vector3DAttr(0,0,0);this.connected=new BooleanAttr(false);this.registerAttribute(this.type,"type");this.registerAttribute(this.normal,"normal");this.registerAttribute(this.connected,"connected")}function SocketConnector(){SnapConnector.call(this);this.className="SocketConnector";this.attrType=eAttrType.SocketConnector;this.slot1=new SphereAttr;this.slot2=new SphereAttr;this.registerAttribute(this.slot1,"slot1");this.registerAttribute(this.slot2,"slot2")}function PlugConnector(){SnapConnector.call(this);this.className="PlugConnector";this.attrType=eAttrType.PlugConnector;this.pin1=new SphereAttr;this.pin2=new SphereAttr;this.registerAttribute(this.pin1,"pin1");this.registerAttribute(this.pin2,"pin2")}function SocketConnectors(){AttributeVector.call(this,new SocketConnectorAllocator);this.className="SocketConnectors";this.attrType=eAttrType.SocketConnectors;this.appendParsedElements.setValueDirect(true)}function SocketConnectorAllocator(){}function PlugConnectors(){AttributeVector.call(this,new PlugConnectorAllocator);this.className="PlugConnectors";this.attrType=eAttrType.PlugConnectors;this.appendParsedElements.setValueDirect(true)}function PlugConnectorAllocator(){}function getEventTypeByName(e){var t=eEventNameMap[e];if(t==undefined){if(e.indexOf("VK")!=-1){var n=e;var r="";var i=e.indexOf(".");if(i!=-1){n=e.substring(0,i);r=e.substring(i+1)}var s=eKeyCodeMap[n];if(s){switch(r){case"Down":t=eEventType.KeyDown_First+s;break;case"Up":default:t=eEventType.KeyUp_First+s;break}}}}return t}function Event(e,t,n){AttributeContainer.call(this);this.className="Event";this.type=e||eEventType.Unknown;this.time=t||0;this.userData=n||null}function InputEvent(e,t,n,r,i,s){Event.call(this,e,t,s);this.className="InputEvent";this.inputId=n||0;this.modifiers=r||0;this.state=i||0}function MouseEvent(e,t,n,r,i,s,o,u){InputEvent.call(this,e,t,n,r,i,u);this.className="MouseEvent";this.x=s||0;this.y=o||0}function KeyboardEvent(e,t,n,r,i,s){InputEvent.call(this,e,t,n,r,i,s);this.className="KeyboardEvent"}function MouseEventState(){this.leftButtonDown=false;this.middleButtonDown=false;this.rightButtonDown=false}function EventAdapter(){AttributeContainer.call(this);this.className="EventAdapter";this.mouseState=new MouseEventState;this.name=new StringAttr("EventAdapter");this.registerAttribute(this.name,"name")}function EventListener(){Agent.call(this);this.className="EventListener";this.events=[];this.listen=new BooleanAttr(true);this.trigger=new StringAttr("");this.numResponses=new NumberAttr(1);this.event=new StringAttr("");this.event.addModifiedCB(EventListener_EventModifiedCB,this);this.registerAttribute(this.listen,"listen");this.registerAttribute(this.trigger,"trigger");this.registerAttribute(this.numResponses,"numResponses");this.registerAttribute(this.event,"event")}function EventListener_EventModifiedCB(e,t){var n=getEventTypeByName(e.getValueDirect().join(""));{t.addEventType(n)}}function EventMgr(){AttributeContainer.call(this);this.className="EventMgr";this.listeners=[];this.name=new StringAttr("EventMgr");this.registerAttribute(this.name,"name")}function DeviceHandler(){EventListener.call(this);this.className="DeviceHandler";this.attrType=eAttrType.DeviceHandler;this.inputMessage=new NumberAttr(0);this.inputId=new NumberAttr(0);this.inputModifier=new NumberAttr(0);this.inputState=new NumberAttr(0);this.prevInputState=new NumberAttr(0);this.output=new StringAttr("");this.registerAttribute(this.inputMessage,"inputMessage");this.registerAttribute(this.inputId,"inputId");this.registerAttribute(this.inputModifier,"inputModifier");this.registerAttribute(this.inputState,"inputState");this.registerAttribute(this.prevInputState,"prevInputState");this.registerAttribute(this.output,"output");this.numResponses.setValueDirect(-1)}function MouseHandler(){DeviceHandler.call(this);this.className="MouseHandler";this.attrType=eAttrType.MouseHandler;this.name.setValueDirect("MouseHandler");this.lastX=0;this.lastY=0;this.x=new NumberAttr(0);this.y=new NumberAttr(0);this.deltaX=new NumberAttr(0);this.deltaY=new NumberAttr(0);this.delta=new Vector2DAttr(0,0);this.registerAttribute(this.x,"deviceX");this.registerAttribute(this.y,"deviceY");this.registerAttribute(this.deltaX,"deltaX");this.registerAttribute(this.deltaY,"deltaY");this.registerAttribute(this.delta,"delta");this.addEventType(eEventType.MouseMove);this.addEventType(eEventType.MouseLeftDown)}function KeyboardHandler(){DeviceHandler.call(this);this.className="KeyboardHandler";this.attrType=eAttrType.KeyboardHandler;this.name.setValueDirect("KeyboardHandler");this.keyString=new StringAttr;this.registerAttribute(this.keyString,"keyString")}function Command(){EventListener.call(this);this.className="Command";this.attrType=eAttrType.Command;this.borrowedAttributes=[];this.attributeValuePairs=[];this.attributeRefPairs=[];this.target=new StringAttr("");this.registerAttribute(this.target,"target")}function SetCommand(){Command.call(this);this.className="Set";this.attrType=eAttrType.Set;this.target.addModifiedCB(SetCommand_TargetModifiedCB,this)}function SetCommand_TargetModifiedCB(e,t){var n=e.getValueDirect().join("");var r=n.split(",");t.targets.length=0;for(var i=0;i<r.length;i++){var s=t.registry.find(r[i]);if(s){t.registerTargetAttributes(s,r[i])}}setAttributeBin(t.attributeValuePairs)}function ConnectionDesc(){this.sourceContainer=null;this.targetContainer=null;this.sourceAttribute=null;this.targetAttribute=null;this.sourceAttributeName="";this.targetAttributeName="";this.sourceIndex=-1;this.targetIndex=-1}function registerConnectionHelper(e,t,n){gConnectionHelpers[e]=new Pair(t,n)}function ConnectAttributesCommand(){Command.call(this);this.className="ConnectAttributes";this.attrType=eAttrType.ConnectAttributes;this.connections=new Stack;this.connectionHelper=new Pair(null,null);this.sourceContainer=new StringAttr("");this.targetContainer=new StringAttr("");this.sourceAttribute=new StringAttr("");this.targetAttribute=new StringAttr("");this.source=new StringAttr("");this.negate=new BooleanAttr(false);this.persist=new BooleanAttr(true);this.connectionType=new StringAttr("");this.source.addTarget(this.sourceAttribute);this.target.addTarget(this.targetAttribute);this.sourceContainer.addModifiedCB(ConnectAttributesCommand_SourceContainerModifiedCB,this);this.targetContainer.addModifiedCB(ConnectAttributesCommand_TargetContainerModifiedCB,this);this.sourceAttribute.addModifiedCB(ConnectAttributesCommand_SourceAttributeModifiedCB,this);this.targetAttribute.addModifiedCB(ConnectAttributesCommand_TargetAttributeModifiedCB,this);this.connectionType.addModifiedCB(ConnectAttributesCommand_ConnectionTypeModifiedCB,this);this.negate.addModifiedCB(ConnectAttributesCommand_NegateModifiedCB,this);this.registerAttribute(this.sourceContainer,"sourceContainer");this.registerAttribute(this.sourceContainer,"sourceEvaluator");this.registerAttribute(this.targetContainer,"targetContainer");this.registerAttribute(this.sourceAttribute,"sourceAttribute");this.registerAttribute(this.sourceAttribute,"sourceOutput");this.registerAttribute(this.targetAttribute,"targetAttribute");this.registerAttribute(this.source,"source");this.registerAttribute(this.negate,"negate");this.registerAttribute(this.persist,"persist");this.registerAttribute(this.connectionType,"connectionType")}function ConnectAttributesCommand_SourceContainerModifiedCB(e,t){if(t.connections.length()==0){t.connections.push(new ConnectionDesc)}var n=t.connections.top();n.sourceContainer=t.registry.find(e.getValueDirect().join(""))}function ConnectAttributesCommand_TargetContainerModifiedCB(e,t){if(t.connections.length()==0){t.connections.push(new ConnectionDesc)}var n=t.connections.top();n.targetContainer=t.registry.find(e.getValueDirect().join(""))}function ConnectAttributesCommand_SourceAttributeModifiedCB(e,t){var n=null;var r=-1;if(t.connections.length()==0){t.connections.push(new ConnectionDesc)}var i=t.connections.top();if(i.sourceContainer){var s=e.getValueDirect().join("").split(":");n=i.sourceContainer.getAttribute(s[0]);if(s.length>1){r=s[1]}}else{n=t.registry.find(e.getValueDirect().join(""));if(n){i.sourceContainer=n.getContainer();if(!i.sourceContainer)i.sourceContainer=n}}i.sourceAttribute=n;i.sourceAttributeName=e.getValueDirect().join("");i.sourceIndex=r;if(i.sourceAttribute&&i.targetAttribute){t.connections.push(new ConnectionDesc);t.connections.top().sourceContainer=i.sourceContainer;t.connections.top().targetContainer=i.targetContainer}}function ConnectAttributesCommand_TargetAttributeModifiedCB(e,t){var n=null;var r=-1;if(t.connections.length()==0){t.connections.push(new ConnectionDesc)}var i=t.connections.top();if(i.targetContainer){var s=e.getValueDirect().join("").split(":");n=i.targetContainer.getAttribute(s[0]);if(s.length>1){r=s[1]}}else{n=t.registry.find(e.getValueDirect().join(""));if(n){i.targetContainer=n.getContainer();if(!i.targetContainer)i.targetContainer=n}}i.targetAttribute=n;i.targetAttributeName=e.getValueDirect().join("");i.targetIndex=r;if(i.sourceAttribute&&i.targetAttribute){t.connections.push(new ConnectionDesc);t.connections.top().sourceContainer=i.sourceContainer;t.connections.top().targetContainer=i.targetContainer}}function ConnectAttributesCommand_ConnectionTypeModifiedCB(e,t){var n=gConnectionHelpers[e.getValueDirect().join("")];if(n){t.connectionHelper.first=n.first;t.connectionHelper.second=n.second}}function ConnectAttributesCommand_NegateModifiedCB(e,t){var n=e.getValueDirect();if(n){t.className="DisconnectAttributes";t.attrType=eAttrType.DisconnectAttributes}else{t.className="ConnectAttributes";t.attrType=eAttrType.ConnectAttributes}}function AutoInterpolateCommand(){Command.call(this);this.className="AutoInterpolate";this.attrType=eAttrType.AutoInterpolate;this.kfi=null;this.numValueChannels=0;this.numReferenceChannels=0;this.numChannels=0;this.shape=new NumberAttr(eKeyframeShape.Linear);this.duration=new NumberAttr(1);this.preBehavior=new NumberAttr(eEndBehavior.Constant);this.postBehavior=new NumberAttr(eEndBehavior.Constant);this.renderAndRelease=new BooleanAttr(true);this.target.addModifiedCB(AutoInterpolateCommand_TargetModifiedCB,this);this.registerAttribute(this.shape,"shape");this.registerAttribute(this.duration,"duration");this.registerAttribute(this.preBehavior,"preBehavior");this.registerAttribute(this.postBehavior,"postBehavior");this.registerAttribute(this.renderAndRelease,"renderAndRelease")}function AutoInterpolateCommand_TargetModifiedCB(e,t){var n=e.getValueDirect().join("");var r=n.split(",");t.targets.length=0;for(var i=0;i<r.length;i++){var s=t.registry.find(r[i]);if(s){t.registerTargetAttributes(s,r[i])}}setAttributeBin(t.attributeValuePairs);setAttributePairs(t.attributeRefPairs)}function MotionInterpolateCommand(){AutoInterpolateCommand.call(this);this.className="MotionInterpolateCommand";this.startPosition=new Vector3DAttr;this.endPosition=new Vector3DAttr;this.resultPosition=new Vector3DAttr;this.positionControl=new Vector3DAttr;this.easeIn=new BooleanAttr(true);this.easeOut=new BooleanAttr(true);this.midPosition=new Vector3DAttr;this.registerAttribute(this.startPosition,"startPosition");this.registerAttribute(this.endPosition,"endPosition");this.registerAttribute(this.resultPosition,"resultPosition");this.registerAttribute(this.positionControl,"positionControl");this.registerAttribute(this.easeIn,"easeIn");this.registerAttribute(this.easeOut,"easeOut")}function MotionInterpolateCommand_ResultPositionModifiedCB(e,t){var n=e.getValueDirect();OutputDebugMsg("x: "+n.x+" y: "+n.y+" z: "+n.z+"\n")}function LocateCommand(){Command.call(this);this.className="LocateCommand";this.attrType=eAttrType.Locate;this.targetNode=null;this.directive=new BBoxDirective;this.locator=new BBoxLocator;this.inspector=null;this.duration=new NumberAttr(1);this.transition=new BooleanAttr(true);this.updateClipPlanes=new BooleanAttr(false);this.shape=new NumberAttr(eKeyframeShape.TCB);this.easeIn=new BooleanAttr(true);this.easeOut=new BooleanAttr(true);this.resultPosition=new Vector3DAttr;this.resultFarDistance=new NumberAttr;this.resultWidth=new NumberAttr;this.target.addModifiedCB(LocateCommand_TargetModifiedCB,this);this.registerAttribute(this.duration,"duration");this.registerAttribute(this.transition,"transition");this.registerAttribute(this.updateClipPlanes,"updateClipPlanes");this.registerAttribute(this.shape,"shape");this.registerAttribute(this.easeIn,"easeIn");this.registerAttribute(this.easeOut,"easeOut");this.registerAttribute(this.resultPosition,"resultPosition");this.registerAttribute(this.resultFarDistance,"resultFarDistance");this.registerAttribute(this.resultWidth,"resultWidth");this.registerAttribute(this.locator.getAttribute("closeness"),"closeness");this.registerAttribute(this.locator.getAttribute("resultPivotDistance"),"resultPivotDistance")}function LocateCommand_TargetModifiedCB(e,t){var n=e.getValueDirect().join("");var r=t.registry.find(n);if(r){t.targetNode=r;t.inspector=t.registry.find("SceneInspector")}else{console.debug("TODO: "+arguments.callee.name)}}function PlayCommand(){Command.call(this);this.className="Play";this.attrType=eAttrType.Play;this.evaluators=[];this.negate=new BooleanAttr(false);this.registerAttribute(this.negate,"negate");this.target.addModifiedCB(PlayCommand_TargetModifiedCB,this);this.negate.addModifiedCB(PlayCommand_NegateModifiedCB,this)}function PlayCommand_TargetModifiedCB(e,t){var n=e.getValueDirect().join("");var r=n.split(",");t.targets.length=0;for(var i=0;i<r.length;i++){var s=t.registry.find(r[i]);if(s){t.evaluators[i]=s}}}function PlayCommand_NegateModifiedCB(e,t){var n=e.getValueDirect();if(n){t.className="Pause";t.attrType=eAttrType.Pause}else{t.className="Play";t.attrType=eAttrType.Play}}function RemoveCommand(){Command.call(this);this.className="RemoveCommand";this.attrType=eAttrType.Remove;this.targetAttribute=null;this.target.addModifiedCB(RemoveCommand_TargetModifiedCB,this)}function RemoveCommand_TargetModifiedCB(e,t){var n=e.getValueDirect().join("");t.targetAttribute=t.registry.find(n)}function StopCommand(){Command.call(this);this.className="Stop";this.attrType=eAttrType.Stop;this.evaluators=[];this.target.addModifiedCB(StopCommand_TargetModifiedCB,this)}function StopCommand_TargetModifiedCB(e,t){var n=e.getValueDirect().join("");var r=n.split(",");t.targets.length=0;for(var i=0;i<r.length;i++){var s=t.registry.find(r[i]);if(s){t.evaluators[i]=s}}}function CommandSequence(){Command.call(this);this.className="CommandSequence";this.attrType=eAttrType.CommandSequence;this.sequence=[]}function CommandMgr(){AttributeContainer.call(this);this.className="CommandMgr";this.commandSeqStack=new Stack;this.name=new StringAttr("CommandMgr");this.registerAttribute(this.name,"name")}function CommandMgr_CommandTriggerModifiedCB(e,t){this.createCommandTrigger(e,t)}function AttributeTrigger(e,t,n,r,i,s){this.input=e;this.trigger=t;this.target=n;this.lastValues=[];this.input.getValue(this.lastValues);this.attrType=eAttrType.AttributeTrigger;this.item=r;this.not=i;this.executionCount=s;this.input.addModifiedCB(AttributeTrigger_InputModifiedCB,this);var o=this.input.getLength();if(o==1){this.item=0}}function AttributeTrigger_InputModifiedCB(e,t){t.execute()}function BwRegistry(){AttributeRegistry.call(this);this.className="BwRegistry";this.attrType=eAttrType.AttributeRegistry;this.rootPtr=new ReferenceAttr(null);this.subtreePtr=new ReferenceAttr(null);this.sgPointer=new StringAttr("");this.maxAnimationTimeInSecs=new NumberAttr(0);this.rootPtr.addModifiedCB(BwRegistry_RootPtrModifiedCB,this);this.sgPointer.addModifiedCB(BwRegistry_SgPointerModifiedCB,this);this.registerAttribute(this.rootPtr,"rootPtr");this.registerAttribute(this.subtreePtr,"subtreePtr");this.registerAttribute(this.sgPointer,"sgPointer");this.registerAttribute(this.maxAnimationTimeInSecs,"maxAnimationTimeInSecs");this.registerByName(this,"NodeMgr");this.registerByName(this,"EvaluatorMgr")}function BwRegistry_RootPtrModifiedCB(e,t){var n=e.getValueDirect()}function BwRegistry_SgPointerModifiedCB(e,t){t.sgPointerModified()}function BwSceneInspector(){SceneInspector.call(this);this.className="BwSceneInspector";this.attrType=eAttrType.SceneInspector;this.viewport=new Viewport;this.worldUnitsPerPixel=new Vector2D;this.clickPosWorld=new Vector3D;this.last_d3=0;this.translationSensitivity=new Vector3DAttr(1,1,1);this.panSensitivity=new Vector3DAttr(1,1,1);this.trackSensitivity=new Vector3DAttr(1,1,1);this.rotationSensitivity=new Vector3DAttr(1,1,1);this.zoomSensitivity=new NumberAttr(1);this.invertedTranslationDelta=new Vector3DAttr(0,0,0);this.invertedPanDelta=new Vector3DAttr(0,0,0);this.invertedTrackDelta=new Vector3DAttr(0,0,0);this.invertedRotationDelta=new Vector3DAttr(0,0,0);this.zoomDelta=new NumberAttr(0);this.invertedZoomDelta=new NumberAttr(0);this.selectionOccurred=new BooleanAttr(false);this.viewRelativeTranslationDelta=new Vector3DAttr(0,0,0);this.translationDelta.addModifiedCB(BwSceneInspector_TranslationDeltaModifiedCB,this);this.panDelta.addModifiedCB(BwSceneInspector_PanDeltaModifiedCB,this);this.trackDelta.addModifiedCB(BwSceneInspector_TrackDeltaModifiedCB,this);this.rotationDelta.addModifiedCB(BwSceneInspector_RotationDeltaModifiedCB,this);this.invertedTranslationDelta.addModifiedCB(BwSceneInspector_InvertedTranslationDeltaModifiedCB,this);this.invertedPanDelta.addModifiedCB(BwSceneInspector_InvertedPanDeltaModifiedCB,this);this.invertedTrackDelta.addModifiedCB(BwSceneInspector_InvertedTrackDeltaModifiedCB,this);this.invertedRotationDelta.addModifiedCB(BwSceneInspector_InvertedRotationDeltaModifiedCB,this);this.zoomDelta.addModifiedCB(BwSceneInspector_ZoomDeltaModifiedCB,this);this.invertedZoomDelta.addModifiedCB(BwSceneInspector_InvertedZoomDeltaModifiedCB,this);this.selectionOccurred.addModifiedCB(BwSceneInspector_SelectionOccurredCB,this);this.viewRelativeTranslationDelta.addModifiedCB(BwSceneInspector_TrackDeltaModifiedCB,this);this.registerAttribute(this.translationSensitivity,"translationSensitivity");this.registerAttribute(this.panSensitivity,"panSensitivity");this.registerAttribute(this.trackSensitivity,"trackSensitivity");this.registerAttribute(this.rotationSensitivity,"rotationSensitivity");this.registerAttribute(this.zoomSensitivity,"zoomSensitivity");this.registerAttribute(this.invertedTranslationDelta,"invertedTranslationDelta");this.registerAttribute(this.invertedPanDelta,"invertedPanDelta");this.registerAttribute(this.invertedTrackDelta,"invertedTrackDelta");this.registerAttribute(this.invertedRotationDelta,"invertedRotationDelta");this.registerAttribute(this.zoomDelta,"zoomDelta");this.registerAttribute(this.invertedZoomDelta,"invertedZoomDelta");this.registerAttribute(this.selectionOccurred,"selectionOccurred");this.registerAttribute(this.viewRelativeTranslationDelta,"viewRelativeTranslationDelta");this.orphan.setValueDirect(true);this.enabled.addModifiedCB(BwSceneInspector_EnabledModifiedCB,this)}function BwSceneInspector_TranslationDeltaModifiedCB(e,t){var n=t.enabled.getValueDirect();if(n){t.translate(e.getValueDirect())}}function BwSceneInspector_PanDeltaModifiedCB(e,t){var n=t.enabled.getValueDirect();if(n){t.pan(e.getValueDirect())}}function BwSceneInspector_TrackDeltaModifiedCB(e,t){var n=t.enabled.getValueDirect();if(n){t.track(e.getValueDirect())}}function BwSceneInspector_RotationDeltaModifiedCB(e,t){var n=t.enabled.getValueDirect();if(n){t.rotate(e.getValueDirect())}}function BwSceneInspector_InvertedTranslationDeltaModifiedCB(e,t){var n=t.enabled.getValueDirect();if(n){var r=e.getValueDirect();r.x*=-1;r.y*=-1;r.z*=-1;t.translate(r);if(r.x!=0||r.y!=0||r.z!=0)alert("rotate")}}function BwSceneInspector_InvertedPanDeltaModifiedCB(e,t){var n=t.enabled.getValueDirect();if(n){var r=e.getValueDirect();r.x*=-1;r.y*=-1;r.z*=-1;t.pan(r)}}function BwSceneInspector_InvertedTrackDeltaModifiedCB(e,t){var n=t.enabled.getValueDirect();if(n){var r=e.getValueDirect();r.x*=-1;r.y*=-1;r.z*=-1;t.track(r)}}function BwSceneInspector_InvertedRotationDeltaModifiedCB(e,t){var n=t.enabled.getValueDirect();if(n){var r=e.getValueDirect();r.x*=-1;r.y*=-1;r.z*=-1;t.rotate(r)}}function BwSceneInspector_ZoomDeltaModifiedCB(e,t){var n=t.enabled.getValueDirect();if(n){t.zoom(e.getValueDirect())}}function BwSceneInspector_InvertedZoomDeltaModifiedCB(e,t){var n=t.enabled.getValueDirect();if(n){t.zoom(e.getValueDirect()*-1)}}function BwSceneInspector_SelectionOccurredCB(e,t){var n=t.registry.find("Selector");if(n){if(n.selections.viewports.length>0){t.viewport.loadViewport(n.selections.viewports[0])}t.clickPosWorld.copy(n.getAttribute("pointWorld").getValueDirect());var r=n.getAttribute("pointView").getValueDirect();t.getWorldUnitsPerPixel(r.z)}}function BwSceneInspector_EnabledModifiedCB(e,t){var n=e.getValueDirect()}function ObjectInspector(){ArcballInspector.call(this);this.className="ObjectInspector";this.attrType=eAttrType.ObjectInspector;this.camera=null;this.selectedObjects=[];this.pointView=new Vector3DAttr(1,1,1);this.translationDelta=new Vector3DAttr(0,0,0);this.rotationDelta=new Vector3DAttr(0,0,0);this.translationNow=new Vector3DAttr(0,0,0);this.rotationNow=new Vector3DAttr(0,0,0);this.selectionOccurred=new BooleanAttr(false);this.selectionCleared=new BooleanAttr(false);this.translationDelta.addModifiedCB(ObjectInspector_TranslationDeltaModifiedCB,this);this.rotationDelta.addModifiedCB(ObjectInspector_RotationDeltaModifiedCB,this);this.translationNow.addModifiedCB(ObjectInspector_TranslationNowModifiedCB,this);this.rotationNow.addModifiedCB(ObjectInspector_RotationNowModifiedCB,this);this.selectionOccurred.addModifiedCB(ObjectInspector_SelectionOccurredCB,this);this.selectionCleared.addModifiedCB(ObjectInspector_SelectionClearedCB,this);this.registerAttribute(this.pointView,"pointView");this.registerAttribute(this.translationDelta,"translationDelta");this.registerAttribute(this.rotationDelta,"rotationDelta");this.registerAttribute(this.translationNow,"translationNow");this.registerAttribute(this.rotationNow,"rotationNow");this.registerAttribute(this.selectionOccurred,"selectionOccurred");this.registerAttribute(this.selectionCleared,"selectionCleared");this.orphan.setValueDirect(true);this.enabled.addModifiedCB(ObjectInspector_EnabledModifiedCB,this)}function ObjectInspector_TranslationDeltaModifiedCB(e,t){var n=t.enabled.getValueDirect();if(n){t.translationDeltaModified()}}function ObjectInspector_RotationDeltaModifiedCB(e,t){var n=t.enabled.getValueDirect();if(n){t.rotationDeltaModified()}}function ObjectInspector_TranslationNowModifiedCB(e,t){}function ObjectInspector_RotationNowModifiedCB(e,t){var n=t.enabled.getValueDirect();if(n){t.rotationNowModified()}}function ObjectInspector_SelectionOccurredCB(e,t){var n=t.enabled.getValueDirect();if(n){t.runSelectionOccurred()}}function ObjectInspector_SelectionClearedCB(e,t){t.runSelectionCleared()}function ObjectInspector_EnabledModifiedCB(e,t){console.debug("ObjectInspector.enable modified: "+t.enabled.getValueDirect().toString())}function ConnectionMgr(){AttributeContainer.call(this);this.className="ConnectionMgr";this.name=new StringAttr("ConnectionMgr");this.registerAttribute(this.name,"name");registerConnectionHelper("DisconnectAllTargets",null,ConnectionMgr.prototype.disconnectAllTargets);registerConnectionHelper("dissolve",ConnectionMgr.prototype.connectDissolve,ConnectionMgr.prototype.disconnectDissolve);registerConnectionHelper("walkSimulation",ConnectionMgr.prototype.connectWalkSimulation,ConnectionMgr.prototype.disconnectWalkSimulation)}function RenderAgent(e){Agent.call(this);this.className="RenderAgent";this.bridgeworks=e;this.name.setValueDirect("RenderAgent");this.timer=new Timer;this.frameRate=new NumberAttr(0);this.desiredFrameRate=new NumberAttr(30);this.timeIncrement=new NumberAttr(0);this.globalTimeInSecs=new NumberAttr(0);this.elapsedTimeInSecs=new NumberAttr(0);this.desiredFrameRate.addModifiedCB(RenderAgent_DesiredFrameRateModified,this);this.globalTimeInSecs.addModifiedCB(RenderAgent_GlobalTimeInSecsModified,this);this.registerAttribute(this.frameRate,"frameRate");this.registerAttribute(this.desiredFrameRate,"desiredFrameRate");this.registerAttribute(this.timeIncrement,"timeIncrement");this.registerAttribute(this.globalTimeInSecs,"globalTimeInSecs");this.registerAttribute(this.elapsedTimeInSecs,"elapsedTimeInSecs")}function RenderAgent_DesiredFrameRateModified(e,t){}function RenderAgent_GlobalTimeInSecsModified(e,t){var n=t.registry.find("RenderAgent");n.globalTimeInSecsModified()}function RenderController(e){AttributeContainer.call(this);this.className="RenderController";this.playState=ePlayState.Pause;this.renderAgent=e.renderAgent}function Selections(){this.viewports=[];this.cameras=[];this.lights=[];this.models=[];this.surfaces=[];this.labels=[];this.clear=function(){this.viewports=[];this.cameras=[];this.lights=[];this.models=[];this.surfaces=[];this.labels=[]}}function SelectionListener(){EventListener.call(this);this.className="SelectionListener";this.name.setValueDirect("Selector");this.rayPick=null;this.selections=new Selections;this.selected=null;this.selectionOccurred=new PulseAttr;this.selectionCleared=new PulseAttr;this.pointView=new Vector3DAttr;this.pointWorld=new Vector3DAttr;this.pointObject=new Vector3DAttr;this.pointGeo=new Vector3DAttr;this.triIndex=new NumberAttr;this.distance=new NumberAttr;this.distanceFromScreenCenter=new NumberAttr;this.computePivotDistance=new BooleanAttr(true);this.selectedName=new StringAttr;this.selectedElement=new NumberAttr(-1);this.lastSelectedName=new StringAttr;this.pointWorld.addModifiedCB(SelectionListener_PointWorldModifiedCB,this);this.registerAttribute(this.selectionOccurred,"selectionOccurred");this.registerAttribute(this.selectionCleared,"selectionCleared");this.registerAttribute(this.pointView,"pointView");this.registerAttribute(this.pointWorld,"pointWorld");this.registerAttribute(this.pointObject,"pointObject");this.registerAttribute(this.pointGeo,"pointGeo");this.registerAttribute(this.triIndex,"triIndex");this.registerAttribute(this.distance,"distance");this.registerAttribute(this.distanceFromScreenCenter,"distanceFromScreenCenter");this.registerAttribute(this.computePivotDistance,"computePivotDistance");this.registerAttribute(this.selectedName,"selectedName");this.registerAttribute(this.lastSelectedName,"lastSelectedName");this.numResponses.setValueDirect(-1)}function SelectionListener_ClickPointModifiedCB(e,t){t.clickPointModified()}function SelectionListener_PointWorldModifiedCB(e,t){}function ViewportLayout(){AttributeContainer.call(this);this.className="ViewportLayout";this.name=new StringAttr("ViewportLayout");this.width=new NumberAttr(0);this.height=new NumberAttr(0);this.registerAttribute(this.name,"name");this.registerAttribute(this.width,"width");this.registerAttribute(this.height,"height")}function GridLayout(){ViewportLayout.call(this);this.className="GridLayout";this.name.setValueDirect("GridLayout");this.rows=new NumberAttr(1);this.cols=new NumberAttr(1);this.registerAttribute(this.rows,"rows");this.registerAttribute(this.cols,"cols")}function ViewportMgr(){AttributeContainer.call(this);this.className="ViewportMgr";this.name=new StringAttr("ViewportMgr");this.cursor=new StringAttr("Arrow");this.width=new NumberAttr(0);this.height=new NumberAttr(0);this.layout=new ReferenceAttr(null);this.cursor.addModifiedCB(ViewportMgr_CursorModifiedCB,this);this.width.addModifiedCB(ViewportMgr_WidthModifiedCB,this);this.height.addModifiedCB(ViewportMgr_HeightModifiedCB,this);this.layout.addModifiedCB(ViewportMgr_LayoutModifiedCB,this);this.registerAttribute(this.name,"name");this.registerAttribute(this.cursor,"cursor");this.registerAttribute(this.width,"width");this.registerAttribute(this.height,"height");this.registerAttribute(this.layout,"layout")}function ViewportMgr_CursorModifiedCB(e,t){}function ViewportMgr_WidthModifiedCB(e,t){var n=t.layout.getValueDirect();if(n){n.getAttribute("width").setValueDirect(e.getValueDirect())}}function ViewportMgr_HeightModifiedCB(e,t){var n=t.layout.getValueDirect();if(n){n.getAttribute("height").setValueDirect(e.getValueDirect())}}function ViewportMgr_LayoutModifiedCB(e,t){var n=e.getValueDirect();if(n){n.getAttribute("width").setValueDirect(t.width.getValueDirect());n.getAttribute("height").setValueDirect(t.height.getValueDirect())}}function RasterComponentEventListener(){EventListener.call(this);this.className="RasterComponentEventListener";this.rcs=[];this.rcsSelectionState=[];this.rcListenMap=[];this.rcEventMap=[];this.styleMgr=null;this.selectionEvent=new InputEvent(eEventType.Unknown,0,4294967295,0,eEventType.Key_Up);this.name.setValueDirect("RasterComponentEventListener");this.numResponses.setValueDirect(-1)}function addInspectionGroup(e,t){var n=getInspectionGroup(e);if(n)return;var r=new Group;r.setGraphMgr(t.graphMgr);var i=new Translate;i.setGraphMgr(t.graphMgr);var s=new Scale;s.setGraphMgr(t.graphMgr);var o=new QuaternionRotate;o.setGraphMgr(t.graphMgr);var u=new Translate;u.setGraphMgr(t.graphMgr);var a=new Scale;a.setGraphMgr(t.graphMgr);o.addModifiedCB(Util_InspectionGroup_RotationQuatModifiedCB,null);r.name.setValueDirect("InspectionGroup");i.name.setValueDirect("Translate");s.name.setValueDirect("ScaleInverse");o.name.setValueDirect("Quaternion");u.name.setValueDirect("TranslateBack");a.name.setValueDirect("Scale");r.addChild(i);r.addChild(s);r.addChild(o);r.addChild(a);r.addChild(u);var f=e.getChild(0);if(f){f.insertChild(r,0)}e.registerAttribute(i.translation,"inspectionGroup_translate");e.registerAttribute(s.scale,"inspectionGroup_scaleInverse");e.registerAttribute(o.rotationQuat,"inspectionGroup_rotationQuat");e.registerAttribute(o.enabled,"inspectionGroup_rotationEnabled");e.registerAttribute(a.scale,"inspectionGroup_scale");e.registerAttribute(u.translation,"inspectionGroup_translateBack");i.translation.setContainer(e);s.scale.setContainer(e);o.rotationQuat.setContainer(e);o.enabled.setContainer(e);a.scale.setContainer(e);u.translation.setContainer(e);return}function deleteInspectionGroup(e){var t=getInspectionGroup(e);if(t){t.getChild(0).getAttribute("translation").setContainer(t.getChild(0));t.getChild(1).getAttribute("scale").setContainer(t.getChild(1));t.getChild(2).getAttribute("rotationQuat").setContainer(t.getChild(2));t.getChild(2).getAttribute("enabled").setContainer(t.getChild(2));t.getChild(3).getAttribute("scale").setContainer(t.getChild(3));t.getChild(4).getAttribute("translation").setContainer(t.getChild(4));e.unregisterAttribute(e.getAttribute("inspectionGroup_translate"));e.unregisterAttribute(e.getAttribute("inspectionGroup_scaleInverse"));e.unregisterAttribute(e.getAttribute("inspectionGroup_rotationQuat"));e.unregisterAttribute(e.getAttribute("inspectionGroup_rotationEnabled"));e.unregisterAttribute(e.getAttribute("inspectionGroup_scale"));e.unregisterAttribute(e.getAttribute("inspectionGroup_translateBack"));e.removeChild(t)}return}function getInspectionGroup(e){var t=null;var n=e.getChild(0);if(n){t=n.getNamedChild("InspectionGroup")}return t}function setInspectionGroupActivationState(e,t){var n=getInspectionGroup(e);if(n){var r=n.getChild(2);if(r){r.enabled.setValueDirect(t);if(!t){var i=new Quaternion;i.loadIdentity();var s=r.rotationQuat;s.setValueDirect(i)}}var o=e.getAttribute("position");if(t){if(!(e in g_objPosMap)){g_objPosMap[e]=o.getValueDirect()}}else{var u=g_objPosMap[e];o.setValueDirect(u)}}return}function setInspectionGroupContainer(e){var t=getInspectionGroup(e);if(t){e.unregisterAttribute(e.getAttribute("inspectionGroup_translate"));e.unregisterAttribute(e.getAttribute("inspectionGroup_scaleInverse"));e.unregisterAttribute(e.getAttribute("inspectionGroup_rotationQuat"));e.unregisterAttribute(e.getAttribute("inspectionGroup_rotationEnabled"));e.unregisterAttribute(e.getAttribute("inspectionGroup_scale"));e.unregisterAttribute(e.getAttribute("inspectionGroup_translateBack"));e.registerAttribute(t.getChild(0).getAttribute("translation"),"inspectionGroup_translate");e.registerAttribute(t.getChild(1).getAttribute("scale"),"inspectionGroup_scaleInverse");e.registerAttribute(t.getChild(2).getAttribute("rotationQuat"),"inspectionGroup_rotationQuat");e.registerAttribute(t.getChild(2).getAttribute("enabled"),"inspectionGroup_rotationEnabled");e.registerAttribute(t.getChild(3).getAttribute("scale"),"inspectionGroup_scale");e.registerAttribute(t.getChild(4).getAttribute("translation"),"inspectionGroup_translateBack");t.getChild(0).getAttribute("translation").setContainer(e);t.getChild(1).getAttribute("scale").setContainer(e);t.getChild(2).getAttribute("rotationQuat").setContainer(e);t.getChild(2).getAttribute("enabled").setContainer(e);t.getChild(3).getAttribute("scale").setContainer(e);t.getChild(4).getAttribute("translation").setContainer(e)}return}function zeroInspectionGroup(e){var t=getInspectionGroup(e);if(t){var n=t.getChild(2);if(n){var r=new Quaternion;r.loadIdentity();var i=n.rotationQuat;i.setValueDirect(r)}}return}function clearObjectPositionMap(){g_objPosMap={};return}function Util_InspectionGroup_RotationQuatModifiedCB(e,t){}function SerializeCommand(){Command.call(this);this.className="Serialize";this.attrType=eAttrType.Serialize;this.targetAttribute=null;this.target.addModifiedCB(SerializeCommand_TargetModifiedCB,this);this.directive=null;this.serialized=""}function SerializeCommand_TargetModifiedCB(e,t){var n=e.getValueDirect().join("");t.targetAttribute=t.registry.find(n)}function ScreenCaptureCommand(){Command.call(this);this.className="ScreenCapture";this.attrType=eAttrType.ScreenCapture;this.canvasId=new StringAttr;this.registerAttribute(this.canvasId,"canvasId");this.numResponses.setValueDirect(0)}function ExportCommand(){Command.call(this);this.className="Export";this.attrType=eAttrType.Export;this.targetNode=null;this.url=new StringAttr;this.target.addModifiedCB(ExportCommand_TargetModifiedCB,this);this.registerAttribute(this.url,"url")}function ExportCommand_TargetModifiedCB(e,t){var n=e.getValueDirect().join("");var r=t.registry.find(n);if(r){t.targetNode=r}}function MorphCommand(){Command.call(this);this.className="Morph";this.attrType=eAttrType.Morph;this.sourceModel=null;this.targetModel=null;this.source=new StringAttr("");this.morphIncr=new NumberAttr(.1);this.source.addModifiedCB(MorphCommand_SourceModifiedCB,this);this.target.addModifiedCB(MorphCommand_TargetModifiedCB,this);this.registerAttribute(this.source,"source");this.registerAttribute(this.morphIncr,"morphIncr")}function MorphCommand_SourceModifiedCB(e,t){var n=e.getValueDirect().join("");var r=t.registry.find(n);if(r){t.sourceModel=r}}function MorphCommand_TargetModifiedCB(e,t){var n=e.getValueDirect().join("");var r=t.registry.find(n);if(r){t.targetModel=r}}function SnapToCommand(){Command.call(this);this.className="SnapTo";this.attrType=eAttrType.SnapTo;this.plugModel=null;this.socketModel=null;this.socket=new StringAttr("");this.plug=new StringAttr("");this.slot=new NumberAttr(0);this.socketConnector=new SocketConnector;this.plugConnector=new PlugConnector;this.socketWorldMatrix=new Matrix4x4Attr(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);this.plugWorldMatrix=new Matrix4x4Attr(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);this.target.addModifiedCB(SnapToCommand_TargetModifiedCB,this);this.socket.addModifiedCB(SnapToCommand_TargetModifiedCB,this);this.plug.addModifiedCB(SnapToCommand_PlugModifiedCB,this);this.registerAttribute(this.socket,"socket");this.registerAttribute(this.plug,"plug");this.registerAttribute(this.slot,"slot");this.registerAttribute(this.socketConnector,"socketConnector");this.registerAttribute(this.plugConnector,"plugConnector");this.registerAttribute(this.socketWorldMatrix,"socketWorldMatrix");this.registerAttribute(this.plugWorldMatrix,"plugWorldMatrix");this.target.addTarget(this.socket,null,null,false)}function SnapToCommand_TargetModifiedCB(e,t){var n=e.getValueDirect().join("");var r=t.registry.find(n);if(r){t.socketModel=r}}function SnapToCommand_PlugModifiedCB(e,t){var n=e.getValueDirect().join("");var r=t.registry.find(n);if(r){t.plugModel=r}}function LWO2BlockData(){this.type="";this.ordinal="";this.channel=0;this.enable=1;this.opacityType=7;this.opacity=1;this.opacityEnvelope=0;this.negative=0;this.center=new Vector3D;this.size=new Vector3D;this.coordSys=0;this.projMode=0;this.axis=0;this.imageIndex=0;this.widthWrap=1;this.heightWrap=1;this.widthWrapAmt=0;this.heightWrapAmt=0;this.uvMapName=""}function LWO2SurfaceData(){this.name="";this.source="";this.color=new Vector3D;this.diffuseLevel=1;this.specularLevel=0;this.luminosityLevel=0;this.transparencyLevel=0;this.glossiness=.4;this.doubleSided=false;this.smoothingAngle=0;this.blocks=[];this.addBlock=function(){this.blocks.push(new LWO2BlockData)};this.currentBlock=function(){return this.blocks.length>0?this.blocks[this.blocks.length-1]:null}}function LWO2ClipData(){this.type=0;this.negative=0;var e="";var t="";this.setPlatformNeutralFilename=function(n){t=n;e=n;if(e.indexOf(":")>=0){var r=new Array;r=e.split(":");e=r[0]+":"+"/"+r[1]}};this.setFilename=function(n){e=n;t=n;var r=e.indexOf(":");if(r>=0){if(e.charAt(r+1)!="/"&&e.charAt(r+1)!="\\"){var i=new Array;i=e.split(":");e=i[0]+":"+"/"+i[1]}}r=t.indexOf(":");if(r>=0){if(t.charAt(r+1)=="/"||t.charAt(r+1)=="\\"){var i=new Array;i=t.split(":");t=i[0]+":"+i[1].substr(1,i[1].length)}}this.getPlatformNeutralFilename=function(){return t};this.getFilename=function(){return e}}}function LWO2EnvelopeData(){this.userFormat=0;this.type=0;this.preBehavior=0;this.postBehavior=0;this.keyframes=[];this.currentKyframe=function(){return this.keyframes.length>0?this.keyframes[this.keyframes.length-1]:null}}function LWO2VMAPData(){this.vertex=0;this.u=0;this.v=0}function LWO2VMADData(){this.poly=0;this.vertex=0;this.u=0;this.v=0}function LWO2PTAGData(){this.poly=0;this.tag=0}function LWO2LayerData(){this.number=0;this.name="";this.pnts=[];this.pols=[];this.ptagsSURF=[];this.vmapsTXUV=[];this.vmadsTXUV=[];this.ptagsSURFMaxIndex=0;this.pivot=new Vector3D;this.getVmap=function(e,t){switch(e){case"TXUV":return this.vmapsTXUV[t];break;default:return null}};this.putVmap=function(e,t,n){switch(e){case"TXUV":if(this.vmapsTXUV[t]==undefined)this.vmapsTXUV[t]=[];this.vmapsTXUV[t].push(n);break}};this.getVmad=function(e,t){switch(e){case"TXUV":return this.vmadsTXUV[t];break;default:return null}};this.putVmad=function(e,t,n){switch(e){case"TXUV":if(this.vmadsTXUV[t]==undefined)this.vmadsTXUV[t]=[];this.vmadsTXUV[t].push(n);break}};this.putPtag=function(e){this.ptagsSURF.push(e)}}function LWO2Data(){this.name="";this.contentDir="";this.layers=[];this.tags=[];this.surfaces=[];this.clips=[];this.envelopes=[];this.subChunkContext="";this.evaluators=[];var e=null;var t=null;var n=null;this.addLayer=function(e){var t=new LWO2LayerData;t.number=e;if(this.layers.length<=e){this.layers.length=e+1}this.layers[e]=t;n=t};this.currentLayer=function(){return n};this.addSurface=function(e,t){var n=new LWO2SurfaceData;n.name=e;n.source=t;this.surfaces.push(n)};this.currentSurface=function(){return this.surfaces.length>0?this.surfaces[this.surfaces.length-1]:null};this.getSurface=function(e){for(var t=0;t<this.surfaces.length;t++){if(this.surfaces[t].name==e){return this.surfaces[t]}}return null};this.addClip=function(t){var n=new LWO2ClipData;if(this.clips.length<=t){this.clips.length=t+1}this.clips[t]=n;e=n};this.currentClip=function(){return e};this.addEnvelope=function(e){var n=new LWO2EnvelopeData;this.envelopes[e]=n;t=n};this.currentEnvelope=function(){return t}}function LWObjectHandler(){ContentHandler.call(this);this.className="LWObjectHandler";this.lwo2DataHandlers=[];this.lwo2DataHandlersData=[]}function LWObjectBuilder(){ContentBuilder.call(this);this.className="LWObjectBuilder";this.graphMgr=null;this.indexGeometry=new BooleanAttr(true);this.registerAttribute(this.indexGeometry,"indexGeometry")}function LWObjectBuilder_ObjectHandler(e,t){t.allocateModel(e)}function LWObjectBuilder_CompareVmapEntries(e,t){if(e.vertex<t.vertex)return-1;if(e.vertex>t.vertex)return 1;return 0}function LWObjectBuilder_CompareVmadEntries(e,t){if(e.poly<t.poly)return-1;if(e.poly>t.poly)return 1;return 0}function LWSceneHandler(){ContentHandler.call(this);this.className="LWSceneHandler";this.tokenHandlers=[];this.tokenHandlersData=[]}function TLWSCSceneData(){var e=0;var t=0;var n=0;var r=0;var i="";var s="";var o="";var u=false;var a=0;var f=.25}function TLWSCv3LightDesc(){this.name="";this.type=0;this.colorR=0;this.colorG=0;this.colorB=0;this.intensity=0;this.range=0;this.coneAngle=0;this.edgeAngle=0;this.motion=null;this.parentItem=0}function LWSceneBuilder(){ContentBuilder.call(this);this.className="LWSceneBuilder";this.root=null;this.sgRoot=null;this.evaluatorsGroup=null;this.camerasSelector=null;this.lightsGroup=null;this.modelsGroup=null;this.renderDirective=null;this.boneFalloffType=eBoneFalloffType.InverseDistance;this.parsingBgImage=false;this.parsingFgImage=false;this.parsingFgAlphaImage=false;this.imagePath="";this.currElement=null;this.currChannel=0;this.sceneData=new TLWSCSceneData;this.ambientLightDesc=new TLWSCv3LightDesc;this.globalLightDesc=new TLWSCv3LightDesc;this.lightDescs=[];this.parentItems=[];this.bones=[];this.objectBones=[];this.indexGeometry=new BooleanAttr(true);this.registerAttribute(this.indexGeometry,"indexGeometry");this.ambientLightDesc.colorR=1;this.ambientLightDesc.colorG=1;this.ambientLightDesc.colorB=1;this.ambientLightDesc.intensity=.05;this.globalLightDesc.intensity=1}function LWSceneBuilder_TokenHandler(e,t){t.handleToken(e[0],e.slice(1))}function AttributeFactory(){AttributeContainer.call(this);this.className="AttributeFactory";this.attrType=eAttrType.AttributeFactory;this.newResourceProcs=[];this.configureProcs=[];this.finalizeProcs=[];this.registry=null;this.graphMgr=null;this.name=new StringAttr("AttributeFactory");this.registerAttribute(this.name,"name");this.initializeNewResourceMap();this.initializeConfigureMap();this.initializeFinalizeMap()}function newAttribute(e,t){var n=null;switch(e){case"BalloonTipLabelStyleAttr":n=new BalloonTipLabelStyleAttr;break;case"BBoxAttr":n=new BBoxAttr;break;case"BooleanAttr":n=new BooleanAttr;break;case"ColorAttr":n=new ColorAttr;break;case"FontStyleAttr":n=new FontStyleAttr;break;case"IconStyleAttr":n=new IconStyleAttr;break;case"ImageAttr":n=new ImageAttr;break;case"KeyframeAttr":n=new KeyframeAttr;break;case"KeyframesAttr":n=new KeyframesAttr;break;case"LabelStyleAttr":n=new LabelStyleAttr;break;case"HTMLLabelStyleAttr":n=new HTMLLabelStyleAttr;break;case"NumberArrayAttr":n=new NumberArrayAttr;break;case"NumberAttr":n=new NumberAttr;break;case"Matrix4x4Attr":n=new Matrix4x4Attr;break;case"PlaneAttr":n=new PlaneAttr;break;case"PulseAttr":n=new PulseAttr;break;case"QuaternionAttr":n=new QuaternionAttr;break;case"RectAttr":n=new RectAttr;break;case"ReferenceAttr":n=new ReferenceAttr;break;case"StringAttr":n=new StringAttr;break;case"StyleAttr":n=new StyleAttr;break;case"StylesAttr":n=new StylesAttr;break;case"StyleMapAttr":n=new StyleMapAttr;break;case"StylesMapAttr":n=new StylesMapAttr;break;case"Vector2DAttr":n=new Vector2DAttr;break;case"Vector3DAttr":n=new Vector3DAttr;break;case"ViewportAttr":n=new ViewportAttr;break;case"ViewVolumeAttr":n=new ViewVolumeAttr;break;case"RenderableElementStyleAttr":n=new RenderableElementStyleAttr;break;case"Serializer":n=new Serializer;break;case"Bone":n=new Bone;break}return n}function newSGNode(e,t){var n=null;switch(e){case"DirectionalLight":n=new DirectionalLight;registerParentableAttributes(n,t);break;case"GlobalIllumination":n=new GlobalIllumination;break;case"Group":n=new Group;break;case"Isolator":n=new Isolator;break;case"Label":n=new Label;break;case"HTMLLabel":n=new HTMLLabel;break;case"BalloonTipLabel":n=new BalloonTipLabel;break;case"LineList":n=new LineList;break;case"MediaTexture":n=new MediaTexture;break;case"OrthographicCamera":n=new OrthographicCamera;registerParentableAttributes(n,t);break;case"PerspectiveCamera":n=new PerspectiveCamera;registerParentableAttributes(n,t);break;case"PointLight":n=new PointLight;registerParentableAttributes(n,t);break;case"PointList":n=new PointList;break;case"QuaternionRotate":n=new QuaternionRotate;break;case"Rotate":n=new Rotate;break;case"Scale":n=new Scale;break;case"Selector":n=new Selector;break;case"Surface":n=new Surface;break;case"Transform":n=new Transform;break;case"Translate":n=new Translate;break;case"TriList":n=new TriList;break;case"NullObject":n=new NullObject;registerParentableAttributes(n,t);break;case"Cube":n=new Cube;break;case"Material":n=new Material;break;case"ScreenRect":n=new ScreenRect;break}if(n){n.setGraphMgr(t.graphMgr)}return n}function newSGDirective(e,t){var n=null;switch(e){case"BBoxDirective":n=new BBoxDirective;break;case"RayPickDirective":n=new RayPickDirective;break;case"RenderDirective":n=new RenderDirective;break;case"SerializeDirective":n=new SerializeDirective;break;case"UpdateDirective":n=new UpdateDirective;break;case"CollideDirective":n=new CollideDirective;break;case"HighlightDirective":n=new HighlightDirective;break}if(n){n.setGraphMgr(t.graphMgr)}return n}function newModel(e,t){var n=new Model;n.setGraphMgr(t.graphMgr);registerParentableAttributes(n,t);return n}function newBBoxLocator(e,t){var n=new BBoxLocator;registerEvaluatorAttributes(n,t);return n}function newKeyframeInterpolator(e,t){var n=new KeyframeInterpolator;registerEvaluatorAttributes(n,t);return n}function newMapProjectionCalculator(e,t){var n=new MapProjectionCalculator;registerEvaluatorAttributes(n,t);return n}function newObjectInspector(e,t){var n=new ObjectInspector;registerEvaluatorAttributes(n,t);var r=t.registry.find("Selector");if(r){r.getAttribute("selectionOccurred").addTarget(n.getAttribute("selectionOccurred"),eAttrSetOp.Replace,null,false);r.getAttribute("selectionCleared").addTarget(n.getAttribute("selectionCleared"),eAttrSetOp.Replace,null,false);r.getAttribute("pointView").addTarget(n.getAttribute("pointView"),eAttrSetOp.Replace,null,false)}return n}function newSceneInspector(e,t){var n=new BwSceneInspector;registerEvaluatorAttributes(n,t);var r=t.registry.find("Selector");if(r){r.getAttribute("selectionOccurred").addTarget(n.getAttribute("selectionOccurred"),eAttrSetOp.Replace,null,false);r.getAttribute("distanceFromScreenCenter").addTarget(n.getAttribute("pivotDistance"),eAttrSetOp.Replace,null,false)}return n}function newTargetObserver(e,t){var n=new BwTargetObserver;registerEvaluatorAttributes(n,t);return n}function newAnimalMover(e,t){var n=new AnimalMover;registerEvaluatorAttributes(n,t);return n}function newWalkSimulator(e,t){var n=new WalkSimulator;registerEvaluatorAttributes(n,t);return n}function newMorphEffector(e,t){var n=new MorphEffector;registerEvaluatorAttributes(n,t);return n}function newBoneEffector(e,t){var n=new BoneEffector;registerEvaluatorAttributes(n,t);return n}function newCommand(e,t){var n=null;switch(e){case"AppendNode":n=new AppendNodeCommand;break;case"AutoInterpolate":n=new AutoInterpolateCommand;break;case"CommandSequence":n=new CommandSequence;break;case"ConnectAttributes":n=new ConnectAttributesCommand;break;case"ConnectOutputs":n=new ConnectAttributesCommand;break;case"DisconnectAttributes":n=new ConnectAttributesCommand;n.getAttribute("negate").setValueDirect(true);break;case"DisconnectOutputs":n=new ConnectAttributesCommand;n.getAttribute("negate").setValueDirect(true);break;case"Export":n=new ExportCommand;break;case"Locate":n=new LocateCommand;break;case"MotionInterpolate":n=new MotionInterpolateCommand;break;case"Pause":n=new PlayCommand;n.getAttribute("negate").setValueDirect(true);break;case"Play":n=new PlayCommand;break;case"Remove":n=new RemoveCommand;break;case"ScreenCapture":n=new ScreenCaptureCommand;break;case"Serialize":n=new SerializeCommand;break;case"Set":n=new SetCommand;break;case"Stop":n=new StopCommand;break;case"Morph":n=new MorphCommand;break;case"SnapTo":n=new SnapToCommand;break}if(e=="CommandSequence"){var r=t.registry.find("CommandMgr");if(r){r.pushCommandSequence(n)}}return n}function newDeviceHandler(e,t){var n=null;switch(e){case"MouseHandler":n=new MouseHandler;break;case"KeyboardHandler":n=new KeyboardHandler;break}return n}function configureModel(e,t){console.debug("TODO: "+arguments.callee.name)}function configureDirective(e,t){var n=new StringAttr("");n.addModifiedCB(AttributeFactory_DirectiveRootModifiedCB,t);e.registerAttribute(n,"root");var r=t.registry.getAttribute("rootPtr").getValueDirect();if(r){n.setValueDirect(r.getAttribute("name").getValueDirect().join(""))}}function finalizeModel(e,t){console.debug("TODO: remove LWO assumption");var n=e.getAttribute("url").getValueDirect();if(n){n=n.join("");var r=formatPath(n);console.debug("path: "+r[0]);console.debug("content dir: "+r[1]);var i=new LWObjectHandler;i.getAttribute("contentDirectory").setValueDirect(r[1]);var s=new LWObjectBuilder;s.setRegistry(t.registry);s.models.push(e);s.layer=e.getAttribute("layer").getValueDirect();s.visitHandler(i);i.parseFileStream(r[0])}addInspectionGroup(e,t)}function finalizeDirective(e,t){}function finalizeCommand(e,t){e.finalize();var n=t.registry.find("CommandMgr");if(n){if(e.className=="CommandSequence"){n.popCommandSequence()}n.addCommand(e)}}function finalizeDeviceHandler(e,t){var n=t.registry.find("EventMgr");if(n){var r=e.getEventTypes();for(var i=0;i<r.length;i++){n.addListener(r[i],e)}}}function finalizeEvaluator(e,t){console.debug("TODO: "+arguments.callee.name);switch(e.className){case"KeyframeInterpolator":var n=e.getAttribute("url").getValueDirect();if(n){n=n.join("");var r=formatPath(n);var i=new LWSceneHandler;i.getAttribute("contentDirectory").setValueDirect(r[1]);var s=new LWSceneBuilder;s.setRegistry(t.registry);s.evaluators.push(e);s.visitHandler(i);i.parseFileStream(r[0])}AttributeFactory_EvaluatorTargetConnectionTypeModifiedCB(e.getAttribute("targetConnectionType"),t);break}}function registerEvaluatorAttributes(e,t){if(!e.getAttribute("url")){var n=new StringAttr("");e.registerAttribute(n,"url")}if(!e.getAttribute("target")){var r=new StringAttr("");e.registerAttribute(r,"target")}if(!e.getAttribute("renderAndRelease")){var i=new BooleanAttr(false);e.registerAttribute(i,"renderAndRelease")}if(!e.getAttribute("targetConnectionType")){var s=new StringAttr("transform");s.addModifiedCB(AttributeFactory_EvaluatorTargetConnectionTypeModifiedCB,t);e.registerAttribute(s,"targetConnectionType")}}function registerParentableAttributes(e,t){if(!e.getAttribute("label")){var n=new StringAttr("");e.registerAttribute(n,"label");n.addModifiedCB(AttributeFactory_ParentableLabelModifiedCB,t)}if(!e.getAttribute("geoPosition")){var r=new Vector3DAttr;e.registerAttribute(r,"geoPosition");r.addModifiedCB(AttributeFactory_ParentableGeoPositionModifiedCB,t)}if(!e.getAttribute("altitude")){var i=new NumberAttr;e.registerAttribute(i,"altitude")}if(!e.getAttribute("latitude")){var s=new NumberAttr;e.registerAttribute(s,"latitude")}if(!e.getAttribute("longitude")){var o=new NumberAttr;e.registerAttribute(o,"longitude")}e.getAttribute("worldCenter").addModifiedCB(AttributeFactory_ParentableWorldPositionModifiedCB,t)}function getSceneGraph(){return this.sceneGraph}function AttributeFactory_DirectiveRootModifiedCB(e,t){var n=e.getContainer();var r=t.registry.getByName(e.getValueDirect().join(""));if(r){n.getAttribute("rootNode").setValueDirect(r[0])}}function AttributeFactory_ParentableLabelModifiedCB(e,t){console.debug("TODO: "+arguments.callee.name)}function AttributeFactory_ParentableGeoPositionModifiedCB(e,t){var n=e.getContainer();if(n){var r=t.registry.getByName("ConnectionMgr");if(r&&r.length){var i=r[0];var s=t.registry.getByType(eAttrType.MapProjectionCalculator);if(s&&s.length){var o=s[0];o.getAttribute("geoPosition").copyValue(e);i.connectMapProjectionCalculator(o,n);i.disconnectMapProjectionCalculator(o,n)}}}}function AttributeFactory_ParentableWorldPositionModifiedCB(e,t){}function AttributeFactory_EvaluatorTargetConnectionTypeModifiedCB(e,t){var n=e.getContainer();if(n){var r=new ConnectAttributesCommand;r.setRegistry(t.registry);r.getAttribute("sourceContainer").copyValue(n.getAttribute("name"));r.getAttribute("targetContainer").copyValue(n.getAttribute("target"));r.getAttribute("connectionType").copyValue(e);r.execute()}}function Bridgeworks(e,t,n){AttributeContainer.call(this);this.className="Bridgeworks";this.renderContext=newRenderContext("webgl",e,t);if(!this.renderContext)return;n=n==null?"BwContent":n;this.canvas=e;this.contentDir=n;this.graphMgr=new GraphMgr;this.graphMgr.setRenderContext(this.renderContext);this.styleMgr=new StyleMgr;this.registry=new BwRegistry;this.factory=new AttributeFactory;this.parser=new XMLParser(this.factory,this.registry,this.contentDir);this.eventAdapter=new EventAdapter;this.eventMgr=new EventMgr;this.commandMgr=new CommandMgr;this.connectionMgr=new ConnectionMgr;this.viewportMgr=new ViewportMgr;this.selector=new SelectionListener;this.rayPick=new RayPickDirective;this.renderAgent=new RenderAgent(this);this.renderController=new RenderController(this);this.layout=new GridLayout;this.mapProjectionCalculator=new MapProjectionCalculator;this.rasterComponentEventListener=new RasterComponentEventListener;this.graphMgr.setRegistry(this.registry);this.factory.setRegistry(this.registry);this.eventAdapter.setRegistry(this.registry);this.eventMgr.setRegistry(this.registry);this.commandMgr.setRegistry(this.registry);this.connectionMgr.setRegistry(this.registry);this.viewportMgr.setRegistry(this.registry);this.selector.setRegistry(this.registry);this.renderAgent.setRegistry(this.registry);this.layout.setRegistry(this.registry);this.mapProjectionCalculator.setRegistry(this.registry);this.rasterComponentEventListener.setRegistry(this.registry);this.factory.setGraphMgr(this.graphMgr);this.selector.setRayPick(this.rayPick);this.rasterComponentEventListener.setStyleMgr(this.styleMgr);this.rasterComponents=null;this.name=new StringAttr("Bridgeworks");this.onLoad=new StringAttr;this.onLoad.addModifiedCB(Bridgeworks_OnLoadModifiedCB,this);this.registerAttribute(this.name,"name");this.registerAttribute(this.onLoad,"onLoad");this.viewportMgr.getAttribute("width").setValueDirect(this.canvas.width);this.viewportMgr.getAttribute("height").setValueDirect(this.canvas.height);this.viewportMgr.getAttribute("layout").setValueDirect(this.layout);enumerateAttributeTypes();enumerateAttributeElementTypes();console.debug("TODO: "+arguments.callee.name);this.initRegistry();this.initEventListeners();this.viewportMgr.initLayout()}function Bridgeworks_OnLoadModifiedCB(e,t){t.onLoadModified()}Base.prototype.destroy=function(){delete this};var message="";var imgeData="";var cimageData="";var serializedScene="";Allocator.prototype.allocate=function(){return null};Color.prototype.v=function(){var e=[this.r,this.g,this.b,this.a];return e};Color.prototype.load=function(e,t,n,r){this.r=e;this.g=t;this.b=n;this.a=r};Color.prototype.copy=function(e){if(e){this.r=e.r;this.g=e.g;this.b=e.b;this.a=e.a}};Rect.prototype.load=function(e,t,n,r){this.left=e;this.top=t;this.right=n;this.bottom=r};Rect.prototype.loadRect=function(e){this.left=e.left;this.top=e.top;this.right=e.right;this.bottom=e.bottom};Viewport.prototype.load=function(e,t,n,r){this.x=e;this.y=t;this.width=n;this.height=r};Viewport.prototype.loadViewport=function(e){this.x=e.x;this.y=e.y;this.width=e.width;this.height=e.height};Viewport.prototype.containsPoint=function(e,t){if(e>=this.x&&t>=this.y&&e<=this.x+this.width&&t<=this.y+this.height)return true;return false};Stack.prototype.push=function(e){if(this.maxLength>0&&this.stack.length>=this.maxLength){this.pop()}this.stack.push(e)};Stack.prototype.pop=function(){if(this.stack.length>0){this.stack.pop()}};Stack.prototype.load=function(e){this.pop();this.push(e)};Stack.prototype.top=function(){if(this.stack.length>0){return this.stack[this.stack.length-1]}return null};Stack.prototype.getAt=function(e){if(this.stack.length>e){return this.stack[e]}return null};Stack.prototype.length=function(){return this.stack.length};Stack.prototype.empty=function(){return this.stack.length==0};Stack.prototype.clear=function(){this.stack.length=0};Stack.prototype.copy=function(){return this.stack.slice()};Queue.prototype.push=function(e){if(this.maxLength>0&&this.queue.length>=this.maxLength){this.pop()}this.queue.push(e)};Queue.prototype.pop=function(){if(this.queue.length>0){this.queue.shift()}};Queue.prototype.load=function(e){this.pop();this.push(e)};Queue.prototype.front=function(){if(this.queue.length>0){return this.queue[0]}return null};Queue.prototype.getAt=function(e){if(this.queue.length>e){return this.queue[e]}return null};Queue.prototype.length=function(){return this.queue.length};Queue.prototype.empty=function(){return this.queue.length==0};Queue.prototype.clear=function(){this.queue.length=0};Queue.prototype.copy=function(){return this.queue.slice()};var gAttributeBin=null;var gAttributePairs=null;var whitespace="\n\r	 ";XMLP=function(e){e=SAXStrings.replace(e,null,null,"\r\n","\n");e=SAXStrings.replace(e,null,null,"\r","\n");this.m_xml=e;this.m_iP=0;this.m_iState=XMLP._STATE_PROLOG;this.m_stack=new saxStack;this._clearAttributes()};XMLP._NONE=0;XMLP._ELM_B=1;XMLP._ELM_E=2;XMLP._ELM_EMP=3;XMLP._ATT=4;XMLP._TEXT=5;XMLP._ENTITY=6;XMLP._PI=7;XMLP._CDATA=8;XMLP._COMMENT=9;XMLP._DTD=10;XMLP._ERROR=11;XMLP._CONT_XML=0;XMLP._CONT_ALT=1;XMLP._ATT_NAME=0;XMLP._ATT_VAL=1;XMLP._STATE_PROLOG=1;XMLP._STATE_DOCUMENT=2;XMLP._STATE_MISC=3;XMLP._errs=new Array;XMLP._errs[XMLP.ERR_CLOSE_PI=0]="PI: missing closing sequence";XMLP._errs[XMLP.ERR_CLOSE_DTD=1]="DTD: missing closing sequence";XMLP._errs[XMLP.ERR_CLOSE_COMMENT=2]="Comment: missing closing sequence";XMLP._errs[XMLP.ERR_CLOSE_CDATA=3]="CDATA: missing closing sequence";XMLP._errs[XMLP.ERR_CLOSE_ELM=4]="Element: missing closing sequence";XMLP._errs[XMLP.ERR_CLOSE_ENTITY=5]="Entity: missing closing sequence";XMLP._errs[XMLP.ERR_PI_TARGET=6]="PI: target is required";XMLP._errs[XMLP.ERR_ELM_EMPTY=7]="Element: cannot be both empty and closing";XMLP._errs[XMLP.ERR_ELM_NAME=8]='Element: name must immediatly follow "<"';XMLP._errs[XMLP.ERR_ELM_LT_NAME=9]='Element: "<" not allowed in element names';XMLP._errs[XMLP.ERR_ATT_VALUES=10]="Attribute: values are required and must be in quotes";XMLP._errs[XMLP.ERR_ATT_LT_NAME=11]='Element: "<" not allowed in attribute names';XMLP._errs[XMLP.ERR_ATT_LT_VALUE=12]='Attribute: "<" not allowed in attribute values';XMLP._errs[XMLP.ERR_ATT_DUP=13]="Attribute: duplicate attributes not allowed";XMLP._errs[XMLP.ERR_ENTITY_UNKNOWN=14]="Entity: unknown entity";XMLP._errs[XMLP.ERR_INFINITELOOP=15]="Infininte loop";XMLP._errs[XMLP.ERR_DOC_STRUCTURE=16]="Document: only comments, processing instructions, or whitespace allowed outside of document element";XMLP._errs[XMLP.ERR_ELM_NESTING=17]="Element: must be nested correctly";XMLP.prototype._addAttribute=function(e,t){this.m_atts[this.m_atts.length]=new Array(e,t)};XMLP.prototype._checkStructure=function(e){if(XMLP._STATE_PROLOG==this.m_iState){if(XMLP._TEXT==e||XMLP._ENTITY==e){if(SAXStrings.indexOfNonWhitespace(this.getContent(),this.getContentBegin(),this.getContentEnd())!=-1){return this._setErr(XMLP.ERR_DOC_STRUCTURE)}}if(XMLP._ELM_B==e||XMLP._ELM_EMP==e){this.m_iState=XMLP._STATE_DOCUMENT}}if(XMLP._STATE_DOCUMENT==this.m_iState){if(XMLP._ELM_B==e||XMLP._ELM_EMP==e){this.m_stack.push(this.getName())}if(XMLP._ELM_E==e||XMLP._ELM_EMP==e){var t=this.m_stack.pop();if(t==null||t!=this.getName()){return this._setErr(XMLP.ERR_ELM_NESTING)}}if(this.m_stack.count()==0){this.m_iState=XMLP._STATE_MISC;return e}}if(XMLP._STATE_MISC==this.m_iState){if(XMLP._ELM_B==e||XMLP._ELM_E==e||XMLP._ELM_EMP==e||XMLP.EVT_DTD==e){return this._setErr(XMLP.ERR_DOC_STRUCTURE)}if(XMLP._TEXT==e||XMLP._ENTITY==e){if(SAXStrings.indexOfNonWhitespace(this.getContent(),this.getContentBegin(),this.getContentEnd())!=-1){return this._setErr(XMLP.ERR_DOC_STRUCTURE)}}}return e};XMLP.prototype._clearAttributes=function(){this.m_atts=new Array};XMLP.prototype._findAttributeIndex=function(e){for(var t=0;t<this.m_atts.length;t++){if(this.m_atts[t][XMLP._ATT_NAME]==e){return t}}return-1};XMLP.prototype.getAttributeCount=function(){return this.m_atts?this.m_atts.length:0};XMLP.prototype.getAttributeName=function(e){return e<0||e>=this.m_atts.length?null:this.m_atts[e][XMLP._ATT_NAME]};XMLP.prototype.getAttributeValue=function(e){return e<0||e>=this.m_atts.length?null:__unescapeString(this.m_atts[e][XMLP._ATT_VAL])};XMLP.prototype.getAttributeValueByName=function(e){return this.getAttributeValue(this._findAttributeIndex(e))};XMLP.prototype.getColumnNumber=function(){return SAXStrings.getColumnNumber(this.m_xml,this.m_iP)};XMLP.prototype.getContent=function(){return this.m_cSrc==XMLP._CONT_XML?this.m_xml:this.m_cAlt};XMLP.prototype.getContentBegin=function(){return this.m_cB};XMLP.prototype.getContentEnd=function(){return this.m_cE};XMLP.prototype.getLineNumber=function(){return SAXStrings.getLineNumber(this.m_xml,this.m_iP)};XMLP.prototype.getName=function(){return this.m_name};XMLP.prototype.next=function(){return this._checkStructure(this._parse())};XMLP.prototype._parse=function(){if(this.m_iP==this.m_xml.length){return XMLP._NONE}if(this.m_iP==this.m_xml.indexOf("<?",this.m_iP)){return this._parsePI(this.m_iP+2)}else if(this.m_iP==this.m_xml.indexOf("<!DOCTYPE",this.m_iP)){return this._parseDTD(this.m_iP+9)}else if(this.m_iP==this.m_xml.indexOf("<!--",this.m_iP)){return this._parseComment(this.m_iP+4)}else if(this.m_iP==this.m_xml.indexOf("<![CDATA[",this.m_iP)){return this._parseCDATA(this.m_iP+9)}else if(this.m_iP==this.m_xml.indexOf("<",this.m_iP)){return this._parseElement(this.m_iP+1)}else if(this.m_iP==this.m_xml.indexOf("&",this.m_iP)){return this._parseEntity(this.m_iP+1)}else{return this._parseText(this.m_iP)}};XMLP.prototype._parseAttribute=function(e,t){var n,r,i,s,o;var u,a,f;this.m_cAlt="";n=SAXStrings.indexOfNonWhitespace(this.m_xml,e,t);if(n==-1||n>=t){return n}i=this.m_xml.indexOf("=",n);if(i==-1||i>t){return this._setErr(XMLP.ERR_ATT_VALUES)}r=SAXStrings.lastIndexOfNonWhitespace(this.m_xml,n,i);s=SAXStrings.indexOfNonWhitespace(this.m_xml,i+1,t);if(s==-1||s>t){return this._setErr(XMLP.ERR_ATT_VALUES)}u=this.m_xml.charAt(s);if(SAXStrings.QUOTES.indexOf(u)==-1){return this._setErr(XMLP.ERR_ATT_VALUES)}o=this.m_xml.indexOf(u,s+1);if(o==-1||o>t){return this._setErr(XMLP.ERR_ATT_VALUES)}a=this.m_xml.substring(n,r+1);f=this.m_xml.substring(s+1,o);if(a.indexOf("<")!=-1){return this._setErr(XMLP.ERR_ATT_LT_NAME)}if(f.indexOf("<")!=-1){return this._setErr(XMLP.ERR_ATT_LT_VALUE)}f=SAXStrings.replace(f,null,null,"\n"," ");f=SAXStrings.replace(f,null,null,"	"," ");iRet=this._replaceEntities(f);if(iRet==XMLP._ERROR){return iRet}f=this.m_cAlt;if(this._findAttributeIndex(a)==-1){this._addAttribute(a,f)}else{return this._setErr(XMLP.ERR_ATT_DUP)}this.m_iP=o+2;return XMLP._ATT};XMLP.prototype._parseCDATA=function(e){var t=this.m_xml.indexOf("]]>",e);if(t==-1){return this._setErr(XMLP.ERR_CLOSE_CDATA)}this._setContent(XMLP._CONT_XML,e,t);this.m_iP=t+3;return XMLP._CDATA};XMLP.prototype._parseComment=function(e){var t=this.m_xml.indexOf("-"+"->",e);if(t==-1){return this._setErr(XMLP.ERR_CLOSE_COMMENT)}this._setContent(XMLP._CONT_XML,e,t);this.m_iP=t+3;return XMLP._COMMENT};XMLP.prototype._parseDTD=function(e){var t,n,r,i;t=this.m_xml.indexOf(">",e);if(t==-1){return this._setErr(XMLP.ERR_CLOSE_DTD)}r=this.m_xml.indexOf("[",e);n=r!=-1&&r<t?"]>":">";while(true){if(t==i){return this._setErr(XMLP.ERR_INFINITELOOP)}i=t;t=this.m_xml.indexOf(n,e);if(t==-1){return this._setErr(XMLP.ERR_CLOSE_DTD)}if(this.m_xml.substring(t-1,t+2)!="]]>"){break}}this.m_iP=t+n.length;return XMLP._DTD};XMLP.prototype._parseElement=function(e){var t,n,r,i;var s,o,u;n=t=this.m_xml.indexOf(">",e);if(t==-1){return this._setErr(XMLP.ERR_CLOSE_ELM)}if(this.m_xml.charAt(e)=="/"){s=XMLP._ELM_E;e++}else{s=XMLP._ELM_B}if(this.m_xml.charAt(t-1)=="/"){if(s==XMLP._ELM_E){return this._setErr(XMLP.ERR_ELM_EMPTY)}s=XMLP._ELM_EMP;n--}n=SAXStrings.lastIndexOfNonWhitespace(this.m_xml,e,n);if(t-e!=1){if(SAXStrings.indexOfNonWhitespace(this.m_xml,e,n)!=e){return this._setErr(XMLP.ERR_ELM_NAME)}}this._clearAttributes();r=SAXStrings.indexOfWhitespace(this.m_xml,e,n);if(r==-1){r=n+1}else{this.m_iP=r;while(this.m_iP<n){if(this.m_iP==u)return this._setErr(XMLP.ERR_INFINITELOOP);u=this.m_iP;i=this._parseAttribute(this.m_iP,n);if(i==XMLP._ERROR)return i}}o=this.m_xml.substring(e,r);if(o.indexOf("<")!=-1){return this._setErr(XMLP.ERR_ELM_LT_NAME)}this.m_name=o;this.m_iP=t+1;return s};XMLP.prototype._parseEntity=function(e){var t=this.m_xml.indexOf(";",e);if(t==-1){return this._setErr(XMLP.ERR_CLOSE_ENTITY)}this.m_iP=t+1;return this._replaceEntity(this.m_xml,e,t)};XMLP.prototype._parsePI=function(e){var t,n,r,i,s;t=this.m_xml.indexOf("?>",e);if(t==-1){return this._setErr(XMLP.ERR_CLOSE_PI)}n=SAXStrings.indexOfNonWhitespace(this.m_xml,e,t);if(n==-1){return this._setErr(XMLP.ERR_PI_TARGET)}r=SAXStrings.indexOfWhitespace(this.m_xml,n,t);if(r==-1){r=t}i=SAXStrings.indexOfNonWhitespace(this.m_xml,r,t);if(i==-1){i=t}s=SAXStrings.lastIndexOfNonWhitespace(this.m_xml,i,t);if(s==-1){s=t-1}this.m_name=this.m_xml.substring(n,r);this._setContent(XMLP._CONT_XML,i,s+1);this.m_iP=t+2;return XMLP._PI};XMLP.prototype._parseText=function(e){var t,n;t=this.m_xml.indexOf("<",e);if(t==-1){t=this.m_xml.length}n=this.m_xml.indexOf("&",e);if(n!=-1&&n<=t){t=n}this._setContent(XMLP._CONT_XML,e,t);this.m_iP=t;return XMLP._TEXT};XMLP.prototype._replaceEntities=function(e,t,n){if(SAXStrings.isEmpty(e))return"";t=t||0;n=n||e.length;var r,i,s="";r=e.indexOf("&",t);i=t;while(r>0&&r<n){s+=e.substring(i,r);i=e.indexOf(";",r)+1;if(i==0||i>n){return this._setErr(XMLP.ERR_CLOSE_ENTITY)}iRet=this._replaceEntity(e,r+1,i-1);if(iRet==XMLP._ERROR){return iRet}s+=this.m_cAlt;r=e.indexOf("&",i)}if(i!=n){s+=e.substring(i,n)}this._setContent(XMLP._CONT_ALT,s);return XMLP._ENTITY};XMLP.prototype._replaceEntity=function(e,t,n){if(SAXStrings.isEmpty(e))return-1;t=t||0;n=n||e.length;switch(e.substring(t,n)){case"amp":strEnt="&";break;case"lt":strEnt="<";break;case"gt":strEnt=">";break;case"apos":strEnt="'";break;case"quot":strEnt='"';break;default:if(e.charAt(t)=="#"){strEnt=String.fromCharCode(parseInt(e.substring(t+1,n)))}else{return this._setErr(XMLP.ERR_ENTITY_UNKNOWN)}break}this._setContent(XMLP._CONT_ALT,strEnt);return XMLP._ENTITY};XMLP.prototype._setContent=function(e){var t=arguments;if(XMLP._CONT_XML==e){this.m_cAlt=null;this.m_cB=t[1];this.m_cE=t[2]}else{this.m_cAlt=t[1];this.m_cB=0;this.m_cE=t[1].length}this.m_cSrc=e};XMLP.prototype._setErr=function(e){var t=XMLP._errs[e];this.m_cAlt=t;this.m_cB=0;this.m_cE=t.length;this.m_cSrc=XMLP._CONT_ALT;return XMLP._ERROR};SAXDriver=function(){this.m_hndDoc=null;this.m_hndErr=null;this.m_hndLex=null};SAXDriver.DOC_B=1;SAXDriver.DOC_E=2;SAXDriver.ELM_B=3;SAXDriver.ELM_E=4;SAXDriver.CHARS=5;SAXDriver.PI=6;SAXDriver.CD_B=7;SAXDriver.CD_E=8;SAXDriver.CMNT=9;SAXDriver.DTD_B=10;SAXDriver.DTD_E=11;SAXDriver.prototype.parse=function(e){var t=new XMLP(e);if(this.m_hndDoc&&this.m_hndDoc.setDocumentLocator){this.m_hndDoc.setDocumentLocator(this)}this.m_parser=t;this.m_bErr=false;if(!this.m_bErr){this._fireEvent(SAXDriver.DOC_B)}this._parseLoop();if(!this.m_bErr){this._fireEvent(SAXDriver.DOC_E)}this.m_xml=null;this.m_iP=0};SAXDriver.prototype.setDocumentHandler=function(e){this.m_hndDoc=e};SAXDriver.prototype.setErrorHandler=function(e){this.m_hndErr=e};SAXDriver.prototype.setLexicalHandler=function(e){this.m_hndLex=e};SAXDriver.prototype.getColumnNumber=function(){return this.m_parser.getColumnNumber()};SAXDriver.prototype.getLineNumber=function(){return this.m_parser.getLineNumber()};SAXDriver.prototype.getMessage=function(){return this.m_strErrMsg};SAXDriver.prototype.getPublicId=function(){return null};SAXDriver.prototype.getSystemId=function(){return null};SAXDriver.prototype.getLength=function(){return this.m_parser.getAttributeCount()};SAXDriver.prototype.getName=function(e){return this.m_parser.getAttributeName(e)};SAXDriver.prototype.getValue=function(e){return this.m_parser.getAttributeValue(e)};SAXDriver.prototype.getValueByName=function(e){return this.m_parser.getAttributeValueByName(e)};SAXDriver.prototype._fireError=function(e){this.m_strErrMsg=e;this.m_bErr=true;if(this.m_hndErr&&this.m_hndErr.fatalError){this.m_hndErr.fatalError(this)}};SAXDriver.prototype._fireEvent=function(e){var t,n,r=arguments,i=r.length-1;if(this.m_bErr)return;if(SAXDriver.DOC_B==e){n="startDocument";t=this.m_hndDoc}else if(SAXDriver.DOC_E==e){n="endDocument";t=this.m_hndDoc}else if(SAXDriver.ELM_B==e){n="startElement";t=this.m_hndDoc}else if(SAXDriver.ELM_E==e){n="endElement";t=this.m_hndDoc}else if(SAXDriver.CHARS==e){n="characters";t=this.m_hndDoc}else if(SAXDriver.PI==e){n="processingInstruction";t=this.m_hndDoc}else if(SAXDriver.CD_B==e){n="startCDATA";t=this.m_hndLex}else if(SAXDriver.CD_E==e){n="endCDATA";t=this.m_hndLex}else if(SAXDriver.CMNT==e){n="comment";t=this.m_hndLex}if(t&&t[n]){if(0==i){t[n]()}else if(1==i){t[n](r[1])}else if(2==i){t[n](r[1],r[2])}else if(3==i){t[n](r[1],r[2],r[3])}}};SAXDriver.prototype._parseLoop=function(e){var t,e;e=this.m_parser;while(!this.m_bErr){t=e.next();if(t==XMLP._ELM_B){this._fireEvent(SAXDriver.ELM_B,e.getName(),this)}else if(t==XMLP._ELM_E){this._fireEvent(SAXDriver.ELM_E,e.getName())}else if(t==XMLP._ELM_EMP){this._fireEvent(SAXDriver.ELM_B,e.getName(),this);this._fireEvent(SAXDriver.ELM_E,e.getName())}else if(t==XMLP._TEXT){this._fireEvent(SAXDriver.CHARS,e.getContent(),e.getContentBegin(),e.getContentEnd()-e.getContentBegin())}else if(t==XMLP._ENTITY){this._fireEvent(SAXDriver.CHARS,e.getContent(),e.getContentBegin(),e.getContentEnd()-e.getContentBegin())}else if(t==XMLP._PI){this._fireEvent(SAXDriver.PI,e.getName(),e.getContent().substring(e.getContentBegin(),e.getContentEnd()))}else if(t==XMLP._CDATA){this._fireEvent(SAXDriver.CD_B);this._fireEvent(SAXDriver.CHARS,e.getContent(),e.getContentBegin(),e.getContentEnd()-e.getContentBegin());this._fireEvent(SAXDriver.CD_E)}else if(t==XMLP._COMMENT){this._fireEvent(SAXDriver.CMNT,e.getContent(),e.getContentBegin(),e.getContentEnd()-e.getContentBegin())}else if(t==XMLP._DTD){}else if(t==XMLP._ERROR){this._fireError(e.getContent())}else if(t==XMLP._NONE){return}}};SAXStrings=function(){};SAXStrings.WHITESPACE=" 	\n\r";SAXStrings.QUOTES="\"'";SAXStrings.getColumnNumber=function(e,t){if(SAXStrings.isEmpty(e)){return-1}t=t||e.length;var n=e.substring(0,t).split("\n");var r=n[n.length-1];n.length--;var i=n.join("\n").length;return t-i};SAXStrings.getLineNumber=function(e,t){if(SAXStrings.isEmpty(e)){return-1}t=t||e.length;return e.substring(0,t).split("\n").length};SAXStrings.indexOfNonWhitespace=function(e,t,n){if(SAXStrings.isEmpty(e)){return-1}t=t||0;n=n||e.length;for(var r=t;r<n;r++){if(SAXStrings.WHITESPACE.indexOf(e.charAt(r))==-1){return r}}return-1};SAXStrings.indexOfWhitespace=function(e,t,n){if(SAXStrings.isEmpty(e)){return-1}t=t||0;n=n||e.length;for(var r=t;r<n;r++){if(SAXStrings.WHITESPACE.indexOf(e.charAt(r))!=-1){return r}}return-1};SAXStrings.isEmpty=function(e){return e==null||e.length==0};SAXStrings.lastIndexOfNonWhitespace=function(e,t,n){if(SAXStrings.isEmpty(e)){return-1}t=t||0;n=n||e.length;for(var r=n-1;r>=t;r--){if(SAXStrings.WHITESPACE.indexOf(e.charAt(r))==-1){return r}}return-1};SAXStrings.replace=function(e,t,n,r,i){if(SAXStrings.isEmpty(e)){return""}t=t||0;n=n||e.length;return e.substring(t,n).split(r).join(i)};saxStack=function(){this.m_arr=new Array};saxStack.prototype.clear=function(){this.m_arr=new Array};saxStack.prototype.count=function(){return this.m_arr.length};saxStack.prototype.destroy=function(){this.m_arr=null};saxStack.prototype.peek=function(){if(this.m_arr.length==0){return null}return this.m_arr[this.m_arr.length-1]};saxStack.prototype.pop=function(){if(this.m_arr.length==0){return null}var e=this.m_arr[this.m_arr.length-1];this.m_arr.length--;return e};saxStack.prototype.push=function(e){this.m_arr[this.m_arr.length]=e};var xmlTextArray;var xmlCDataArray;var xmlAttrArray;xmlHandler=function(){this.m_strError="";this.m_treePath=[];this.m_xPath=[""];this.m_text=[""];this.m_cdata=[""];this.m_attr=[""];this.m_pi=[""];this.cdata=false};xmlHandler.prototype.characters=function(e,t,n){var r=e.substr(t,n);if(r=="\n")return null;if(this.m_treePath.length>0){if(this.cdata==false){if(!this.m_text[this.m_xPath.join("/")]){this.m_text[this.m_xPath.join("/")]=""}this.m_text[this.m_xPath.join("/")]+=r}else{if(!this.m_cdata[this.m_xPath.join("/")]){this.m_cdata[this.m_xPath.join("/")]=""}this.m_cdata[this.m_xPath.join("/")]+=r}}};xmlHandler.prototype.comment=function(e,t,n){var r=e.substr(t,n)};xmlHandler.prototype.endCDATA=function(){this.cdata=false};xmlHandler.prototype.endDocument=function(){};xmlHandler.prototype.endElement=function(e){this.m_xPath=this.m_xPath.slice(0,-1)};xmlHandler.prototype.error=function(e){this.m_strError+="Error:"+e.getMessage()+"\n"};xmlHandler.prototype.fatalError=function(e){this.m_strError+="fatal error:"+e.getMessage()+"\n"};xmlHandler.prototype.getAttr_Array=function(){return this.m_attr};xmlHandler.prototype.getCDATA_Array=function(){return this.m_cdata};xmlHandler.prototype.getError=function(){return this.m_strError};xmlHandler.prototype.getPath_Array=function(){return this.m_treePath};xmlHandler.prototype.getText_Array=function(){return this.m_text};xmlHandler.prototype.processingInstruction=function(e,t){};xmlHandler.prototype.setDocumentLocator=function(e){this.m_locator=e};xmlHandler.prototype.startCDATA=function(){this.cdata=true};xmlHandler.prototype.startDocument=function(){};xmlHandler.prototype.startElement=function(e,t){alert(e);var n,r=t.getLength();this.m_xPath[this.m_xPath.length]=e;n=this.m_xPath.join("/");this.m_treePath[this.m_treePath.length]=n;if(r){var s=[];for(i=0;i<r;i++){s[t.getName(i)]=t.getValue(i)}this.m_attr[this.m_xPath.join("/")]=s}};xmlHandler.prototype.warning=function(e){this.m_strError+="Warning:"+e.getMessage()+"\n"};Timer.prototype.start=function(){var e=new Date;this.startTime=e.getTime()};Timer.prototype.stop=function(){var e=new Date;this.stopTime=e.getTime()};Timer.prototype.getTime=function(){if(this.startTime&&this.stopTime){return(this.stopTime-this.startTime)/1e3}return 0};var __userAgent=navigator.userAgent;var __isIE=navigator.appVersion.match(/MSIE/)!=null;var __IEVersion=__getIEVersion();var __isIENew=__isIE&&__IEVersion>=8;var __isIEOld=__isIE&&!__isIENew;var __isFireFox=__userAgent.match(/firefox/i)!=null;var __isFireFoxOld=__isFireFox&&(__userAgent.match(/firefox\/2./i)!=null||__userAgent.match(/firefox\/1./i)!=null);var __isFireFoxNew=__isFireFox&&!__isFireFoxOld;var __isWebKit=navigator.appVersion.match(/WebKit/)!=null;var __isChrome=navigator.appVersion.match(/Chrome/)!=null;var __isOpera=window.opera!=null;var __operaVersion=__getOperaVersion();var __isOperaOld=__isOpera&&__operaVersion<10;var eEndBehavior={Reset:0,Constant:1,Repeat:2,Oscillate:3,OffsetRepeat:4,Linear:5};var eImageAntialiasOp={None:0,TwoPass:1,FourPass:2,EightPass:3,EnumCount:4};var eKeyframeShape={Linear:0,Stepped:1,TCB:2,Bezier1D:3,Bezier2D:4,Hermite:5};var eTextureType={Color:0,Diffuse:1,Luminosity:2,Reflection:3,Specularity:4,Transparency:5,Clip:6,Bump:7,EnumCount:8};var eTextureWrap={None:0,Clamp:1,Repeat:2,Mirror:3,EnumCount:4};var eHighlightType={None:0,FourPass:1,EightPass:2};var eBoneFalloffType={InverseDistance:0,InverseDistance_2:1,InverseDistance_4:2,InverseDistance_8:3,InverseDistance_16:4};var FLT_EPSILON=1.192092896e-7;var FLT_MAX=3.402823466e38;var TWOPI=Math.PI*2;var HALFPI=Math.PI/2;var QUARTERPI=Math.PI/4;Vector2D.prototype.v=function(){var e=[this.x,this.y];return e};Vector2D.prototype.load=function(e,t){this.x=e;this.y=t};Vector2D.prototype.copy=function(e){if(e){this.x=e.x;this.y=e.y}};Vector3D.prototype.alert=function(){var e="x: "+this.x+"\n";e+="y: "+this.y+"\n";e+="z: "+this.z+"\n";alert(e)};Vector3D.prototype.v=function(){var e=[this.x,this.y,this.z];return e};Vector3D.prototype.load=function(e,t,n){this.x=e;this.y=t;this.z=n};Vector3D.prototype.copy=function(e){if(e){this.x=e.x;this.y=e.y;this.z=e.z}};Vector3D.prototype.multiplyScalar=function(e){this.x*=e;this.y*=e;this.z*=e};Vector3D.prototype.multiplyVector=function(e){this.x*=e.x;this.y*=e.y;this.z*=e.z};Vector3D.prototype.addVector=function(e){this.x+=e.x;this.y+=e.y;this.z+=e.z};Vector3D.prototype.subtractVector=function(e){this.x-=e.x;this.y-=e.y;this.z-=e.z};Vector3D.prototype.normalize=function(){var e=magnitude(this.x,this.y,this.z);if(e!=0){this.x/=e;this.y/=e;this.z/=e}};Vector4D.prototype.v=function(){var e=[this.x,this.y,this.z,this.w];return e};Vector4D.prototype.load=function(e,t,n,r){if(Vector4D){this.x=e;this.y=t;this.z=n;this.w=r}};Vector4D.prototype.copy=function(e){this.x=e.x;this.y=e.y;this.z=e.z;this.w=e.w};Matrix4x4.prototype.alert=function(){alert([[this._11,this._12,this._13,this._14].join(" "),[this._21,this._22,this._23,this._24].join(" "),[this._31,this._32,this._33,this._34].join(" "),[this._41,this._42,this._43,this._44].join(" ")].join("\n"))};Matrix4x4.prototype.flatten=function(){var e=[this._11,this._12,this._13,this._14,this._21,this._22,this._23,this._24,this._31,this._32,this._33,this._34,this._41,this._42,this._43,this._44];return e};Matrix4x4.prototype.getAt=function(e,t){switch(e){case 0:{switch(t){case 0:return this._11;case 1:return this._12;case 2:return this._13;case 3:return this._14}}break;case 1:{switch(t){case 0:return this._21;case 1:return this._22;case 2:return this._23;case 3:return this._24}}break;case 2:{switch(t){case 0:return this._31;case 1:return this._32;case 2:return this._33;case 3:return this._34}}break;case 3:{switch(t){case 0:return this._41;case 1:return this._42;case 2:return this._43;case 3:return this._44}}break}};Matrix4x4.prototype.setAt=function(e,t,n){switch(e){case 0:{switch(t){case 0:this._11=n;break;case 1:this._12=n;break;case 2:this._13=n;break;case 3:this._14=n;break}}break;case 1:{switch(t){case 0:this._21=n;break;case 1:this._22=n;break;case 2:this._23=n;break;case 3:this._24=n;break}}break;case 2:{switch(t){case 0:this._31=n;break;case 1:this._32=n;break;case 2:this._33=n;break;case 3:this._34=n;break}}break;case 3:{switch(t){case 0:this._41=n;break;case 1:this._42=n;break;case 2:this._43=n;break;case 3:this._44=n;break}}break}};Matrix4x4.prototype.load=function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){this._11=e;this._12=t;this._13=n;this._14=r;this._21=i;this._22=s;this._23=o;this._24=u;this._31=a;this._32=f;this._33=l;this._34=c;this._41=h;this._42=p;this._43=d;this._44=v};Matrix4x4.prototype.loadMatrix=function(e){this._11=e._11;this._12=e._12;this._13=e._13;this._14=e._14;this._21=e._21;this._22=e._22;this._23=e._23;this._24=e._24;this._31=e._31;this._32=e._32;this._33=e._33;this._34=e._34;this._41=e._41;this._42=e._42;this._43=e._43;this._44=e._44};Matrix4x4.prototype.loadArray=function(e){this._11=e[0];this._12=e[1];this._13=e[2];this._14=e[3];this._21=e[4];this._22=e[5];this._23=e[6];this._24=e[7];this._31=e[8];this._32=e[9];this._33=e[10];this._34=e[11];this._41=e[12];this._42=e[13];this._43=e[14];this._44=e[15]};Matrix4x4.prototype.loadIdentity=function(){this._11=1;this._12=0;this._13=0;this._14=0;this._21=0;this._22=1;this._23=0;this._24=0;this._31=0;this._32=0;this._33=1;this._34=0;this._41=0;this._42=0;this._43=0;this._44=1};Matrix4x4.prototype.loadTranslation=function(e,t,n){this.loadIdentity();this._41=e;this._42=t;this._43=n};Matrix4x4.prototype.loadRotation=function(e,t,n,r){var i=new Matrix4x4;var s=new Matrix4x4;var o=Math.sqrt(t*t+n*n);if(o!=0){var u=t/o;var a=n/o;i._22=a;i._23=u;i._32=-u;i._33=a;s._22=a;s._23=-u;s._32=u;s._33=a}var f=new Matrix4x4;var l=new Matrix4x4;var c=magnitude(e,t,n);if(c!=0){var h=o/c;var p=e/c;f._11=h;f._13=p;f._31=-p;f._33=h;l._11=h;l._13=-p;l._31=p;l._33=h}var d=new Matrix4x4;var v=Math.cos(toRadians(r));var m=Math.sin(toRadians(r));d._11=v;d._12=m;d._21=-m;d._22=v;var g=i.multiply(f.multiply(d.multiply(l.multiply(s))));this.loadMatrix(g)};Matrix4x4.prototype.loadXAxisRotation=function(e){this.loadIdentity();var t=Math.cos(toRadians(e));var n=Math.sin(toRadians(e));this._22=t;this._23=n;this._32=-n;this._33=t};Matrix4x4.prototype.loadYAxisRotation=function(e){this.loadIdentity();var t=Math.cos(toRadians(e));var n=Math.sin(toRadians(e));this._11=t;this._13=-n;this._31=n;this._33=t};Matrix4x4.prototype.loadZAxisRotation=function(e){this.loadIdentity();var t=Math.cos(toRadians(e));var n=Math.sin(toRadians(e));this._11=t;this._12=n;this._21=-n;this._22=t};Matrix4x4.prototype.loadXYZAxisRotation=function(e,t,n){var r=new Matrix4x4;var i=new Matrix4x4;var s=new Matrix4x4;r.loadXAxisRotation(e);i.loadYAxisRotation(t);s.loadZAxisRotation(n);var o=i.multiply(r.multiply(s));this.loadMatrix(o)};Matrix4x4.prototype.getRotationAngles=function(){var e,t,n;e=Math.asin(clamp(this._23,-1,1));var r=Math.cos(e);if(!epsilonEqual(r,0,FLT_EPSILON)){t=Math.atan2(-this._13/r,this._33/r);n=Math.atan2(-this._21/r,this._22/r)}else{var i=new Matrix4x4;i.loadXAxisRotation(toDegrees(e));i.transpose();i.loadMatrix(i.multiply(this));t=0;n=Math.atan2(-i._21,i._22)}return{x:toDegrees(e),y:toDegrees(t),z:toDegrees(n)}};Matrix4x4.prototype.loadScale=function(e,t,n){this.loadIdentity();this._11=e;this._22=t;this._33=n};Matrix4x4.prototype.getScalingFactors=function(){var e,t;e=this.transform(1,0,0,0);t=this.transform(2,0,0,0);var n=magnitude(t.x,t.y,t.z)-magnitude(e.x,e.y,e.z);e=this.transform(0,1,0,0);t=this.transform(0,2,0,0);var r=magnitude(t.x,t.y,t.z)-magnitude(e.x,e.y,e.z);e=this.transform(0,0,1,0);t=this.transform(0,0,2,0);var i=magnitude(t.x,t.y,t.z)-magnitude(e.x,e.y,e.z);return{x:n,y:r,z:i}};Matrix4x4.prototype.multiply=function(e){var t=new Matrix4x4;if(!e){return null}t.load(this._11*e._11+this._12*e._21+this._13*e._31+this._14*e._41,this._11*e._12+this._12*e._22+this._13*e._32+this._14*e._42,this._11*e._13+this._12*e._23+this._13*e._33+this._14*e._43,this._11*e._14+this._12*e._24+this._13*e._34+this._14*e._44,this._21*e._11+this._22*e._21+this._23*e._31+this._24*e._41,this._21*e._12+this._22*e._22+this._23*e._32+this._24*e._42,this._21*e._13+this._22*e._23+this._23*e._33+this._24*e._43,this._21*e._14+this._22*e._24+this._23*e._34+this._24*e._44,this._31*e._11+this._32*e._21+this._33*e._31+this._34*e._41,this._31*e._12+this._32*e._22+this._33*e._32+this._34*e._42,this._31*e._13+this._32*e._23+this._33*e._33+this._34*e._43,this._31*e._14+this._32*e._24+this._33*e._34+this._34*e._44,this._41*e._11+this._42*e._21+this._43*e._31+this._44*e._41,this._41*e._12+this._42*e._22+this._43*e._32+this._44*e._42,this._41*e._13+this._42*e._23+this._43*e._33+this._44*e._43,this._41*e._14+this._42*e._24+this._43*e._34+this._44*e._44);return t};Matrix4x4.prototype.leftMultiply=function(e){var t=e.multiply(this);return t};Matrix4x4.prototype.transpose=function(){var e=new Matrix4x4;e.loadMatrix(this);this._11=e._11;this._12=e._21;this._13=e._31;this._14=e._41;this._21=e._12;this._22=e._22;this._23=e._32;this._24=e._42;this._31=e._13;this._32=e._23;this._33=e._33;this._34=e._43;this._41=e._14;this._42=e._24;this._43=e._34;this._44=e._44};Matrix4x4.prototype.invert=function(){var e=determinant4x4(this._11,this._12,this._13,this._14,this._21,this._22,this._23,this._24,this._31,this._32,this._33,this._34,this._41,this._42,this._43,this._44);if(e==0){return}var t=new Matrix4x4;var n,r,i,s,o;for(n=0;n<4;n++){for(r=0;r<4;r++){var u=[];for(i=0,o=0;i<4;i++){if(i==n)continue;for(s=0;s<4;s++){if(s==r)continue;u[o++]=this.getAt(i,s)}}t.setAt(n,r,determinant3x3(u[0],u[1],u[2],u[3],u[4],u[5],u[6],u[7],u[8])/e*(n+r&1?-1:1))}}t.transpose();this.loadMatrix(t)};Matrix4x4.prototype.transform=function(e,t,n,r){var i,s,o;if(r==0){i=this._11*e+this._21*t+this._31*n;s=this._12*e+this._22*t+this._32*n;o=this._13*e+this._23*t+this._33*n}else if(r==1){i=this._11*e+this._21*t+this._31*n+this._41;s=this._12*e+this._22*t+this._32*n+this._42;o=this._13*e+this._23*t+this._33*n+this._43}else{i=this._11*e+this._21*t+this._31*n+this._41*r;s=this._12*e+this._22*t+this._32*n+this._42*r;o=this._13*e+this._23*t+this._33*n+this._43*r}return{x:i,y:s,z:o}};Matrix4x4.prototype.transformw=function(e,t,n,r){var i,s,o,u;if(r==0){i=this._11*e+this._21*t+this._31*n;s=this._12*e+this._22*t+this._32*n;o=this._13*e+this._23*t+this._33*n;u=this._14*e+this._24*t+this._34*n}else if(r==1){i=this._11*e+this._21*t+this._31*n+this._41;s=this._12*e+this._22*t+this._32*n+this._42;o=this._13*e+this._23*t+this._33*n+this._43;u=this._14*e+this._24*t+this._34*n+this._44}else{i=this._11*e+this._21*t+this._31*n+this._41*r;s=this._12*e+this._22*t+this._32*n+this._42*r;o=this._13*e+this._23*t+this._33*n+this._43*r;u=this._14*e+this._24*t+this._34*n+this._44*r}return{x:i,y:s,z:o,w:u}};Matrix4x4.prototype.transformVector3D=function(e,t){return this.transform(e.x,e.y,e.z,t)};MatrixStack.prototype=new Stack;MatrixStack.prototype.constructor=MatrixStack;MatrixStack.prototype.push=function(e){if(e){this.stack.push(e)}else{this.stack.push(this.top())}};MatrixStack.prototype.loadMatrix=function(e){this.load(e)};MatrixStack.prototype.leftMultiply=function(e){var t=e.multiply(this.top());this.pop();Stack.prototype.push.call(this,t)};MatrixStack.prototype.rightMultiply=function(e){var t=this.top().multiply(e);this.pop();Stack.prototype.push.call(this,t)};Quaternion.prototype.load=function(e,t,n,r){this.w=e;this.x=t;this.y=n;this.z=r};Quaternion.prototype.loadQuaternion=function(e){this.w=e.w;this.x=e.x;this.y=e.y;this.z=e.z};Quaternion.prototype.loadArray=function(e){this.w=e[0];this.x=e[1];this.y=e[2];this.z=e[3]};Quaternion.prototype.loadIdentity=function(){this.w=1;this.x=0;this.y=0;this.z=0};Quaternion.prototype.magnitude=function(){return Math.sqrt(this.w*this.w+this.x*this.x+this.y*this.y+this.z*this.z)};Quaternion.prototype.normalize=function(){var e=this.magnitude();this.w/=e;this.x/=e;this.y/=e;this.z/=e};Quaternion.prototype.loadRotation=function(e,t,n,r){var i=toRadians(r)/2;var s=Math.sin(i);var o=Math.cos(i);this.w=o;this.x=e*s;this.y=t*s;this.z=n*s;this.normalize()};Quaternion.prototype.loadXAxisRotation=function(e){var t=toRadians(e)/2;this.w=Math.cos(t);this.x=Math.sin(t);this.y=0;this.z=0};Quaternion.prototype.loadYAxisRotation=function(e){var t=toRadians(e)/2;this.w=Math.cos(t);this.x=0;this.y=Math.sin(t);this.z=0};Quaternion.prototype.loadZAxisRotation=function(e){var t=toRadians(e)/2;this.w=Math.cos(t);this.x=0;this.y=0;this.z=Math.sin(t)};Quaternion.prototype.loadXYZAxisRotation=function(e,t,n){var r=toRadians(e)/2;var i=toRadians(t)/2;var s=toRadians(n)/2;var o=new Quaternion;o.load(Math.cos(r),Math.sin(r),0,0);var u=new Quaternion;u.load(Math.cos(i),0,Math.sin(i),0);var a=new Quaternion;a.load(Math.cos(s),0,0,Math.sin(s));var f=u.multiply(o.multiply(a));this.loadQuaternion(f)};Quaternion.prototype.multiply=function(e){var t=new Quaternion;t.load(this.w*e.w-this.x*e.x-this.y*e.y-this.z*e.z,this.w*e.x+this.x*e.w+this.y*e.z-this.z*e.y,this.w*e.y+this.y*e.w+this.z*e.x-this.x*e.z,this.w*e.z+this.z*e.w+this.x*e.y-this.y*e.x);return t};Quaternion.prototype.getMatrix=function(){var e=new Matrix4x4;var t=this.x+this.x;var n=this.y+this.y;var r=this.z+this.z;var i=this.x*t;var s=this.x*n;var o=this.x*r;var u=this.y*n;var a=this.y*r;var f=this.z*r;var l=this.w*t;var c=this.w*n;var h=this.w*r;e._11=1-(u+f);e._21=s-h;e._31=o+c;e._41=0;e._12=s+h;e._22=1-(i+f);e._32=a-l;e._42=0;e._13=o-c;e._23=a+l;e._33=1-(i+u);e._43=0;e._14=0;e._24=0;e._34=0;e._44=1;return e};Plane2.prototype=new Plane;Plane2.prototype.constructor=Plane2;ViewVolume.prototype.setPerspective=function(e,t,n,r){var i=n*Math.tan(.5*e);var s=i*t;var o=new Vector3D(-s,i,n);var u=new Vector3D(s,i,n);var a=new Vector3D(-s,-i,n);var f=new Vector3D(s,-i,n);i=r*Math.tan(.5*e);s=i*t;var l=new Vector3D(-s,i,r);var c=new Vector3D(s,i,r);var h=new Vector3D(-s,-i,r);var p=new Vector3D(s,-i,r);this.left=new Plane2(o,a,h);this.right=new Plane2(f,u,c);this.top=new Plane2(o,l,c);this.bottom=new Plane2(a,f,p);this.near=new Plane2(a,o,u);this.far=new Plane2(p,c,l)};ViewVolume.prototype.setOrthographic=function(e,t,n,r,i,s){var o=new Vector3D(e,n,i);var u=new Vector3D(t,n,i);var a=new Vector3D(e,r,i);var f=new Vector3D(t,r,i);var l=new Vector3D(e,n,s);var c=new Vector3D(t,n,s);var h=new Vector3D(e,r,s);var p=new Vector3D(t,r,s);this.left=new Plane2(h,l,o);this.right=new Plane2(f,u,c);this.top=new Plane2(o,l,c);this.bottom=new Plane2(p,h,a);this.near=new Plane2(a,o,u);this.far=new Plane2(p,c,l)};var EPSILON=1e-8;var eAttrType={Unknown:-1,Attribute:0,AttributeContainer:1,AttributeVector:2,AttributeFactory:3,AttributeRegistry:4,BalloonTipLabelStyleAttr:5,BBoxAttr:6,BooleanAttr:7,ColorAttr:8,FontStyleAttr:9,IconStyleAttr:10,ImageAttr:11,KeyframeAttr:12,KeyframesAttr:13,LabelStyleAttr:14,HTMLLabelStyleAttr:15,NumberArrayAttr:16,NumberAttr:17,Matrix4x4Attr:18,PlaneAttr:19,PulseAttr:20,RectAttr:21,ReferenceAttr:22,StringAttr:23,StyleAttr:24,StylesAttr:25,StyleMapAttr:26,StylesMapAttr:27,Vector2DAttr:28,Vector3DAttr:29,ViewportAttr:30,ViewVolumeAttr:31,RenderableElementStyleAttr:32,Bone:33,SnapConnector:34,SnapConnectors:35,SocketConnector:36,PlugConnector:37,SphereAttr:38,Node:1e3,ParentableMotionElement:1001,Camera:1002,PerspectiveCamera:1003,OrthographicCamera:1004,Light:1005,DirectionalLight:1006,PointLight:1007,SpotLight:1008,GlobalIllumination:1009,Material:1010,Texture:1011,RenderableElement:1012,Geometry:1013,VertexGeoemtry:1014,TriList:1015,Group:1016,Isolator:1017,Dissolve:1018,Transform:1019,QuaternionRotate:1020,Scale:1021,Rotate:1022,Translate:1023,Model:1024,Surface:1025,MediaTexture:1026,NullObject:1027,Label:1028,HTMLLabel:1029,BalloonTipLabel:1030,PathTrace:1031,Cube:1032,Bone:1033,Selector:1034,ScreenRect:1035,Evaluator:1100,SceneInspector:1101,KeyframeInterpolator:1102,BBoxLocator:1103,ArcballInspector:1104,MapProjectionCalculator:1105,ObjectInspector:1106,MultiTargetObserver:1107,ObjectMover:1108,AnimalMover:1109,WalkSimulator:1110,MorphEffector:1111,BoneEffector:1112,Evaluator_End:1199,Node_End:1999,Directive:2e3,UpdateDirective:2001,RenderDirective:2002,RayPickDirective:2003,BBoxDirective:2004,SerializeDirective:2005,CollideDirective:2006,HighlightDirective:2007,Directive_End:2999,Command:3e3,CommandSequence:3001,AppendNode:3002,AttributeTrigger:3003,AutoInterpolate:3004,Locate:3005,Play:3006,Pause:3007,Remove:3008,ScreenCapture:3009,Serialize:3010,Set:3011,Stop:3012,ConnectAttributes:3013,DisconnectAttributes:3014,Export:3015,Morph:3016,SnapTo:3017,Command_End:3999,DeviceHandler:4e3,MouseHandler:4001,KeyboardHandler:4002,DeviceHandler_End:4999,UserDefined:5e3};var eAttrElemType={Unknown:-1,Attribute:0,Int:1,UnsignedInt:2,Char:3,UnsignedChar:4,Float:5,Double:6,UserDefined:100};var eAttrSetOp={Replace:0,Add:1,Subtract:2,Multiply:3,Divide:4,Append:5,AND:6,OR:7,XOR:8,NAND:9,NOR:10};Attribute.prototype=new Base;Attribute.prototype.constructor=Attribute;Attribute.prototype.destroy=function(){this.removeAllSources();this.removeAllTargets();Base.prototype.destroy.call(this)};Attribute.prototype.clone=function(){return null};Attribute.prototype.getValue=function(e,t){var n=t?t.elementIndex:-1;if(n<0){if(this.values==null){e[0]=null}else if(this.values.length==undefined){e[0]=this.values}else{for(var r=0;r<this.values.length;r++){e[r]=this.values[r]}}}else{var i=Math.max(0,t?t.valueElementIndex:0);e[i]=this.values[n]}};Attribute.prototype.setValue=function(e,t){this.lastValues=this.values.slice();var n=t?t.elementIndex:-1;var r=t?t.op:eAttrSetOp.Replace;if(n<0){if(e==null){this.values[0]=null}else if(e.length==undefined){switch(r){case eAttrSetOp.Add:this.values[0]+=e;break;case eAttrSetOp.Replace:this.values[0]=e;break;case eAttrSetOp.AND:this.values[0]&=e;break;default:alert("unsupported operation passed to Attribute::setValue");break}}else{for(var i=0;i<e.length;i++){switch(r){case eAttrSetOp.Add:this.values[i]+=e[i];break;case eAttrSetOp.Replace:this.values[i]=e[i];break;case eAttrSetOp.AND:this.values[i]&=e[i];break;default:alert("unsupported operation passed to Attribute::setValue");break}}}}else{if(e==null){this.values[n]=null}else if(e.length==undefined){this.values[n]=e}else{var s=Math.max(0,t?t.valueElementIndex:0);this.values[n]=e[s]}}var o=t?t.alertModifiedCBs:true;if(o){for(var i=0;i<this.modifiedCBs.length;i++){this.modifiedCBs[i](this,this.modifiedCBsData[i])}}var u=t?t.updateTargets:true;if(u){var a=t?t.caller:null;for(var i=0;i<this.targets.length;i++){var f=this.targets[i];if(a==f.target)continue;var t=new AttributeSetParams(f.targetElementIndex,f.sourceElementIndex,f.op,true,true,this);f.target.setValue(this.values,t)}}};Attribute.prototype.revertValues=function(){this.setValue(this.lastValues,null)};Attribute.prototype.getElement=function(e){if(this.values.length>e){return this.values[e]}return undefined};Attribute.prototype.setElement=function(e,t,n,r){console.debug("TODO: "+arguments.callee.name)};Attribute.prototype.getLength=function(){if(this.values.length==undefined){return this.values==undefined?0:1}return this.values.length};Attribute.prototype.setLength=function(e){this.values.length=e};Attribute.prototype.addModifiedCB=function(e,t){this.modifiedCBs.push(e);this.modifiedCBsData.push(t)};Attribute.prototype.removeModifiedCB=function(e,t){this.modifiedCBs.splice(this.modifiedCBs.indexOf(e),1);this.modifiedCBsData.splice(this.modifiedCBsData.indexOf(t),1)};Attribute.prototype.addTarget=function(e,t,n,r){if(t==undefined)t=eAttrSetOp.Replace;if(n==undefined)n=null;if(r==undefined)r=true;this.addElementTarget(e,-1,-1,t,n,r)};Attribute.prototype.addSource=function(e,t,n,r){e.addTarget(this,t,n,r)};Attribute.prototype.removeTarget=function(e){this.removeElementTarget(e,-1,-1)};Attribute.prototype.removeSource=function(e){e.removeTarget(this)};Attribute.prototype.removeAllTargets=function(){while(this.targets.length>0){this.removeElementTarget(this.targets[0].target,this.targets[0].sourceElementIndex,this.targets[0].targetElementIndex)}};Attribute.prototype.removeAllSources=function(){while(this.sources.length>0){this.sources[0].source.removeElementTarget(this,this.sources[0].sourceElementIndex,this.sources[0].targetElementIndex)}};Attribute.prototype.addElementTarget=function(e,t,n,r,i,s){if(e){if(t==undefined)t=-1;if(n==undefined)n=-1;if(r==undefined)r=eAttrSetOp.Replace;if(i==undefined)i=null;if(s==undefined)s=true;this.createTarget(new AttributeTargetDesc(e,t,n,r,i));e.createSource(new AttributeSourceDesc(this,t,n,r,i));if(s){var o=new AttributeSetParams(n,t,r,true,true);e.setValue(this.values,o)}}};Attribute.prototype.addElementSource=function(e,t,n,r,i,s){e.addElementTarget(this,t,n,r,i,s)};Attribute.prototype.removeElementTarget=function(e,t,n){if(e){this.deleteTarget(new AttributeTargetDesc(e,t,n));e.deleteSource(new AttributeSourceDesc(this,t,n))}};Attribute.prototype.removeElementSource=function(e,t,n){e.removeElementTarget(this,t,n)};Attribute.prototype.createTarget=function(e){this.targets.push(e)};Attribute.prototype.createSource=function(e){this.sources.push(e)};Attribute.prototype.deleteTarget=function(e){for(var t=0;t<this.targets.length;t++){var n=this.targets[t];if(n.target==e.target&&n.sourceElementIndex==e.sourceElementIndex&&n.targetElementIndex==e.targetElementIndex){this.targets.splice(t,1);break}}};Attribute.prototype.deleteSource=function(e){for(var t=0;t<this.sources.length;t++){var n=this.sources[t];if(n.source==e.source&&n.sourceElementIndex==e.sourceElementIndex&&n.targetElementIndex==e.targetElementIndex){this.sources.splice(t,1);break}}};Attribute.prototype.copyValue=function(e,t){e.addTarget(this,t);e.removeTarget(this)};Attribute.prototype.isContainer=function(){return false};Attribute.prototype.isCollection=function(){return false};Attribute.prototype.isNode=function(){return false};Attribute.prototype.getContainer=function(){return this.container};Attribute.prototype.setContainer=function(e){this.container=e};Attribute.prototype.setNative=function(e){this.native=e};Attribute.prototype.isNative=function(){return this.native};Attribute.prototype.setTransient=function(e){this.transient=e};Attribute.prototype.isTransient=function(){return this.transient};Attribute.prototype.setPersistent=function(e){this.persistent=e};Attribute.prototype.isPersistent=function(){return this.persistent};Attribute.prototype.getRegistry=function(){return this.registry};Attribute.prototype.setRegistry=function(e){this.registry=e};Attribute.prototype.onRegister=function(e){};Attribute.prototype.onUnregister=function(e){};Attribute.prototype.flagDeserializedFromXML=function(){this.deserialized=true;if(this.attrContainer){this.attrContainer.flagDeserializedFromXML()}};Attribute.prototype.isDeserializedFromXML=function(){return this.deserialized};AttributeContainer.prototype=new Attribute;AttributeContainer.prototype.constructor=AttributeContainer;AttributeContainer.prototype.destroy=function(){for(var e in this.attrNameMap){for(var t=0;t<this.attrNameMap[e].length;t++){var n=this.attrNameMap[e][t];if(n.getContainer()==this){n.destroy()}}}Attribute.prototype.destroy.call(this)};AttributeContainer.prototype.isContainer=function(){return true};AttributeContainer.prototype.registerAttribute=function(e,t){if(!e)return;if(this.attrNameMap[t]==undefined){this.attrNameMap[t]=new Array}this.attrNameMap[t].push(e);this.attrModifiedCountMap.push(new Pair(e,0));if(!e.getContainer()){e.setContainer(this)}e.addModifiedCB(AttributeContainer_AttributeModifiedCB,this);e.addModifiedCB(AttributeContainer_AttributeModifiedCounterCB,this)};AttributeContainer.prototype.unregisterAttribute=function(e){if(!e)return;for(var t in this.attrNameMap){for(var n=0;n<this.attrNameMap[t].length;n++){if(this.attrNameMap[t][n]==e){e.removeModifiedCB(AttributeContainer_AttributeModifiedCB,this);e.removeModifiedCB(AttributeContainer_AttributeModifiedCounterCB,this);delete this.attrNameMap[t][n];this.attrNameMap[t].splice(n,1);break}}}};AttributeContainer.prototype.getAttribute=function(e){if(this.attrNameMap[e]==undefined){return null}return this.attrNameMap[e][0]};AttributeContainer.prototype.getAttributeAt=function(e){var t=0;for(var n in this.attrNameMap){for(var r=0;r<this.attrNameMap[n].length;r++){if(t==e){return this.attrNameMap[n][r]}t++}}return null};AttributeContainer.prototype.getAttributeName=function(e){var t=0;for(var n in this.attrNameMap){for(var r=0;r<this.attrNameMap[n].length;r++){if(this.attrNameMap[n][r]==e){return n}t++}}return null};AttributeContainer.prototype.getAttributeNameAt=function(e){var t=0;for(var n in this.attrNameMap){for(var r=0;r<this.attrNameMap[n].length;r++){if(t==e){return n}t++}}return null};AttributeContainer.prototype.getAttributeCount=function(){var e=0;for(var t in this.attrNameMap)e+=this.attrNameMap[t].length;return e};AttributeContainer.prototype.getAttributeModificationCount=function(e){for(var t in this.attrModifiedCountMap){if(this.attrModifiedCountMap[t].first==e){return this.attrModifiedCountMap[t].second}}return undefined};AttributeContainer.prototype.incrementAttributeModificationCount=function(e){for(var t in this.attrModifiedCountMap){if(this.attrModifiedCountMap[t].first==e){this.attrModifiedCountMap[t].second++;break}}};AttributeContainer.prototype.addTarget=function(e,t,n,r){if(e){if(t==undefined)t=null;if(n==undefined)n=null;if(r==undefined)r=true;var i=Math.max(this.getAttributeCount(),e.getAttributeCount());if(i==0){return}var s=null;var o=null;for(var u=0;u<i;u++){s=this.getAttributeAt(u);o=e.getAttribute(this.getAttributeNameAt(u));if(!s||!o){continue}s.addTarget(o,t,n,r)}}};AttributeContainer.prototype.removeTarget=function(e){if(e){var t=Math.max(this.getAttributeCount(),e.getAttributeCount());if(t==0){return}var n=null;var r=null;for(var i=0;i<t;i++){n=this.getAttributeAt(i);r=e.getAttribute(this.getAttributeNameAt(i));if(!n||!r){continue}n.removeTarget(r)}}};AttributeContainer.prototype.synchronize=function(e,t){if(t==undefined)t=true;for(var n in e.attrNameMap){for(var r=0;r<e.attrNameMap.length;r++){var i=this.attrNameMap[n][r];if(!i){i=e.attrNameMap[n].clone();if(!i)continue;i.setContainer(this);this.registerAttribute(i,n)}if(i&&t){i.copyValue(e.attrNameMap[n])}}}};AttributeRegistry.prototype=new AttributeContainer;AttributeRegistry.prototype.constructor=AttributeRegistry;AttributeRegistry.prototype.addUnique=function(e){for(var t=0;t<this.uniqueAttributes.length;t++){if(this.uniqueAttributes[t]==e)return}this.uniqueAttributes.push(e)};AttributeRegistry.prototype.removeUnique=function(e){for(var t=0;t<this.uniqueAttributes.length;t++){if(this.uniqueAttributes[t]==e){this.uniqueAttributes.splice(t,1);return}}};AttributeRegistry.prototype.registerByType=function(e,t){if(this.typeRegistry[t]==undefined){this.typeRegistry[t]=new Array}this.typeRegistry[t].push(e)};AttributeRegistry.prototype.registerByName=function(e,t){if(t.length==0){t="unnamed"}if(this.nameRegistry[t]==undefined){this.nameRegistry[t]=new Array}this.nameRegistry[t].push(e)};AttributeRegistry.prototype.register=function(e){this.registerByType(e,e.attrType);if(e.isContainer()){var t=e.getAttribute("name")||e.getAttribute("id");if(t){this.registerByName(e,t.getValueDirect().join(""));t.addModifiedCB(AttributeRegistry_AttributeContainerNameModifiedCB,this)}}this.addUnique(e);this.objectCount++;e.onRegister(this)};AttributeRegistry.prototype.unregisterByType=function(e,t){if(this.typeRegistry[t]){this.typeRegistry[t].splice(this.typeRegistry[t].indexOf(e),1)}};AttributeRegistry.prototype.unregisterByName=function(e,t){if(t.length==0){t="unnamed"}if(this.nameRegistry[t]){this.nameRegistry[t].splice(this.nameRegistry[t].indexOf(e),1)}};AttributeRegistry.prototype.unregister=function(e){this.unregisterByType(e,e.attrType);if(e.isContainer()){var t=e.getAttribute("name")||e.getAttribute("id");if(t){this.unregisterByName(e,t.getValueDirect().join(""));t.removeModifiedCB(AttributeRegistry_AttributeContainerNameModifiedCB,this)}}this.removeUnique(e);this.objectCount--;e.onUnregister(this)};AttributeRegistry.prototype.getByType=function(e){switch(e){case eAttrType.Camera:{var t=[];var n=this.getByType(eAttrType.PerspectiveCamera);if(n){for(var r=0;r<n.length;r++){t.push(n[r])}}var i=this.getByType(eAttrType.OrthographicCamera);if(i){for(var r=0;r<i.length;r++){t.push(i[r])}}return t}break;case eAttrType.Evaluator:{var t=[];for(var s=eAttrType.Evaluator+1;s!=eAttrType.Evaluator_End;s++){var o=this.getByType(s);if(o){for(var r=0;r<o.length;r++){t.push(o[r])}}}return t}break;default:{return this.typeRegistry[e]}break}};AttributeRegistry.prototype.getByName=function(e){return this.nameRegistry[e]};AttributeRegistry.prototype.updateName=function(e,t){for(var n in this.nameRegistry){for(var r=0;r<this.nameRegistry[n].length;r++){if(this.nameRegistry[n][r]==e){this.nameRegistry[n].splice(r,1);this.registerByName(e,t);return}}}};AttributeRegistry.prototype.clear=function(){for(var e in this.typeRegistry){this.typeRegistry[e]=[]}this.typeRegistry=[];for(var e in this.nameRegistry){this.nameRegistry[e]=[]}this.nameRegistry=[];this.uniqueAttributes=[];this.objectCount=0};AttributeRegistry.prototype.getObjectCount=function(){return this.uniqueAttributes.length};AttributeRegistry.prototype.getObject=function(e){if(e<this.uniqueAttributes.length){return this.uniqueAttributes[e]}return null};BooleanAttr.prototype=new Attribute;BooleanAttr.prototype.constructor=BooleanAttr;BooleanAttr.prototype.clone=function(){var e=new BooleanAttr;e.setValue(this.values);return e};BooleanAttr.prototype.getValueDirect=function(){var e=[];this.getValue(e);return e[0]};BooleanAttr.prototype.setValueDirect=function(e,t){var n=[e];this.setValue(e,t)};ColorAttr.prototype=new Attribute;ColorAttr.prototype.constructor=ColorAttr;ColorAttr.prototype.clone=function(){var e=new ColorAttr;e.setValue(this.values);return e};ColorAttr.prototype.getValueDirect=function(){var e=[];this.getValue(e);return{r:e[0],g:e[1],b:e[2],a:e[3]}};ColorAttr.prototype.setValueDirect=function(e,t,n,r,i){var s=[e,t,n,r];this.setValue(s,i)};Matrix4x4Attr.prototype=new Attribute;Matrix4x4Attr.prototype.constructor=Matrix4x4Attr;Matrix4x4Attr.prototype.clone=function(){var e=new Matrix4x4Attr;e.setValue(this.values);return e};Matrix4x4Attr.prototype.getValueDirect=function(){var e=[];this.getValue(e);var t=new Matrix4x4;t.loadArray(e);return t};Matrix4x4Attr.prototype.setValueDirect=function(e,t){var n=[e._11,e._12,e._13,e._14,e._21,e._22,e._23,e._24,e._31,e._32,e._33,e._34,e._41,e._42,e._43,e._44];this.setValue(n,t)};NumberArrayAttr.prototype=new Attribute;NumberArrayAttr.prototype.constructor=NumberArrayAttr;NumberArrayAttr.prototype.clone=function(){var e=new NumberArrayAttr;e.setValue(this.values);return e};NumberArrayAttr.prototype.getValueDirect=function(){var e=[];this.getValue(e);return e};NumberArrayAttr.prototype.setValueDirect=function(e,t){this.setValue(e,t)};NumberAttr.prototype=new Attribute;NumberAttr.prototype.constructor=NumberAttr;NumberAttr.prototype.clone=function(){var e=new NumberAttr;e.setValue(this.values);return e};NumberAttr.prototype.getValueDirect=function(){var e=[];this.getValue(e);return e[0]};NumberAttr.prototype.setValueDirect=function(e,t){var n=[e];this.setValue(n,t)};PulseAttr.prototype=new BooleanAttr;PulseAttr.prototype.constructor=PulseAttr;PulseAttr.prototype.clone=function(){var e=new PulseAttr;e.setValue(this.values);return e};PulseAttr.prototype.pulse=function(){this.setValueDirect(true);this.setValueDirect(false)};QuaternionAttr.prototype=new Attribute;QuaternionAttr.prototype.constructor=QuaternionAttr;QuaternionAttr.prototype.clone=function(){var e=new QuaternionAttr;e.setValue(this.values);return e};QuaternionAttr.prototype.getValueDirect=function(){var e=[];this.getValue(e);var t=new Quaternion;t.loadArray(e);return t};QuaternionAttr.prototype.setValueDirect=function(e,t){var n=[e.w,e.x,e.y,e.z];this.setValue(n,t)};ReferenceAttr.prototype=new Attribute;ReferenceAttr.prototype.constructor=ReferenceAttr;ReferenceAttr.prototype.clone=function(){var e=new ReferenceAttr;e.setValue(this.values);return e};ReferenceAttr.prototype.getValueDirect=function(){var e=[];this.getValue(e);return e[0]};ReferenceAttr.prototype.setValueDirect=function(e,t){var n=[e];this.setValue(e,t)};StringAttr.prototype=new Attribute;StringAttr.prototype.constructor=StringAttr;StringAttr.prototype.clone=function(){var e=new StringAttr;e.setValue(this.values);return e};StringAttr.prototype.getValueDirect=function(){var e=[];this.getValue(e);return e};StringAttr.prototype.setValueDirect=function(e,t){this.setValue(e,t)};StringAttr.prototype.setValue=function(e,t){this.values=[];Attribute.prototype.setValue.call(this,e,t)};TernaryAttr.prototype=new NumberAttr;TernaryAttr.prototype.constructor=TernaryAttr;TernaryAttr.prototype.clone=function(){var e=new TernaryAttr;e.setValue(this.values);return e};Vector2DAttr.prototype=new Attribute;Vector2DAttr.prototype.constructor=Vector2DAttr;Vector2DAttr.prototype.clone=function(){var e=new Vector2DAttr;e.setValue(this.values);return e};Vector2DAttr.prototype.getValueDirect=function(){var e=[];this.getValue(e);return{x:e[0],y:e[1]}};Vector2DAttr.prototype.setValueDirect=function(e,t,n){var r=[e,t];this.setValue(r,n)};Vector3DAttr.prototype=new Attribute;Vector3DAttr.prototype.constructor=Vector3DAttr;Vector3DAttr.prototype.clone=function(){var e=new Vector3DAttr;e.setValue(this.values);return e};Vector3DAttr.prototype.getValueDirect=function(){var e=[];this.getValue(e);return{x:e[0],y:e[1],z:e[2]}};Vector3DAttr.prototype.setValueDirect=function(e,t,n,r){var i=[e,t,n];this.setValue(i,r)};Vector3DAttr.prototype.isZero=function(){var e=[];this.getValue(e);return e[0]==0&&e[1]==0&&e[2]==0?true:false};ViewportAttr.prototype=new Attribute;ViewportAttr.prototype.constructor=ViewportAttr;ViewportAttr.prototype.clone=function(){var e=new ViewportAttr;e.setValue(this.values);return e};ViewportAttr.prototype.getValueDirect=function(){var e=[];this.getValue(e);return{x:e[0],y:e[1],width:e[2],height:e[3]}};ViewportAttr.prototype.setValueDirect=function(e,t,n,r,i){var s=[e,t,n,r];this.setValue(s,i)};AttributeVector.prototype=new AttributeContainer;AttributeVector.prototype.constructor=AttributeVector;AttributeVector.prototype.allocatesElements=function(){return this.allocator?true:false};AttributeVector.prototype.push_back=function(e){this.addElement(this.vector.length,e);this.size.setValueDirect(this.vector.length)};AttributeVector.prototype.resize=function(e){this.size.setValueDirect(e)};AttributeVector.prototype.clear=function(){this.resize(0)};AttributeVector.prototype.getAt=function(e){if(this.vector.length>e){return this.vector[e]}return null};AttributeVector.prototype.setAt=function(e,t){if(this.vector.length>e){this.vector[e]=t}};AttributeVector.prototype.prev=function(e){for(var t=0;t<this.vector.length;t++){if(this.vector[t]==e){if(t>0)return this.vector[t-1];break}}return null};AttributeVector.prototype.next=function(e){for(var t=0;t<this.vector.length;t++){if(this.vector[t]==e){if(t<this.vector.length-1)return this.vector[t+1];break}}return null};AttributeVector.prototype.addElement=function(e,t){this.vector.splice(e,0,t)};AttributeVector.prototype.removeElement=function(e){this.vector.splice(e,1)};AttributeVector.prototype.Size=function(){return this.size.getValueDirect()};AttributeVector.prototype.AppendParsedElements=function(){return this.appendParsedElements.getValueDirect()};AttributeVector.prototype.setElementName=function(e,t){this.unregisterAttribute(e);this.registerAttribute(e,t);console.debug("TODO: add to element name map")};AttributeVector.prototype.synchronize=function(e,t){AttributeContainer.prototype.synchronize.call(this,e,t);this.clear();for(var n=0;n<e.vector.length;n++){this.push_back(e.vector[n])}};AttributeVector.prototype.isCollection=function(){return true};AttributeVector.prototype.sizeModified=function(){var e=this.vector.length;var t=this.size.getValueDirect();var n,r;if(t>e){n=e;r=n+(t-e);for(var i=n;i<r;i++){this.addElement(i,this.allocator?this.allocator.allocate():null)}}else if(t<e){n=e;r=n-(e-t);for(var i=n-1;i>=r;i--){this.removeElement(i)}}};StyleAttr.prototype=new AttributeContainer;StyleAttr.prototype.constructor=StyleAttr;StyleAttr.prototype.updateStyle=function(e){};StyleAttr.prototype.styleUrlModified=function(){var e=this.styleUrl.getValueDirect().join("");if(this.registry){this.updateStyle(this.registry.find(e))}};StylesAttr.prototype=new AttributeVector;StylesAttr.prototype.constructor=StylesAttr;StylesAttr.prototype.updateStyle=function(e){var t=this.enabled.getValueDirect();if(!t){return}for(var n=0;n<e.Size();n++){for(var r=0;r<this.Size();r++){if(this.vector[r].attrType==e.vector[n].attrType){this.vector[r].updateStyle(e.vector[n]);break}}}};StylesAttr.prototype.registerStyle=function(e,t){this.push_back(e);this.setElementName(e,t);this.alertRegisteredCBs(e,true)};StylesAttr.prototype.unregisterStyle=function(e){for(var t in this.vector){if(this.vector[t]==e){this.alertRegisteredCBs(e,false);delete this.vector[t];break}}};StylesAttr.prototype.addRegisteredCB=function(e,t){this.registeredCBs.push(e);this.registeredCBsData.push(t)};StylesAttr.prototype.alertRegisteredCBs=function(e,t){for(var n=0;n<this.registeredCBs.length;n++){this.registeredCBs[n](e,this.registeredCBs[n])}};StylesAttr.prototype.push_back=function(e){AttributeVector.prototype.push_back.call(this,e);this.alertRegisteredCBs(e,true)};StylesAttr.prototype.getStyle=function(e){for(var t=0;t<this.Size();t++){if(this.vector[t].attrType==e){return this.vector[t]}}return undefined};StyleMapAttr.prototype=new AttributeContainer;StyleMapAttr.prototype.constructor=StyleMapAttr;StyleMapAttr.prototype.getStyles=function(e){var t=null;var n=null;if(this.eventType==e){t=this.styles;n=this.targetContainer}return{styles:t,target:n}};StyleMapAttr.prototype.setStyles=function(e){this.styles=e};StyleMapAttr.prototype.setTargetContainer=function(e){this.targetContainer=e};StyleMapAttr.prototype.eventModified=function(){var e=this.event.getValueDirect().join("");this.eventType=eEventNameMap[e]};StyleMapAttr.prototype.styleUrlModified=function(){var e=this.styleUrl.getValueDirect();if(e[0]=="#"){e.splice(0,1)}e=e.join("");var t=this.registry.find(e);if(t){this.styles=t}};StyleMapAttr.prototype.targetModified=function(){var e=this.target.getValueDirect().join("");this.targetContainer=this.registry.find(e)};StyleMapAttrAllocator.prototype=new Allocator;StyleMapAttrAllocator.prototype.constructor=StyleMapAttrAllocator;StyleMapAttrAllocator.prototype.allocate=function(){return new StyleMapAttr};StylesMapAttr.prototype=new AttributeVector;StylesMapAttr.prototype.constructor=StylesMapAttr;StylesMapAttr.prototype.getStyles=function(e){var t=null;var n=false;var r=null;for(var i=0;i<this.Size();i++){var s=this.vector[i].getStyles(e);if(s.styles){t=s.styles;r=s.target;if(this.stylesEnabledMap[s.styles]){n=this.stylesEnabledMap[s.styles]}}}return{styles:t,target:r,enabled:n}};StylesMapAttr.prototype.StylesMapAttr_SizeModified=function(){for(var e=0;e<this.Size();e++){if(!this.vector[e].registry){this.vector[e].setRegistry(this.registry)}if(!this.stylesEnabledMap[this.vector[e].styles]){this.stylesEnabledMap[this.vector[e].styles]=new BooleanAttr(true)}}};KeyframeAttr.prototype=new AttributeContainer;KeyframeAttr.prototype.constructor=KeyframeAttr;KeyframesAttr.prototype=new AttributeVector;KeyframesAttr.prototype.constructor=KeyframesAttr;BBoxAttr.prototype=new AttributeContainer;BBoxAttr.prototype.constructor=BBoxAttr;BBoxAttr.prototype.setValueDirect=function(e,t){this.min.setValueDirect(e.x,e.y,e.z);this.max.setValueDirect(t.x,t.y,t.z)};ImageAttr.prototype=new AttributeContainer;ImageAttr.prototype.constructor=ImageAttr;RectAttr.prototype=new AttributeContainer;RectAttr.prototype.constructor=RectAttr;RectAttr.prototype.getValueDirect=function(){var e=new Rect;e.left=this.left.getValueDirect();e.top=this.top.getValueDirect();e.right=this.right.getValueDirect();e.bottom=this.bottom.getValueDirect();return e};RectAttr.prototype.setValueDirect=function(e){this.left.setValueDirect(e.left);this.top.setValueDirect(e.top);this.right.setValueDirect(e.right);this.bottom.setValueDirect(e.bottom)};RectAttr.prototype.containsPoint=function(e,t){if(e>=this.left.getValueDirect()&&t>=this.top.getValueDirect()&&e<=this.right.getValueDirect()&&t<=this.bottom.getValueDirect())return true;return false};FontStyleAttr.prototype=new StyleAttr;FontStyleAttr.prototype.constructor=FontStyleAttr;FontStyleAttr.prototype.updateStyle=function(e){var t=e.setOp.getValueDirect();if(e.getAttributeModificationCount(e.antialiasType)){this.antialiasType.copyValue(e.antialiasType,t)}if(e.getAttributeModificationCount(e.borderColor)){this.borderColor.copyValue(e.borderColor,t)}if(e.getAttributeModificationCount(e.borderWidth)){this.borderWidth.copyValue(e.borderWidth,t)}if(e.getAttributeModificationCount(e.color)){this.color.copyValue(e.color,t)}if(e.getAttributeModificationCount(e.effects)){this.effects.copyValue(e.effects,t)}if(e.getAttributeModificationCount(e.font)){this.font.copyValue(e.font,t)}if(e.getAttributeModificationCount(e.opacity)){this.opacity.copyValue(e.opacity,t)}if(e.getAttributeModificationCount(e.size)){this.size.copyValue(e.size,t)}if(e.getAttributeModificationCount(e.style)){this.style.copyValue(e.style,t)}};LabelStyleAttr.prototype=new StyleAttr;LabelStyleAttr.prototype.constructor=LabelStyleAttr;LabelStyleAttr.prototype.updateStyle=function(e){var t=e.setOp.getValueDirect();if(e.getAttributeModificationCount(e.angle)){this.angle.copyValue(e.angle,t)}if(e.getAttributeModificationCount(e.backgroundColor)){this.backgroundColor.copyValue(e.backgroundColor,t)}if(e.getAttributeModificationCount(e.backgroundOpacity)){this.backgroundOpacity.copyValue(e.backgroundOpacity,t)}this.fontStyle.updateStyle(e.fontStyle);if(e.getAttributeModificationCount(e.format)){this.format.copyValue(e.format,t)}if(e.getAttributeModificationCount(e.height)){this.height.copyValue(e.height,t)}if(e.getAttributeModificationCount(e.offset)){this.offset.copyValue(e.offset,t)}if(e.getAttributeModificationCount(e.padding)){this.padding.copyValue(e.padding,t)}if(e.getAttributeModificationCount(e.scale)){this.scale.copyValue(e.scale,t)}if(e.getAttributeModificationCount(e.textAlign)){this.textAlign.copyValue(e.textAlign,t)}if(e.getAttributeModificationCount(e.width)){this.width.copyValue(e.width,t)}};IconStyleAttr.prototype=new StyleAttr;IconStyleAttr.prototype.constructor=IconStyleAttr;IconStyleAttr.prototype.updateStyle=function(e){var t=e.setOp.getValueDirect();if(e.getAttributeModificationCount(e.alphaUrl)){this.alphaUrl.copyValue(e.alphaUrl,t)}if(e.getAttributeModificationCount(e.color)){this.color.copyValue(e.color,t)}if(e.getAttributeModificationCount(e.opacity)){this.opacity.copyValue(e.opacity,t)}if(e.getAttributeModificationCount(e.scale)){this.scale.copyValue(e.scale,t)}if(e.getAttributeModificationCount(e.url)){this.url.copyValue(e.url,t)}};HTMLLabelStyleAttr.prototype=new StyleAttr;HTMLLabelStyleAttr.prototype.constructor=HTMLLabelStyleAttr;BalloonTipLabelStyleAttr.prototype=new StyleAttr;BalloonTipLabelStyleAttr.prototype.constructor=BalloonTipLabelStyleAttr;BalloonTipLabelStyleAttr.prototype.updateStyle=function(e){var t=e.setOp.getValueDirect();if(e.getAttributeModificationCount(e.balloonOffset)){this.balloonOffset.copyValue(e.balloonOffset,t)}if(e.getAttributeModificationCount(e.bgColor)){this.bgColor.copyValue(e.bgColor,t)}if(e.getAttributeModificationCount(e.displayMode)){this.displayMode.copyValue(e.displayMode,t)}this.htmlLabelStyle.updateStyle(e.htmlLabelStyle);if(e.getAttributeModificationCount(e.text)){this.text.copyValue(e.text,t)}if(e.getAttributeModificationCount(e.textColor)){this.textColor.copyValue(e.textColor,t)}};RenderableElementStyleAttr.prototype=new StyleAttr;RenderableElementStyleAttr.prototype.constructor=RenderableElementStyleAttr;RenderableElementStyleAttr.prototype.updateStyle=function(e){var t=e.setOp.getValueDirect();if(e.getAttributeModificationCount(e.hasFocus)){this.hasFocus.copyValue(e.hasFocus,t)}if(e.getAttributeModificationCount(e.selected)){this.selected.copyValue(e.selected,t)}};PlaneAttr.prototype=new AttributeContainer;PlaneAttr.prototype.constructor=PlaneAttr;PlaneAttr.prototype.getValueDirect=function(){var e=this.point.getValueDirect();var t=this.normal.getValueDirect();var n=new Plane(new Vector3D(e.x,e.y,e.z),new Vector3D(t.x,t.y,t.z));return n};PlaneAttr.prototype.setValueDirect=function(e){this.point.setValueDirect(e.point.x,e.point.y,e.point.z);this.normal.setValueDirect(e.normal.x,e.normal.y,e.normal.z);this.dot.setValueDirect(e.dot)};ViewVolumeAttr.prototype=new AttributeContainer;ViewVolumeAttr.prototype.constructor=ViewVolumeAttr;ViewVolumeAttr.prototype.setValueDirect=function(e,t,n,r,i,s){this.left.setValueDirect(e);this.right.setValueDirect(t);this.top.setValueDirect(n);this.bottom.setValueDirect(r);this.near.setValueDirect(i);this.far.setValueDirect(s)};SphereAttr.prototype=new AttributeContainer;SphereAttr.prototype.constructor=SphereAttr;Agent.prototype=new AttributeContainer;Agent.prototype.constructor=Agent;Agent.prototype.start=function(){this.running=true};Agent.prototype.stop=function(){this.running=false};Agent.prototype.pause=function(){this.running=false};Sphere.prototype.setTransform=function(e){var t=e.transform(this.center.x,this.center.y,this.center.z,1);this.xcenter.x=t.x;this.xcenter.y=t.y;this.xcenter.z=t.z;var n=e.getScalingFactors();this.xradius=this.radius*max3(n.x,n.y,n.z)};Sphere.prototype.intersects=function(e){var t=distanceBetween(this.xcenter,e.xcenter);var n=this.xradius+e.xradius;if(t<n)return true;return false};Region.prototype.setPlanes=function(){this.xpos=new Plane(this.max,new Vector3D(1,0,0));this.xneg=new Plane(this.min,new Vector3D(-1,0,0));this.ypos=new Plane(this.max,new Vector3D(0,1,0));this.yneg=new Plane(this.min,new Vector3D(0,-1,0));this.zpos=new Plane(this.max,new Vector3D(0,0,1));this.zneg=new Plane(this.min,new Vector3D(0,0,-1));var e=new Vector3D(this.max.x,this.max.y,this.max.z);var t=new Vector3D(this.max.x,this.max.y,this.min.z);var n=new Vector3D(this.max.x,this.min.y,this.max.z);var r=new Vector3D(this.max.x,this.min.y,this.min.z);var i=new Vector3D(this.min.x,this.max.y,this.max.z);var s=new Vector3D(this.min.x,this.max.y,this.min.z);var o=new Vector3D(this.min.x,this.min.y,this.max.z);var u=new Vector3D(this.min.x,this.min.y,this.min.z);this.xpos_ypos_zpos=new Plane(e,e-u);this.xpos_ypos_zneg=new Plane(t,t-o);this.xpos_yneg_zpos=new Plane(n,n-s);this.xpos_yneg_zneg=new Plane(r,r-i);this.xneg_ypos_zpos=new Plane(i,i-r);this.xneg_ypos_zneg=new Plane(s,s-n);this.xneg_yneg_zpos=new Plane(o,o-t);this.xneg_yneg_zneg=new Plane(u,u-e)};Region.prototype.containsGeometry=function(e,t){var n=[];for(var r=0;r<t.length;r++){if(this.containsTriangle(e[t[r]])){n.push(t[r])}}return n};Region.prototype.containsTriangle=function(e){var t=new Array(3);t[0]=e.v0;t[1]=e.v1;t[2]=e.v2;for(var n=0;n<3;n++){if(t[n].x>=this.min.x&&t[n].y>=this.min.y&&t[n].z>=this.min.z&&t[n].x<=this.max.x&&t[n].y<=this.max.y&&t[n].z<=this.max.z){return true}}if(triangleOnPositiveSideOfPlane(t[0],t[1],t[2],this.xpos)||triangleOnPositiveSideOfPlane(t[0],t[1],t[2],this.xneg)||triangleOnPositiveSideOfPlane(t[0],t[1],t[2],this.ypos)||triangleOnPositiveSideOfPlane(t[0],t[1],t[2],this.yneg)||triangleOnPositiveSideOfPlane(t[0],t[1],t[2],this.zpos)||triangleOnPositiveSideOfPlane(t[0],t[1],t[2],this.zneg)||triangleOnPositiveSideOfPlane(t[0],t[1],t[2],this.xpos_ypos_zpos)||triangleOnPositiveSideOfPlane(t[0],t[1],t[2],this.xpos_ypos_zneg)||triangleOnPositiveSideOfPlane(t[0],t[1],t[2],this.xpos_yneg_zpos)||triangleOnPositiveSideOfPlane(t[0],t[1],t[2],this.xpos_yneg_zneg)||triangleOnPositiveSideOfPlane(t[0],t[1],t[2],this.xneg_ypos_zpos)||triangleOnPositiveSideOfPlane(t[0],t[1],t[2],this.xneg_ypos_zneg)||triangleOnPositiveSideOfPlane(t[0],t[1],t[2],this.xneg_yneg_zpos)||triangleOnPositiveSideOfPlane(t[0],t[1],t[2],this.xneg_yneg_zneg)){return false}var r;for(var n=0;n<3;n++){var i=t[n];var s=t[(n+1)%3];r=lineSegmentPlaneIntersection(i,s,this.xpos);if(r.count>0){if(r.point.y>=this.min.y&&r.point.y<=this.max.y&&r.point.z>=this.min.z&&r.point.z<=this.max.z){return true}}r=lineSegmentPlaneIntersection(i,s,this.xneg);if(r.count>0){if(r.point.y>=this.min.y&&r.point.y<=this.max.y&&r.point.z>=this.min.z&&r.point.z<=this.max.z){return true}}r=lineSegmentPlaneIntersection(i,s,this.ypos);if(r.count>0){if(r.point.x>=this.min.x&&r.point.x<=this.max.x&&r.point.z>=this.min.z&&r.point.z<=this.max.z){return true}}r=lineSegmentPlaneIntersection(i,s,this.yneg);if(r.count>0){if(r.point.x>=this.min.x&&r.point.x<=this.max.x&&r.point.z>=this.min.z&&r.point.z<=this.max.z){return true}}r=lineSegmentPlaneIntersection(i,s,this.zpos);if(r.count>0){if(r.point.x>=this.min.x&&r.point.x<=this.max.x&&r.point.y>=this.min.y&&r.point.y<=this.max.y){return true}}r=lineSegmentPlaneIntersection(i,s,this.zneg);if(r.count>0){if(r.point.x>=this.min.x&&r.point.x<=this.max.x&&r.point.y>=this.min.y&&r.point.y<=this.max.y){return true}}}r=lineSegmentTriangleIntersection(this.min,this.max,t[0],t[1],t[2]);if(r.count>0)return true;r=lineSegmentTriangleIntersection(new Vector3D(this.min.x,this.max.y,this.min.z),new Vector3D(this.max.x,this.min.y,this.max.z),t[0],t[1],t[2]);if(r.count>0)return true;r=lineSegmentTriangleIntersection(new Vector3D(this.max.x,this.min.y,this.min.z),new Vector3D(this.min.x,this.max.y,this.max.z),t[0],t[1],t[2]);if(r.count>0)return true;r=lineSegmentTriangleIntersection(new Vector3D(this.min.x,this.min.y,this.max.z),new Vector3D(this.max.x,this.max.y,this.min.z),t[0],t[1],t[2]);if(r.count>0)return true;return false};SphereTreeNode.prototype.isLeaf=function(){return this.children.length==0?true:false};SphereTreeNode.prototype.addChild=function(e){this.children.push(e);e.parent=this};SphereTreeNode.prototype.intersects=function(e){return this.sphere.intersects(e.sphere)};BoundingTree.prototype.setTriangles=function(e,t,n){this.tris=e.slice();this.min.copy(t);this.max.copy(n)};BoundingTree.prototype.setTransform=function(e){};SphereTree.prototype=new BoundingTree;SphereTree.prototype.constructor=SphereTree;SphereTree.prototype.setTransform=function(e){if(this.root)this.transformNode(e,this.root)};SphereTree.prototype.transformNode=function(e,t){t.sphere.setTransform(e);for(var n=0;n<t.children.length;n++){this.transformNode(e,t.children[n])}};SphereTree.prototype.collides=function(e){if(!this.root||!e.root){return false}if(this.nodesCollide(this.root,e.root)){if(this.root.isLeaf()&&e.root.isLeaf()){return true}var t=new SphereHitRec;var n=[];if(e.root.isLeaf()){t.target=e.root;t.testList=this.root.children}else{t.target=this.root;t.testList=e.root.children}n.push(t);return this.testSphereHits(n)}return false};SphereTree.prototype.obstructs=function(e,t){if(!this.root||!e.root){return 0}var n=e.root.sphere.xcenter;var r=new Vector3D(n.x+t.x,n.y+t.y,n.z+t.z);var i=e.root.sphere.xradius;var s=distanceBetweenLineSegmentAndPoint(n,r,this.root.sphere.xcenter);if(s<this.root.sphere.xradius+i){return s}return 0};SphereTree.prototype.nodesCollide=function(e,t){return e.intersects(t)};SphereTree.prototype.testSphereHits=function(e){while(e.length>0){if(this.testSphereHit(e[0],e)){return true}e.splice(0,1)}return false};SphereTree.prototype.testSphereHit=function(e,t){for(var n=0;n<e.testList.length;n++){if(this.nodesCollide(e.target,e.testList[n])){var r=new SphereHitRec;r.target=e.testList[n];if(e.target.isLeaf()){r.testList.push(e.target)}else{r.testList=e.target.children}t.push(r);if(e.target.isLeaf()&&e.testList[n].isLeaf()){return true}}}return false};SphereTree.prototype.rayIntersectsTree=function(e){if(this.root){this.visited.length=this.tris.length;for(var t=0;t<this.visited.length;t++){this.visited[t]=false}return this.rayIntersectsTreeNode(this.root,e)}return false};SphereTree.prototype.rayIntersectsTreeNode=function(e,t){if(e.children.length>0){if(this.rayIntersectsSphere(e,t)==false){return false}var n=false;for(var r=0;r<e.children.length;r++){if(this.rayIntersectsTreeNode(e.children[r],t)==true){n=true}}if(n){return true}else{return false}}else{return this.rayIntersectsTriangleList(e.triIndices,t)}};SphereTree.prototype.rayIntersectsSphere=function(e,t){var n=t.worldViewMatrix.transform(e.sphere.center.x,e.sphere.center.y,e.sphere.center.z,1);var r=e.sphere.radius*max3(t.scale.x,t.scale.y,t.scale.z);var i=raySphereIntersection(t.rayOrigin,t.rayDir,n,r);switch(i.count){case 2:if(i.root1<=0&&i.root2<=0){return false}break;case 1:if(i.root1<=0){return false}break;case 0:default:return false}return true};SphereTree.prototype.rayIntersectsTriangleList=function(e,t){var n,r,i;for(var s=0;s<e.length;s++){var o=e[s];if(this.visited[o]==true){continue}var u=this.tris[o];var a=t.worldViewMatrix.transform(u.v0.x,u.v0.y,u.v0.z,1);var f=t.worldViewMatrix.transform(u.v1.x,u.v1.y,u.v1.z,1);var l=t.worldViewMatrix.transform(u.v2.x,u.v2.y,u.v2.z,1);var c=rayTriangleIntersection(t.rayOrigin,t.rayDir,a,f,l,false,t.doubleSided?false:true);if(c.result){if(c.t>=t.nearDistance&&c.t<=t.farDistance&&c.t<t.intersectRecord.distance){var h=new Vector3D(u.v0.x*(1-c.u-c.v)+u.v1.x*c.u+u.v2.x*c.v,u.v0.y*(1-c.u-c.v)+u.v1.y*c.u+u.v2.y*c.v,u.v0.z*(1-c.u-c.v)+u.v1.z*c.u+u.v2.z*c.v);var p=t.worldMatrix.transform(h.x,h.y,h.z,1);var d=t.worldViewMatrix.transform(h.x,h.y,h.z,1);for(var v=0;v<t.clipPlanes.length;v++){if(pointOnNegativeSideOfPlane(p,t.clipPlanes[v])){this.visited[o]=true;break}}if(this.visited[o]){continue}t.intersectRecord.distance=c.t;t.intersectRecord.pointModel.copy(h);t.intersectRecord.pointWorld.copy(p);t.intersectRecord.pointView.copy(d);t.intersectRecord.triIndex=o;t.intersects=true}}this.visited[o]=true}return t.intersects};Octree.prototype=new SphereTree;Octree.prototype.constructor=Octree;Octree.prototype.buildTree=function(e){if(e<0)return;var t=new SphereTreeNode;t.sphere.center.copy(midpoint(this.min,this.max));t.sphere.xcenter.copy(t.sphere.center);t.sphere.radius=distanceBetween(t.sphere.center,this.max);t.sphere.xradius=t.sphere.radius;t.triIndices.length=this.tris.length;for(var n=0;n<this.tris.length;n++){t.triIndices[n]=n}if(e>0){this.buildTreeLevels(e,this.min,this.max,t,t.triIndices)}this.root=t};Octree.prototype.buildTreeLevels=function(e,t,n,r,i){if(r.level==e){return}var s=new Vector3D(t.x+(n.x-t.x)/2,t.y+(n.y-t.y)/2,t.z+(n.z-t.z)/2);var o=new Array(8);o[0]=new Region(t.x,t.y,t.z,s.x,s.y,s.z);o[1]=new Region(s.x,t.y,t.z,n.x,s.y,s.z);o[2]=new Region(t.x,t.y,s.z,s.x,s.y,n.z);o[3]=new Region(s.x,t.y,s.z,n.x,s.y,n.z);o[4]=new Region(t.x,s.y,t.z,s.x,n.y,s.z);o[5]=new Region(s.x,s.y,t.z,n.x,n.y,s.z);o[6]=new Region(t.x,s.y,s.z,s.x,n.y,n.z);o[7]=new Region(s.x,s.y,s.z,n.x,n.y,n.z);for(var u=0;u<8;u++){var a=o[u].containsGeometry(this.tris,i);if(a.length>0){var f=new SphereTreeNode;f.level=r.level+1;f.sphere.center.copy(midpoint(o[u].min,o[u].max));f.sphere.xcenter.copy(f.sphere.center);f.sphere.radius=distanceBetween(f.sphere.center,o[u].max);f.sphere.xradius=f.sphere.radius;f.triIndices=a.slice();r.addChild(f);this.buildTreeLevels(e,o[u].min,o[u].max,f,f.triIndices)}}};Context.prototype.clear=function(){this.container=null;this.attribute=null;this.item=0;this.containerName="";this.attributeName=""};var eRenderContextMethod={Unknown:0,ApplyModelViewTransform:1,ApplyProjectionTransform:2,Clear:3,ClearColor:4,ClearDepth:5,ClearStencil:6,CreateVertexBuffer:7,CreateTextureObject:8,Disable:9,Enable:10,Enabled:11,EnableLight:12,EnableTextureStage:13,Finish:14,GetEnabledLights:15,GetGlobalIllumination:16,GetLight:17,GetMaxLightCount:18,GetMaxTextureStages:19,PerspectiveMatrixLH:20,OrthographicMatrixLH:21,SetBlendColor:22,SetBlendFactor:23,SetDepthFunc:24,SetEnabledLights:25,SetFrontMaterial:26,SetGlobalIllumination:27,SetLight:28,SetShadeModel:29,SetStencilFunc:30,SetStencilMask:31,SetStencilOp:32,SetTextureBlendFactor:33,SetTextureBlendOp:34,SetTextureColorMask:35,SetViewport:36,VB_SetPrimitiveType:37,VB_SetVertices:38,VB_SetNormals:39,VB_SetColors:40,VB_SetUVCoords:41,VB_SetTextureStage:42,VB_Draw:43,TO_SetImage:44,TO_SetImageData:45,TO_SetVideo:46,SetMatrixMode:47,PushMatrix:48,PopMatrix:49,LoadMatrix:50,LeftMultMatrix:51,RightMultMatrix:52};DisplayListObj.prototype.record_begin=function(){this.clear();this.renderContext.setDisplayList(this)};DisplayListObj.prototype.record_end=function(){this.renderContext.setDisplayList(null)};DisplayListObj.prototype.play=function(){for(var e=0;e<this.displayList.length;e++){this.invokeMethod(this.displayList[e])}};DisplayListObj.prototype.addMethodDesc=function(e){this.displayList.push(e)};DisplayListObj.prototype.clear=function(){this.displayList=[]};DisplayListObj.prototype.invokeMethod=function(e){switch(e.method){case eRenderContextMethod.ApplyModelViewTransform:{this.renderContext.applyModelViewTransform()}break;case eRenderContextMethod.ApplyProjectionTransform:{this.renderContext.applyProjectionTransform()}break;case eRenderContextMethod.Clear:{return this.renderContext.clear(e.params[0])}break;case eRenderContextMethod.ClearColor:{this.renderContext.clearColor(e.params[0],e.params[1],e.params[2],e.params[3])}break;case eRenderContextMethod.ClearDepth:{this.renderContext.clearDepth(e.params[0])}break;case eRenderContextMethod.ClearStencil:{this.renderContext.clearStencil(e.params[0])}break;case eRenderContextMethod.CreateVertexBuffer:{return this.renderContext.createVertexBuffer(e.params[0])}break;case eRenderContextMethod.CreateTextureObject:{this.renderContext.createTextureObject()}break;case eRenderContextMethod.Disable:{this.renderContext.disable(e.params[0])}break;case eRenderContextMethod.Enable:{this.renderContext.enable(e.params[0])}break;case eRenderContextMethod.Enabled:{return this.renderContext.enabled(e.params[0])}break;case eRenderContextMethod.EnableLight:{this.renderContext.enableLight(e.params[0],e.params[1])}break;case eRenderContextMethod.EnableTextureStage:{this.renderContext.enableTextureStage(e.params[0],e.params[1])}break;case eRenderContextMethod.Finish:{this.renderContext.finish()}break;case eRenderContextMethod.GetEnabledLights:{return this.renderContext.getEnabledLights()}break;case eRenderContextMethod.GetGlobalIllumination:{return this.renderContext.getGlobalIllumination()}break;case eRenderContextMethod.GetLight:{return this.renderContext.getLight(e.params[0])}break;case eRenderContextMethod.GetMaxLightCount:{return this.renderContext.getMaxLightCount()}break;case eRenderContextMethod.getMaxTextureStages:{return this.renderContext.getMaxTextureStages()}break;case eRenderContextMethod.PerspectiveMatrixLH:{this.renderContext.perspectiveMatrixLH(e.params[0],e.params[1],e.params[2],e.params[3],e.params[4],e.params[5])}break;case eRenderContextMethod.OrthographicMatrixLH:{this.renderContext.orthographicMatrixLH(e.params[0],e.params[1],e.params[2],e.params[3],e.params[4],e.params[5])}break;case eRenderContextMethod.SetBlendColor:{this.renderContext.setBlendColor(e.params[0],e.params[1],e.params[2],e.params[3])}break;case eRenderContextMethod.SetBlendFactor:{this.renderContext.setBlendFactor(e.params[0],e.params[1])}break;case eRenderContextMethod.SetDepthFunc:{this.renderContext.setDepthFunc(e.params[0])}break;case eRenderContextMethod.SetEnabledLights:{this.renderContext.setEnabledLights(e.params[0])}break;case eRenderContextMethod.SetFrontMaterial:{this.renderContext.setFrontMaterial(e.params[0])}break;case eRenderContextMethod.SetGlobalIllumination:{this.renderContext.setGlobalIllumination(e.params[0])}break;case eRenderContextMethod.SetLight:{this.renderContext.setLight(e.params[0],e.params[1])}break;case eRenderContextMethod.SetShadeModel:{this.renderContext.setShadeModel(e.params[0])}break;case eRenderContextMethod.SetStencilFunc:{this.renderContext.setStencilFunc(e.params[0],e.params[1],e.params[2])}break;case eRenderContextMethod.SetStencilMask:{this.renderContext.setStencilMask(e.params[0])}break;case eRenderContextMethod.SetStencilOp:{this.renderContext.setStencilOp(e.params[0],e.params[1],e.params[2])}break;case eRenderContextMethod.SetTextureBlendFactor:{this.renderContext.setTextureBlendFactor(e.params[0])}break;case eRenderContextMethod.SetTextureBlendOp:{this.renderContext.setTextureBlendOp(e.params[0])}break;case eRenderContextMethod.SetTextureColorMask:{this.renderContext.setTextureColorMask(e.params[0],e.params[1],e.params[2],e.params[3])}break;case eRenderContextMethod.SetViewport:{this.renderContext.setViewport(e.params[0],e.params[1],e.params[2],e.params[3])}break;case eRenderContextMethod.VB_SetPrimitiveType:{e.params[0].setPrimitiveType(e.params[1])}break;case eRenderContextMethod.VB_SetVertices:{e.params[0].setVertices(e.params[1])}break;case eRenderContextMethod.VB_SetNormals:{e.params[0].setNormals(e.params[1])}break;case eRenderContextMethod.VB_SetColors:{e.params[0].setColors(e.params[1])}break;case eRenderContextMethod.VB_SetUVCoords:{e.params[0].setUVCoords(e.params[1],e.params[2])}break;case eRenderContextMethod.VB_SetTextureStage:{e.params[0].setTextureStage(e.params[1],e.params[2],e.params[3],e.params[4],e.params[5],e.params[6])}break;case eRenderContextMethod.VB_Draw:{e.params[0].draw()}break;case eRenderContextMethod.TO_SetImage:{e.params[0].setImage(e.params[1],e.params[2],e.params[3])}break;case eRenderContextMethod.TO_SetImageData:{e.params[0].setImageData(e.params[1],e.params[2],e.params[3],e.params[4],e.params[5])}break;case eRenderContextMethod.TO_SetVideo:{e.params[0].setVideo(e.params[1])}break;case eRenderContextMethod.SetMatrixMode:{this.renderContext.setMatrixMode(e.params[0])}break;case eRenderContextMethod.PushMatrix:{this.renderContext.pushMatrix()}break;case eRenderContextMethod.PopMatrix:{this.renderContext.popMatrix()}break;case eRenderContextMethod.LoadMatrix:{this.renderContext.loadMatrix(e.params[0])}break;case eRenderContextMethod.LeftMultMatrix:{this.renderContext.leftMultMatrix(e.params[0])}break;case eRenderContextMethod.RightMultMatrix:{this.renderContext.rightMultMatrix(e.params[0])}break}};var eRenderMode={AlphaBlend:1,CullBackFace:2,DepthTest:3,DepthBufferWrite:4,Lighting:5,NormalizeNormals:6,Fog:7,StencilTest:8,PolygonOffset_Fill:9,PolygonOffset_Line:10,PolygonOffset_Point:11};var eDepthFunc={Never:1,Less:2,LessEqual:3,Equal:4,NotEqual:5,GreaterEqual:6,Greater:7,Always:8};var eStencilFunc={Never:1,Less:2,LessEqual:3,Equal:4,NotEqual:5,GreaterEqual:6,Greater:7,Always:8};var eStencilOp={Keep:0,Replace:1,Increment:2,Decrement:3,Invert:4,Zero:5};var eShadeModel={Flat:1,Gouraud:2};var RC_BLEND=1;var RC_CULL_FACE=2884;var LIGHTDESC_POSITION_BIT=1;var LIGHTDESC_DIRECTION_BIT=2;var LIGHTDESC_AMBIENT_BIT=4;var LIGHTDESC_DIFFUSE_BIT=8;var LIGHTDESC_SPECULAR_BIT=16;var LIGHTDESC_CONSTANT_ATT_BIT=32;var LIGHTDESC_LINEAR_ATT_BIT=64;var LIGHTDESC_QUADRATIC_ATT_BIT=128;var LIGHTDESC_RANGE_BIT=256;var LIGHTDESC_OUTER_CONE_DEG_BIT=512;var LIGHTDESC_INNER_CONE_DEG_BIT=1024;var LIGHTDESC_CONE_FALLOFF_BIT=2048;var MATERIALDESC_AMBIENT_BIT=1;var MATERIALDESC_DIFFUSE_BIT=2;var MATERIALDESC_SPECULAR_BIT=4;var MATERIALDESC_EMISSIVE_BIT=8;var MATERIALDESC_GLOSSINESS_BIT=16;var MATERIALDESC_ALL_BITS=31;var RC_COLOR_BUFFER_BIT=1;var RC_DEPTH_BUFFER_BIT=2;var RC_STENCIL_BUFFER_BIT=4;var RC_ZERO=1;var RC_ONE=2;var RC_SRC_COLOR=4;var RC_SRC_ALPHA=8;var RC_ONE_MINUS_SRC_COLOR=16;var RC_ONE_MINUS_SRC_ALPHA=32;var RC_DEST_COLOR=64;var RC_DEST_ALPHA=128;var RC_ONE_MINUS_DEST_COLOR=256;var RC_ONE_MINUS_DEST_ALPHA=512;var RC_MODULATE=1;var RC_REPLACE=2;var RC_BLEND=4;var RC_DECAL=8;var eTextureCoordSrc={VertexUVs:1,ViewSpaceVertexPosition:2,ViewSpaceReflectionVector:3};var RC_REPEAT=10497;var RC_CLAMP_TO_EDGE=33071;var RC_MIRRORED_REPEAT=33648;var RC_MODELVIEW=1;var RC_PROJECTION=2;var RC_TEXTURE=4;var RENDERSTATE_TRANSFORM_BIT=1;var RENDERSTATE_LIGHTING_BIT=2;var RENDERSTATE_MATERIAL_BIT=4;var RENDERSTATE_FOG_BIT=8;var RENDERSTATE_CLIP_PLANE_BIT=16;var RENDERSTATE_ZBUFFER_BIT=32;var RENDERSTATE_ALL_BITS=63;var RC_POINTS=0;var RC_LINES=1;var RC_LINE_LOOP=2;var RC_LINE_STRIP=3;var RC_TRIANGLES=4;var RC_TRIANGLE_STRIP=5;var RC_TRIANGLE_FAN=6;WebGLDebugUtils=function(){function r(e){if(n==null){n={};for(var t in e){if(typeof e[t]=="number"){n[e[t]]=t}}}}function i(){if(n==null){throw"WebGLDebugUtils.init(ctx) not called"}}function s(e){i();return n[e]!==undefined}function o(e){i();var t=n[e];return t!==undefined?t:"*UNKNOWN WebGL ENUM"}function u(e,n,r){var i=t[e];if(i!==undefined){if(i[n]){return o(r)}}return r.toString()}function a(t,n){function s(e,t){return function(){var r=e[t].apply(e,arguments);var s=e.getError();if(s!=0){i[s]=true;n(s,t,arguments)}return r}}r(t);n=n||function(t,n,r){var i="";for(var s=0;s<r.length;++s){i+=(s==0?"":", ")+u(n,s,r[s])}e("WebGL error "+o(t)+" in "+n+"("+i+")")};var i={};var a={};for(var f in t){if(typeof t[f]=="function"){a[f]=s(t,f)}else{a[f]=t[f]}}a.getError=function(){for(var e in i){if(i[e]){i[e]=false;return e}}return t.NO_ERROR};return a}var e=function(e){if(window.console&&window.console.log){window.console.log(e)}};var t={enable:{0:true},disable:{0:true},getParameter:{0:true},drawArrays:{0:true},drawElements:{0:true,2:true},createShader:{0:true},getShaderParameter:{1:true},getProgramParameter:{1:true},getVertexAttrib:{1:true},vertexAttribPointer:{2:true},bindTexture:{0:true},activeTexture:{0:true},getTexParameter:{0:true,1:true},texParameterf:{0:true,1:true},texParameteri:{0:true,1:true,2:true},texImage2D:{0:true,2:true,6:true,7:true},texSubImage2D:{0:true,6:true,7:true},copyTexImage2D:{0:true,2:true},copyTexSubImage2D:{0:true},generateMipmap:{0:true},bindBuffer:{0:true},bufferData:{0:true,2:true},bufferSubData:{0:true},getBufferParameter:{0:true,1:true},pixelStorei:{0:true,1:true},readPixels:{4:true,5:true},bindRenderbuffer:{0:true},bindFramebuffer:{0:true},checkFramebufferStatus:{0:true},framebufferRenderbuffer:{0:true,1:true,2:true},framebufferTexture2D:{0:true,1:true,2:true},getFramebufferAttachmentParameter:{0:true,1:true,2:true},getRenderbufferParameter:{0:true,1:true},renderbufferStorage:{0:true,1:true},clear:{0:true},depthFunc:{0:true},blendFunc:{0:true,1:true},blendFuncSeparate:{0:true,1:true,2:true,3:true},blendEquation:{0:true},blendEquationSeparate:{0:true,1:true},stencilFunc:{0:true},stencilFuncSeparate:{0:true,1:true},stencilMaskSeparate:{0:true},stencilOp:{0:true,1:true,2:true},stencilOpSeparate:{0:true,1:true,2:true,3:true},cullFace:{0:true},frontFace:{0:true}};var n=null;return{init:r,mightBeEnum:s,glEnumToString:o,glFunctionArgToString:u,makeDebugContext:a}}();var gl_MaxLights=8;var gl_MaxTextureStages=2;webglRC.prototype=new RenderContext;webglRC.prototype.constructor=webglRC;webglVB.prototype=new VertexBuffer;webglVB.prototype.constructor=webglVB;webglTO.prototype=new TextureObject;webglTO.prototype.constructor=webglTO;var eShaderType={VertexLighting:0,FragmentLighting:1};ContentHandler.prototype=new AttributeContainer;ContentHandler.prototype.constructor=ContentHandler;ContentHandler.prototype.parseFileStream=function(e){};ContentHandler.prototype.matchesType=function(e){};ContentBuilder.prototype=new AttributeContainer;ContentBuilder.prototype.constructor=ContentBuilder;ContentBuilder.prototype.setRegistry=function(e){AttributeContainer.prototype.setRegistry.call(this,e);this.factory=this.registry.find("AttributeFactory")};ContentBuilder.prototype.visitHandler=function(e){};ContentBuilder.prototype.finalize=function(){};ContentBuilder.prototype.matchesType=function(e){};XMLParser.prototype.parse=function(e){parser=new SAXDriver;parser.setDocumentHandler(this);parser.setErrorHandler(this);parser.setLexicalHandler(this);parser.parse(e)};XMLParser.prototype.processingInstruction=function(e,t){switch(e){case"bw":{console.debug("TODO: "+e.toString())}break;case"bwinclude":{var n=new String(t);var r=this.parseTokenValue(n,'url="','"');if(r){console.debug("Processing Instruction for: "+r);var i=getFileExtension(r);switch(i){case"xml":{var s=loadXMLResource(this.contentDir+"/"+r);this.parse(s)}break;case"lws":{var o=formatPath(r);console.debug("Include instruction for path: "+o[0]);console.debug("Include content dir: "+o[1]);var u=new LWSceneHandler;u.getAttribute("contentDirectory").setValueDirect(o[1]);var a=new LWSceneBuilder;a.setRegistry(this.factory.registry);a.visitHandler(u);u.parseFileStream(o[0])}break}}}break}};XMLParser.prototype.startElement=function(e,t){if(isUpper(e[0])){this.parseAttributeContainer(e,t)}else{this.parseComplexAttribute(e,t)}};XMLParser.prototype.endElement=function(e){if(isUpper(e[0])){this.parseAttributeContainer(e)}else{this.parseComplexAttribute(e)}};XMLParser.prototype.startCDATA=function(){};XMLParser.prototype.endCDATA=function(){};XMLParser.prototype.characters=function(e,t,n){var r="";for(var i=0;i<n;i++){r+=e[t+i]}if(r.length&&!isSpace(r[0])){var s=this.attributeStack.top();if(s){deserializeAttribute(s,r)}}};XMLParser.prototype.error=function(e){alert("Error: "+e.getMessage())};XMLParser.prototype.fatalError=function(e){alert("Fatal Error: "+e.getMessage())};XMLParser.prototype.parseAttributeContainer=function(e,t){if(t){var n=this.factory.create(e);if(!n){this.attributeStack.push(null);return}n.flagDeserializedFromXML();if(!resolveAttributeContainerReference(n,t.m_parser.m_atts,this.registry)){deserializeAttributeContainer(n,t.m_parser.m_atts)}this.registry.registerResource(n);var r=this.attributeStack.top();if(r&&r.isCollection()){if(!r.allocatesElements()){r.push_back(n);r.setElementName(n,e);var i=this.collectionCountStack.top();i++;this.collectionCountStack.pop();this.collectionCountStack.push(i)}else{r.setElementName(r.getAt(r.Size()-1),e)}}this.attributeStack.push(n);if(n.isCollection()){this.collectionCountStack.push(0)}}else{var n=this.attributeStack.top();this.attributeStack.pop();if(n&&n.isCollection()){this.collectionCountStack.pop()}if(n){this.factory.finalize(e,n);this.registry.finalizeResource(n)}}};XMLParser.prototype.parseComplexAttribute=function(e,t){if(t){var n=this.attributeStack.top();if(!n)return;var r=n.getAttribute(e);if(!r){if(n.isCollection()){var i=this.collectionCountStack.top();i++;var s=n.Size();if(n.AppendParsedElements()){n.resize(s+1);i=s}else if(s<=i){n.resize(i+1)}r=n.getAt(i)}else{this.attributeStack.push(n);return}}this.attributeStack.push(r);if(r&&r.isContainer()){if(!resolveAttributeContainerReference(r,t.m_parser.m_atts,this.registry)){deserializeAttributeContainer(r,t.m_parser.m_atts)}if(r.isCollection()){this.collectionCountStack.push(0)}}else if(r){if(!resolveComplexAttributeReference(r,t.m_parser.m_atts)){deserializeComplexAttribute(r,t.m_parser.m_atts)}}}else{this.attributeStack.pop();if(n&&n.isCollection()){this.collectionCountStack.pop()}}};XMLParser.prototype.parsePrimitiveAttribute=function(){};XMLParser.prototype.parseTokenValue=function(e,t,n){var r=e.indexOf(t);if(r==-1){return undefined}r+=t.length;var i=e.indexOf(n,r);if(i==-1){return undefined}return e.substring(r,i)};Serializer.prototype=new AttributeContainer;Serializer.prototype.constructor=Serializer;Serializer.prototype.serialize=function(e,t,n,r){this.RootElement=null;this.DOM=document.implementation.createDocument("","__InitialRoot",null);if(this.DOM){if(this.RootElement){this.DOM.removeChild(this.RootElement);this.RootElement=null;this.mixedModifiedCB(attr,data)}if(e){this.serializeAttribute(e,t,n)}else{this.serializeAttribute(r,0,"")}}};Serializer.prototype.serializeAttribute=function(e,t,n){if(e){if(e.isTransient()){return}if(this.serializeMinimum.getValueDirect()==true&&!e.isDeserializedFromXML()){return}if(e.attrType==eAttrType.Model){var r=e;this.serializeModel(r)}else if(e.attrType==eAttrType.PerspectiveCamera){var i=e;this.serializeAttributeContainer(i)}else if(e.attrType>eAttrType.Command&&e.attrType<eAttrType.Command_End){var s=e;this.serializeCommand(s)}else if(e.isContainer()){var i=e;this.serializeAttributeContainer(i)}else if(n&&this.DOM){var o=e.attrType;var u=null;var a=null;var f=null;var l=null;var c;var h;var p;var d=e.getLength();if(n){var v=0;while(true){v=n.indexOf("(");if(v==-1)break;n.replace(v,1,"_x0028")}while(true){v=n.indexOf(")");if(v==-1)break;n.replace(v,1,"_x0029")}var m=n;if(m){u=this.DOM.createElement(m);if(u){var g;g=this.getAttributeStringValue(e,t);if(g=="")return;if(t>=0||d==1||o==eAttrType.StringAttr){var y="<![CDATA[";var b="]]>";var w=0;var E=g.indexOf(b);if(w!=-1&&E!=-1){w+=y.length;g=g.substr(w,g.length-w-b.length);var S=null;m=g;if(m){S=this.DOM.createCDATASection(m)}u.appendChild(S)}else{u.textContent=g}}else{var x;var T=0;var N=0;for(var C=0;C<d;++C){c="item"+C.toString();N=C==d-1?g.length:g.indexOf(",",T);x=g.substr(T,N-T);T=N+1;if(this.bMixed){a=this.DOM.createElement(c);a.textValue=x;u.appendChild(a)}else{f=this.DOM.createAttribute(c);f.value=x;u.setAttributeNode(f)}}}this.pushElement(u);this.popElement()}}}}}};Serializer.prototype.serializeAttributeReference=function(e,t){if(e&&t&&this.DOM){var n=null;var r=null;var i=null;var s=null;var o=null;n=e.getContainer();if(n){var u=n.getAttributeName(e);if(u){r=this.DOM.createElement(u)}}if(r){if(r.attributes.length>0){i=this.DOM.createAttribute("ref");if(i){var a="";var f="";var l=null;n=t.getContainer();if(n){a=n.getAttributeName(t);if(l=n.getAttribute("name")){var c;f=l.getValueDirect().join("");f+="/";f+=a;a=f}}i.textContent=a;s.setNamedItem(i,o)}}this.pushElement(r);this.popElement()}}};Serializer.prototype.serializeModel=function(e){var t=null;var n=null;if(this.DOM){t="ModelRoot";if(t){n=this.DOM.createElement(t);if(n){this.pushElement(n)}}}if(e){this.serializeAttributeContainer(e);var r=null;if(r=getInspectionGroup(e)){var i=e;var s=r.getChild(2).getAttribute("rotationQuat");var o;var u=i.getAttribute("name");o=u.getValueDirect().join("");var a=null;var f=this.registry.find("AttributeFactory");a=f.create("Set");if(a){a.getAttribute("target").setValueDirect(o);a.getAttribute("target").flagDeserializedFromXML();var l=[];s.getValue(l);a.attributeValuePairs.push(new Pair(s,l));this.serializeCommand(a);setAttributeBin(null);setAttributePairs(null)}}}if(n){this.popElement()}};Serializer.prototype.serializeCommand=function(e){var t;if(e&&this.DOM){var n=null;var r=e.className;if(r=="Serialize")return;var i=r;if(i){n=this.DOM.createElement(i);if(n){this.pushElement(n);var t;var s=null;var o=null;var u=e.getAttributeCount();for(t=0;t<u;++t){s=e.getAttributeAt(t);o=e.getAttributeName(s);if(!e.isBorrowed(s)&&o!="sourceContainer"&&o!="sourceEvaluator"&&o!="sourceAttribute"&&o!="sourceOutput"&&o!="source"&&o!="targetContainer"&&o!="targetAttribute"&&o!="target"){this.serializeAttribute(s,-1,o)}}s=e.getAttribute("sourceContainer");if(s){this.serializeAttribute(s,-1,"sourceContainer")}s=e.getAttribute("targetContainer");if(s){this.serializeAttribute(s,-1,"targetContainer")}var a=[];var f=[];for(t=0;t<u;++t){var l=e.getAttributeAt(t);var c=e.getAttributeName(l);if(c=="sourceAttribute"){a.push(l)}else if(c=="targetAttribute"){f.push(l)}}for(t=0;t<a.length&&t<f.length;t++){this.serializeAttribute(a[t],-1,"sourceAttribute");this.serializeAttribute(f[t],-1,"targetAttribute")}if(f.length==0){s=e.getAttribute("target");if(s){this.serializeAttribute(s,-1,"target")}}var h;var p;for(t=0;t<u;++t){s=e.getAttributeAt(t);var c=e.getAttributeName(s);var d=e.isBorrowedAndValueModified(s);if(d.borrowed){var v=newAttribute(s.className);if(v){setAttributeValue(v,d.value);v.flagDeserializedFromXML();this.serializeAttribute(v,-1,c)}}else{var d=e.isBorrowedAndReferenceModified(s);if(d.borrowed){this.serializeAttributeReference(s,d.reference)}}}this.popElement()}}}};Serializer.prototype.serializeAttributeContainer=function(e){if(e&&this.DOM){var t=null;var n=e.className;if(n=="BwSceneInspector"){n="SceneInspector"}var r=n;if(r){t=this.DOM.createElement(r);if(t){this.pushElement(t);var i=null;var s=null;var o=e.getAttributeCount();for(var u=0;u<o;++u){i=e.getAttributeAt(u);var a=e.getAttributeName(i);if(i.isNative()==true){this.serializeAttribute(i,-1,a)}}if(this.serializeChildren.getValueDirect()){this.doSerializeChildren(e)}for(var u=0;u<o;++u){i=e.getAttributeAt(u);if(e.getAttributeModificationCount(i)==0)continue;var a=e.getAttributeName(i);if(i.isNative()==false){this.serializeAttribute(i,-1,a)}}this.popElement()}}}};Serializer.prototype.serializeAttributeCollection=function(e){if(e&&this.DOM){var t=null;var n=e.className;var r=n;if(r){t=this.DOM.createElement(r);if(t){this.pushElement(t);var i=e;{var s;var o=i.baseName.getValueDirect().join("");var u=i.length;for(var a=0;a<u;a++){s=o[0];s+="[";s+=a.toString();s+="]";this.serializeAttribute(i[a],0,s)}}this.popElement()}}}};Serializer.prototype.doSerializeChildren=function(e){if(e.attrType<eAttrType.Node||e.attrType>eAttrType.Node_End){return}for(var t=0;t<e.getChildCount();t++){this.serializeAttribute(e.getChild(t),0,null)}};Serializer.prototype.pushElement=function(e){this.elementStack.push(e);if(this.RootElement){this.RootElement.appendChild(e)}else{this.DOM.replaceChild(e,this.DOM.documentElement)}this.RootElement=e};Serializer.prototype.popElement=function(){this.elementStack.pop();if(this.elementStack.length()>0){this.RootElement=this.elementStack.top()}};Serializer.prototype.getAttributeStringValue=function(e,t){strValue="";var n=e.attrType;var r=-1;switch(n){case eAttrType.NumberAttr:{var i=e.getValueDirect();strValue=i.toString()}break;case eAttrType.BooleanAttr:{var s=e.getValueDirect();if(s==true){strValue="true"}else{strValue="false"}}break;case eAttrType.StringAttr:{var o=e.getLength();strValue=e.getValueDirect().join("")}break;case eAttrType.ColorAttr:case eAttrType.Vector2DAttr:case eAttrType.Vector3DAttr:case eAttrType.Matrix4x4Attr:case eAttrType.QuaternionAttr:{var u=[];e.getValue(u);if(t==-1){for(var i=0;i<u.length;++i){strValue+=u[i].toString();if(i<u.length-1){strValue+=","}}}else{strValue+=u[t].toString()}}break;case eAttrType.NumberArrayAttr:case eAttrType.ViewportAttr:{var a=[];e.getValue(a);if(t==-1){for(var i=0;i<a.length;++i){strValue+=a[i].toString();if(i<a.length-1){strValue+=","}}}else{strValue+=a[t].toString()}}break;default:{}break}return strValue};Serializer.prototype.mixedModifiedCB=function(e,t){var n=[];e.getValue(n);var r=t;if(r!=4294967295){r.bMixed=n[0]}};var ePixelFormat={Unknown:-1,R8G8B8:0,B8G8R8:1,X8X8X8:2,R8G8B8A8:3,B8G8R8A8:4,A8R8G8B8:5,A8B8G8R8:6,X8X8X8X8:7,A8:8};var ePixelMap={Default:0,RGBToAlpha:1};var eImageFormat={Unknown:-1,RGB:0,RGBA:1,Alpha:2,Luminance:3,Luminance_Alpha:4};var FRAME_FILTER_SCALE_FRAME_BIT=1;var FRAME_FILTER_INVERT_FRAME_BIT=2;var FRAME_FILTER_NEGATE_COLOR_BIT=4;var FRAME_FILTER_NEGATE_ALPHA_BIT=8;var FRAME_FILTER_ALPHA_ONOFF_BIT=16;MediaPlayback.prototype.loadImage=function(e){this.ready=false;this.frameRetrieved=false;this.htmlImageElement=null;this.imageWidth=0;this.imageHeight=0;this.imagePitch=0;this.imagePixels=null;var t=getFileExtension(e);switch(t){case"avi":case"mpg":case"ogg":{this.htmlImageElement=document.createElement("video");this.htmlImageElement.container=this;this.htmlImageElement.controls="controls";this.htmlImageElement.src="http://localhost/bwjs/BwContent/images/Bear.ogg";this.video=true;this.onVideoLoad()}break;default:{this.htmlImageElement=new Image;this.htmlImageElement.container=this;this.htmlImageElement.onload=MediaPlayback_OnImageLoad;this.htmlImageElement.src=e}break}this.url=e};MediaPlayback.prototype.onImageLoad=function(){var e=this.htmlImageElement;this.imageWidth=e.width;this.imageHeight=e.height;this.imagePitch=e.width*4;var t=document.createElement("canvas");var n=t.getContext("2d");t.width=e.width;t.height=e.height;n.drawImage(e,0,0);var r=n.getImageData(0,0,e.width,e.height);this.imagePixels=r.data;this.ready=true;if(this.onload){this.onload.call(this)}};MediaPlayback.prototype.onVideoLoad=function(){this.ready=true};MediaPlayback.prototype.getFrameDimensions=function(){return{width:this.imageWidth,height:this.imageHeight,pitch:this.imagePitch}};MediaPlayback.prototype.getPixelFormat=function(){return ePixelFormat.R8G8B8A8};MediaPlayback.prototype.getPixelByteAlignment=function(){return 4};MediaPlayback.prototype.getBytesPerPixel=function(){return BytesPerPixel(this.getPixelFormat())};MediaPlayback.prototype.getFramePixels=function(e,t){if(!this.ready||this.imageWidth==0||this.imageHeight==0||!this.imagePixels){return undefined}e.length=this.imagePixels.length;for(var n=0;n<this.imagePixels.length;n++){e[n]=this.imagePixels[n]}return-1};MediaPlayback.prototype.newFrameDataAvailable=function(){return this.ready&&!this.frameRetrieved};MediaPlayback.prototype.getFrameData=function(e,t,n,r,i,s,o,u){if(!this.ready||this.imageWidth==0||this.imageHeight==0||!this.imagePixels){return undefined}if(e==0||t==0||n<e||r==ePixelFormat.Unknown||!i){return undefined}var a=-1;var f=s&FRAME_FILTER_SCALE_FRAME_BIT?true:false;var l=s&FRAME_FILTER_INVERT_FRAME_BIT?true:false;var c=s&FRAME_FILTER_NEGATE_COLOR_BIT?true:false;var h=s&FRAME_FILTER_NEGATE_ALPHA_BIT?true:false;var p=s&FRAME_FILTER_ALPHA_ONOFF_BIT?true:false;var d=this.getFrameDimensions();var v=d.width;var m=d.height;var g=d.pitch;var y=this.getPixelFormat();if(y!=ePixelFormat.R8G8B8A8){return undefined}var b=[];var w=this.getFramePixels(b,u);if(w==undefined){return undefined}if(f&&(e!=v||t!=m)){var E=this.getBytesPerPixel();g=e*E;g+=(4-g%4)%4;var S=[];if(!ScaleImage(y,v,m,this.getPixelByteAlignment(),b,e,t,4,S)){return undefined}b=S;v=e;m=t}if(!this.alphaPlayback&&!c&&!l&&g==n&&m==t&&y==r){for(var x=0;x<i.length;x++){i[x]=b[x]}this.frameRetrieved=true;return a}var T=0;var N=0;var C=0;var k;var L=null;if(this.alphaChannel){d=this.alphaChannel.getFrameDimensions();T=d.width;N=d.height;C=d.pitch;k=this.alphaChannel.getPixelFormat();if(k!=ePixelFormat.R8G8B8A8){return undefined}var A=[];var O=this.alphaChannel.getFramePixels(A,w);if(O!=undefined){if(T!=v||N!=m){var M=this.alphaChannel.getBytesPerPixel();C=v*M;C+=(4-C%4)%4;var _=[];if(ScaleImage(k,T,N,this.alphaChannel.getPixelByteAlignment(),L,v,m,4,_)){L=_;T=v;N=m}}else{L=A}}}var D=Math.min(e,v);var P=Math.min(t,m);var H=0,B=0,j=0,F=0;switch(r){case ePixelFormat.R8G8B8:H=0;B=1;j=2;break;case ePixelFormat.B8G8R8:H=2;B=1;j=0;break;case ePixelFormat.R8G8B8A8:H=0;B=1;j=2;F=3;break;case ePixelFormat.B8G8R8A8:H=2;B=1;j=0;F=3;break;case ePixelFormat.A8R8G8B8:H=1;B=2;j=3;F=0;break;case ePixelFormat.A8B8G8R8:H=3;B=2;j=1;F=0;break}var I=0,q=0,R=0;if(l){I+=g*(P-1);if(L){q+=C*(P-1)}}var U=new TPixel(0,0,0,255);var z=new TPixel(0,0,0,255);for(var W=0;W<P;W++){for(var X=0;X<D;X++){U.red=b[I];U.green=b[I+1];U.blue=b[I+2];U.alpha=b[I+3];I+=4;if(c){U.red=255-U.red;U.green=255-U.green;U.blue=255-U.blue;U.alpha=255-U.alpha}if(L){z.red=L[q];z.green=L[q+1];z.blue=L[q+2];z.alpha=L[q+3];q+=4}if(h){z.red=255-z.red;z.green=255-z.green;z.blue=255-z.blue;z.alpha=255-z.alpha}switch(r){case ePixelFormat.R8G8B8:case ePixelFormat.B8G8R8:i[R+H]=U.red;i[R+B]=U.green;i[R+j]=U.blue;R+=3;break;case ePixelFormat.R8G8B8A8:case ePixelFormat.B8G8R8A8:case ePixelFormat.A8R8G8B8:case ePixelFormat.A8B8G8R8:switch(o){case ePixelMap.RGBToAlpha:i[R+H]=0;i[R+B]=255;i[R+j]=0;if(L){i[R+F]=(U.red+U.green+U.blue)/3&(z.red+z.green+z.blue)/3}else{i[R+F]=(U.red+U.green+U.blue)/3}if(p){i[R+F]=i[R+F]<=127?0:255}R+=4;break;case ePixelMap.Default:default:i[R+H]=U.red;i[R+B]=U.green;i[R+j]=U.blue;if(L){i[R+F]=(z.red+z.green+z.blue)/3}else{i[R+F]=U.alpha}if(p){i[R+F]=i[R+F]<=127?0:255}R+=4;break}break;case ePixelFormat.A8:if(L){i[R]=(z.red+z.green+z.blue)/3}else{i[R]=(U.red+U.green+U.blue)/3}if(p){i[R]=i[R]<=127?0:255}R+=1;break}}if(l)I-=2*g;if(L){if(l)q-=2*C}}this.frameRetrieved=true;return a};MediaPlayback.prototype.setAlphaChannel=function(e){this.alphaPlayback=e};StyleMgr.prototype=new AttributeContainer;StyleMgr.prototype.constructor=StyleMgr;StyleMgr.prototype.eventPerformed=function(e,t){var n=t.stylesMap.getStyles(e.type);if(n.styles&&n.enabled){this.applyStyle(n.styles,n.target?n.target:t)}};StyleMgr.prototype.applyStyle=function(e,t){t.styles.updateStyle(e)};GraphMgr.prototype=new AttributeContainer;GraphMgr.prototype.constructor=GraphMgr;GraphMgr.prototype.setRenderContext=function(e){this.renderContext=e;this.renderState=new RenderState(e)};GraphMgr.prototype.getAvailableLightIndex=function(){return this.lightIndex++};GraphMgr.prototype.getCurrentMaterial=function(){return this.material};GraphMgr.prototype.setCurrentMaterial=function(e){this.material=e};GraphMgr.prototype.getCurrentDissolve=function(){return this.dissolve};GraphMgr.prototype.setCurrentDissolve=function(e){this.dissolve=e};GraphMgr.prototype.getCurrentBalloonTipLabel=function(){return this.balloonTipLabel};GraphMgr.prototype.setCurrentBalloonTipLabel=function(e){this.balloonTipLabel=e};GraphMgr.prototype.getDrawTextures=function(){return this.drawTextures};GraphMgr.prototype.setDrawTextures=function(e){this.drawTextures=e};GraphMgr.prototype.getNextLabelIndex=function(){return this.labelIndex++};GraphMgr.prototype.getNextBalloonTipLabelIndex=function(){return this.balloonTipLabelIndex++};GraphMgr.prototype.reset=function(){this.lightIndex=0;this.labelIndex=1;this.balloonTipLabelIndex=1;this.setCurrentDissolve(null);this.setCurrentMaterial(null);this.setCurrentBalloonTipLabel(null);this.setDrawTextures(true);this.collisions=new Array;for(var e=0;e<gl_MaxLights;e++){this.renderContext.enableLight(e,false)}};Node.prototype=new AttributeContainer;Node.prototype.constructor=Node;Node.prototype.copyNode=function(e,t,n,r){var i=false;if(!e){if(!(e=new Node)){return-1}i=true}e.synchronize(this,false);n.push(this);r.push(this);if(t){var s;for(var o in this.children){s=o-this.children.start();var u=null;if(!o.getCreatedByParent()){if(o.copyNode(u,t,n,r)){if(i){}return-1}if(e.getChildCount()>s){e.insertChild(u,s)}else{e.addChild(u)}o.postCloneChild(u,n,r)}else{u=e.getChild(o-this.children.start());if(o.copyNode(u,t,n,r)){if(i){}return-1}}}}this.postClone(e,n,r)};Node.prototype.searchTree=function(e,t,n,r,i,s,o,u,a){var f=[];var l=[];if(!f.push(e))return;if(!l.push(t))return;this.searchesTree(f,l,n,r,i,s,o,u,a)};Node.prototype.searchesTree=function(e,t,n,r,i,s,o,u,a){var f=false;var l=false;var c=false;if(n){for(var h=0;h<e.size();h++){if(!(this.name==e[h])){l=true;break}}}if(r){for(var h=0;h<t.size();h++){if(this.attrType==t[h]){c=true;break}}}if(n&&r){f=l&&c}else if(n){f=l}else{f=c}if(f){if(!a.push(this))return}if(this==u){return}if(i){for(var h=0;h<this.parents.size();h++){if(this.parents[h]!=o){this.parents[h].searchesTree(e,t,n,r,i,this,null,u,a)}}}for(var h=0;h<this.children.size();h++){if(this.children[h]!=s){this.children[h].searchesTree(e,t,n,r,false,null,null,u,a)}}};Node.prototype.setCreatedByParent=function(e){this.createdByParent=e};Node.prototype.getCreatedByParent=function(){return this.createdByParent};Node.prototype.isNode=function(){return true};Node.prototype.addChild=function(e){this.children.push(e);this.incrementModificationCount();e.addParent(this)};Node.prototype.insertChild=function(e,t){this.children.splice(t,0,e);this.incrementModificationCount();e.addParent(this)};Node.prototype.removeChild=function(e){this.children.splice(this.children.indexOf(e),1);this.incrementModificationCount();e.removeParent(this)};Node.prototype.replaceChild=function(e,t){this.children.splice(this.children.indexOf(e),1,t);e.removeParent(this);t.addParent(this)};Node.prototype.getChild=function(e){if(this.children.length>e){return this.children[e]}return null};Node.prototype.getNamedChild=function(e){for(var t=0;t<this.children.length;t++){if(this.children[t].name.getValueDirect().join("")==e){return this.children[t]}}return null};Node.prototype.getChildCount=function(){return this.children.length};Node.prototype.getParent=function(e){if(this.parents.length>e){return this.parents[e]}return null};Node.prototype.getParentCount=function(){return this.parents.length};Node.prototype.addParent=function(e){this.parents.push(e)};Node.prototype.removeParent=function(e){this.parents.splice(this.parents.indexOf(e),1)};Node.prototype.update=function(e,t){if(!this.thisModified&&!this.childModified){this.setChildModified(false,false);e.visited.push(this);return}e.visited.push(this);if(t){for(var n=0;n<this.children.length;n++){this.children[n].update(e,t)}}this.childModified=this.isChildModified()};Node.prototype.apply=function(e,t,n){switch(e){case"serialize":{var r=new Context;r.attribute=this;var i=this.registry.find("AttributeFactory");var s=i.create("Serializer");var o=new XMLSerializer;s.getAttribute("format").setValueDirect("xml");s.getAttribute("serializeMinimum").setValueDirect(true);s.getAttribute("serializeChildren").setValueDirect(true);s.serialize(r.attribute,r.item,r.attributeName,r.container);var u=o.serializeToString(s.DOM);if(u!="<__InitialRoot/>"){t.serialized+=u}n=false}break}if(n){if(t.path){if(t.path.length>t.pathIndex){for(var a=0;a<this.children.length;a++){var f=t.path[t.pathIndex];if(this.children[a]==f){t.pathIndex++;this.children[a].apply(e,t,n)}}}}else{for(var a=0;a<this.children.length;a++){this.children[a].apply(e,t,n)}}}};Node.prototype.applyNode=function(e,t,n,r){e.apply(t,n,r)};Node.prototype.setModified=function(){this.thisModified=true;this.setChildModified(true,true)};Node.prototype.incrementModificationCount=function(){this.modificationCount++;this.setModified()};Node.prototype.setChildModified=function(e,t){var n=null;for(var r=0;r<this.parents.length;r++){n=this.parents[r];if(n){n.childrenModified[this.name.getValueDirect().join("")]=e;n.childModified=e?true:n.isChildModified();if(t)n.setChildModified(e,t)}}};Node.prototype.isChildModified=function(){for(var e in this.childrenModified){if(this.childrenModified[e]==true)return true}return false};Node.prototype.onRemove=function(){for(var e=0;e<this.children.length;e++){this.children[e].onRemove()}};SGNode.prototype=new Node;SGNode.prototype.constructor=SGNode;SGNode.prototype.setGraphMgr=function(e){this.graphMgr=e};SGNode.prototype.update=function(e,t){if(!this.enabled.getValueDirect()&&!this.thisModified){return}if(!this.thisModified&&!this.childModified&&this.enableDisplayList.getValueDirect()==false&&this.autoDisplayList.getValueDirect()==false){this.setChildModified(false,false);e.visited.push(this);return}e.visited.push(this);var n=false;if(this.thisModified){n=true;this.thisModified=false}if(this.childModified){n=true}if(this.disableDisplayLists){e.disableDisplayLists=true;this.disableDisplayLists=false}if(n){this.enableDisplayList.setValueDirect(false);this.recordDisplayList=true}if(this.autoDisplayList.getValueDirect()&&!n){this.enableDisplayList.setValueDirect(true)}if(e.displayListObj||e.disableDisplayLists){this.enableDisplayList.setValueDirect(false)}if(this.enableDisplayList.getValueDirect()){if(!this.displayListObj){this.createDisplayList();this.recordDisplayList=true}if(!this.recordDisplayList){t=false}e.displayListObj=this.displayListObj}if(t){for(var r=0;r<this.children.length;r++){this.children[r].update(e,t)}}if(e.displayListObj==this.displayListObj){e.displayListObj=null}this.childModified=this.isChildModified()};SGNode.prototype.apply=function(e,t,n){var r=this.enabled.getValueDirect();if(!r){return}var i=false;switch(e){case"render":{if(t.resetDisplayLists){this.recordDisplayList=true}i=this.enableDisplayList.getValueDirect()&&this.displayListObj&&!t.displayListObj&&!t.disableDisplayLists;if(i&&0){t.displayListObj=this.displayListObj;if(this.recordDisplayList){this.displayListObj.record_begin()}else{this.displayListObj.play();n=false}}}break;case"rayPick":{t.currentNodePath.push(this)}break;default:{Node.prototype.apply.call(this,e,t,n);return}break}if(n){if(t.path){if(t.path.length>t.pathIndex){for(var s=0;s<this.children.length;s++){var o=t.path[t.pathIndex];if(this.children[s]==o){t.pathIndex++;this.children[s].apply(e,t,n)}}}}else{for(var s=0;s<this.children.length;s++){this.children[s].apply(e,t,n)}}}switch(e){case"render":{if(i){if(this.recordDisplayList){this.displayListObj.record_end();this.recordDisplayList=false}t.displayListObj=null}}break;case"rayPick":{t.currentNodePath.pop()}break}};SGNode.prototype.isRecordingDisplayList=function(){if(this.graphMgr.renderContext.getDisplayList()){return true}return false};SGNode.prototype.createDisplayList=function(){this.displayListObj=new DisplayListObj(this.graphMgr.renderContext)};SGNode.prototype.deleteDisplayList=function(){this.displayListObj=null};SGNode.prototype.enableDisplayListModified=function(){};RenderableElement.prototype=new SGNode;RenderableElement.prototype.constructor=RenderableElement;RenderableElement.prototype.setRegistry=function(e){this.stylesMap.setRegistry(e);SGNode.prototype.setRegistry.call(this,e)};RenderableElement.prototype.update=function(e,t){SGNode.prototype.update.call(this,e,t)};RenderableElement.prototype.apply=function(e,t,n){SGNode.prototype.apply.call(this,e,t,n)};ParentableMotionElement.prototype=new RenderableElement;ParentableMotionElement.prototype.constructor=ParentableMotionElement;ParentableMotionElement.prototype.getTransform=function(){var e=new Matrix4x4;e.loadMatrix(this.transformCompound);return e};ParentableMotionElement.prototype.getSectorTransform=function(){var e=new Matrix4x4;e.loadMatrix(this.sectorTransformCompound);return e};ParentableMotionElement.prototype.update=function(e,t){if(this.nonZeroVelocity){this.updateVelocityMotion(e.timeIncrement)}if(this.updateInheritance){this.updateInheritance=false;this.inheritsPosition=this.inheritPosition_X.getValueDirect()&&this.inheritPosition_Y.getValueDirect()&&this.inheritPosition_Z.getValueDirect();this.inheritsRotation=this.inheritRotation_X.getValueDirect()&&this.inheritRotation_Y.getValueDirect()&&this.inheritRotation_Z.getValueDirect();this.inheritsScale=this.inheritScale_X.getValueDirect()&&this.inheritScale_Y.getValueDirect()&&this.inheritScale_Z.getValueDirect();this.inheritsPivot=this.inheritPivot_X.getValueDirect()&&this.inheritPivot_Y.getValueDirect()&&this.inheritPivot_Z.getValueDirect()}var n=this.updateSimpleTransform();if(n){this.incrementModificationCount()}if(this.motionParent){this.motionParent.update(e,false)}this.updateCompoundTransform();this.updateWorldMotionInfo();RenderableElement.prototype.update.call(this,e,t)};ParentableMotionElement.prototype.apply=function(e,t,n){var r=this.enabled.getValueDirect();if(!r){RenderableElement.prototype.apply.call(this,e,t,n);return}switch(e){case"render":{var i=toScreenSpace(this.sectorWorldPosition.getValueDirect(),t.viewMatrix,t.projMatrix,t.viewport);this.screenPosition.setValueDirect(i.x,i.y,i.z)}break}RenderableElement.prototype.apply.call(this,e,t,n)};ParentableMotionElement.prototype.updateChildDisplayLists=function(){};ParentableMotionElement.prototype.applyTransform=function(){this.graphMgr.renderContext.setMatrixMode(RC_MODELVIEW);this.graphMgr.renderContext.leftMultMatrix(this.sectorTransformCompound);this.graphMgr.renderContext.applyModelViewTransform()};ParentableMotionElement.prototype.updateVelocityMotion=function(e){var t=this.panVelocity.getValueDirect();var n=this.linearVelocity.getValueDirect();if(t.x!=0||t.y!=0||t.z!=0||n.x!=0||n.y!=0||n.z!=0){var r=this.position.getValueDirect();var i=this.getDirectionVectors();var s=this.linearVelocity_affectPosition_Y.getValueDirect();r.x=r.x+i.right.x*t.x*e+i.up.x*t.y*e+i.forward.x*t.z*e+n.x*e;if(s){r.y=r.y+i.right.y*t.x*e+i.up.y*t.y*e+i.forward.y*t.z*e+n.y*e}r.z=r.z+i.right.z*t.x*e+i.up.z*t.y*e+i.forward.z*t.z*e+n.z*e;this.position.setValueDirect(r.x,r.y,r.z)}var o=this.angularVelocity.getValueDirect();if(o.x!=0||o.y!=0||o.z!=0){var u=this.rotation.getValueDirect();u.x=u.x+o.x*e;u.y=u.y+o.y*e;u.z=u.z+o.z*e;this.rotation.setValueDirect(u.x,u.y,u.z)}var a=this.scalarVelocity.getValueDirect();if(a.x!=0||a.y!=0||a.z!=0){var f=this.scale.getValueDirect();f.x=f.x+a.x*e;f.y=f.y+a.y*e;f.z=f.z+a.z*e;this.scale.setValueDirect(f.x,f.y,f.z)}};ParentableMotionElement.prototype.updateSimpleTransform=function(){var e=false;if(this.updatePosition||this.updateRotation||this.updateScale||this.updatePivot){var t;if(this.updatePosition){this.updatePosition=false;t=this.position.getValueDirect();this.translationMatrix.loadTranslation(t.x,t.y,t.z);e=true}if(this.updateRotation){this.updateRotation=false;t=this.rotation.getValueDirect();this.rotationQuat.loadXYZAxisRotation(t.x,t.y,t.z);this.rotationMatrix=this.rotationQuat.getMatrix();e=true}if(this.updateScale){this.updateScale=false;t=this.scale.getValueDirect();this.scaleMatrix.loadScale(t.x,t.y,t.z);e=true}if(this.updatePivot){this.updatePivot=false;t=this.pivot.getValueDirect();this.pivotMatrix.loadTranslation(-t.x,-t.y,-t.z);e=true}if(this.updateSectorPosition){this.updateSectorPosition=false;t=this.sectorPosition.getValueDirect();this.sectorTranslationMatrix.loadTranslation(t.x,t.y,t.z);e=true}if(e){this.transformModified.pulse();var n=new Matrix4x4;n.loadMatrix(this.pivotMatrix.multiply(this.scaleMatrix.multiply(this.rotationMatrix)));this.transformSimple.loadMatrix(n.multiply(this.translationMatrix));this.sectorTransformSimple.loadMatrix(n.multiply(this.sectorTranslationMatrix));this.updateChildDisplayLists()}}return e};ParentableMotionElement.prototype.updateCompoundTransform=function(){this.transformCompound.loadMatrix(this.transformSimple);this.sectorTransformCompound.loadMatrix(this.sectorTransformSimple);if(this.motionParent){if(this.inheritsPosition&&this.inheritsRotation&&this.inheritsScale&&this.inheritsPivot){this.transformCompound.loadMatrix(this.transformCompound.multiply(this.motionParent.transformCompound));this.sectorTransformCompound.loadMatrix(this.sectorTransformCompound.multiply(this.motionParent.sectorTransformCompound))}else{}}};ParentableMotionElement.prototype.updateWorldMotionInfo=function(){this.worldTransform.setValueDirect(this.transformCompound);this.sectorWorldTransform.setValueDirect(this.sectorTransformCompound);this.updateWorldCenter();this.updateWorldPosition();this.updateWorldRotation();this.updateWorldScale()};ParentableMotionElement.prototype.updateWorldCenter=function(){var e=this.center.getValueDirect();e=this.transformCompound.transform(e.x,e.y,e.z,1);this.worldCenter.setValueDirect(e.x,e.y,e.z);e=this.center.getValueDirect();e=this.sectorTransformCompound.transform(e.x,e.y,e.z,1);this.sectorWorldCenter.setValueDirect(e.x,e.y,e.z)};ParentableMotionElement.prototype.updateWorldPosition=function(){var e=this.transformCompound.transform(0,0,0,1);this.worldPosition.setValueDirect(e.x,e.y,e.z);e=this.sectorTransformCompound.transform(0,0,0,1);this.sectorWorldPosition.setValueDirect(e.x,e.y,e.z)};ParentableMotionElement.prototype.updateWorldRotation=function(){var e=this.transformCompound.getRotationAngles();this.worldRotation.setValueDirect(e.x,e.y,e.z)};ParentableMotionElement.prototype.updateWorldScale=function(){var e=this.transformCompound.getScalingFactors();this.worldScale.setValueDirect(e.x,e.y,e.z)};ParentableMotionElement.prototype.synchronizePosition=function(){var e=new Vector3D;if(this.motionParent){e.x=0;e.y=0;e.z=0}else{e=this.sectorOrigin.getValueDirect()}var t=this.sectorPosition.getValueDirect();var n=new Vector3D;n.x=e.x+t.x;n.y=e.y+t.y;n.z=e.z+t.z;this.position.removeModifiedCB(ParentableMotionElement_PositionModifiedCB,this);this.position.setValueDirect(n.x,n.y,n.z);this.position.addModifiedCB(ParentableMotionElement_PositionModifiedCB,this);this.updatePosition=true};ParentableMotionElement.prototype.synchronizeSectorPosition=function(){var e=new Vector3D;if(this.motionParent){e.x=0;e.y=0;e.z=0}else{e=this.sectorOrigin.getValueDirect()}var t=this.position.getValueDirect();var n=new Vector3D;n.x=t.x-e.x;n.y=t.y-e.y;n.z=t.z-e.z;this.sectorPosition.removeModifiedCB(ParentableMotionElement_SectorPositionModifiedCB,this);this.sectorPosition.setValueDirect(n.x,n.y,n.z);this.sectorPosition.addModifiedCB(ParentableMotionElement_SectorPositionModifiedCB,this);this.updateSectorPosition=true};ParentableMotionElement.prototype.getDirectionVectors=function(){var e=this.sectorTransformCompound.transform(0,1,0,0);var t=this.sectorTransformCompound.transform(1,0,0,0);var n=this.sectorTransformCompound.transform(0,0,1,0);return{up:e,right:t,forward:n}};ParentableMotionElement.prototype.setMotionParent=function(e){if(e==this)return;this.motionParent=e;this.synchronizeSectorPosition()};ParentableMotionElement.prototype.velocityModified=function(){if(this.panVelocity.isZero()&&this.linearVelocity.isZero()&&this.angularVelocity.isZero()&&this.scalarVelocity.isZero()){this.nonZeroVelocity=false}else{this.nonZeroVelocity=true}};Directive.prototype=new AttributeContainer;Directive.prototype.constructor=Directive;SGDirective.prototype=new Directive;SGDirective.prototype.constructor=SGDirective;SGDirective.prototype.setGraphMgr=function(e){this.graphMgr=e};UpdateParams.prototype=new DirectiveParams;UpdateParams.prototype.constructor=UpdateParams();UpdateDirective.prototype=new SGDirective;UpdateDirective.prototype.constructor=UpdateDirective;UpdateDirective.prototype.execute=function(e,t){e=e||this.rootNode.getValueDirect();t.timeIncrement=this.timeIncrement.getValueDirect();e.update(t,true);while(t.nextPass.length>0){t.pass++;var n=[];for(var r=0;r<t.nextPass.length;r++){n[r]=t.nextPass[r]}t.nextPass.length=0;for(var r=0;r<n.length;r++){n[r].update(t,false)}}return t.visited};Camera.prototype=new ParentableMotionElement;Camera.prototype.constructor=Camera;Camera.prototype.update=function(e,t){if(this.updateNearDistance){this.updateNearDistance=false;this.near=this.nearDistance.getValueDirect();this.updateClipPlanes=true}if(this.updateFarDistance){this.updateFarDistance=false;this.far=this.farDistance.getValueDirect();this.updateClipPlanes=true}ParentableMotionElement.prototype.update.call(this,e,t)};Camera.prototype.apply=function(e,t,n){var r=this.enabled.getValueDirect();if(!r){ParentableMotionElement.prototype.apply.call(this,e,t,n);return}switch(e){case"render":{this.applyTransform();t.projMatrix.loadMatrix(this.projectionMatrix);t.viewMatrix.loadMatrix(this.sectorTransformCompound);t.viewMatrix.invert()}break;case"rayPick":{if(!t.camera||t.camera==this){var i=this.getViewSpaceRay(t.viewport,t.clickPoint);t.rayOrigin=i.origin;t.rayDir=i.direction;t.currentCamera=this;t.nearDistance=this.nearDistance.getValueDirect();t.farDistance=this.farDistance.getValueDirect();t.viewMatrix.loadMatrix(this.sectorTransformCompound);t.viewMatrix.invert()}}break;case"bbox":{t.viewMatrix.loadMatrix(this.sectorTransformCompound);t.viewMatrix.invert()}break;case"collide":{t.viewMatrix.loadMatrix(this.sectorTransformCompound);t.viewMatrix.invert()}break;case"highlight":{t.projMatrix.loadMatrix(this.projectionMatrix);t.viewMatrix.loadMatrix(this.transformCompound);t.viewMatrix.invert();t.camera=this;t.viewport=this.viewport}break}ParentableMotionElement.prototype.apply.call(this,e,t,n)};Camera.prototype.applyTransform=function(){var e=new Matrix4x4;e.loadMatrix(this.sectorTransformCompound);e.invert();this.graphMgr.renderContext.setMatrixMode(RC_MODELVIEW);this.graphMgr.renderContext.loadMatrix(e);this.graphMgr.renderContext.applyModelViewTransform()};OrthographicCamera.prototype=new Camera;OrthographicCamera.prototype.constructor=OrthographicCamera;OrthographicCamera.prototype.update=function(e,t){if(this.updateWidth){this.updateWidth=false;this.updateClipPlanes=true}Camera.prototype.update.call(this,e,t)};OrthographicCamera.prototype.apply=function(e,t,n){var r=this.enabled.getValueDirect();if(!r){Camera.prototype.apply.call(this,e,t,n);return}switch(e){case"render":{if(!this.viewport.equals(t.viewport)){this.viewport=t.viewport;this.updateClipPlanes=true}if(this.updateClipPlanes){this.updateClipPlanes=false;this.setClipPlanes()}this.applyOrthographicTransform()}break}Camera.prototype.apply.call(this,e,t,n)};OrthographicCamera.prototype.setClipPlanes=function(){var e=this.width.getValueDirect();var t=e*this.viewport.height/this.viewport.width;this.top=t/2;this.bottom=-this.top;this.right=e/2;this.left=-this.right;this.projectionMatrix.loadMatrix(this.graphMgr.renderContext.orthographicMatrixLH(this.left,this.right,this.top,this.bottom,this.near,this.far));var n=new ViewVolume;n.setOrthographic(this.left,this.right,this.top,this.bottom,this.near,this.far);this.viewVolume.setValueDirect(n.left,n.right,n.top,n.bottom,n.near,n.far)};OrthographicCamera.prototype.applyOrthographicTransform=function(){this.graphMgr.renderContext.projectionMatrixStack.top().loadMatrix(this.projectionMatrix);this.graphMgr.renderContext.applyProjectionTransform()};OrthographicCamera.prototype.getViewSpaceRay=function(e,t){var n=(t.x-e.x)/e.width*2-1;var r=-((t.y-e.y)/e.height*2-1);var i=(this.right-this.left)/2;var s=(this.top-this.bottom)/2;var o=new Vector3D(n*i,r*s,this.near);var u=new Vector3D(0,0,1);return{origin:o,direction:u}};PerspectiveCamera.prototype=new Camera;PerspectiveCamera.prototype.constructor=PerspectiveCamera;PerspectiveCamera.prototype.update=function(e,t){if(this.updateZoom){this.updateZoom=false;this.fovyRadians=2*Math.atan2(1,this.zoom.getValueDirect());this.updateClipPlanes=true}Camera.prototype.update.call(this,e,t)};PerspectiveCamera.prototype.apply=function(e,t,n){var r=this.enabled.getValueDirect();if(!r){Camera.prototype.apply.call(this,e,t,n);return}switch(e){case"render":{if(!this.viewport.equals(t.viewport)){this.viewport=t.viewport;this.updateClipPlanes=true}if(this.updateClipPlanes){this.updateClipPlanes=false;this.setClipPlanes()}this.applyPerspectiveTransform()}break}Camera.prototype.apply.call(this,e,t,n)};PerspectiveCamera.prototype.setClipPlanes=function(){this.top=Math.tan(this.fovyRadians/2)*this.near;this.bottom=-this.top;this.right=this.top*(this.viewport.width/this.viewport.height);this.left=-this.right;this.projectionMatrix.loadMatrix(this.graphMgr.renderContext.perspectiveMatrixLH(this.left,this.right,this.top,this.bottom,this.near,this.far));var e=new ViewVolume;e.setPerspective(this.fovyRadians,this.viewport.width/this.viewport.height,this.near,this.far);this.viewVolume.setValueDirect(e.left,e.right,e.top,e.bottom,e.near,e.far)};PerspectiveCamera.prototype.applyPerspectiveTransform=function(){this.graphMgr.renderContext.projectionMatrixStack.top().loadMatrix(this.projectionMatrix);this.graphMgr.renderContext.applyProjectionTransform()};PerspectiveCamera.prototype.getViewSpaceRay=function(e,t){var n=(t.x-e.x)/e.width*2-1;var r=-((t.y-e.y)/e.height*2-1);var i=this.fovyRadians;var s=2*Math.atan(e.width/e.height*Math.tan(i/2));var o=Math.tan(s/2)*this.far;var u=Math.tan(i/2)*this.far;var a=new Vector3D(0,0,0);var f=new Vector3D(n*o,r*u,this.far);return{origin:a,direction:f}};Light.prototype=new ParentableMotionElement;Light.prototype.constructor=Light;Light.prototype.setGraphMgr=function(e){this.lightIndex=e.getAvailableLightIndex();ParentableMotionElement.prototype.setGraphMgr.call(this,e)};Light.prototype.update=function(e,t){if(this.updateAmbient){this.updateAmbient=false;this.lightDesc.ambient.copy(this.ambient.getValueDirect());this.lightDesc.validMembersMask|=LIGHTDESC_AMBIENT_BIT}if(this.updateDiffuse){this.updateDiffuse=false;this.lightDesc.diffuse.copy(this.diffuse.getValueDirect());this.lightDesc.validMembersMask|=LIGHTDESC_DIFFUSE_BIT}if(this.updateSpecular){this.updateSpecular=false;this.lightDesc.specular.copy(this.specular.getValueDirect());this.lightDesc.validMembersMask|=LIGHTDESC_SPECULAR_BIT}if(this.updateConstantAttenuation){this.updateConstantAttenuation=false;this.lightDesc.constantAttenuation=this.constantAttenuation.getValueDirect();this.lightDesc.validMembersMask|=LIGHTDESC_CONSTANT_ATT_BIT}if(this.updateLinearAttenuation){this.updateLinearAttenuation=false;this.lightDesc.linearAttenuation=this.linearAttenuation.getValueDirect();this.lightDesc.validMembersMask|=LIGHTDESC_LINEAR_ATT_BIT}if(this.updateQuadraticAttenuation){this.updateQuadraticAttenuation=false;this.lightDesc.quadraticAttenuation=this.quadraticAttenuation.getValueDirect();this.lightDesc.validMembersMask|=LIGHTDESC_QUADRATIC_ATT_BIT}if(this.lightDesc.validMembersMask){this.setLightDesc=true}this.setModified();ParentableMotionElement.prototype.update.call(this,e,t)};Light.prototype.apply=function(e,t,n){var r=this.enabled.getValueDirect();if(!r){switch(e){case"render":{this.setLightEnabled()}break}ParentableMotionElement.prototype.apply.call(this,e,t,n);return}switch(e){case"render":{if(this.setLightDesc){this.setLightDesc=false;this.applyLightDesc()}this.setLightEnabled()}break}ParentableMotionElement.prototype.apply.call(this,e,t,n)};Light.prototype.applyLightDesc=function(){this.graphMgr.renderContext.setLight(this.lightIndex,this.lightDesc)};Light.prototype.setLightEnabled=function(){this.graphMgr.renderContext.enableLight(this.lightIndex,this.enabled.getValueDirect()?1:0)};Light.prototype.onRemove=function(){this.graphMgr.renderContext.enableLight(this.lightIndex,0);ParentableMotionElement.prototype.onRemove.call(this)};DirectionalLight.prototype=new Light;DirectionalLight.prototype.constructor=DirectionalLight;DirectionalLight.prototype.update=function(e,t){this.validMembersMask=0;Light.prototype.update.call(this,e,t)};DirectionalLight.prototype.apply=function(e,t,n){var r=this.enabled.getValueDirect();if(!r){Light.prototype.apply.call(this,e,t,n);return}switch(e){case"render":{var i=this.sectorTransformCompound.transform(0,0,1,0);this.lightDesc.direction.copy(i);this.lightDesc.validMembersMask|=LIGHTDESC_DIRECTION_BIT;this.setLightDesc=true}break}Light.prototype.apply.call(this,e,t,n)};PointLight.prototype=new Light;PointLight.prototype.constructor=PointLight;PointLight.prototype.update=function(e,t){this.validMembersMask=0;if(this.updateRange){this.updateRange=false;this.lightDesc.range=this.range.getValueDirect();this.lightDesc.validMembersMask|=LIGHTDESC_RANGE_BIT}Light.prototype.update.call(this,e,t)};PointLight.prototype.apply=function(e,t,n){var r=this.enabled.getValueDirect();if(!r){Light.prototype.apply.call(this,e,t,n);return}switch(e){case"render":{var i=this.sectorTransformCompound.transform(0,0,0,1);this.lightDesc.position.copy(i);this.lightDesc.validMembersMask|=LIGHTDESC_POSITION_BIT;this.lightDesc.outerConeDegrees=180;this.lightDesc.validMembersMask|=LIGHTDESC_OUTER_CONE_DEG_BIT;this.setLightDesc=true}break}Light.prototype.apply.call(this,e,t,n)};GlobalIllumination.prototype=new SGNode;GlobalIllumination.prototype.constructor=GlobalIllumination;GlobalIllumination.prototype.update=function(e,t){if(this.updateAmbient){this.updateAmbient=false;this.setGlobalIllumination=true}SGNode.prototype.update.call(this,e,t)};GlobalIllumination.prototype.apply=function(e,t,n){var r=this.enabled.getValueDirect();if(!r){ParentableMotionElement.prototype.apply.call(this,e,t,n);return}switch(e){case"render":{if(this.setGlobalIllumination){this.setGlobalIllumination=false;this.applyGlobalIllumination()}}break}SGNode.prototype.apply.call(this,e,t,n)};GlobalIllumination.prototype.applyGlobalIllumination=function(){this.graphMgr.renderContext.setGlobalIllumination(this.ambient.getValueDirect())};GlobalIllumination.prototype.onRemove=function(){var e=new Color(0,0,0,0);this.graphMgr.renderContext.setGlobalIllumination(e);SGNode.prototype.onRemove.call(this)};Group.prototype=new SGNode;Group.prototype.constructor=Group;Group.prototype.addChild=function(e){if(this.proxyChildAttrs.getValueDirect()==true){this.proxyAttributes(e)}var t=e.getAttribute("autoDisplayList");if(t){t.addTarget(this.autoDisplayList,eAttrSetOp.AND);t.addModifiedCB(Group_ChildAutoDisplayListModifiedCB,this)}else{this.autoDisplayList.setValueDirect(false)}SGNode.prototype.addChild.call(this,e)};Group.prototype.insertChild=function(e,t){if(this.proxyChildAttrs.getValueDirect()==true){this.proxyAttributes(e)}var n=e.getAttribute("autoDisplayList");if(n){n.addTarget(this.autoDisplayList,eAttrSetOp.AND);n.addModifiedCB(Group_ChildAutoDisplayListModifiedCB,this)}else{this.autoDisplayList.setValueDirect(false)}SGNode.prototype.insertChild.call(this,e,t)};Group.prototype.removeChild=function(e){if(this.proxyChildAttrs.getValueDirect()==true){this.synchronizeProxiedAttributes()}var t=e.getAttribute("autoDisplayList");if(t){t.removeTarget(this.autoDisplayList,eAttrSetOp.AND);t.removeModifiedCB(Group_ChildAutoDisplayListModifiedCB,this)}return SGNode.prototype.removeChild.call(this,e)};Group.prototype.replaceChild=function(e,t){if(this.proxyChildAttrs.getValueDirect()==true){this.proxyAttributes(e);this.synchronizeProxiedAttributes()}var n=t.getAttribute("autoDisplayList");if(n){n.removeTarget(this.autoDisplayList,eAttrSetOp.AND);n.removeModifiedCB(Group_ChildAutoDisplayListModifiedCB,this)}n=e.getAttribute("autoDisplayList");if(n){n.addTarget(this.autoDisplayList,eAttrSetOp.AND);n.addModifiedCB(Group_ChildAutoDisplayListModifiedCB,this)}else{this.autoDisplayList.setValueDirect(false)}return SGNode.prototype.replaceChild.call(this,e,t)};Group.prototype.update=function(e,t){SGNode.prototype.update.call(this,e,t)};Group.prototype.apply=function(e,t,n){SGNode.prototype.apply.call(this,e,t,n)};Group.prototype.proxyChildAttrsModified=function(){};Group.prototype.childAutoDisplayListModified=function(){var e=true;for(var t=0;t<this.children.length;t++){childAutoDL=this.children[t].getAttribute("autoDisplayList");if(childAutoDL){e&=childAutoDL.getValueDirect();if(!e){break}}}this.autoDisplayList.setValueDirect(e)};Isolator.prototype=new Group;Isolator.prototype.constructor=Isolator;Isolator.prototype.update=function(e,t){Group.prototype.update.call(this,e,t)};Isolator.prototype.apply=function(e,t,n){var r=this.enabled.getValueDirect();if(!r){Group.prototype.apply.call(this,e,t,n);return}var i=this.isolateTransforms.getValueDirect();var s=this.isolateTextures.getValueDirect();var o=this.isolateDissolves.getValueDirect();var u=this.isolateClipPlanes.getValueDirect();var a=0;var f=null;var l=null;var c=null;var h=null;switch(e){case"render":{this.pushIsolatedStates();if(i){l=t.projMatrix;c=t.viewMatrix;h=t.worldMatrix;this.graphMgr.renderContext.setMatrixMode(RC_PROJECTION);this.graphMgr.renderContext.pushMatrix();this.graphMgr.renderContext.setMatrixMode(RC_MODELVIEW);this.graphMgr.renderContext.pushMatrix()}if(s){this.graphMgr.textureArrayStack.push(new TextureArray(this.graphMgr.textureArrayStack.top()))}}break;case"rayPick":{if(o){a=t.dissolve;f=this.graphMgr.getCurrentDissolve()}if(i){}if(u){}}break;case"bbox":{if(i){h=t.worldMatrix}}break;case"collide":{if(i){h=t.worldMatrix}}break;case"highlight":{if(i){h=t.worldMatrix}}break}Group.prototype.apply.call(this,e,t,n);switch(e){case"render":{this.popIsolatedStates();if(i){t.projMatrix=l;t.viewMatrix=c;t.worldMatrix=h;this.graphMgr.renderContext.setMatrixMode(RC_PROJECTION);this.graphMgr.renderContext.popMatrix();this.graphMgr.renderContext.setMatrixMode(RC_MODELVIEW);this.graphMgr.renderContext.popMatrix()}if(s){this.graphMgr.textureArrayStack.pop()}}break;case"rayPick":{if(o){t.dissolve=a;this.graphMgr.setCurrentDissolve(f)}if(i){}if(u){}}break;case"bbox":{if(i){t.worldMatrix=h}}break;case"collide":{if(i){t.worldMatrix=h}}break;case"highlight":{if(i){t.worldMatrix=h}}break}};Isolator.prototype.pushIsolatedStates=function(){};Isolator.prototype.popIsolatedStates=function(){};Selector.prototype=new Group;Selector.prototype.constructor=Selector;Selector.prototype.update=function(e,t){var n=this.selectee.getValueDirect();if(t&&this.children.length>n){this.children[n].update(e,t);return}Group.prototype.update.call(this,e,t)};Selector.prototype.apply=function(e,t,n){var r=this.enabled.getValueDirect();if(!r){Group.prototype.apply.call(this,e,t,n);return}var i=this.selectee.getValueDirect();if(n&&this.children.length>i){this.children[i].apply(e,t,n);return}Group.prototype.apply.call(this,e,t,n)};Dissolve.prototype=new SGNode;Dissolve.prototype.constructor=Dissolve;Dissolve.prototype.update=function(e,t){SGNode.prototype.update.call(this,e,t)};Dissolve.prototype.apply=function(e,t,n){var r=this.enabled.getValueDirect();if(!r){Group.prototype.apply.call(this,e,t,n);return}switch(e){case"render":{var i=this.dissolve.getValueDirect();this.lastDissolve=i;t.dissolve=i}break;case"rayPick":{t.dissolve=this.lastDissolve}break}SGNode.prototype.apply.call(this,e,t,n)};RenderParams.prototype=new DirectiveParams;RenderParams.prototype.constructor=RenderParams();RenderDirective.prototype=new SGDirective;RenderDirective.prototype.constructor=RenderDirective;RenderDirective.prototype.setRegistry=function(e){this.distanceSortAgent.setRegistry(e);this.updateDirective.setRegistry(e);this.collideDirective.setRegistry(e);this.highlightDirective.setRegistry(e);this.backgroundScreen.setRegistry(e);this.backgroundTexture.setRegistry(e);this.backgroundScreenRect.setRegistry(e);SGDirective.prototype.setRegistry.call(this,e)};RenderDirective.prototype.setGraphMgr=function(e){this.distanceSortAgent.setGraphMgr(e);this.updateDirective.setGraphMgr(e);this.collideDirective.setGraphMgr(e);this.highlightDirective.setGraphMgr(e);this.backgroundScreen.setGraphMgr(e);this.backgroundTexture.setGraphMgr(e);this.backgroundScreenRect.setGraphMgr(e);SGDirective.prototype.setGraphMgr.call(this,e)};RenderDirective.prototype.execute=function(e){this.drawBackground();e=e||this.rootNode.getValueDirect();var t=new UpdateParams;t.directive=this.updateDirective;t.disableDisplayLists=this.resetDisplayLists;var n=this.updateDirective.execute(e,t);t=new CollideParams;t.directive=this.collideDirective;this.collideDirective.execute(e,t);t=new RenderParams;t.directive=this;t.path=null;t.pathIndex=1;t.viewport.loadViewport(this.viewport.getValueDirect());t.distanceSortAgent=this.distanceSortAgent;t.drawTextures=this.texturesEnabled.getValueDirect();if(this.resetDisplayLists){t.resetDisplayLists=true;this.resetDisplayLists=false}n[0].apply("render",t,true);if(!this.distanceSortAgent.isEmpty()){this.distanceSortAgent.sort();this.distanceSortAgent.draw();this.distanceSortAgent.clear()}this.drawHighlights(e)};RenderDirective.prototype.drawBackground=function(){if(!this.backgroundImageSet)return;var e=new UpdateParams;e.directive=this.updateDirective;var t=this.updateDirective.execute(this.backgroundScreen,e);e=new RenderParams;e.directive=this;e.path=null;e.pathIndex=1;e.viewport.loadViewport(this.viewport.getValueDirect());t[0].apply("render",e,true)};RenderDirective.prototype.drawHighlights=function(e){switch(this.highlightType.getValueDirect()){case eHighlightType.FourPass:case eHighlightType.EightPass:this.highlightDirective.execute(e);break;case eHighlightType.None:default:break}};RenderDirective.prototype.backgroundColorModified=function(){var e=this.backgroundColor.getValueDirect();this.graphMgr.renderContext.clearColor(e.r,e.g,e.b,e.a)};RayPickParams.prototype=new DirectiveParams;RayPickParams.prototype.constructor=RayPickParams();RayPickDirective.prototype=new SGDirective;RayPickDirective.prototype.constructor=RayPickDirective;RayPickDirective.prototype.execute=function(e){e=e||this.rootNode.getValueDirect();this.picked.length=0;var t=new RayPickParams;t.directive=this;t.camera=this.camera.getValueDirect();t.viewport.loadViewport(this.viewport.getValueDirect());t.clickPoint.copy(this.clickPoint.getValueDirect());e.apply("rayPick",t,true)};RayPickDirective.prototype.addPickRecord=function(e){for(var t=0;t<this.picked.length;t++){if(this.picked[t].intersectRecord.distance>e.intersectRecord.distance){break}}this.picked.splice(t,0,e)};BBoxParams.prototype=new DirectiveParams;BBoxParams.prototype.constructor=BBoxParams();BBoxDirective.prototype=new SGDirective;BBoxDirective.prototype.constructor=BBoxDirective;BBoxDirective.prototype.execute=function(e){e=e||this.rootNode.getValueDirect();var t=new BBoxParams;t.viewSpace=this.viewSpace.getValueDirect();var n=this.viewTransform.getValueDirect();t.viewMatrix.load(n._11,n._12,n._13,n._14,n._21,n._22,n._23,n._24,n._31,n._32,n._33,n._34,n._41,n._42,n._43,n._44);e.apply("bbox",t,true);this.min=t.minPoint;this.max=t.maxPoint};BBoxDirective.prototype.getBounds=function(){return{min:this.min,max:this.max}};Geometry.prototype=new RenderableElement;Geometry.prototype.constructor=Geometry;Geometry.prototype.update=function(e,t){if(this.updateBoundingTree){this.updateBoundingTree=false;this.buildBoundingTree()}RenderableElement.prototype.update.call(this,e,t)};Geometry.prototype.apply=function(e,t,n){var r=this.enabled.getValueDirect();if(!r){RenderableElement.prototype.apply.call(this,e,t,n);return}switch(e){case"render":{var i=true;var s=t.dissolve;var o=t.opacity;if(s==1){i=false}else if(s>0||o<1||this.graphMgr.textureArrayStack.top().textures[eTextureType.Transparency].length>0||this.graphMgr.projectionTextureArrayStack.top().textures[eTextureType.Transparency].length>0){var u=this.getBBox();t.distanceSortAgent.addGeometry(this,u.min,u.max,s);i=false}if(i){this.draw(s)}}break;case"rayPick":{if(this.selectable.getValueDirect()==true&&t.opacity>0&&t.dissolve<1){var a=t.worldMatrix.multiply(t.viewMatrix);var f=a.getScalingFactors();var l=rayPick(this.boundingTree,t.rayOrigin,t.rayDir,t.nearDistance,t.farDistance,t.worldMatrix,t.viewMatrix,max3(f.x,f.y,f.z),t.doubleSided,t.clipPlanes);if(l){t.currentNodePath.push(this);t.directive.addPickRecord(new RayPickRecord(t.currentNodePath,l,t.camera));t.currentNodePath.pop()}}}break;case"bbox":{var u=this.getBBox();var c=new Matrix4x4;c.loadMatrix(t.worldMatrix);if(t.viewSpace){c.loadMatrix(c.multiply(t.viewMatrix))}var h=c.transform(u.min.x,u.min.y,u.min.z,1);var p=c.transform(u.max.x,u.max.y,u.max.z,1);if(t.minMaxSet){t.minPoint.x=Math.min(t.minPoint.x,Math.min(h.x,p.x));t.minPoint.y=Math.min(t.minPoint.y,Math.min(h.y,p.y));t.minPoint.z=Math.min(t.minPoint.z,Math.min(h.z,p.z));t.maxPoint.x=Math.max(t.maxPoint.x,Math.max(h.x,p.x));t.maxPoint.y=Math.max(t.maxPoint.y,Math.max(h.y,p.y));t.maxPoint.z=Math.max(t.maxPoint.z,Math.max(h.z,p.z))}else{t.minPoint.x=Math.min(h.x,p.x);t.minPoint.y=Math.min(h.y,p.y);t.minPoint.z=Math.min(h.z,p.z);t.maxPoint.x=Math.max(h.x,p.x);t.maxPoint.y=Math.max(h.y,p.y);t.maxPoint.z=Math.max(h.z,p.z);t.minMaxSet=true}}break;case"highlight":{if(this.highlight.getValueDirect()){if(t.targets.length>0){t.targets[t.targets.length-1].geometries.push(this)}}}break}RenderableElement.prototype.apply.call(this,e,t,n)};Geometry.prototype.draw=function(e){};Geometry.prototype.drawPrimitives=function(){};Geometry.prototype.getBBox=function(){return{min:this.bbox.min.getValueDirect(),max:this.bbox.max.getValueDirect()}};Geometry.prototype.getTriangles=function(){return new Array};VertexGeometry.prototype=new Geometry;VertexGeometry.prototype.constructor=VertexGeometry;VertexGeometry.prototype.postCloneChild=function(e,t,n){var r;var i;var s;for(r=0;r<t.length();r++){i=t.stack[r];if(i.getAttribute()==eAttrType.Texture){if(!s.push(i))return}}var o;for(r=0;r<n.length();r++){i=n.stack[r];if(i.getAttribute()==eAttrType.Texture){if(!o.push(i))return}}var u=new NumberArrayAttr;for(r=0;r<s.size()&&r<o.size();r++){u=this.findUVCoords(s[r]);if(u){var a=new NumberArrayAttr;a=e.getUVCoords(o[r]);a.copyValue(u)}}};VertexGeometry.prototype.getUVCoords=function(e){for(var t=0;t<this.uvCoords.length;t++){if(this.uvCoords[t].first==e)return this.uvCoords[t].second}var n=new NumberArrayAttr;n.addModifiedCB(VertexGeometry_UVCoordsModifiedCB,this);this.uvCoords.push(new Pair(e,n));return n};VertexGeometry.prototype.findUVCoords=function(e){if(!e){return null}for(var t=0;t<this.uvCoords.length;t++){if(this.uvCoords[t].first==e)return this.uvCoords[t].second}return null};VertexGeometry.prototype.update=function(e,t){if(this.updateVertices){this.updateVertices=false;this.vertexBuffer.setVertices(this.vertices.getValueDirect());this.updateBoundingTree=true;this.calculateBBox()}if(this.updateColors){this.updateColors=false;this.vertexBuffer.setColors(this.colors.getValueDirect())}if(this.updateUVCoords.length){for(var n=0;n<this.updateUVCoords.length;n++){for(var r=0;r<this.uvCoords.length;r++){if(this.uvCoords[r].second==this.updateUVCoords[n]){this.vertexBuffer.setUVCoords(this.uvCoords[r].first.textureObj,this.uvCoords[r].second.getValueDirect());break}}}this.updateUVCoords.length=0}Geometry.prototype.update.call(this,e,t)};VertexGeometry.prototype.apply=function(e,t,n){var r=this.enabled.getValueDirect();if(!r){Geometry.prototype.apply.call(this,e,t,n);return}switch(e){case"render":{}break}Geometry.prototype.apply.call(this,e,t,n)};VertexGeometry.prototype.drawTextured=function(e){var t=null;var n=null;this.graphMgr.renderContext.enable(eRenderMode.AlphaBlend);this.graphMgr.renderContext.setBlendFactor(RC_SRC_ALPHA,RC_ONE_MINUS_SRC_ALPHA);var r=this.graphMgr.renderContext.getMaxTextureStages();var i=this.graphMgr.textureArrayStack.top();var s=1;var o=1;var u=1;var a=1;var f=this.graphMgr.getCurrentMaterial();if(f){s=f.getAttribute("ambientLevel").getValueDirect();o=f.getAttribute("diffuseLevel").getValueDirect();u=f.getAttribute("specularLevel").getValueDirect();a=f.getAttribute("emissiveLevel").getValueDirect()}var l=this.graphMgr.renderContext.getFrontMaterial();this.graphMgr.renderState.push(RENDERSTATE_MATERIAL_BIT);if(e>0){l.ambient.a*=1-e;l.diffuse.a*=1-e;l.specular.a*=1-e;l.emissive.a*=1-e;this.graphMgr.renderContext.setFrontMaterial(l)}if(i.textures[eTextureType.Transparency].length){var c=i.textures[eTextureType.Transparency][0];var h=this.getUVCoords(c);if(h&&h.getLength()>0){this.setTextureStage(0,eTextureType.Transparency,c,c.transformCompound);t=c}if(r>1){this.graphMgr.renderContext.enableTextureStage(1,0);n=null}}if(i.textures[eTextureType.Color].length){this.setBlendingMaterial(i.textures[eTextureType.Color][0].getAttribute("opacity").getValueDirect(),s,o,u,a)}this.graphMgr.renderContext.setTextureBlendFactor(l.diffuse.a*(1-e));if(i.textures[eTextureType.Color].length==0||i.textures[eTextureType.Color][0].getAttribute("opacity").getValueDirect()<1){this.vertexBuffer.draw()}if(t){this.graphMgr.renderContext.enableTextureStage(0,0);t=null}if(n){this.graphMgr.renderContext.enableTextureStage(1,0);n=null}for(var p=0;p<i.textures[eTextureType.Color].length;p++){var c=i.textures[eTextureType.Color][p];var h=this.getUVCoords(c);if(h&&h.getLength()>0){this.setTextureStage(0,eTextureType.Color,c,c.transformCompound);t=c;this.setBlendingMaterial(c.getAttribute("opacity").getValueDirect(),s,o,u,a);this.graphMgr.renderContext.setTextureBlendFactor(l.diffuse.a*(1-e)*c.getAttribute("opacity").getValueDirect())}if(r>1){if(i.textures[eTextureType.Transparency].length){c=i.textures[eTextureType.Transparency][0];h=this.getUVCoords(c);if(h&&h.getLength()>0){this.setTextureStage(1,eTextureType.Transparency,c,c.transformCompound);n=c}}}this.vertexBuffer.draw();if(t){this.graphMgr.renderContext.enableTextureStage(0,0);t=null}if(n){this.graphMgr.renderContext.enableTextureStage(1,0);n=null}}this.graphMgr.renderContext.enableTextureStage(0,0);this.graphMgr.renderContext.enableTextureStage(1,0);this.graphMgr.renderContext.disable(eRenderMode.AlphaBlend);this.graphMgr.renderState.pop(RENDERSTATE_MATERIAL_BIT)};VertexGeometry.prototype.drawPrimitives=function(){this.vertexBuffer.draw()};VertexGeometry.prototype.setTextureStage=function(e,t,n,r,i,s){r=r||new Matrix4x4;i=i||eTextureCoordSrc.VertexUVs;s=s||new Matrix4x4;this.graphMgr.renderContext.enableTextureStage(e,1);var o=n.getAttribute("widthWrap").getValueDirect();var u=n.getAttribute("heightWrap").getValueDirect();var a,f;switch(o){case eTextureWrap.Clamp:a=RC_CLAMP_TO_EDGE;break;case eTextureWrap.Repeat:default:a=RC_REPEAT;break}switch(u){case eTextureWrap.Clamp:f=RC_CLAMP_TO_EDGE;break;case eTextureWrap.Repeat:default:f=RC_REPEAT;break}this.vertexBuffer.setTextureStage(e,n.textureObj,a,f,i,s);this.graphMgr.renderContext.setTextureBlendOp(n.blendOp.getValueDirect())};VertexGeometry.prototype.setBlendingMaterial=function(e,t,n,r,i){var s=this.graphMgr.renderContext.getFrontMaterial();var o=e*t;var u=e*n;var a=e*r;var f=e*i;s.ambient.r=o+s.ambient.r*(1-e);s.ambient.g=o+s.ambient.g*(1-e);s.ambient.b=o+s.ambient.b*(1-e);s.diffuse.r=u+s.diffuse.r*(1-e);s.diffuse.g=u+s.diffuse.g*(1-e);s.diffuse.b=u+s.diffuse.b*(1-e);s.specular.r=0;s.specular.g=0;s.specular.b=0;s.glossiness=1;s.emissive.r=f+s.emissive.r*(1-e);s.emissive.g=f+s.emissive.g*(1-e);s.emissive.b=f+s.emissive.b*(1-e);s.validMembersMask=MATERIALDESC_ALL_BITS;this.graphMgr.renderContext.setFrontMaterial(s)};VertexGeometry.prototype.setSpecularMaterial=function(e,t){var n=new MaterialDesc;n.validMembersMask=MATERIALDESC_ALL_BITS;n.specular=e;n.glossiness=t;this.graphMgr.renderContext.setFrontMaterial(n);this.graphMgr.renderContext.setBlendFactor(RC_ONE_MINUS_SRC_ALPHA,RC_ONE)};VertexGeometry.prototype.calculateBBox=function(){var e=this.vertices.getValueDirect();if(e.length<3)return;var t=new Vector3D(e[0],e[1],e[2]);var n=new Vector3D(e[0],e[1],e[2]);for(var r=3;r<e.length;r+=3){t.x=Math.min(t.x,e[r]);t.y=Math.min(t.y,e[r+1]);t.z=Math.min(t.z,e[r+2]);n.x=Math.max(n.x,e[r]);n.y=Math.max(n.y,e[r+1]);n.z=Math.max(n.z,e[r+2])}this.bbox.getAttribute("min").setValueDirect(t.x,t.y,t.z);this.bbox.getAttribute("max").setValueDirect(n.x,n.y,n.z)};TriList.prototype=new VertexGeometry;TriList.prototype.constructor=TriList;TriList.prototype.update=function(e,t){if(!this.vertexBuffer){this.vertexBuffer=this.graphMgr.renderContext.createVertexBuffer(3);this.vertexBuffer.setPrimitiveType(this.primitiveType)}if(this.updateNormals){this.updateNormals=false;this.vertexBuffer.setNormals(this.normals.getValueDirect())}VertexGeometry.prototype.update.call(this,e,t)};TriList.prototype.apply=function(e,t,n){VertexGeometry.prototype.apply.call(this,e,t,n)};TriList.prototype.draw=function(e){this.drawTextured(e)};TriList.prototype.buildBoundingTree=function(){var e=this.bbox.getAttribute("min").getValueDirect();var t=this.bbox.getAttribute("max").getValueDirect();this.boundingTree.setTriangles(this.getTriangles(),e,t);this.boundingTree.buildTree(this.approximationLevels.getValueDirect())};TriList.prototype.getTriangles=function(){var e=this.vertices.getValueDirect();var t=[];for(var n=0,r=0;r+8<e.length;n++,r+=9){t.push(new Triangle(e[r],e[r+1],e[r+2],e[r+3],e[r+4],e[r+5],e[r+6],e[r+7],e[r+8]))}return t};Material.prototype=new SGNode;Material.prototype.constructor=Material;Material.prototype.update=function(e,t){if(this.updateColor){this.updateColor=false;this.updateAmbientLevel=true;this.updateDiffuseLevel=true;this.updateSpecularLevel=true;this.updateEmissiveLevel=true}if(this.updateAmbientLevel||this.updateDiffuseLevel||this.updateSpecularLevel||this.updateEmissiveLevel){var n=this.color.getValueDirect();if(this.updateAmbientLevel){this.updateAmbientLevel=false;var r=this.ambientLevel.getValueDirect();this.ambient.setValueDirect(n.r*r,n.g*r,n.b*r,n.a)}if(this.updateDiffuseLevel){this.updateDiffuseLevel=false;var r=this.diffuseLevel.getValueDirect();this.diffuse.setValueDirect(n.r*r,n.g*r,n.b*r,n.a)}if(this.updateSpecularLevel){this.updateSpecularLevel=false;var r=this.specularLevel.getValueDirect();this.specular.setValueDirect(n.r*r,n.g*r,n.b*r,n.a)}if(this.updateEmissiveLevel){this.updateEmissiveLevel=false;var r=this.emissiveLevel.getValueDirect();this.emissive.setValueDirect(n.r*r,n.g*r,n.b*r,n.a)}}var i=this.opacity.getValueDirect();var s=false;if(this.updateOpacity){this.updateOpacity=false;this.lastOpacity=i;s=true}if(this.updateAmbient||s){this.updateAmbient=false;this.materialDesc.ambient.copy(this.ambient.getValueDirect());this.materialDesc.ambient.a*=i}if(this.updateDiffuse||s){this.updateDiffuse=false;this.materialDesc.diffuse.copy(this.diffuse.getValueDirect());this.materialDesc.diffuse.a*=i}if(this.updateSpecular||s){this.updateSpecular=false;this.materialDesc.specular.copy(this.specular.getValueDirect());this.materialDesc.specular.a*=i}if(this.updateEmissive||s){this.updateEmissive=false;this.materialDesc.emissive.copy(this.emissive.getValueDirect());this.materialDesc.emissive.a*=i}if(this.updateGlossiness||s){this.updateGlossiness=false;this.materialDesc.glossiness=this.glossiness.getValueDirect()}SGNode.prototype.update.call(this,e,t)};Material.prototype.apply=function(e,t,n){var r=this.enabled.getValueDirect();if(!r){SGNode.prototype.apply.call(this,e,t,n);return}this.graphMgr.setCurrentMaterial(this);switch(e){case"render":{t.opacity=this.lastOpacity;this.applyMaterialDesc()}break;case"rayPick":{t.doubleSided=this.lastDoubleSided;t.opacity=this.lastOpacity}break}SGNode.prototype.apply.call(this,e,t,n)};Material.prototype.applyMaterialDesc=function(){this.graphMgr.renderContext.setFrontMaterial(this.materialDesc);var e=this.doubleSided.getValueDirect();this.lastDoubleSided=e;if(e){this.graphMgr.renderContext.disable(eRenderMode.CullBackFace)}else{this.graphMgr.renderContext.enable(eRenderMode.CullBackFace)}};Surface.prototype=new Isolator;Surface.prototype.constructor=Surface;Surface.prototype.setGraphMgr=function(e){this.materialNode.setGraphMgr(e);this.colorTexturesNode.setGraphMgr(e);this.diffuseTexturesNode.setGraphMgr(e);this.luminosityTexturesNode.setGraphMgr(e);this.specularityTexturesNode.setGraphMgr(e);this.transparencyTexturesNode.setGraphMgr(e);Isolator.prototype.setGraphMgr.call(this,e)};Surface.prototype.update=function(e,t){Isolator.prototype.update.call(this,e,t)};Surface.prototype.apply=function(e,t,n){Isolator.prototype.apply.call(this,e,t,n)};Surface.prototype.connectMaterialAttributes=function(e){this.connectMaterialAttribute(e,this.color,"color");this.connectMaterialAttribute(e,this.ambientLevel,"ambientLevel");this.connectMaterialAttribute(e,this.diffuseLevel,"diffuseLevel");this.connectMaterialAttribute(e,this.specularLevel,"specularLevel");this.connectMaterialAttribute(e,this.emissiveLevel,"emissiveLevel");this.connectMaterialAttribute(e,this.ambient,"ambient");this.connectMaterialAttribute(e,this.diffuse,"diffuse");this.connectMaterialAttribute(e,this.specular,"specular");this.connectMaterialAttribute(e,this.emissive,"emissive");this.connectMaterialAttribute(e,this.glossiness,"glossiness");this.connectMaterialAttribute(e,this.opacity,"opacity");this.connectMaterialAttribute(e,this.doubleSided,"doubleSided")};Surface.prototype.connectMaterialAttribute=function(e,t,n){var r=this.getAttributeModificationCount(t)>0?true:false;t.addTarget(e.getAttribute(n),eAttrSetOp.Replace,null,r)};Surface.prototype.addTexture=function(e){this.colorTexturesNode.addChild(e)};Model.prototype=new ParentableMotionElement;Model.prototype.constructor=Model;Model.prototype.copyModel=function(e,t,n,r){var i=false;if(!e){if(!(e=new Model)){return-1}i=true}if(this.copyNode(e,t,n,r)){return-1}};Model.prototype.initializeSurfaceAttrConnectionsMap=function(){this.surfaceAttrConnections.push(new Pair(this.color,false));this.surfaceAttrConnections.push(new Pair(this.ambientLevel,false));this.surfaceAttrConnections.push(new Pair(this.diffuseLevel,false));this.surfaceAttrConnections.push(new Pair(this.specularLevel,false));this.surfaceAttrConnections.push(new Pair(this.emissiveLevel,false));this.surfaceAttrConnections.push(new Pair(this.ambient,false));this.surfaceAttrConnections.push(new Pair(this.diffuse,false));this.surfaceAttrConnections.push(new Pair(this.specular,false));this.surfaceAttrConnections.push(new Pair(this.emissive,false));this.surfaceAttrConnections.push(new Pair(this.glossiness,false));this.surfaceAttrConnections.push(new Pair(this.opacity,false));this.surfaceAttrConnections.push(new Pair(this.doubleSided,false));this.surfaceAttrConnections.push(new Pair(this.texturesEnabled,false));this.surfaceAttrConnections.push(new Pair(this.renderSequenceSlot,false))};Model.prototype.initializeGeometryAttrConnectionsMap=function(){this.geometryAttrConnections.push(new Pair(this.selectable,false));this.geometryAttrConnections.push(new Pair(this.cullable,false));this.geometryAttrConnections.push(new Pair(this.show,false));this.geometryAttrConnections.push(new Pair(this.approximationLevels,false));this.geometryAttrConnections.push(new Pair(this.showApproximationLevel,false));this.geometryAttrConnections.push(new Pair(this.sortPolygons,false));this.geometryAttrConnections.push(new Pair(this.flipPolygons,false));this.geometryAttrConnections.push(new Pair(this.intersector,false));this.geometryAttrConnections.push(new Pair(this.intersectee,false));this.geometryAttrConnections.push(new Pair(this.stationary,false));this.geometryAttrConnections.push(new Pair(this.shadowCaster,false));this.geometryAttrConnections.push(new Pair(this.shadowTarget,false))};Model.prototype.clearSurfaceAttrConnectionMap=function(){this.surfaceAttrConnections=[];this.initializeSurfaceAttrConnectionsMap()};Model.prototype.clearGeometryAttrConnectionsMap=function(){this.geometryAttrConnections=[];this.initializeGeometryAttrConnectionsMap()};Model.prototype.setGraphMgr=function(e){this.isolatorNode.setGraphMgr(e);this.dissolveNode.setGraphMgr(e);this.surfacesNode.setGraphMgr(e);ParentableMotionElement.prototype.setGraphMgr.call(this,e)};Model.prototype.update=function(e,t){if(this.updateBoundingTree){this.updateBoundingTree=false;this.buildBoundingTree()}ParentableMotionElement.prototype.update.call(this,e,t)};Model.prototype.apply=function(e,t,n){var r=this.enabled.getValueDirect();if(!r){ParentableMotionElement.prototype.apply.call(this,e,t,n);return}switch(e){case"render":{var i=this.show.getValueDirect();if(!i){ParentableMotionElement.prototype.apply.call(this,e,t,n);return}this.pushMatrix();this.applyTransform();ParentableMotionElement.prototype.apply.call(this,e,t,n);this.popMatrix()}break;case"rayPick":{var s=new Matrix4x4;s.loadMatrix(t.worldMatrix);var o=new Vector3D(t.sectorOrigin.x,t.sectorOrigin.y,t.sectorOrigin.z);t.worldMatrix=t.worldMatrix.multiply(this.sectorTransformCompound);t.sectorOrigin.load(this.sectorOrigin.getValueDirect());ParentableMotionElement.prototype.apply.call(this,e,t,n);t.worldMatrix.loadMatrix(s);t.sectorOrigin.copy(o)}break;case"bbox":{var s=new Matrix4x4;s.loadMatrix(t.worldMatrix);t.worldMatrix.loadMatrix(this.sectorTransformCompound.multiply(t.worldMatrix));ParentableMotionElement.prototype.apply.call(this,e,t,n);t.worldMatrix.loadMatrix(s)}break;case"collide":{var s=new Matrix4x4;s.loadMatrix(t.worldMatrix);t.worldMatrix=t.worldMatrix.multiply(this.sectorTransformCompound);ParentableMotionElement.prototype.apply.call(this,e,t,n);if(this.detectCollision.getValueDirect()){this.boundingTree.setTransform(t.worldMatrix);t.detectCollisions[this.name.getValueDirect().join("")]=new CollideRec(this,this.boundingTree,t.worldMatrix);this.collisionDetected.setValueDirect(false)}t.worldMatrix.loadMatrix(s)}break;case"highlight":{if(this.highlight.getValueDirect()){var u=new HighlightTarget;u.projMatrix=t.projMatrix;u.viewMatrix=t.viewMatrix;u.worldMatrix=this.sectorTransformCompound.multiply(t.worldMatrix);u.camera=t.camera;u.viewport=t.viewport;u.center=this.center.getValueDirect();var a=this.highlightColor.getValueDirect();u.highlightColor_r=a.r;u.highlightColor_g=a.g;u.highlightColor_b=a.b;u.highlightColor_a=a.a;u.highlightWidth=this.highlightWidth.getValueDirect();t.targets.push(u);ParentableMotionElement.prototype.apply.call(this,e,t,n)}}break;default:{ParentableMotionElement.prototype.apply.call(this,e,t,n)}break}};Model.prototype.pushMatrix=function(){this.graphMgr.renderContext.setMatrixMode(RC_MODELVIEW);this.graphMgr.renderContext.pushMatrix()};Model.prototype.popMatrix=function(){this.graphMgr.renderContext.setMatrixMode(RC_MODELVIEW);this.graphMgr.renderContext.popMatrix();this.graphMgr.renderContext.applyModelViewTransform()};Model.prototype.addSurface=function(e){this.surfacesNode.addChild(e);this.registerAttribute(e,e.getAttribute("name").getValueDirect().join(""));this.connectSurfaceAttributes(e)};Model.prototype.addGeometry=function(e,t,n){n.addChild(e);this.connectGeometryAttributes(e);this.addGeometryBBox(e);this.geometry.push(e);this.geometryIndices.push(t);this.updateBoundingTree=true};Model.prototype.connectSurfaceAttributes=function(e){this.connectSurfaceAttribute(e,this.color,"color");this.connectSurfaceAttribute(e,this.ambientLevel,"ambientLevel");this.connectSurfaceAttribute(e,this.diffuseLevel,"diffuseLevel");this.connectSurfaceAttribute(e,this.specularLevel,"specularLevel");this.connectSurfaceAttribute(e,this.emissiveLevel,"emissiveLevel");this.connectSurfaceAttribute(e,this.ambient,"ambient");this.connectSurfaceAttribute(e,this.diffuse,"diffuse");this.connectSurfaceAttribute(e,this.specular,"specular");this.connectSurfaceAttribute(e,this.emissive,"emissive");this.connectSurfaceAttribute(e,this.glossiness,"glossiness");this.connectSurfaceAttribute(e,this.opacity,"opacity");this.connectSurfaceAttribute(e,this.doubleSided,"doubleSided");this.connectSurfaceAttribute(e,this.texturesEnabled,"texturesEnabled");this.connectSurfaceAttribute(e,this.enabled,"enabled")};Model.prototype.connectSurfaceAttribute=function(e,t,n){var r=this.getAttributeModificationCount(t)>0?true:false;t.addTarget(e.getAttribute(n),eAttrSetOp.Replace,null,r)};Model.prototype.connectGeometryAttributes=function(e){this.connectGeometryAttribute(e,this.name,"name");this.connectGeometryAttribute(e,this.selectable,"selectable");this.connectGeometryAttribute(e,this.cullable,"cullable");this.connectGeometryAttribute(e,this.show,"show");this.connectGeometryAttribute(e,this.approximationLevels,"approximationLevels");this.connectGeometryAttribute(e,this.sortPolygons,"sortPolygons");this.connectGeometryAttribute(e,this.flipPolygons,"flipPolygons");this.connectGeometryAttribute(e,this.shadowCaster,"shadowCaster");this.connectGeometryAttribute(e,this.shadowTarget,"shadowTarget");this.connectGeometryAttribute(e,this.renderSequenceSlot,"renderSequenceSlot");this.connectGeometryAttribute(e,this.highlight,"highlight")};Model.prototype.connectGeometryAttribute=function(e,t,n){var r=this.getAttributeModificationCount(t)>0?true:false;t.addTarget(e.getAttribute(n),eAttrSetOp.Replace,null,r)};Model.prototype.addGeometryBBox=function(e){if(e==null||e==undefined)return;e.bbox.min.addModifiedCB(Model_GeometryBBoxModifiedCB,this);e.bbox.max.addModifiedCB(Model_GeometryBBoxModifiedCB,this);this.updateGeometryBBox(e)};Model.prototype.updateGeometryBBox=function(e){if(e==null||e==undefined)return;var t=e.bbox.min.getValueDirect();var n=e.bbox.max.getValueDirect();this.geometryBBoxesMap.push(new Pair(t,n));this.updateBBox()};Model.prototype.updateBBox=function(){var e=new Vector3D;var t=new Vector3D;var n=true;for(var r in this.geometryBBoxesMap){if(n){e.x=this.geometryBBoxesMap[r].first.x;e.y=this.geometryBBoxesMap[r].first.y;e.z=this.geometryBBoxesMap[r].first.z;t.x=this.geometryBBoxesMap[r].second.x;t.y=this.geometryBBoxesMap[r].second.y;t.z=this.geometryBBoxesMap[r].second.z;n=false;continue}e.x=Math.min(e.x,this.geometryBBoxesMap[r].first.x);e.y=Math.min(e.y,this.geometryBBoxesMap[r].first.y);e.z=Math.min(e.z,this.geometryBBoxesMap[r].first.z);t.x=Math.max(t.x,this.geometryBBoxesMap[r].second.x);t.y=Math.max(t.y,this.geometryBBoxesMap[r].second.y);t.z=Math.max(t.z,this.geometryBBoxesMap[r].second.z)}this.bbox.min.setValueDirect(e.x,e.y,e.z);this.bbox.max.setValueDirect(t.x,t.y,t.z);var i=new Vector3D((e.x+t.x)/2,(e.y+t.y)/2,(e.z+t.z)/2);this.center.setValueDirect(i.x,i.y,i.z);this.updateBoundingTree=true};Model.prototype.buildBoundingTree=function(){var e=[];for(var t=0;t<this.geometry.length;t++){e=e.concat(this.geometry[t].getTriangles())}this.boundingTree=new Octree;this.boundingTree.setTriangles(e,this.bbox.min.getValueDirect(),this.bbox.max.getValueDirect());this.boundingTree.buildTree(this.approximationLevels.getValueDirect())};Model.prototype.autoDisplayListModified=function(){};Texture.prototype=new ParentableMotionElement;Texture.prototype.constructor=Texture;Texture.prototype.setGraphMgr=function(e){this.textureObj=e.renderContext.createTextureObject();ParentableMotionElement.prototype.setGraphMgr.call(this,e)};Texture.prototype.update=function(e,t){if(this.updateImage){this.updateImage=false;this.setImage=true}if(this.updateMipmappingEnabled){if(this.imageSet){this.setImage=true;this.updateMipmappingEnabled=false}}if(this.setImage){this.setImage=!this.SetImage()}if(this.updatePosition||this.updateRotation||this.updateScale){ParentableMotionElement.prototype.update.call(this,e,t)}else{SGNode.prototype.update.call(this,e,t)}};Texture.prototype.apply=function(e,t,n){var r=this.enabled.getValueDirect();if(!r){ParentableMotionElement.prototype.apply.call(this,e,t,n);return}switch(e){case"render":{if(this.imageSet){var i=t.drawTextures&&this.graphMgr.getDrawTextures();if(i){var s=this.graphMgr.textureArrayStack.top().textures;var o=this.textureType.getValueDirect();if(s[o]){s[o].push(this)}}}}break}ParentableMotionElement.prototype.apply.call(this,e,t,n)};Texture.prototype.SetImage=function(){var e=this.image.width.getValueDirect();var t=this.image.height.getValueDirect();var n=this.image.pixelFormat.getValueDirect();var r=this.image.pixels.getValueDirect();if(e==0||t==0||n==ePixelFormat.Unknown||r==null){return false}var i;switch(this.textureType.getValueDirect()){case eTextureType.Diffuse:case eTextureType.Luminosity:case eTextureType.Specularity:case eTextureType.Transparency:i=eImageFormat.Alpha;break;case eTextureType.Color:default:i=eImageFormat.RGBA;break}this.textureObj.setImageData(e,t,n,i,r);this.imageSet=true;return true};MediaTexture.prototype=new Texture;MediaTexture.prototype.constructor=MediaTexture;MediaTexture.prototype.setGraphMgr=function(e){Texture.prototype.setGraphMgr.call(this,e)};MediaTexture.prototype.update=function(e,t){if(this.updateImageFilename||this.updateAlphaFilename){this.updateImageFilename=false;this.updateAlphaFilename=false;this.frame.setValueDirect(-1);this.loadMedia()}if(this.updateTextureType){this.updateTextureType=false;this.setImageSize();this.forceImageUpdate=true}if(this.updateNegateImage){this.updateNegateImage=false;this.forceImageUpdate=true}if(this.updateNegateAlpha){this.updateNegateAlpha=false;this.forceImageUpdate=true}if(this.enabled.getValueDirect()){this.updateMediaTextureImage()}Texture.prototype.update.call(this,e,t)};MediaTexture.prototype.apply=function(e,t,n){var r=this.enabled.getValueDirect();if(!r){Texture.prototype.apply.call(this,e,t,n);return}Texture.prototype.apply.call(this,e,t,n)};MediaTexture.prototype.loadMedia=function(){var e=this.imageFilename.getValueDirect().join("");if(e&&e!=""&&!this.imagePlayback||this.imagePlayback&&this.imagePlayback.url!=e){this.imagePlayback=new MediaPlayback(this,MediaTexture_OnImageLoad);this.imagePlayback.container=this;this.imagePlayback.loadImage(e)}else if(e==""){}var t=this.alphaFilename.getValueDirect().join("");if(t&&t!=""&&!this.alphaPlayback||this.alphaPlayback&&this.alphaPlayback.url!=t){this.alphaPlayback=new MediaPlayback(this,MediaTexture_OnAlphaLoad);this.alphaPlayback.container=this;this.alphaPlayback.loadImage(t);if(this.imagePlayback){this.imagePlayback.setAlphaChannel(this.alphaPlayback)}}else if(t==""){}this.incrementModificationCount()};MediaTexture.prototype.setImageSize=function(){if(this.textureType.getValueDirect()==eTextureType.Color&&!this.alphaPlayback){return}if(!this.imagePlayback){return}var e=this.imagePlayback.getFrameDimensions();var t=nextHighestPowerOfTwo(e.width);var n=nextHighestPowerOfTwo(e.height);var r;switch(this.textureType.getValueDirect()){case eTextureType.Diffuse:case eTextureType.Luminosity:case eTextureType.Specularity:case eTextureType.Transparency:case eTextureType.Clip:r=ePixelFormat.A8;this.pixelMap=ePixelMap.RGBToAlpha;break;case eTextureType.Color:default:r=this.imagePlayback.getPixelFormat();this.pixelMap=ePixelMap.Default;break}if(this.alphaPlayback){switch(r){case ePixelFormat.R8G8B8:r=ePixelFormat.R8G8B8A8;break;case ePixelFormat.B8G8R8:r=ePixelFormat.B8G8R8A8;break}}var i=this.imagePlayback.getPixelByteAlignment();this.pitch=t*BytesPerPixel(r);this.pitch+=(i-this.pitch%i)%i;this.image.width.setValueDirect(t);this.image.height.setValueDirect(n);this.image.pixelFormat.setValueDirect(r);this.image.byteAlignment.setValueDirect(i);this.image.pixels.setLength(n*this.pitch)};MediaTexture.prototype.updateMediaTextureImage=function(){if(this.textureType.getValueDirect()==eTextureType.Color&&!this.alphaPlayback){return}if(this.imagePlayback&&this.imagePlayback.ready&&(this.imagePlayback.newFrameDataAvailable()||this.alphaPlayback&&this.alphaPlayback.newFrameDataAvailable()||this.forceImageUpdate)){var e=this.image.width.getValueDirect();var t=this.image.height.getValueDirect();var n=this.image.pixelFormat.getValueDirect();var r=FRAME_FILTER_SCALE_FRAME_BIT;if(this.negateImage.getValueDirect()){r|=FRAME_FILTER_NEGATE_COLOR_BIT}if(this.negateAlpha.getValueDirect()){r|=FRAME_FILTER_NEGATE_ALPHA_BIT}var i=this.imagePlayback.getFrameData(e,t,this.pitch,n,this.image.pixels.values,r,this.pixelMap,this.frame.getValueDirect());this.frameRetrieved.setValueDirect(i);this.forceImageUpdate=false}this.incrementModificationCount()};MediaTexture.prototype.onImageLoad=function(){if(this.textureType.getValueDirect()==eTextureType.Color&&!this.alphaPlayback){this.textureObj.setImage(this.imagePlayback.htmlImageElement,ePixelFormat.R8G8B8A8,eImageFormat.RGBA);this.imageSet=true;this.incrementModificationCount();return}this.setImageSize()};MediaTexture.prototype.onAlphaLoad=function(){};MediaTexture.prototype.onVideoLoad=function(){this.textureObj.setVideo(this.htmlImageElement);this.textureObj.negate=this.negateImage.getValueDirect();this.imageSet=true};Evaluator.prototype=new Node;Evaluator.prototype.constructor=Evaluator;Evaluator.prototype.evaluate=function(){};Evaluator.prototype.update=function(e,t){var n=this.enabled.getValueDirect();var r=this.expired.getValueDirect();if(n&&!r){this.evaluate()}Node.prototype.update.call(this,e,t)};SceneInspector.prototype=new Evaluator;SceneInspector.prototype.constructor=SceneInspector;SceneInspector.prototype.setCamera=function(e){this.camera=e};SceneInspector.prototype.getCamera=function(){return this.camera};SceneInspector.prototype.evaluate=function(){var e=this.enabled.getValueDirect();if(!e){return}var t=this.viewPosition.getValueDirect();var n=this.viewRotation.getValueDirect();var r=this.translationDelta.getValueDirect();var i=this.panDelta.getValueDirect();var s=this.trackDelta.getValueDirect();var o=this.rotationDelta.getValueDirect();var u=this.viewRelativeXAxisRotation.getValueDirect();var a=this.viewRelativeYAxisRotation.getValueDirect();var f=this.viewRelativeZAxisRotation.getValueDirect();var l=this.pivotDistance.getValueDirect();var c=new Matrix4x4;c.loadTranslation(-t.x,-t.y,-t.z);var h=new Matrix4x4;h.loadXYZAxisRotation(-n.x,-n.y,-n.z);var p=c.multiply(h);var d=this.transformDirectionVector(0,1,0,p);var v=this.transformDirectionVector(1,0,0,p);var m=this.transformDirectionVector(0,0,1,p);var g=new Matrix4x4;var y=new Matrix4x4;var b=new Matrix4x4;if(u){g.loadRotation(v.x,v.y,v.z,-o.x)}else{g.loadXAxisRotation(-o.x)}if(a){y.loadRotation(d.x,d.y,d.z,-o.y)}else{y.loadYAxisRotation(-o.y)}if(f){b.loadRotation(m.x,m.y,m.z,-o.z)}else{b.loadXAxisRotation(-o.z)}var w=y.multiply(g.multiply(b));var E=new Matrix4x4;E.loadTranslation(r.x,-r.y,-r.z);if(i.x!=0||i.y!=0||i.z!=0||s.x!=0||s.y!=0||s.z!=0){var S=this.upVector.getValueDirect();var x=this.rightVector.getValueDirect();var T=this.forwardVector.getValueDirect();if(S.x==0&&S.y==0&&S.z==0)S=d;if(x.x==0&&x.y==0&&x.z==0)x=v;if(T.x==0&&T.y==0&&T.z==0)T=m;var N=S;var C=x;var k=T;var L=new Matrix4x4;L.loadTranslation(C.x*i.x+N.x*-i.y+k.x*-i.z,C.y*i.x+N.y*-i.y+k.y*-i.z,C.z*i.x+N.z*-i.y+k.z*-i.z);E=E.multiply(L);var A=new Matrix4x4;var O=new Matrix4x4;var M=false;var _=Math.abs(n.y);var D=Math.abs(n.x);var P=Math.abs(n.z);if(n.z>=90&&n.z<=270){M=true}else if(n.z<=-90&&n.z>=-270){M=true}else{if(n.x<=-45||n.x>=45&&n.x<=90){M=true}}var H=k;O.loadRotation(C.x,C.y,C.z,n.x);k=this.transformDirectionVector(k.x,k.y,k.z,O);var B=toDegrees(Math.acos(cosineAngleBetween(H,k)));O.loadRotation(C.x,C.y,C.z,90);N=this.transformDirectionVector(N.x,N.y,N.z,O);A.loadTranslation(C.x*s.x+N.x*-s.y+k.x*-s.z,C.y*s.x+N.y*-s.y+0,C.z*s.x+N.z*-s.y+k.z*-s.z);E=E.multiply(A)}var j=new Matrix4x4;j.loadMatrix(p);j.invert();var F=new Vector3D;F.load(j._41,j._42,j._43);var I=new Vector3D;I.load(F.x+m.x*l,F.y+m.y*l,F.z+m.z*l);this.pivotPointWorld.setValueDirect(I.x,I.y,I.z);var q=new Matrix4x4;var R=new Matrix4x4;q.loadTranslation(-I.x,-I.y,-I.z);R.loadTranslation(I.x,I.y,I.z);var U=E.multiply(q.multiply(w.multiply(R.multiply(p))));var z=U.getRotationAngles();var W=new Vector3D;W.load(U._41,U._42,U._43);U.transpose();W=U.transform(W.x,W.y,W.z,0);this.resultPosition.setValueDirect(this.affectPosition_X.getValueDirect()?-W.x:t.x,this.affectPosition_Y.getValueDirect()?-W.y:t.y,this.affectPosition_Z.getValueDirect()?-W.z:t.z);this.resultRotation.setValueDirect(this.affectRotation_X.getValueDirect()?-z.x:n.x,this.affectRotation_Y.getValueDirect()?-z.y:n.y,this.affectRotation_Z.getValueDirect()?-z.z:n.z)};SceneInspector.prototype.transformDirectionVector=function(e,t,n,r){var i=new Matrix4x4;i.loadMatrix(r);i.transpose();return i.transform(e,t,n,0)};ArcballInspector.prototype=new Evaluator;ArcballInspector.prototype.constructor=ArcballInspector;ArcballInspector.prototype.evaluate=function(){if(!this.enabled.getValueDirect()){return}var e=this.sphereCenter.getValueDirect();var t=this.sphereRadius.getValueDirect();var n=this.mouseDown.getValueDirect();var r=this.mouseNow.getValueDirect();var i=this.quatAtMouseDown.getValueDirect();var s=this.viewport;var o=this.worldTransform.getValueDirect();var u=this.viewTransform.getValueDirect();o.invert();u=u.multiply(o);var a=this.constrainToAxis.getValueDirect();e.x=2*(e.x-s.x)/s.width-1;e.y=2*(s.height-e.y-s.y)/s.height-1;n.x=2*(n.x-s.x)/s.width-1;n.y=2*(s.height-n.y-s.y)/s.height-1;r.x=2*(r.x-s.x)/s.width-1;r.y=2*(s.height-r.y-s.y)/s.height-1;var f,l;if(!a){f=this.getSpherePoint(n,e,t);l=this.getSpherePoint(r,e,t)}else{var c=this.constraintAxis.getValueDirect();f=this.getSpherePointAboutAxis(n,e,t,c);l=this.getSpherePointAboutAxis(r,e,t,c)}var h=u.transform(f.x,f.y,f.z,0);var p=u.transform(l.x,l.y,l.z,0);f.x=h.x;f.y=h.y;f.z=h.z;l.x=p.x;l.y=p.y;l.z=p.z;f.normalize();l.normalize();var d=this.getQuatFromSpherePoints(f,l);d=d.multiply(i);this.resultQuat.setValueDirect(d)};ArcballInspector.prototype.getSpherePoint=function(e,t,n){var r=new Vector3D;r.x=(e.x-t.x)/n;r.y=(e.y-t.y)/n;var i=r.x*r.x+r.y*r.y;if(i>1){var s=1/Math.sqrt(i);r.x*=s;r.y*=s;r.z=0}else{r.z=-Math.sqrt(1-i)}return r};ArcballInspector.prototype.getSpherePointAboutAxis=function(e,t,n,r){point=this.getSpherePoint(e,t,n);var i=dotProduct(point,r);r.multiplyScalar(i);var s=new Vector3D(point.x,point.y,point.z);s.subtractVector(r);var o=magnitude(s.x,s.y,s.z);point=null;if(o>0){var u=1/Math.sqrt(o);if(s.z<0){s.x=-s.x;s.y=-s.y;s.z=-s.z}point=s.multiplyScalar(u)}else if(r.z==1){point=new Vector3D(1,0,0)}else{point.normalize()}};ArcballInspector.prototype.getQuatFromSpherePoints=function(e,t){var n=new Quaternion;n.x=e.y*t.z-e.z*t.y;n.y=e.z*t.x-e.x*t.z;n.z=e.x*t.y-e.y*t.x;n.w=e.x*t.x+e.y*t.y+e.z*t.z;return n};KeyframeInterpolator.prototype=new Evaluator;KeyframeInterpolator.prototype.constructor=KeyframeInterpolator;KeyframeInterpolator.prototype.setNumChannels=function(e){this.channels.resize(0);this.startKeys.resize(0);this.endKeys.resize(0);this.preBehaviors.resize(0);this.postBehaviors.resize(0);this.resultValues.resize(0);for(var t=0;t<e;t++){this.channels.push_back(new KeyframesAttr);this.startKeys.push_back(new NumberAttr(-1));this.endKeys.push_back(new NumberAttr(-1));this.preBehaviors.push_back(new NumberAttr(eEndBehavior.Reset));this.postBehaviors.push_back(new NumberAttr(eEndBehavior.Reset));this.resultValues.push_back(new NumberAttr(0))}};KeyframeInterpolator.prototype.evaluate=function(){if(!this.endState.initialized){this.updateEndState();this.endState.initialized=true}var e=this.time.getValueDirect();var t,n;var r,i;for(var s=0;s<this.channels.vector.length;s++){var o=this.channels.getAt(s);if(o.vector.length==0)continue;t=this.endState.startKeyIts[s];n=this.endState.endKeyIts[s];r=this.preBehaviors.getAt(s).getValueDirect();i=this.postBehaviors.getAt(s).getValueDirect();var u=interpolate(e,o,t,n,r,i);this.resultValues.getAt(s).setValueDirect(u)}this.lastTime=e;this.evaluated=true};KeyframeInterpolator.prototype.timeModified=function(){this.updateExpired()};KeyframeInterpolator.prototype.updateExpired=function(){this.expired.setValueDirect(false);var e=false;var t=this.time.getValueDirect();var n=0;var r=null;var i=this.channels.vector.length;for(var s=0;s<i;s++){r=this.postBehaviors.getAt(s);if(r){n=r.getValueDirect()}if(n!=eEndBehavior.Constant){e=true;break}}if(!e&&(t<this.endState.startTime||t>this.endState.endTime)){this.expired.setValueDirect(true)}};KeyframeInterpolator.prototype.updateEndState=function(){var e=-1;var t=-1;var n=FLT_MAX;var r=-FLT_MAX;var i=-1,s=-1;var o=null;var u=this.channels.vector.length;this.startKeys.resize(u);this.endKeys.resize(u);for(var a=0;a<u;a++){o=this.channels.getAt(a);i=this.startKeys.vector.length>a?this.startKeys.getAt(a).getValueDirect():-1;s=this.endKeys.vector.length>a?this.endKeys.getAt(a).getValueDirect():-1;if(s<i){s=i}this.endState.startKeyIts[a]=o.getAt(0);this.endState.endKeyIts[a]=o.getAt(o.vector.length-1);if(!this.endState.startKeyIts[a]||!this.endState.endKeyIts[a])continue;if(i>=0&&i<o.vector.length){this.endState.startKeyIts[a]=o.getAt(i)}if(s>=0&&s<o.vector.length){this.endState.endKeyIts[a]=o.getAt(s)}e=this.endState.startKeyIts[a].getTime();t=this.endState.endKeyIts[a].getTime();n=e<n?e:n;r=t>=r?t:r}this.endState.startTime=n;this.endState.endTime=r};BBoxLocator.prototype=new Evaluator;BBoxLocator.prototype.constructor=BBoxLocator;BBoxLocator.prototype.evaluate=function(){var e=this.viewPosition.getValueDirect();var t=this.viewTransform.getValueDirect();var n=this.viewVolume.left.getValueDirect();var r=this.viewVolume.right.getValueDirect();var i=this.viewVolume.top.getValueDirect();var s=this.viewVolume.bottom.getValueDirect();var o=this.viewVolume.near.getValueDirect();var u=this.viewVolume.far.getValueDirect();var a=this.viewport.getValueDirect();var f=this.bbox.min.getValueDirect();var l=this.bbox.max.getValueDirect();var c=this.closeness.getValueDirect();if(c!=0){var h=l.x-f.x;var p=l.y-f.y;h+=h*c;p+=p*c;if(a.width/a.height<h/p){h=(h-(l.x-f.x))/2;f.x-=h;l.x+=h}else{p=(p-(l.y-f.y))/2;f.y-=p;l.y+=p}}var d=new Array(8);d[0]=new Vector3D(f.x,f.y,f.z);d[1]=new Vector3D(f.x,f.y,l.z);d[2]=new Vector3D(f.x,l.y,f.z);d[3]=new Vector3D(f.x,l.y,l.z);d[4]=new Vector3D(l.x,f.y,f.z);d[5]=new Vector3D(l.x,f.y,l.z);d[6]=new Vector3D(l.x,l.y,f.z);d[7]=new Vector3D(l.x,l.y,l.z);var v=new Vector3D((f.x+l.x)/2,(f.y+l.y)/2,(f.z+l.z)/2);var m=new Vector3D;m.copy(t.transform(0,0,1,0));m.normalize();var g=0;var y;var b=planesIntersect(n,r);if(b){var w=new Array(5);w[0]=this.getPlane(n.point,v,n.normal,t);w[1]=this.getPlane(r.point,v,r.normal,t);w[2]=this.getPlane(i.point,v,i.normal,t);w[3]=this.getPlane(s.point,v,s.normal,t);w[4]=this.getPlane(o.point,v,o.normal,t);for(var E=0;E<8;E++){for(var S=0;S<5;S++){if(pointOnPositiveSideOfPlane(d[E],w[S])){var x=this.distanceFromPlane(d[E],m,w[S]);if(x.intersection){g=Math.max(g,x.distance)}}}}y=new Vector3D(v.x,v.y,v.z);m.multiplyScalar(g);y.subtractVector(m)}else{y=new Vector3D(v.x,v.y,v.z);g=magnitude(e.x,e.y,e.z);m.multiplyScalar(g);y.subtractVector(m);var T=this.bboxView.min.getValueDirect();var N=this.bboxView.max.getValueDirect();var C=distanceBetweenPlanes(r,n);var k=distanceBetweenPlanes(i,s);var L=C/k;var A=Math.abs(N.x-T.x);var O=Math.abs(N.y-T.y);if(A>O){C=A;k=C/L;if(k<O){k=O;C=k*L}}else{k=O;C=k*L;if(C<A){C=A}}this.resultWidth.setValueDirect(C)}this.resultPosition.setValueDirect(y.x,y.y,y.z);g=0;for(var E=0;E<8;E++){var M=t.transform(d[E].x,d[E].y,d[E].z,1);g=Math.max(g,distanceBetween(d[E],y))}this.resultFarDistance.setValueDirect(this.nearDistance.getValueDirect()+g);g=distanceBetween(y,new Vector3D(v.x,v.y,v.z));this.resultPivotDistance.setValueDirect(g)};BBoxLocator.prototype.getPlane=function(e,t,n,r){var i=r.transformVector3D(e,0);i.x+=t.x;i.y+=t.y;i.z+=t.z;var s=r.transformVector3D(n,0);var o=new Plane(new Vector3D(i.x,i.y,i.z),new Vector3D(s.x,s.y,s.z));return o};BBoxLocator.prototype.distanceFromPlane=function(e,t,n){var r=new Line(e,t);var i;var s=lineIntersectsPlane(r,n);switch(s.result){case 0:i=FLT_MAX;break;case 1:i=distanceBetween(e,s.point);break;case 2:default:i=0;break}return{intersection:s.result,distance:i}};RasterComponent.prototype=new ParentableMotionElement;RasterComponent.prototype.constructor=RasterComponent;RasterComponent.prototype.setRegistry=function(e){var t=e.find("Bridgeworks");if(t){this.rcEventListener=t.rasterComponentEventListener;if(this.rcEventListener){this.rcEventListener.registerComponent(this);this.rcEventListener.Listen(this)}}ParentableMotionElement.prototype.setRegistry.call(this,e)};RasterComponent.prototype.isSelected=function(e,t){var n=this.show.getValueDirect();if(n){if(this.screenRect.containsPoint(e,t)){return true}}return false};RasterComponent.prototype.stylesMapSizeModified=function(){var e=this.stylesMap.Size();for(var t=0;t<e;t++){var n=this.stylesMap.getAt(t);if(n){n.event.removeModifiedCB(RasterComponent_StylesMapElementEventModifiedCB,this);n.event.addModifiedCB(RasterComponent_StylesMapElementEventModifiedCB,this);RasterComponent_StylesMapElementEventModifiedCB(n.event,this)}}};RasterComponent.prototype.stylesMapElementEventModified=function(e){this.rcEventListener.listenEvent(this,eEventNameMap[e])};RasterComponent.prototype.showModified=function(){};Label.prototype=new RasterComponent;Label.prototype.constructor=Label;Label.prototype.setGraphMgr=function(e){RasterComponent.prototype.setGraphMgr.call(this,e);this.id="Label"+this.graphMgr.getNextLabelIndex();this.labelId=this.id+"_label";this.iconId=this.id+"_icon";var t=CreateHTMLLabel(this.id,this.labelId,this.iconId);this.htmlLabel=t.label;this.htmlIconImg=t.iconImg;this.htmlIconDiv=t.iconDiv;this.htmlIconImg.baseWidth=0;this.htmlIconImg.baseHeight=0;Label_LabelStyleBackgroundColorModifiedCB(this.labelStyle.backgroundColor,this);Label_LabelStyleBackgroundOpacityModifiedCB(this.labelStyle.backgroundOpacity,this);Label_LabelStyleFontBorderModifiedCB(null,this);Label_LabelStyleFontStyleColorModifiedCB(this.labelStyle.fontStyle.color,this);Label_LabelStyleFontStyleFontModifiedCB(this.labelStyle.fontStyle.font,this);Label_LabelStyleFontStyleOpacityModifiedCB(this.labelStyle.fontStyle.opacity,this);Label_LabelStyleFontStyleSizeModifiedCB(this.labelStyle.fontStyle.size,this);Label_LabelStyleFontStyleStyleModifiedCB(this.labelStyle.fontStyle.style,this);Label_LabelStyleFormatModifiedCB(this.labelStyle.format,this);Label_LabelStylePaddingModifiedCB(this.labelStyle.padding,this);Label_IconStyleUrlModifiedCB(this.iconStyle.url,this)};Label.prototype.update=function(e,t){this.updateIconScale();RasterComponent.prototype.update.call(this,e,t)};Label.prototype.updateIconScale=function(){var e=this.iconStyle.scale.getValueDirect();if(this.htmlIconImg.baseWidth==0){this.htmlIconImg.baseWidth=this.htmlIconImg.offsetWidth;this.htmlIconImg.baseHeight=this.htmlIconImg.offsetHeight}if(this.htmlIconImg.baseWidth){this.htmlIconImg.width=this.htmlIconImg.baseWidth*e.x;this.htmlIconImg.height=this.htmlIconImg.baseHeight*e.y}};Label.prototype.apply=function(e,t,n){var r=this.enabled.getValueDirect();if(!r){RasterComponent.prototype.apply.call(this,e,t,n);return}switch(e){case"render":{this.draw(t.viewport)}break;case"rayPick":{if(this.selectable.getValueDirect()==true&&this.show.getValueDirect()==true){if(this.isSelected(t.clickPoint.x,t.clickPoint.y)){var i=new RayIntersectRecord;i.distance=0;t.currentNodePath.push(this);t.directive.addPickRecord(new RayPickRecord(t.currentNodePath,i,t.camera));t.currentNodePath.pop()}}}break}RasterComponent.prototype.apply.call(this,e,t,n)};Label.prototype.draw=function(e){var t=this.registry.find("Bridgeworks");if(this.show.getValueDirect()==false){this.htmlLabel.style.visibility="hidden";this.htmlIconImg.style.visibility="hidden";return}this.htmlLabel.style.visibility="visible";this.htmlIconImg.style.visibility="visible";if(this.labelStyle.fontStyle.opacity.getValueDirect()==0){this.htmlLabel.style.visibility="hidden"}var n=this.iconStyle.color.getValueDirect();if(n.a==0||this.iconStyle.opacity.getValueDirect()==0){this.htmlIconImg.style.visibility="hidden"}var r=this.getRenderingPositions();var i=this.htmlLabel.offsetWidth;var s=this.htmlLabel.offsetHeight;var o=this.htmlIconImg.offsetWidth;var u=this.htmlIconImg.offsetHeight;if(r.labelX<0||r.labelY<0||r.labelX+i>t.canvas.width||r.labelY+s>t.canvas.height){this.htmlLabel.style.visibility="hidden"}if(r.iconX<0||r.iconY<0||r.iconX+o>t.canvas.width||r.iconY+u>t.canvas.height){this.htmlIconImg.style.visibility="hidden"}if(this.htmlLabel.style.visibility=="visible"){this.htmlLabel.style.left=t.canvas.offsetLeft+r.labelX;this.htmlLabel.style.top=t.canvas.offsetTop+r.labelY;this.labelRect.load(t.canvas.offsetLeft+r.labelX,t.canvas.offsetTop+r.labelY,this.labelRect.left+i,this.labelRect.top+s)}else{this.labelRect.load(0,0,0,0)}if(this.htmlIconImg.style.visibility=="visible"){this.htmlIconDiv.style.left=t.canvas.offsetLeft+r.iconX;this.htmlIconDiv.style.top=t.canvas.offsetTop+r.iconY;this.iconRect.load(t.canvas.offsetLeft+r.iconX,t.canvas.offsetTop+r.iconY,this.iconRect.left+o,this.iconRect.top+u)}else{this.iconRect.load(0,0,0,0)}var a=new Rect(0,0,0,0);if(this.htmlLabel.style.visibility=="visible"&&this.htmlIconImg.style.visibility=="visible"){a.left=Math.min(this.labelRect.left,this.iconRect.left);a.top=Math.min(this.labelRect.top,this.iconRect.top);a.right=Math.max(this.labelRect.right,this.iconRect.right);a.bottom=Math.max(this.labelRect.bottom,this.iconRect.bottom)}else if(this.htmlLabel.style.visibility=="visible"){a.loadRect(this.labelRect)}else if(this.htmlIconImg.style.visibility=="visible"){a.loadRect(this.iconRect)}this.screenRect.setValueDirect(a)};Label.prototype.getRenderingPositions=function(){var e=0;var t=0;var n=0;var r=0;var i=this.screenPosition.getValueDirect();var s=this.anchor.getValueDirect();var o=this.labelStyle.offset.getValueDirect();if(this.htmlIconImg.offsetWidth>0&&this.htmlLabel.offsetWidth>0){var u=this.htmlLabel.offsetWidth;var a=this.htmlLabel.offsetHeight;var f=this.htmlIconImg.offsetWidth;var l=this.htmlIconImg.offsetHeight;if(this.origin.getValueDirect().join("")=="bottomLeft"){s.y=l-s.y}n=i.x-s.x;r=i.y-s.y;e=n+o.x;t=r+o.y;switch(this.labelStyle.textAlign.getValueDirect().join("")){case"topLeft":e-=u;t-=a/2;break;case"middleLeft":e-=u;t+=l/2-a/2;break;case"bottomLeft":e-=u;t+=l-a/2;break;case"topCenter":e+=f/2-u/2;t-=a;break;case"middleCenter":e+=f/2-u/2;t+=l/2-a/2;break;case"bottomCenter":e+=f/2-u/2;t+=l;break;case"topRight":e+=f;t-=a/2;break;case"bottomRight":e+=f;t+=l-a/2;break;case"middleRight":default:e+=f;t+=l/2-a/2;break}}else if(this.htmlLabel.offsetWidth>0){var u=this.htmlLabel.offsetWidth;var a=this.htmlLabel.offsetHeight;e=i.x+s.x+o.x;t=i.y-s.y+o.y;switch(this.labelStyle.textAlign.getValueDirect().join("")){case"topLeft":e-=u;t-=a;break;case"middleLeft":e-=u;t-=a/2;break;case"bottomLeft":e-=u;break;case"topCenter":e-=u/2;t-=a;break;case"middleCenter":e-=u/2;t-=a/2;break;case"bottomCenter":e-=u/2;break;case"topRight":t-=a;break;case"bottomRight":break;case"middleRight":default:t-=a/2;break}}else{var f=this.htmlIconImg.offsetWidth;var l=this.htmlIconImg.offsetHeight;s.y=l-s.y;n=i.x-s.x;r=i.y-s.y}return{labelX:e,labelY:t,iconX:n,iconY:r}};Label.prototype.eventPerformed=function(e){if(!this.show.getValueDirect()){return false}var t=this.isSelected(e.x,e.y);return t};Label.prototype.labelStyleFontBorderModified=function(){var e=this.labelStyle.fontStyle.borderColor.getValueDirect();e.a*=this.labelStyle.fontStyle.opacity.getValueDirect();var t=this.labelStyle.fontStyle.borderWidth.getValueDirect();var n="";for(var r=0;r<e.a;r+=.2){if(r>0)n+=", ";n+="rgba("+e.r*255+","+e.g*255+","+e.b*255+","+e.a+")"+" 0px 0px "+t*2+"px"}this.htmlLabel.style.textShadow=n};BalloonTipLabel.prototype=new RasterComponent;BalloonTipLabel.prototype.constructor=BalloonTipLabel;BalloonTipLabel.prototype.setGraphMgr=function(e){RasterComponent.prototype.setGraphMgr.call(this,e);this.id="BalloonTipLabel"+this.graphMgr.getNextBalloonTipLabelIndex();var t=CreateHTMLBalloonTipLabel(this.id);this.htmlBalloonTipLabel=t.label;this.qtip=t.qtip;this.qtip_api=$("a[id="+this.id+"]").qtip("api")};BalloonTipLabel.prototype.update=function(e,t){if(e.userData){var n=e.userData;if(this.show.getValueDirect()){this.updateLabel=false}}RasterComponent.prototype.update.call(this,e,t)};BalloonTipLabel.prototype.apply=function(e,t,n){var r=this.enabled.getValueDirect();if(!r){RasterComponent.prototype.apply.call(this,e,t,n);return}switch(e){case"render":{this.draw(t.viewport)}break}RasterComponent.prototype.apply.call(this,e,t,n)};BalloonTipLabel.prototype.updateLabel=function(e){};BalloonTipLabel.prototype.updateLabelDimensions=function(e){};BalloonTipLabel.prototype.updateShowStates=function(){};BalloonTipLabel.prototype.draw=function(){if(!this.show.getValueDirect()){if(this.graphMgr.getCurrentBalloonTipLabel()==this){this.graphMgr.setCurrentBalloonTipLabel(null)}return}this.graphMgr.setCurrentBalloonTipLabel(this);var e=this.registry.find("Bridgeworks");var t=this.getRenderingPositions();var n=this.htmlBalloonTipLabel.offsetWidth;var r=this.htmlBalloonTipLabel.offsetHeight;{this.htmlBalloonTipLabel.style.left=e.canvas.offsetLeft+t.labelX;this.htmlBalloonTipLabel.style.top=e.canvas.offsetTop+t.labelY;this.labelRect.load(e.canvas.offsetLeft+t.labelX,e.canvas.offsetTop+t.labelY,this.labelRect.left+n,this.labelRect.top+r);if(this.qtip_api){this.qtip_api.reposition(null,false)}}var i=new Rect(0,0,0,0);{i.loadRect(this.labelRect)}this.screenRect.setValueDirect(i)};BalloonTipLabel.prototype.getRenderingPositions=function(){var e=0;var t=0;var n=this.screenPosition.getValueDirect();var r=this.anchor.getValueDirect();e=n.x+r.x;t=n.y-r.y;return{labelX:e,labelY:t}};BalloonTipLabel.prototype.eventPerformed=function(e){if(!this.show.getValueDirect()){return false}var t=this.isSelected(e.x,e.y);return t};BalloonTipLabel.prototype.balloonTipLabelStyleModified=function(e){};BalloonTipLabel.prototype.balloonTipLabelStyleBgColorModified=function(){};BalloonTipLabel.prototype.balloonTipLabelStyleDisplayModeModified=function(e){switch(e){case"default":{this.show.setValueDirect(true,false)}break;case"hide":{if(this.motionParent&&this.motionParent.getAttribute("hasFocus").getValueDirect()>0){this.hasFocus.setValueDirect(1)}else{this.show.setValueDirect(false,false)}}break}this.incrementModificationCount()};BalloonTipLabel.prototype.balloonTipLabelStyleHtmlLabelStyleModified=function(){var e=this.balloonTipLabelStyle.htmlLabelStyle.html.getValueDirect().join("");if(this.qtip_api){this.qtip_api.set("content.text",e)}this.incrementModificationCount()};BalloonTipLabel.prototype.renderSequenceSlotModified=function(){};BalloonTipLabel.prototype.showModified=function(e){if(this.qtip_api){if(e){this.qtip_api.show()}else{this.qtip_api.hide()}}};LineList.prototype=new VertexGeometry;LineList.prototype.constructor=LineList;LineList.prototype.update=function(e,t){if(!this.vertexBuffer){this.vertexBuffer=this.graphMgr.renderContext.createVertexBuffer(3);this.vertexBuffer.setPrimitiveType(RC_LINES)}VertexGeometry.prototype.update.call(this,e,t)};LineList.prototype.apply=function(e,t,n){VertexGeometry.prototype.apply.call(this,e,t,n)};LineList.prototype.draw=function(e){this.vertexBuffer.draw()};LineList.prototype.buildBoundingTree=function(){};PointList.prototype=new VertexGeometry;PointList.prototype.constructor=PointList;PointList.prototype.update=function(e,t){if(!this.vertexBuffer){this.vertexBuffer=this.graphMgr.renderContext.createVertexBuffer(3);this.vertexBuffer.setPrimitiveType(RC_POINTS)}VertexGeometry.prototype.update.call(this,e,t)};PointList.prototype.apply=function(e,t,n){VertexGeometry.prototype.apply.call(this,e,t,n)};PointList.prototype.draw=function(e){this.vertexBuffer.draw()};PointList.prototype.buildBoundingTree=function(){};DistanceSortAgent.prototype=new Agent;DistanceSortAgent.prototype.constructor=DistanceSortAgent;DistanceSortAgent.prototype.setGraphMgr=function(e){this.graphMgr=e};DistanceSortAgent.prototype.isEmpty=function(){return this.sortRecs.length==0};DistanceSortAgent.prototype.addGeometry=function(e,t,n,r){var i=new DistanceSortRec;i.geometry=e;i.dissolve=r;i.stateRec=GetCurrentState(this.graphMgr);var s=new Matrix4x4;s.loadMatrix(this.graphMgr.renderContext.modelViewMatrixStack.top());i.distance=FLT_MAX;var o;for(var u=0;u<8;u++){switch(u){case 0:o=new Vector3D(n.x,n.y,n.z);break;case 1:o=new Vector3D(n.x,n.y,t.z);break;case 2:o=new Vector3D(n.x,t.y,n.z);break;case 3:o=new Vector3D(n.x,t.y,t.z);break;case 4:o=new Vector3D(t.x,n.y,n.z);break;case 5:o=new Vector3D(t.x,n.y,t.z);break;case 6:o=new Vector3D(t.x,t.y,n.z);break;case 7:o=new Vector3D(t.x,t.y,t.z);break}o=s.transform(o.x,o.y,o.z,1);i.distance=Math.min(o.z,i.distance)}this.sortRecs.push(i)};DistanceSortAgent.prototype.clear=function(){this.sortRecs.length=0};DistanceSortAgent.prototype.sort=function(){this.sortRecs.sort(DistanceSortAgent_CompareSortRecs)};DistanceSortAgent.prototype.draw=function(){if(this.sortRecs.length==0){return}var e=GetCurrentState(this.graphMgr);for(var t=0;t<this.sortRecs.length;t++){SetCurrentState(this.graphMgr,this.sortRecs[t].stateRec);this.sortRecs[t].geometry.draw(this.sortRecs[t].dissolve);this.graphMgr.renderState.setState(RENDERSTATE_CLIP_PLANE_BIT,e.renderStateRec)}this.graphMgr.renderContext.enable(eRenderMode.DepthBufferWrite);SetCurrentState(this.graphMgr,e)};var EARTH_RADIUS_KM_EQ=6378;var EARTH_RADIUS_KM_P=6377;var UTM_ZONE_WIDTH_KM=667.956;var EQ_ARC_WIDTH_KM=40075.16;var EQ_ARC_HEIGHT_KM=40008;var EQ_ARC_ONE_DEG_LAT_KM=EQ_ARC_HEIGHT_KM/360;var EQ_ARC_ONE_DEG_LON_KM=EQ_ARC_WIDTH_KM/360;var EQ_ARC_WIDTH_MI=24902;var EQ_ARC_HEIGHT_MI=24900;var EQ_ARC_ONE_DEG_LAT_MI=EQ_ARC_HEIGHT_MI/360;var EQ_ARC_ONE_DEG_LON_MI=EQ_ARC_WIDTH_MI/360;MapProjectionCalculator.prototype=new Evaluator;MapProjectionCalculator.prototype.constructor=MapProjectionCalculator;MapProjectionCalculator.prototype.evaluate=function(){var e=this.geoPosition.getValueDirect();var t=this.computePosition(e.x,e.y,e.z);this.resultPosition.setValueDirect(t.x,t.y,t.z);var n=this.computeGeoPosition(t.x,t.y,t.z);this.resultGeoPosition.setValueDirect(n.x,n.y,n.z)};MapProjectionCalculator.prototype.computePosition=function(e,t,n){var r=undefined;var i=this.mapProjection.getValueDirect().join("");var s=this.positionCalculators[i];if(s){var o=this.center2D.getValueDirect();r=s(e,t,n,o.x,o.y,this.unitsMultiplier)}return r};MapProjectionCalculator.prototype.computeGeoPosition=function(e,t,n){var r=undefined;var i=this.mapProjection.getValueDirect().join("");var s=this.geoPositionCalculators[i];if(s){var o=this.center2D.getValueDirect();r=s(e,t,n,o.x,o.y,this.unitsMultiplier)}return r};NullObject.prototype=new ParentableMotionElement;NullObject.prototype.constructor=NullObject;Transform.prototype=new SGNode;Transform.prototype.constructor=Transform;Transform.prototype.clone=function(e){this.matrix=e.matrix.clone();this.updateMatrix=e.updateMatrix};Transform.prototype.update=function(e,t){if(this.updateMatrix){this.updateMatrix=false;this.matrixTransform=this.matrix.getValueDirect()}SGNode.prototype.update.call(this,e,t)};Transform.prototype.apply=function(e,t,n){if(!this.enabled.getValueDirect()){SGNode.prototype.apply.call(this,e,t,n);return}switch(e){case"render":{t.worldMatrix=this.matrixTransform.multiply(t.worldMatrix);this.applyTransform()}break;case"rayPick":case"bbox":case"collide":{t.worldMatrix=this.matrixTransform.multiply(t.worldMatrix)}break;case"highlight":{t.worldMatrix=this.matrixTransform.multiply(t.worldMatrix);if(t.targets.length>0){t.targets[t.targets.length-1].worldMatrix=this.matrixTransform.multiply(t.targets[t.targets.length-1].worldMatrix)}}break;default:break}SGNode.prototype.apply.call(this,e,t,n)};Transform.prototype.applyTransform=function(){this.graphMgr.renderContext.setMatrixMode(RC_MODELVIEW);this.graphMgr.renderContext.leftMultMatrix(this.matrixTransform);this.graphMgr.renderContext.applyModelViewTransform()};QuaternionRotate.prototype=new Transform;QuaternionRotate.prototype.constructor=QuaternionRotate;QuaternionRotate.prototype.update=function(e,t){if(this.updateRotationQuat){this.updateRotationQuat=false;var n=this.rotationQuat.getValueDirect();var r=n.getMatrix();this.matrix.setValueDirect(r);var i=r.getRotationAngles();this.rotation.setValueDirect(i.x,i.y,i.z)}Transform.prototype.update.call(this,e,t)};QuaternionRotate.prototype.apply=function(e,t,n){if(!this.enabled.getValueDirect()){Transform.prototype.apply.call(this,e,t,n);return}Transform.prototype.apply.call(this,e,t,n)};Rotate.prototype=new Transform;Rotate.prototype.constructor=Rotate;Rotate.prototype.update=function(e,t){if(this.updateRotation){this.updateRotation=false;var n=this.rotation.getValueDirect();var r=new Matrix4x4;r.loadXYZAxisRotation(n.x,n.y,n.z);this.matrix.setValueDirect(r)}Transform.prototype.update.call(this,e,t)};Rotate.prototype.apply=function(e,t,n){if(!this.enabled.getValueDirect()){Transform.prototype.apply.call(this,e,t,n);return}Transform.prototype.apply.call(this,e,t,n)};Scale.prototype=new Transform;Scale.prototype.constructor=Scale;Scale.prototype.update=function(e,t){if(this.updateScale){this.updateScale=false;var n=this.scale.getValueDirect();var r=new Matrix4x4;r.loadScale(n.x,n.y,n.z);this.matrix.setValueDirect(r)}Transform.prototype.update.call(this,e,t)};Scale.prototype.apply=function(e,t,n){if(!this.enabled.getValueDirect()){Transform.prototype.apply.call(this,e,t,n);return}Transform.prototype.apply.call(this,e,t,n)};Translate.prototype=new Transform;Translate.prototype.constructor=Translate;Translate.prototype.update=function(e,t){if(this.updateTranslation){this.updateTranslation=false;var n=this.translation.getValueDirect();var r=new Matrix4x4;r.loadTranslation(n.x,n.y,n.z);this.matrix.setValueDirect(r)}Transform.prototype.update.call(this,e,t)};Translate.prototype.apply=function(e,t,n){if(!this.enabled.getValueDirect()){Transform.prototype.apply.call(this,e,t,n);return}Transform.prototype.apply.call(this,e,t,n)};MultiTargetObserver.prototype=new Evaluator;MultiTargetObserver.prototype.constructor=MultiTargetObserver;MultiTargetObserver.prototype.setNumberOfTargets=function(e){var t=this.targets.getValueDirect();if(t>0){for(var n=0;n<t;n++){this.unregisterAttribute(this.targetPosition[n])}}this.targets.setValueDirect(e);if(e>0){this.targetPosition.length=e;for(var n=0;n<e;n++){this.targetPosition[n]=new Vector3DAttr(0,0,0);this.registerAttribute(this.targetPosition[n],"targetPosition"+n)}}};MultiTargetObserver.prototype.evaluate=function(){if(!this.enabled.getValueDirect()){return}if(this.targets.getValueDirect()==0){return}var e=this.getObserverAndTargetPositions();var t=e.observer;var n=e.target;var r=new Vector3D(n.x-t.x,n.y-t.y,n.z-t.z);var i,s;var o=XYZtoHP(r.x,r.y,r.z);var i=o.heading;var s=o.pitch;var u=0;if(this.affectPitch.getValueDirect()==true){u=-toDegrees(s)}var a=0;if(this.affectHeading.getValueDirect()==true){a=-toDegrees(i)}var f=[t.x,t.y,t.z];this.resultPosition.setValue(f);if(this.affectPitch.getValueDirect()==true){this.resultPitch.setValueDirect(u)}if(this.affectHeading.getValueDirect()==true){this.resultHeading.setValueDirect(a)}};MultiTargetObserver.prototype.getObserverAndTargetPositions=function(){var e,t;switch(this.targets.getValueDirect()){case 0:{e=new Vector3D(0,0,0);t=new Vector3D(0,0,0)}break;case 1:{e=this.position.getValueDirect();t=this.targetPosition[0].getValueDirect()}break;case 2:{var n=this.targetPosition[0].getValueDirect();var r=this.targetPosition[1].getValueDirect();var i=this.distanceFromFirstTarget.getValueDirect();var s=Normalize(n-r);e=s*i+n;if(i==0){t=n-s}else{t=n}}break;default:{e=new Vector3D(0,0,0);t=Vector3D(0,0,0)}break}return{observer:e,target:t}};SerializeParams.prototype=new DirectiveParams;SerializeParams.prototype.constructor=SerializeParams();SerializeDirective.prototype=new SGDirective;SerializeDirective.prototype.constructor=SerializeDirective;SerializeDirective.prototype.execute=function(e){if(!e){return}this.serialized=null;var t=new SerializeParams;t.serialized=new String;e.apply("serialize",t,true);this.serialized=t.serialized;return};var MAX_SEE_AHEAD=2;CollideParams.prototype=new DirectiveParams;CollideParams.prototype.constructor=CollideParams();CollideDirective.prototype=new SGDirective;CollideDirective.prototype.constructor=CollideDirective;CollideDirective.prototype.execute=function(e){e=e||this.rootNode.getValueDirect();var t=new CollideParams;e.apply("collide",t,true);this.detectCollisions(t.detectCollisions);this.detectObstructions(t.detectCollisions);this.detectSnapConnections(t.detectCollisions)};CollideDirective.prototype.detectCollisions=function(e){var t=[];var n=[];var r=[];for(var i in e){t.push(e[i].model);n.push(e[i].tree);r.push(false);e[i].model.getAttribute("collisionList").clear()}for(var i=0;i<n.length;i++){for(var s=i+1;s<n.length;s++){if(n[i].collides(n[s])){t[i].getAttribute("collisionList").push_back(t[s]);t[s].getAttribute("collisionList").push_back(t[i]);r[i]=r[s]=true}}}for(var i=0;i<r.length;i++){t[i].getAttribute("collisionDetected").setValueDirect(r[i])}};CollideDirective.prototype.detectObstructions=function(e){var t=[];var n=[];var r=[];for(var i in e){t.push(e[i].model);n.push(e[i].tree);r.push(false);e[i].model.getAttribute("obstructionList").clear()}var s=0;var o=FLT_MAX;for(var i=0;i<n.length;i++){var u=t[i].getDirectionVectors();u.forward.x*=MAX_SEE_AHEAD;u.forward.y*=MAX_SEE_AHEAD;u.forward.z*=MAX_SEE_AHEAD;for(var a=0;a<n.length;a++){if(i==a)continue;if((s=n[a].obstructs(n[i],u.forward))>0&&s<o){t[i].getAttribute("obstructionList").clear();t[i].getAttribute("obstructionList").push_back(t[a]);r[i]=true;o=s}}}for(var i=0;i<r.length;i++){t[i].getAttribute("obstructionDetected").setValueDirect(r[i])}};CollideDirective.prototype.detectSnapConnections=function(e){var t=[];var n=[];for(var r in e){var i=e[r].model.getAttribute("socketConnectors");for(var s=0;s<i.Size();s++){var o=i.getAt(s);if(o.getAttribute("connected").getValueDirect()==false){t.push(new Pair(o,e[r]))}}var u=e[r].model.getAttribute("plugConnectors");for(var s=0;s<u.Size();s++){var a=u.getAt(s);if(a.getAttribute("connected").getValueDirect()==false){n.push(new Pair(a,e[r]))}}}for(var r=0;r<n.length;r++){var f=n[r].first.getAttribute("type").getValueDirect().join("");for(var s=0;s<t.length;s++){var l=t[s].first.getAttribute("type").getValueDirect().join("");if(f!=l)continue;var c=n[r].first.collides(t[s].first,n[r].second.worldMatrix,t[s].second.worldMatrix);if(c>0){var h=this.registry.find("AttributeFactory");var p=h.create("SnapTo");p.getAttribute("target").copyValue(t[s].second.model.getAttribute("name"));p.getAttribute("plug").copyValue(n[r].second.model.getAttribute("name"));p.getAttribute("socketConnector").copyValue(t[s].first);p.getAttribute("plugConnector").copyValue(n[r].first);p.getAttribute("socketWorldMatrix").setValueDirect(t[s].second.worldMatrix);p.getAttribute("plugWorldMatrix").setValueDirect(n[r].second.worldMatrix);p.getAttribute("slot").setValueDirect(c);p.execute();n[r].first.getAttribute("connected").setValueDirect(true);t[s].first.getAttribute("connected").setValueDirect(true);n[r].second.model.getAttribute("moveable").setValueDirect(false)}}}};HighlightParams.prototype=new DirectiveParams;HighlightParams.prototype.constructor=HighlightParams();HighlightDirective.prototype=new SGDirective;HighlightDirective.prototype.constructor=HighlightDirective;HighlightDirective.prototype.setGraphMgr=function(e){SGDirective.prototype.setGraphMgr.call(this,e);this.initHighlightSquareVB()};HighlightDirective.prototype.execute=function(e){e=e||this.rootNode.getValueDirect();var t=new HighlightParams;e.apply("highlight",t,true);this.drawHighlights(t)};HighlightDirective.prototype.drawHighlights=function(e){if(e.targets.length==0){return}var t=this.graphMgr.renderContext;if(!t){return}var n=this.highlightType.getValueDirect();var r,i,s;for(var o=0;o<e.targets.length;o++){var u=e.targets[o];var a=u.camera.getDirectionVectors();r=a.up;i=a.right;s=a.forward;var f=u.worldMatrix.getScalingFactors();var l=max3(f.x,f.y,f.z);var c=this.getWorldUnitsPerPixel(u.center,u.worldMatrix,u.viewMatrix,u.camera,u.viewport)/l;var h=u.highlightWidth*c;t.clearStencil(0);t.clear(RC_STENCIL_BUFFER_BIT);var p;for(var d=0;d<u.geometries.length;d++){switch(n){case eHighlightType.FourPass:{for(var v=0;v<4;v++){p=this.getWorldViewMatrix(n,h,v,r,i,s,u.worldMatrix,u.viewMatrix);this.configureStencil_Target(t,u.geometries[d],u.projMatrix,p,eStencilOp.Increment)}}break;case eHighlightType.EightPass:{for(var v=0;v<8;v++){p=this.getWorldViewMatrix(n,h,v,r,i,s,u.worldMatrix,u.viewMatrix);this.configureStencil_Target(t,u.geometries[d],u.projMatrix,p,eStencilOp.Increment)}}break}}p=u.worldMatrix.multiply(u.viewMatrix);for(var d=0;d<u.geometries.length;d++){this.configureStencil_Target(t,u.geometries[d],u.projMatrix,p,eStencilOp.Zero)}this.highlightColor.setValueDirect(u.highlightColor_r,u.highlightColor_g,u.highlightColor_b,u.highlightColor_a);this.renderHighlightSquare(e,t)}};HighlightDirective.prototype.getWorldUnitsPerPixel=function(e,t,n,r,i){var s=t.multiply(n);var o=s.transform(e.x,e.y,e.z,1);var u=new Vector2D;switch(r.attrType){case eAttrType.PerspectiveCamera:{var a=r.getAttribute("zoom").getValueDirect();u=worldUnitsPerPixelPersp(i,a,o.z)}break;case eAttrType.OrthographicCamera:{var f=r.getAttribute("width").getValueDirect();u=worldUnitsPerPixelOrtho(i,f)}break;default:break}return Math.max(u.x,u.y)};HighlightDirective.prototype.getWorldViewMatrix=function(e,t,n,r,i,s,o,u){var a=0;switch(e){case eHighlightType.FourPass:a=90;break;case eHighlightType.EightPass:a=45;break}var f=new Matrix4x4;f.loadZAxisRotation(a*n);var l=f.transform(1,0,0,0);l.x*=t;l.y*=t;l.z*=t;var c=new Matrix4x4;c.loadTranslation(i.x*l.x+r.x*l.y,i.y*l.x+r.y*l.y,i.z*l.x+r.z*l.y);return c.multiply(o.multiply(u))};HighlightDirective.prototype.configureStencil_Target=function(e,t,n,r,i){var s=e.enabled(eRenderMode.DepthBufferWrite);var o=e.enabled(eRenderMode.StencilTest);var u=e.enabled(eRenderMode.AlphaBlend);e.setEnabled(eRenderMode.DepthBufferWrite,false);e.setEnabled(eRenderMode.StencilTest,true);e.setDepthFunc(eDepthFunc.LessEqual);e.setShadeModel(eShadeModel.Flat);e.setStencilFunc(eStencilFunc.Always,0,255);e.setStencilMask(255);e.setStencilOp(eStencilOp.Keep,i,i);e.setEnabled(eRenderMode.AlphaBlend,true);e.setBlendFactor(RC_ZERO,RC_ONE);e.setMatrixMode(RC_PROJECTION);e.pushMatrix();e.loadMatrix(n);e.applyProjectionTransform();e.setMatrixMode(RC_MODELVIEW);e.pushMatrix();e.loadMatrix(r);e.applyModelViewTransform();t.drawPrimitives();e.setMatrixMode(RC_PROJECTION);e.popMatrix();e.setMatrixMode(RC_MODELVIEW);e.popMatrix();e.setEnabled(eRenderMode.DepthBufferWrite,s);e.setEnabled(eRenderMode.StencilTest,o);e.setDepthFunc(eDepthFunc.LessEqual);e.setShadeModel(eShadeModel.Gouraud);e.setEnabled(eRenderMode.AlphaBlend,u)};HighlightDirective.prototype.renderHighlightSquare=function(e,t){var n=t.enabled(eRenderMode.DepthTest);var r=t.enabled(eRenderMode.StencilTest);var i=t.enabled(eRenderMode.AlphaBlend);var s=t.enabled(eRenderMode.Lighting);t.setDepthFunc(eDepthFunc.LessEqual);t.setEnabled(eRenderMode.DepthTest,false);t.setEnabled(eRenderMode.StencilTest,true);t.setEnabled(eRenderMode.AlphaBlend,true);t.setEnabled(eRenderMode.Lighting,false);t.setBlendFactor(RC_SRC_ALPHA,RC_ONE_MINUS_SRC_ALPHA);t.setStencilFunc(eStencilFunc.LessEqual,1,255);t.setStencilOp(eStencilOp.Keep,eStencilOp.Keep,eStencilOp.Keep);var o=new Matrix4x4;o.loadIdentity();t.setMatrixMode(RC_PROJECTION);t.pushMatrix();t.loadMatrix(o);t.applyProjectionTransform();t.setMatrixMode(RC_MODELVIEW);t.pushMatrix();t.loadMatrix(o);t.applyModelViewTransform();this.vertexBuffer.draw();t.popMatrix();t.setMatrixMode(RC_PROJECTION);t.popMatrix();t.setDepthFunc(eDepthFunc.LessEqual);t.setEnabled(eRenderMode.DepthTest,n);t.setEnabled(eRenderMode.StencilTest,r);t.setEnabled(eRenderMode.AlphaBlend,i);t.setEnabled(eRenderMode.Lighting,s);t.setMatrixMode(RC_MODELVIEW)};HighlightDirective.prototype.initHighlightSquareVB=function(){this.vertexBuffer=this.graphMgr.renderContext.createVertexBuffer(3);this.vertexBuffer.setPrimitiveType(RC_TRIANGLE_STRIP);var e=[-1,-1,1,-1,1,1,1,-1,1,1,1,1];var t=[0,0,-1,0,0,-1,0,0,-1,0,0,-1];var n=this.highlightColor.getValueDirect();var r=[n.r,n.g,n.b,n.a,n.r,n.g,n.b,n.a,n.r,n.g,n.b,n.a,n.r,n.g,n.b,n.a];this.vertexBuffer.setVertices(e);this.vertexBuffer.setNormals(t);this.vertexBuffer.setColors(r)};HighlightDirective.prototype.highlightColorModified=function(){if(this.vertexBuffer){var e=this.highlightColor.getValueDirect();var t=[e.r,e.g,e.b,e.a,e.r,e.g,e.b,e.a,e.r,e.g,e.b,e.a,e.r,e.g,e.b,e.a];this.vertexBuffer.setColors(t)}};var OBJECTMOTION_PAN_BIT=1;var OBJECTMOTION_LINEAR_BIT=2;var OBJECTMOTION_ANGULAR_BIT=4;var OBJECTMOTION_SCALAR_BIT=8;var OBJECTMOTION_ALL_BITS=15;ObjectMotionDesc.prototype.assign=function(e){this.validMembersMask=e.validMembersMask;this.panVelocity=e.panVelocity;this.linearVelocity=e.linearVelocity;this.angularVelocity=e.angularVelocity;this.scalarVelocity=e.scalarVelocity;this.duration=e.duration};ObjectMover.prototype=new Evaluator;ObjectMover.prototype.constructor=ObjectMover;ObjectMover.prototype.onUnregister=function(){this.motionQueue.clear();this.panVelocity.setValueDirect(0,0,0);this.linearVelocity.setValueDirect(0,0,0);this.angularVelocity.setValueDirect(0,0,0);this.scalarVelocity.setValueDirect(0,0,0)};ObjectMover.prototype.evaluate=function(){var e=this.timeIncrement.getValueDirect();this.updateActiveMotion(e);this.setMotion(this.activeMotion)};ObjectMover.prototype.setMotion=function(e){if(e.validMembersMask&OBJECTMOTION_PAN_BIT){this.panVelocity.setValueDirect(e.panVelocity.x,e.panVelocity.y,e.panVelocity.z)}if(e.validMembersMask&OBJECTMOTION_LINEAR_BIT){this.linearVelocity.setValueDirect(e.linearVelocity.x,e.linearVelocity.y,e.linearVelocity.z)}if(e.validMembersMask&OBJECTMOTION_ANGULAR_BIT){this.angularVelocity.setValueDirect(e.angularVelocity.x,e.angularVelocity.y,e.angularVelocity.z)}if(e.validMembersMask&OBJECTMOTION_SCALAR_BIT){this.scalarVelocity.setValueDirect(e.scalarVelocity.x,e.scalarVelocity.y,e.scalarVelocity.z)}};ObjectMover.prototype.updateActiveMotion=function(e){if(!this.activeMotion||this.activeDuration>=this.activeMotion.duration){this.activeDuration=0;this.activeMotion=this.motionQueue.front()||new ObjectMotionDesc;this.motionQueue.pop()}this.activeDuration+=e};ObjectMover.prototype.connectTarget=function(e){this.panVelocity.removeAllTargets();this.linearVelocity.removeAllTargets();this.angularVelocity.removeAllTargets();this.scalarVelocity.removeAllTargets();if(e){this.panVelocity.addTarget(e.getAttribute("panVelocity"));this.linearVelocity.addTarget(e.getAttribute("linearVelocity"));this.angularVelocity.addTarget(e.getAttribute("angularVelocity"));this.scalarVelocity.addTarget(e.getAttribute("scalarVelocity"));e.getAttribute("collisionDetected").addModifiedCB(ObjectMover_TargetCollisionDetectedModifiedCB,this);e.getAttribute("obstructionDetected").addModifiedCB(ObjectMover_TargetObstructionDetectedModifiedCB,this)}this.targetObject=e};ObjectMover.prototype.collisionDetected=function(e){};ObjectMover.prototype.obstructionDetected=function(e){};var ANIMALMOVER_MAX_QUEUE_LENGTH=2;AnimalMover.prototype=new ObjectMover;AnimalMover.prototype.constructor=AnimalMover;AnimalMover.prototype.evaluate=function(){if(this.motionQueue.length()==0){var e=Math.random();var t=e<.5?-1:1;var n=new ObjectMotionDesc;n.duration=5*e;n.angularVelocity=new Vector3D(0,this.angularSpeed.getValueDirect()*e*t,0);n.panVelocity=new Vector3D(0,0,this.linearSpeed.getValueDirect());this.motionQueue.push(n)}ObjectMover.prototype.evaluate.call(this)};AnimalMover.prototype.collisionDetected=function(e){};AnimalMover.prototype.obstructionDetected=function(e){if(e.Size()>0){this.motionQueue.clear();this.activeMotion=null;var t=this.targetObject.getDirectionVectors();var n=this.targetObject.getAttribute("sectorPosition").getValueDirect();var r=new Vector3D(t.forward.x,t.forward.y,t.forward.z);var i=e.getAt(0).getAttribute("sectorPosition").getValueDirect();var s=toDegrees(Math.acos(cosineAngleBetween(t.forward,new Vector3D(i.x-n.x,i.y-n.y,i.z-n.z))));if(s==0){i.x+=.1;i.z+=.1}var o=distanceBetween(n,i);var u=new Vector3D(t.forward.x*o-i.x,t.forward.y*o-i.y,t.forward.z*o-i.z);u.normalize();r.addVector(u);r.normalize();r.multiplyScalar(this.linearSpeed.getValueDirect());this.linearDirection=r;var a=cosineAngleBetween(t.forward,this.linearDirection);s=toDegrees(Math.acos(a));if(s>0){if(a<0)s=-s;var f=this.targetObject.getAttribute("rotation").getValueDirect();var l=new ObjectMotionDesc;l.angularVelocity=new Vector3D(0,s,0);l.duration=s/this.angularSpeed.getValueDirect();this.motionQueue.push(l)}}else{}};WalkSimulator.prototype=new SceneInspector;WalkSimulator.prototype.constructor=WalkSimulator;WalkSimulator.prototype.evaluate=function(){var e=this.enabled.getValueDirect();if(!e){return}var t=this.linearDelta.getValueDirect();t.x*=-1;var n=this.linearSensitivity.getValueDirect();var r=this.angularDelta.getValueDirect();var i=this.angularSensitivity.getValueDirect();var s=new Vector3D(t.x,t.y,t.z);s.multiplyVector(n);var o=new Vector3D(r.x,r.y,r.z);o.multiplyVector(i);if(s.x!=0||s.y!=0||s.z!=0||o.x!=0||o.y!=0||o.z!=0){this.panDelta.setValueDirect(s.x,s.y,s.z);this.rotationDelta.setValueDirect(o.x,o.y,o.z);{var u=this.viewPosition.getValueDirect();var a=this.viewRotation.getValueDirect();var f=this.groundPlane.getValueDirect();var l=new Matrix4x4;l.loadTranslation(-u.x,-u.y,-u.z);var c=new Matrix4x4;c.loadXYZAxisRotation(-a.x,-a.y,-a.z);var h=l.multiply(c);this.upVector.setValueDirect(f.normal.x,f.normal.y,f.normal.z);var p=this.transformDirectionVector(0,0,1,h);var d=planeProject(p,f);var v=new Vector3D(d.x,d.y,d.z);v.normalize();this.forwardVector.setValueDirect(v.x,v.y,v.z);var m=new Matrix4x4;m.loadYAxisRotation(90);p=m.transform(v.x,v.y,v.z,0);this.rightVector.setValueDirect(p.x,p.y,p.z)}SceneInspector.prototype.evaluate.call(this)}};WalkSimulator.prototype.enabledModified=function(){var e=this.enabled.getValueDirect();if(e){this.enableSceneInspectionState();this.affectRotation_Z.setValueDirect(false)}else if(this.lastEnabled){this.restoreSceneInspectionState();this.affectRotation_Z.setValueDirect(true);this.upVector.setValueDirect(0,0,0,false);this.rightVector.setValueDirect(0,0,0,false);this.forwardVector.setValueDirect(0,0,0,false)}this.lastEnabled=e};WalkSimulator.prototype.enableSceneInspectionState=function(){var e=this.registry.find("SceneInspector");if(e){e.enabled.setValueDirect(true);this.sceneInspector_pivotDistanceValue=e.pivotDistance.getValueDirect();e.pivotDistance.setValueDirect(0)}var t=this.registry.find("Selector");if(t){this.selector_computePivotDistanceValue=t.computePivotDistance.getValueDirect();t.computePivotDistance.setValueDirect(false)}};WalkSimulator.prototype.restoreSceneInspectionState=function(){var e=this.registry.find("SceneInspector");if(e){e.pivotDistance.setValueDirect(this.sceneInspector_pivotDistanceValue)}var t=this.registry.find("Selector");if(t){t.computePivotDistance.setValueDirect(this.selector_computePivotDistanceValue)}};Cube.prototype=new TriList;Cube.prototype.constructor=Cube;Cube.prototype.setGraphMgr=function(e){TriList.prototype.setGraphMgr.call(this,e);this.materialNode.setGraphMgr(e)};Cube.prototype.update=function(e,t){if(this.updateTransform){this.updateTransform=false;var n=this.position.getValueDirect();var r=new Matrix4x4;r.loadTranslation(n.x,n.y,n.z);var i=this.rotation.getValueDirect();var s=new Matrix4x4;s.loadXYZAxisRotation(i.x,i.y,i.z);var o=this.scale.getValueDirect();var u=new Matrix4x4;u.loadScale(o.x,o.y,o.z);this.transform.loadMatrix(u.multiply(s.multiply(r)))}if(this.updateMaterial){this.updateMaterial=false;this.materialNode.update(e,t)}if(this.updateTriList){this.updateTriList=false;TriList.prototype.update.call(this,e,t)}};Cube.prototype.apply=function(e,t,n){var r=this.show.getValueDirect();var i=this.enabled.getValueDirect();if(!r||!i){return}switch(e){case"render":{this.materialNode.apply(e,t,n);this.draw(t.dissolve)}break}};Cube.prototype.draw=function(e){this.graphMgr.renderContext.setMatrixMode(RC_MODELVIEW);this.graphMgr.renderContext.pushMatrix();this.graphMgr.renderContext.leftMultMatrix(this.transform);this.graphMgr.renderContext.applyModelViewTransform();this.vertexBuffer.draw();this.graphMgr.renderContext.setMatrixMode(RC_MODELVIEW);this.graphMgr.renderContext.popMatrix();this.graphMgr.renderContext.applyModelViewTransform()};ScreenRect.prototype=new TriList;ScreenRect.prototype.constructor=ScreenRect;ScreenRect.prototype.update=function(e,t){TriList.prototype.update.call(this,e,t)};ScreenRect.prototype.draw=function(e){var t=new Matrix4x4;this.graphMgr.renderContext.setMatrixMode(RC_MODELVIEW);this.graphMgr.renderContext.pushMatrix();this.graphMgr.renderContext.loadMatrix(t);this.graphMgr.renderContext.applyModelViewTransform();this.graphMgr.renderContext.setMatrixMode(RC_PROJECTION);this.graphMgr.renderContext.pushMatrix();this.graphMgr.renderContext.loadMatrix(t);this.graphMgr.renderContext.applyProjectionTransform();this.graphMgr.renderContext.disable(eRenderMode.DepthTest);this.graphMgr.renderContext.disable(eRenderMode.DepthBufferWrite);this.graphMgr.renderContext.disable(eRenderMode.Lighting);var n=this.textureColorMask.getValueDirect();this.graphMgr.renderContext.setTextureColorMask(n.r,n.g,n.b,n.a);TriList.prototype.draw.call(this,e);this.graphMgr.renderContext.popMatrix();this.graphMgr.renderContext.applyProjectionTransform();this.graphMgr.renderContext.setMatrixMode(RC_MODELVIEW);this.graphMgr.renderContext.popMatrix();this.graphMgr.renderContext.applyModelViewTransform();this.graphMgr.renderContext.enable(eRenderMode.DepthTest);this.graphMgr.renderContext.enable(eRenderMode.DepthBufferWrite);this.graphMgr.renderContext.enable(eRenderMode.Lighting);this.graphMgr.renderContext.setTextureColorMask(2,2,2,2)};ScreenRect.prototype.setTexture=function(e){var t=[0,0,0,1,1,0,1,1];var n=this.getUVCoords(e);n.setValueDirect(t)};MorphEffector.prototype=new Evaluator;MorphEffector.prototype.constructor=MorphEffector;MorphEffector.prototype.evaluate=function(){var e=this.morphAmt.getValueDirect();var t=this.morphIncr.getValueDirect();e+=t;e=clamp(e,0,1);this.morphAmt.setValueDirect(e);var n=this.sourceVertices.getValueDirect();var r=this.targetVertices.getValueDirect();var i=[];var s=Math.min(n.length,r.length);i.length=s;for(var o=0;o<s;o++){i[o]=(r[o]-n[o])*e+n[o]}this.resultVertices.setValue(i)};Bone.prototype=new AttributeContainer;Bone.prototype.constructor=Bone;Bone.prototype.addChild=function(e){if(!e||e.parent){return false}e.parent=this;this.transform.addTarget(e.parentTransform);this.restTransform.addTarget(e.parentRestTransform);this.children.push(e);return true};Bone.prototype.removeChild=function(e){if(!e){return false}for(var t=0;t<this.children.length;t++){if(this.children[t]==e){e.parent=null;this.transform.removeTarget(e.parentTransform);this.restTransform.removeTarget(e.parentRestTransform);var n=new Matrix4x4;n.loadIdentity();e.parentTransform.setValueDirect(n);e.parentRestTransform.setValueDirect(n);this.children.splice(t,1);return true}}return false};Bone.prototype.getChild=function(e){if(e>=this.children.length){return null}return this.children[e]};Bone.prototype.getChildCount=function(){return this.children.length};Bone.prototype.getParent=function(){return this.parent};Bone.prototype.getScaledStrength=function(){var e=this.strength.getValueDirect();if(this.scaleBoneStrength.getValueDirect()){e*=this.restLength.getValueDirect()}return e};Bone.prototype.calculateFalloffValues=function(e){var t=this.restMatrix.transform(0,0,0,1);var n=this.restMatrix.transform(0,0,1,0);var r=this.restLength.getValueDirect();var i=new Vector3D(t.x,t.y,t.z);var s=new Vector3D(t.x+n.x*r,t.y+n.y*r,t.z+n.z*r);var o=e.length/3;var u=this.falloffType.getValueDirect();var a=[];a.length=o;for(var f=0,l=0;f<o;f++,l+=3){var c=distanceBetweenLineSegmentAndPoint(i,s,new Vector3D(e[l],e[l+1],e[l+2]));switch(u){case eBoneFalloffType.InverseDistance:a[f]=1/c;break;case eBoneFalloffType.InverseDistance_2:a[f]=1/(c*c);break;case eBoneFalloffType.InverseDistance_4:a[f]=1/(c*c*c*c);break;case eBoneFalloffType.InverseDistance_8:a[f]=1/(c*c*c*c*c*c*c*c);break;case eBoneFalloffType.InverseDistance_16:a[f]=1/(c*c*c*c*c*c*c*c*c*c*c*c*c*c*c*c);break}a[f]*=this.getScaledStrength()}return a};Bone.prototype.update=function(){var e=false;if(this.updatePosition||this.updateRotation||this.updateScale||this.updatePivot||this.updateParentTransform){if(this.updatePosition){this.updatePosition=false;var t=this.position.getValueDirect();this.translationMatrix.loadTranslation(t.x,t.y,t.z)}if(this.updateRotation){this.updateRotation=false;var n=this.rotation.getValueDirect();this.rotationQuat.loadXYZAxisRotation(n.x,n.y,n.z);this.rotationMatrix=this.rotationQuat.getMatrix()}if(this.updateScale){this.updateScale=false;var r=this.scale.getValueDirect();this.scaleMatrix.loadScale(r.x,r.y,r.z)}if(this.updatePivot){this.updatePivot=false;var i=this.pivot.getValueDirect();this.pivotMatrix.loadTranslation(-i.x,-i.y,-i.z)}if(this.updateParentTransform){this.updateParentTransform=false;this.parentMatrix=this.parentTransform.getValueDirect()}this.matrix=this.pivotMatrix.multiply(this.scaleMatrix.multiply(this.rotationMatrix.multiply(this.translationMatrix.multiply(this.parentMatrix))));this.transform.setValueDirect(this.matrix);e=true}if(this.updateRestPosition||this.updateRestRotation||this.updateParentRestTransform){this.updateRestPosition=false;this.updateRestRotation=false;this.updateParentRestTransform=false;var s=this.restPosition.getValueDirect();var o=new Matrix4x4;o.loadTranslation(s.x,s.y,s.z);var u=this.restRotation.getValueDirect();var a=new Quaternion;a.loadXYZAxisRotation(u.x,u.y,u.z);var f=a.getMatrix();var l=this.parentRestTransform.getValueDirect();this.restMatrix=f.multiply(o.multiply(l));this.restMatrixInv=new Matrix4x4;this.restMatrixInv.loadMatrix(this.restMatrix);this.restMatrixInv.invert();this.restTransform.setValueDirect(this.restMatrix);e=true}if(this.updateRestLength){this.updateRestLength=false}if(e){this.boneMatrix=this.restMatrixInv.multiply(this.matrix)}};BoneEffector.prototype=new Evaluator;BoneEffector.prototype.constructor=BoneEffector;BoneEffector.prototype.evaluate=function(){this.update();for(var e=0;e<this.bones.length;e++){this.updateBones(this.bones[e])}for(var e=0;e<this.bones.length;e++){this.evaluateBones(this.bones[e],e==0?true:false)}this.resultVertices.setValueDirect(this.resultVerticesArray);this.resultNormals.setValueDirect(this.resultNormalsArray)};BoneEffector.prototype.addBoneHierarchy=function(e){if(!e){return false}this.bones.push(e);if(this.verticesArray.length>0){this.calculateFalloffValues()}return true};BoneEffector.prototype.update=function(){if(this.updateVertices){this.updateVertices=false;this.verticesArray=this.vertices.getValueDirect();this.resultVerticesArray.length=this.verticesArray.length;this.calculateFalloffValues()}if(this.updateNormals){this.updateNormals=false;this.normalsArray=this.normals.getValueDirect();this.resultNormalsArray.length=this.normalsArray.length}};BoneEffector.prototype.calculateFalloffValues=function(){this.boneFalloffValuesMap=[];for(var e=0;e<this.bones.length;e++){this.updateBones(this.bones[e]);this.calculateBoneFalloffValues(this.bones[e])}this.sumFalloffValues()};BoneEffector.prototype.calculateBoneFalloffValues=function(e){if(!e||this.verticesArray.length==0){return}var t=e.calculateFalloffValues(this.verticesArray);this.boneFalloffValuesMap.push(new Pair(e,t));for(var n=0;n<e.getChildCount();n++){var r=e.getChild(n);if(!r){continue}this.calculateBoneFalloffValues(r)}};BoneEffector.prototype.sumFalloffValues=function(){if(this.verticesArray.length==0){return}var e=this.verticesArray.length/3;this.falloffSums.length=e;for(var t=0;t<e;t++)this.falloffSums[t]=0;for(var t=0;t<this.boneFalloffValuesMap.length;t++){var n=this.boneFalloffValuesMap[t].second;for(var r=0;r<e;r++){this.falloffSums[r]+=n[r]}}for(var t=0;t<this.boneFalloffValuesMap.length;t++){var n=this.boneFalloffValuesMap[t].second;for(var r=0;r<e;r++){if(this.falloffSums[r]!=0){n[r]/=this.falloffSums[r]}else{n[r]=0}}}};BoneEffector.prototype.updateBones=function(e){if(!e){return}e.update();for(var t=0;t<e.getChildCount();t++){var n=e.getChild(t);if(!n){continue}this.updateBones(n)}};BoneEffector.prototype.evaluateBones=function(e,t){if(!e){return}var n=null;for(var r=0;r<this.boneFalloffValuesMap.length;r++){if(this.boneFalloffValuesMap[r].first==e){n=this.boneFalloffValuesMap[r].second;break}}var i=e.boneMatrix;var s=this.verticesArray.length/3;for(var r=0,o=0;r<s;r++,o+=3){if(n[r]>0){var u=i.transform(this.verticesArray[o],this.verticesArray[o+1],this.verticesArray[o+2],1);if(t){this.resultVerticesArray[o]=u.x*n[r];this.resultVerticesArray[o+1]=u.y*n[r];this.resultVerticesArray[o+2]=u.z*n[r]}else{this.resultVerticesArray[o]+=u.x*n[r];this.resultVerticesArray[o+1]+=u.y*n[r];this.resultVerticesArray[o+2]+=u.z*n[r]}}else{this.resultVerticesArray[o]=this.verticesArray[o];this.resultVerticesArray[o+1]=this.verticesArray[o+1];this.resultVerticesArray[o+2]=this.verticesArray[o+2]}}var a=this.normalsArray.length/3;for(var r=0,o=0;r<a;r++,o+=3){if(n[r]>0){var u=i.transform(this.normalsArray[o],this.normalsArray[o+1],this.normalsArray[o+2],0);if(t){this.resultNormalsArray[o]=u.x*n[r];this.resultNormalsArray[o+1]=u.y*n[r];this.resultNormalsArray[o+2]=u.z*n[r]}else{this.resultNormalsArray[o]+=u.x*n[r];this.resultNormalsArray[o+1]+=u.y*n[r];this.resultNormalsArray[o+2]+=u.z*n[r]}}else{this.resultNormalsArray[o]=this.normalsArray[o];this.resultNormalsArray[o+1]=this.normalsArray[o+1];this.resultNormalsArray[o+2]=this.normalsArray[o+2]}}for(var r=0;r<e.getChildCount();r++){var f=e.getChild(r);if(!f){continue}this.evaluateBones(f)}};SnapConnector.prototype=new AttributeContainer;SnapConnector.prototype.constructor=SnapConnector;SocketConnector.prototype=new SnapConnector;SocketConnector.prototype.constructor=SocketConnector;PlugConnector.prototype=new SnapConnector;PlugConnector.prototype.constructor=PlugConnector;PlugConnector.prototype.collides=function(e,t,n){this.pin1.sphere.setTransform(t);e.slot1.sphere.setTransform(n);if(this.pin1.sphere.intersects(e.slot1.sphere)){return 1}this.pin2.sphere.setTransform(t);e.slot2.sphere.setTransform(n);if(this.pin2.sphere.intersects(e.slot2.sphere)){return 2}return 0};SocketConnectors.prototype=new AttributeVector;SocketConnectors.prototype.constructor=SocketConnectors;SocketConnectorAllocator.prototype=new Allocator;SocketConnectorAllocator.prototype.constructor=SocketConnectorAllocator;SocketConnectorAllocator.prototype.allocate=function(){return new SocketConnector};PlugConnectors.prototype=new AttributeVector;PlugConnectors.prototype.constructor=PlugConnectors;PlugConnectorAllocator.prototype=new Allocator;PlugConnectorAllocator.prototype.constructor=PlugConnectorAllocator;PlugConnectorAllocator.prototype.allocate=function(){return new PlugConnector};var eEventType={Unknown:-1,Render_First:0,RenderBegin:1,RenderEnd:2,Render_End:9,Mouse_First:100,MouseMove:101,MouseDown:102,MouseLeftDown:103,MouseMiddleDown:104,MouseRightDown:105,MouseAllDown:106,MouseBothDown:107,MouseWheelDown:108,MouseUp:109,MouseLeftUp:110,MouseRightUp:111,MouseMiddleUp:112,MouseWheelUp:113,MouseLeftClick:114,MouseMiddleClick:115,MouseRightClick:116,MouseLeftDblClick:117,MouseMiddleDblClick:118,MouseRightDblClick:119,MouseDrag:120,MouseWheelForward:121,MouseWheelBackward:122,MouseHover:123,MouseLeave:124,MouseOver:125,MouseOut:126,Mouse_Last:199,Key_First:200,KeyDown_First:201,KeyDown_Last:500,KeyUp_First:501,KeyUp_Last:798,Key_Last:799,Element_First:800,ElementSelected:801,ElementUnselected:802,ElementFocus:803,ElementBlur:804,Element_Last:899,UserDefined:2e3};var eEventNameMap={MButton1:eEventType.MouseLeftDown,"MButton1.Down":eEventType.MouseLeftDown,MButton2:eEventType.MouseMiddleDown,"MButton2.Down":eEventType.MouseMiddleDown,MButton3:eEventType.MouseRightDown,"MButton3.Down":eEventType.MouseRightDown,"MButton1+MButton2.Down":eEventType.MouseBothDown,"MButton2+MButton3.Down":eEventType.MouseBothDown,"MButton1+MButton3.Down":eEventType.MouseBothDown,"MButton1.Click":eEventType.MouseLeftClick,"MButton1.DoubleClick":eEventType.MouseLeftDblClick,"MButton1.Up":eEventType.MouseLeftUp,"MButton2.Click":eEventType.MouseMiddleClick,"MButton2.DoubleClick":eEventType.MouseMiddleDblClick,"MButton2.Up":eEventType.MouseMiddleUp,"MButton3.Click":eEventType.MouseRightClick,"MButton3.DoubleClick":eEventType.MouseRightDblClick,"MButton3.Up":eEventType.MouseRightUp,MWheel:eEventType.MouseWheelDown,"MWheel.Down":eEventType.MouseWheelDown,"MWheel.Click":eEventType.MouseWheelUp,"MWheel.Up":eEventType.MouseWheelUp,"Mouse.Move":eEventType.MouseMove,"Mouse.Hover":eEventType.MouseHover,"Mouse.Leave":eEventType.MouseLeave,"Mouse.Over":eEventType.MouseOver,"Mouse.Out":eEventType.MouseOut,"Element.Selected":eEventType.ElementSelected,"Element.Unselected":eEventType.ElementUnselected,"Element.Focus":eEventType.ElementFocus,"Element.Blur":eEventType.ElementBlur};var eKeyCodeMap={VK_BACK:8,VK_TAB:9,VK_ENTER:13,VK_SHIFT:16,VK_CONTROL:17,VK_ALT:18,VK_PAUSE:19,VK_CAPITAL:20,VK_ESCAPE:27,VK_PAGEUP:33,VK_PAGEDOWN:34,VK_END:35,VK_HOME:36,VK_LEFT:37,VK_UP:38,VK_RIGHT:39,VK_DOWN:40,VK_INSERT:45,VK_DELETE:46,VK_0:48,VK_1:49,VK_2:50,VK_3:51,VK_4:52,VK_5:53,VK_6:54,VK_7:55,VK_8:56,VK_9:57,VK_A:65,VK_B:66,VK_C:67,VK_D:68,VK_E:69,VK_F:70,VK_G:71,VK_H:72,VK_I:73,VK_J:74,VK_K:75,VK_L:76,VK_M:77,VK_N:78,VK_O:79,VK_P:80,VK_Q:81,VK_R:82,VK_S:83,VK_T:84,VK_U:85,VK_V:86,VK_W:87,VK_X:88,VK_Y:89,VK_Z:90,VK_COMMA:189,VK_PERIOD:190,VK_SLASH:191};Event.prototype=new AttributeContainer;Event.prototype.constructor=Event;Event.prototype.synchronize=function(e){this.type=e.type;this.time=e.time;this.userData=e.userData};InputEvent.prototype=new Event;InputEvent.prototype.constructor=InputEvent;InputEvent.prototype.synchronize=function(e){this.inputId=e.inputId;this.modifiers=e.modifiers;this.state=e.state;Event.prototype.synchronize.call(this,e)};var MOUSEEVENT_LEFT_BUTTON=1;var MOUSEEVENT_MIDDLE_BUTTON=2;var MOUSEEVENT_RIGHT_BUTTON=4;MouseEvent.prototype=new InputEvent;MouseEvent.prototype.constructor=MouseEvent;KeyboardEvent.prototype=new InputEvent;KeyboardEvent.prototype.constructor=KeyboardEvent;EventAdapter.prototype=new AttributeContainer;EventAdapter.prototype.constructor=EventAdapter;EventAdapter.prototype.createKeyboardEvent=function(e,t){var n=new Date;var r=eEventType.Unknown;var i=n.getTime();var s=e.keyCode;var o=0;var u=0;var t=t||e.type;switch(t){case"keydown":{r=eEventType.KeyDown_First+s}break;case"keypress":{r=eEventType.KeyDown_First+s-32}break;case"keyup":{r=eEventType.KeyUp_First+s}break}var a=new KeyboardEvent(r,i,s,o,u);return a};EventAdapter.prototype.createMouseEvent=function(e){var t=new Date;var n=eEventType.Unknown;var r=t.getTime();var i=0;var s=0;var o=0;var u=e.canvasX;var a=e.canvasY;switch(e.type){case"click":{switch(e.button){case 0:n=eEventType.MouseLeftClick;break;case 1:n=eEventType.MouseMiddleDown;break;case 2:n=eEventType.MouseRightClick;break}}break;case"dblclick":{switch(e.button){case 0:n=eEventType.MouseLeftDblClick;break;case 1:n=eEventType.MouseMiddleDblClick;break;case 2:n=eEventType.MouseRightDblClick;break}}break;case"mousedown":{switch(e.button){case 0:{if(this.mouseState.rightButtonDown){n=eEventType.MouseBothDown}else{n=eEventType.MouseLeftDown}this.mouseState.leftButtonDown=true}break;case 1:{n=eEventType.MouseMiddleDown;this.mouseState.middleButtonDown=true}break;case 2:{if(this.mouseState.leftButtonDown){n=eEventType.MouseBothDown}else{n=eEventType.MouseRightDown}this.mouseState.rightButtonDown=true}break}}break;case"mouseup":{switch(e.button){case 0:{n=eEventType.MouseLeftUp;this.mouseState.leftButtonDown=false}break;case 1:{n=eEventType.MouseMiddleUp;this.mouseState.middleButtonDown=false}break;case 2:{n=eEventType.MouseRightUp;this.mouseState.rightButtonDown=false}break}}break;case"mousemove":{n=eEventType.MouseMove}break;default:{n=eEventType.UserDefined}break}if(this.mouseState.leftButtonDown)i|=MOUSEEVENT_LEFT_BUTTON;if(this.mouseState.middleButtonDown)i|=MOUSEEVENT_MIDDLE_BUTTON;if(this.mouseState.rightButtonDown)i|=MOUSEEVENT_RIGHT_BUTTON;var f=new MouseEvent(n,r,i,s,o,u,a);return f};EventListener.prototype=new Agent;EventListener.prototype.constructor=EventListener;EventListener.prototype.addEventType=function(e){this.events.push(e);var t=this.event.getValueDirect().join("");var n=new StringAttr(t);n.flagDeserializedFromXML();this.events.push(n);this.registerAttribute(n,"event")};EventListener.prototype.getEventTypes=function(){return this.events};EventListener.prototype.eventPerformed=function(e){var t=this.numResponses.getValueDirect();if(t>0){this.numResponses.setValueDirect(t-1)}};EventListener.prototype.getTrigger=function(){this.trigger};EventListener.prototype.setTrigger=function(e){if(e){this.trigger=e}};EventMgr.prototype=new AttributeContainer;EventMgr.prototype.constructor=EventMgr;EventMgr.prototype.addListener=function(e,t){if(this.listeners[e]==undefined){this.listeners[e]=[]}if(this.listeners[e].indexOf(t)==-1){this.listeners[e].push(t)}};EventMgr.prototype.removeListener=function(e,t){if(this.listeners[e]){this.listeners[e].splice(this.listeners[e].indexOf(t),1)}};EventMgr.prototype.processEvent=function(e){var t=e.type;var n=[];if(this.listeners[t]){for(var r=0;r<this.listeners[t].length;r++){this.listeners[t][r].eventPerformed(e);var i=this.listeners[t][r].getAttribute("numResponses");if(i&&i.getValueDirect()==0){n.push(this.listeners[t][r])}}}for(var r=0;r<n.length;r++){this.removeListener(t,n[r]);this.registry.unregister(n[r])}};EventMgr.prototype.clearEvents=function(){this.listeners.length=0};DeviceHandler.prototype=new EventListener;DeviceHandler.prototype.constructor=DeviceHandler;DeviceHandler.prototype.eventPerformed=function(e){this.inputMessage.setValueDirect(e.type);this.inputId.setValueDirect(e.inputId);this.inputState.setValueDirect(e.state);this.inputModifier.setValueDirect(e.modifiers)};MouseHandler.prototype=new DeviceHandler;MouseHandler.prototype.constructor=MouseHandler;MouseHandler.prototype.eventPerformed=function(e){var t=e.x;var n=e.y;switch(e.type){case eEventType.MouseMove:{}break;default:{this.lastX=t;this.lastY=n}break}this.x.setValueDirect(t);this.y.setValueDirect(n);this.deltaX.setValueDirect(this.lastX-t);this.deltaY.setValueDirect(this.lastY-n);this.delta.setValueDirect(this.lastX-t,this.lastY-n);this.lastX=t;this.lastY=n;DeviceHandler.prototype.eventPerformed.call(this,e);this.deltaX.setValueDirect(0);this.deltaY.setValueDirect(0);this.delta.setValueDirect(0,0)};KeyboardHandler.prototype=new DeviceHandler;KeyboardHandler.prototype.constructor=KeyboardHandler;KeyboardHandler.prototype.eventPerformed=function(e){};Command.prototype=new EventListener;Command.prototype.constructor=Command;Command.prototype.finalize=function(){};Command.prototype.eventPerformed=function(e){if(this.listen.getValueDirect()==true){this.execute()}EventListener.prototype.eventPerformed.call(this,e)};Command.prototype.isBorrowed=function(e){for(var t=0;t<this.borrowedAttributes.length;t++){if(e==this.borrowedAttributes[t]){return true}}return false};Command.prototype.isBorrowedAndValueModified=function(e){if(this.isBorrowed(e)){for(var t=0;t<this.attributeValuePairs.length;t++){if(e==this.attributeValuePairs[t].first){return{borrowed:true,value:this.attributeValuePairs[t].second}}}}return{borrowed:false,value:null}};Command.prototype.isBorrowedAndReferenceModified=function(e){if(this.isBorrowed(e)){for(var t=0;t<this.attributeRefPairs.length;t++){if(e==this.attributeRefPairs[t].second){return{borrowed:true,reference:this.attributeRefPairs[t].first}}}}return{borrowed:false,reference:null}};SetCommand.prototype=new Command;SetCommand.prototype.constructor=SetCommand;SetCommand.prototype.execute=function(){this.applyAttributeValues()};SetCommand.prototype.applyAttributeValues=function(){for(var e=0;e<this.attributeValuePairs.length;e++){setAttributeValue(this.attributeValuePairs[e].first,this.attributeValuePairs[e].second)}};SetCommand.prototype.registerTargetAttributes=function(e,t){var n;var r;var i=e.getAttributeCount();for(var s=0;s<i;s++){var o=e.getAttributeAt(s);var u=e.getAttributeNameAt(s);if((r=this.getAttribute(u))!=null){sName=t+"_";sName+=u}else{sName=u}this.registerAttribute(o,sName);this.borrowedAttributes.push(o)}};var gConnectionHelpers=[];ConnectAttributesCommand.prototype=new Command;ConnectAttributesCommand.prototype.constructor=ConnectAttributesCommand;ConnectAttributesCommand.prototype.finalize=function(){for(var e=0;e<this.connections.length()-2;e++){var t=this.connections.getAt(e);if(t.sourceAttribute&&t.targetAttribute){var n=new StringAttr(t.sourceAttributeName);n.flagDeserializedFromXML();this.registerAttribute(n,"sourceAttribute");var r=new StringAttr(t.targetAttributeName);r.flagDeserializedFromXML();this.registerAttribute(r,"targetAttribute")}}Command.prototype.finalize.call(this)};ConnectAttributesCommand.prototype.eventPerformed=function(e){Command.prototype.eventPerformed.call(this,e)};ConnectAttributesCommand.prototype.execute=function(){var e=this.connections.top();var t=this.persist.getValueDirect();var n=null;if(e.sourceContainer&&e.sourceContainer.attrType>=eAttrType.Evaluator&&e.sourceContainer.attrType<=eAttrType.Evaluator_End){n=e.sourceContainer}if(this.negate.getValueDirect()==false){if(this.connectionHelper.first){this.connectionHelper.first(e.sourceContainer,e.targetContainer);if(!t&&this.connectionHelper.second){if(n)n.evalute();this.connectionHelper.second(e.sourceContainer,e.targetContainer)}}else{this.addOrRemoveTargets(true);if(!t){if(n)n.evalute();this.addOrRemoveTargets(false)}}}else{if(this.connectionHelper.second){var e=this.connections.top();this.connectionHelper.second(e.sourceContainer,e.targetContainer);if(n)n.evalute()}else{this.addOrRemoveTargets(false);if(n)n.evalute()}}};ConnectAttributesCommand.prototype.addOrRemoveTargets=function(e){for(var t=0;t<this.connections.length();t++){var n=this.connections.getAt(t);if(n.sourceAttribute&&n.targetAttribute){n.sourceAttribute.removeElementTarget(n.targetAttribute,n.sourceIndex,n.targetIndex);if(e){n.sourceAttribute.addElementTarget(n.targetAttribute,n.sourceIndex,n.targetIndex)}var r=n.sourceAttribute.getContainer();if(r){var i=r.getAttribute("screenPosition");if(i&&i==n.sourceAttribute){var s=r.getAttribute("autoDisplayList");if(s){s.setValueDirect(false)}var o=r.getAttribute("enableDisplayList");if(o){o.setValueDirect(false)}}}}}};AutoInterpolateCommand.prototype=new Command;AutoInterpolateCommand.prototype.constructor=AutoInterpolateCommand;AutoInterpolateCommand.prototype.execute=function(){this.buildMotion();if(this.kfi){this.kfi.getAttribute("time").setValueDirect(0);this.kfi.getAttribute("enabled").setValueDirect(true)}};AutoInterpolateCommand.prototype.buildMotion=function(){var e=this.registry.find("AttributeFactory");this.kfi=e.create("KeyframeInterpolator");if(!this.kfi){return}this.kfi.getAttribute("enabled").setValueDirect(false);this.kfi.getAttribute("renderAndRelease").copyValue(this.renderAndRelease);for(var t=0;t<this.attributeValuePairs.length;t++){this.numValueChannels+=this.attributeValuePairs[t].first.getLength()}for(var t=0;t<this.attributeRefPairs.length;t++){this.numReferenceChannels+=this.attributeRefPairs[t].first.getLength()}this.numChannels=this.numValueChannels+this.numReferenceChannels;this.kfi.setNumChannels(this.numChannels);var n=this.preBehavior.getValueDirect();var r=this.postBehavior.getValueDirect();for(var t=0;t<this.numChannels;t++){this.kfi.getAttribute("preBehaviors").getAt(t).setValueDirect(n);this.kfi.getAttribute("postBehaviors").getAt(t).setValueDirect(r)}this.applyAttributeValues();this.applyAttributeRefs()};AutoInterpolateCommand.prototype.applyAttributeValues=function(){var e,t,n;for(e=0,n=0;n<this.attributeValuePairs.length;n++){var r=this.attributeValuePairs[n].first;var i=this.attributeValuePairs[n].second;for(t=0;t<r.getLength();t++){var s=this.kfi.getAttribute("channels").getAt(e+t);var o=new KeyframeAttr;var u=new KeyframeAttr;o.getAttribute("time").setValueDirect(0);u.getAttribute("time").setValueDirect(this.duration.getValueDirect());o.getAttribute("shape").setValueDirect(this.shape.getValueDirect());u.getAttribute("shape").setValueDirect(this.shape.getValueDirect());var a=parseFloat(r.getElement(t));var f=parseFloat(r.getLength()>1?i[t]:i);if(this.isAttributeRotational(r)){var l=this.shortestPath(a,f);a=l.start;f=l.end}o.getAttribute("value").setValueDirect(a);u.getAttribute("value").setValueDirect(f);s.push_back(o);s.push_back(u);this.kfi.getAttribute("resultValues").getAt(e+t).addElementTarget(r,0,t)}e+=t}};AutoInterpolateCommand.prototype.applyAttributeRefs=function(){var e,t,n;for(e=0,n=0;n<this.attributeRefPairs.length;n++){var r=this.attributeRefPairs[n].first;var i=this.attributeRefPairs[n].second;for(t=0;t<i.getLength();t++){var s=this.kfi.getAttribute("channels").getAt(e+t);var o=new KeyframeAttr;var u=new KeyframeAttr;o.getAttribute("time").setValueDirect(0);u.getAttribute("time").setValueDirect(this.duration.getValueDirect());o.getAttribute("shape").setValueDirect(this.shape.getValueDirect());u.getAttribute("shape").setValueDirect(this.shape.getValueDirect());var a=parseFloat(i.getElement(t));var f=parseFloat(r.getElement(t));if(this.isAttributeRotational(i)){var l=this.shortestPath(a,f);a=l.start;f=l.end}o.getAttribute("value").setValueDirect(a);u.getAttribute("value").setValueDirect(f);s.push_back(o);s.push_back(u);this.kfi.getAttribute("resultValues").getAt(e+t).addElementTarget(i,0,t)}e+=t}};AutoInterpolateCommand.prototype.registerTargetAttributes=function(e,t){var n;var r;var i=e.getAttributeCount();for(var s=0;s<i;s++){var o=e.getAttributeAt(s);var u=e.getAttributeNameAt(s);if((r=this.getAttribute(u))!=null){sName=t+"_";sName+=u}else{sName=u}this.registerAttribute(o,sName);this.borrowedAttributes.push(o)}};AutoInterpolateCommand.prototype.isAttributeRotational=function(e){var t=e.getContainer();if(t){var n=t.getAttributeName(e);if(n){if(n=="rotation"||n=="angle"){return true}}}return false};AutoInterpolateCommand.prototype.shortestPath=function(e,t){var n=degreeNormalize(e);var r=degreeNormalize(t);var i=r-n;if(i<=180&&i>=-180){return{start:e,end:t}}var s=0;if(i>180){s=360-i}else{s=360+i}e=n;if(r>n){t=n-s}else{t=n+s}return{start:e,end:t}};MotionInterpolateCommand.prototype=new AutoInterpolateCommand;MotionInterpolateCommand.prototype.constructor=MotionInterpolateCommand;MotionInterpolateCommand.prototype.execute=function(){AutoInterpolateCommand.prototype.execute.call(this)};MotionInterpolateCommand.prototype.buildMotion=function(){var e=this.registry.find("AttributeFactory");this.kfi=e.create("KeyframeInterpolator");if(!this.kfi){return}this.kfi.getAttribute("enabled").setValueDirect(false);this.kfi.getAttribute("renderAndRelease").copyValue(this.renderAndRelease);this.numChannels=3;this.kfi.setNumChannels(this.numChannels);var t=this.preBehavior.getValueDirect();var n=this.postBehavior.getValueDirect();for(var r=0;r<this.numChannels;r++){this.kfi.getAttribute("preBehaviors").getAt(r).setValueDirect(t);this.kfi.getAttribute("postBehaviors").getAt(r).setValueDirect(n)}this.setKeyframes()};MotionInterpolateCommand.prototype.setKeyframes=function(){var e=this.startPosition.getValueDirect();var t=this.endPosition.getValueDirect();var n=distanceBetween(e,t);var r=new Vector3D;r.copy(this.positionControl.getValueDirect());r.normalize();var i=new Vector3D((e.x+t.x)/2+r.x*(n/2),(e.y+t.y)/2+r.y*(n/2),(e.z+t.z)/2+r.z*(n/2));this.midPosition.setValueDirect(i.x,i.y,i.z);var s=this.easeIn.getValueDirect();var o=this.easeOut.getValueDirect();var u=this.shape.getValueDirect();var a=this.duration.getValueDirect();for(var f=0;f<this.numChannels;f++){var l=this.kfi.getAttribute("channels").getAt(f);var c=new KeyframeAttr;var h=new KeyframeAttr;var p=new KeyframeAttr;c.getAttribute("time").setValueDirect(0);h.getAttribute("time").setValueDirect(a*.5);p.getAttribute("time").setValueDirect(a);c.getAttribute("shape").setValueDirect(u);h.getAttribute("shape").setValueDirect(u);p.getAttribute("shape").setValueDirect(u);c.getAttribute("value").setValueDirect(this.startPosition.getElement(f));h.getAttribute("value").setValueDirect(this.midPosition.getElement(f));p.getAttribute("value").setValueDirect(this.endPosition.getElement(f));l.push_back(c);l.push_back(h);l.push_back(p);this.kfi.getAttribute("resultValues").getAt(f).addElementTarget(this.resultPosition,0,f)}};LocateCommand.prototype=new Command;LocateCommand.prototype.constructor=LocateCommand;LocateCommand.prototype.execute=function(){if(this.targetNode){this.locate()}};LocateCommand.prototype.locate=function(){var e=this.registry.find("Selector");var t=this.registry.find("ViewportMgr");var n=e.getAttribute("clickPoint").getValueDirect();var r=t.getViewportAtScreenXY(n.x,n.y);var i=r.camera;var s=r.viewport;this.directive.execute(this.targetNode);var o=this.directive.getBounds();this.locator.getAttribute("bbox").setValueDirect(o.min,o.max);var u=r.camera.getTransform();u.invert();this.directive.getAttribute("viewTransform").setValueDirect(u);this.directive.getAttribute("viewSpace").setValueDirect(true);this.directive.execute(this.targetNode);o=this.directive.getBounds();this.locator.getAttribute("bboxView").setValueDirect(o.min,o.max);this.locator.getAttribute("viewport").setValueDirect(s.x,s.y,s.width,s.height);var a=this.locator.getAttribute("nearDistance");var f=this.locator.getAttribute("viewVolume");var l=this.locator.getAttribute("viewPosition");var c=this.locator.getAttribute("viewTransform");var h=this.locator.getAttribute("resultPosition");var p=this.locator.getAttribute("resultWidth");var d=this.locator.getAttribute("resultFarDistance");var v=this.locator.getAttribute("resultPivotDistance");var m=null;var g=this.updateClipPlanes.getValueDirect();var y=this.transition.getValueDirect();if(this.inspector){m=this.inspector.getAttribute("pivotDistance")}if(v&&m){v.addTarget(m)}cameraNear=i.getAttribute("nearDistance");cameraFar=i.getAttribute("farDistance");cameraWidth=i.getAttribute("width");cameraVolume=i.getAttribute("viewVolume");cameraPosition=i.getAttribute("sectorPosition");cameraWorldPosition=i.getAttribute("sectorWorldPosition");cameraWorldTransform=i.getAttribute("sectorWorldTransform");cameraNear.addTarget(a);cameraVolume.addTarget(f);cameraWorldPosition.addTarget(l);cameraWorldTransform.addTarget(c);if(y==false){h.addTarget(cameraPosition);p.addTarget(cameraWidth);if(g){d.addTarget(cameraFar)}this.locator.evaluate();h.removeTarget(cameraPosition);p.removeTarget(cameraWidth);d.removeTarget(cameraFar)}else{h.addTarget(this.resultPosition);p.addTarget(this.resultWidth);if(g){d.addTarget(this.resultFarDistance)}this.locator.evaluate();h.removeTarget(this.resultPosition);p.removeTarget(this.resultWidth);d.removeTarget(this.resultFarDistance);switch(this.shape.getValueDirect()){case eKeyframeShape.Stepped:case eKeyframeShape.TCB:case eKeyframeShape.Bezier1D:case eKeyframeShape.Bezier2D:{var b=this.registry.find("AttributeFactory");var w=b.create("MotionInterpolate");w.getAttribute("shape").copyValue(this.shape);w.getAttribute("easeIn").copyValue(this.easeIn);w.getAttribute("easeOut").copyValue(this.easeOut);w.getAttribute("startPosition").copyValue(cameraPosition);w.getAttribute("endPosition").copyValue(this.resultPosition);w.getAttribute("resultPosition").addTarget(cameraPosition,eAttrSetOp.Replace,null,false);var E=i.getDirectionVectors();w.getAttribute("positionControl").setValueDirect(-E.forward.x,-E.forward.y,-E.forward.z)}break;case eKeyframeShape.Linear:default:{var b=this.registry.find("AttributeFactory");var w=b.create("AutoInterpolate");w.attributeRefPairs.push(new Pair(this.resultPosition,cameraPosition))}break}if(g){if(cameraWidth)w.attributeRefPairs.push(new Pair(this.resultWidth,cameraWidth));if(cameraFar)w.attributeRefPairs.push(new Pair(this.resultFarDistance,cameraFar))}w.target=i;w.getAttribute("duration").copyValue(this.duration);w.execute();this.registry.unregister(w)}if(v&&m){v.removeTarget(m)}};PlayCommand.prototype=new Command;PlayCommand.prototype.constructor=PlayCommand;PlayCommand.prototype.execute=function(){var e=this.registry.find("RenderAgent");if(e){if(this.evaluators.length<1){if(this.negate.getValueDirect()==false){e.setEvaluatorsPlayState(ePlayState.Play)}else{e.setEvaluatorsPlayState(ePlayState.Pause)}}else{for(var t=0;t<this.evaluators.length;t++){if(this.negate.getValueDirect()==false){e.setEvaluatorPlayState(evaluators[t],ePlayState.Play)}else{e.setEvaluatorPlayState(evaluators[t],ePlayState.Pause)}}}}};RemoveCommand.prototype=new Command;RemoveCommand.prototype.constructor=RemoveCommand;RemoveCommand.prototype.execute=function(){if(this.targetAttribute){if(this.targetAttribute.isNode()){var e=0;var t=null;while(t=this.targetAttribute.getParent(e++)){t.removeChild(this.targetAttribute)}this.removeChildren(this.targetAttribute);this.targetAttribute.onRemove()}this.registry.unregister(this.targetAttribute);this.targetAttribute.destroy()}};RemoveCommand.prototype.removeChildren=function(e){var t=null;while(t=e.getChild(0)){this.removeChildren(t);this.registry.unregister(t);e.removeChild(t)}};StopCommand.prototype=new Command;StopCommand.prototype.constructor=StopCommand;StopCommand.prototype.execute=function(){var e=this.registry.find("RenderAgent");if(e){if(this.evaluators.length<1){e.setEvaluatorsPlayState(ePlayState.Stop)}else{for(var t=0;t<this.evaluators.length;t++){e.setEvaluatorPlayState(evaluators[t],ePlayState.Stop)}}}};CommandSequence.prototype=new Command;CommandSequence.prototype.constructor=CommandSequence;CommandSequence.prototype.execute=function(){for(var e=0;e<this.sequence.length;e++){this.sequence[e].execute()}};CommandSequence.prototype.addCommand=function(e){this.sequence.push(e);var t=this.sequence.length-1;var n="Command("+t.toString()+")";this.registerAttribute(e,n)};CommandMgr.prototype=new AttributeContainer;CommandMgr.prototype.constructor=CommandMgr;CommandMgr.prototype.pushCommandSequence=function(e){this.commandSeqStack.push(e)};CommandMgr.prototype.popCommandSequence=function(){this.commandSeqStack.pop()};CommandMgr.prototype.clearCommandSequenceStack=function(){this.commandSeqStack.clear()};CommandMgr.prototype.addCommand=function(e){setAttributeBin(null);setAttributePairs(null);if(this.commandSeqStack.length()>0){this.commandSeqStack.top().addCommand(e);this.registry.unregister(e);return}var t=e.getEventTypes();var n=e.getAttribute("trigger");if(t.length>0){var r=this.registry.find("EventMgr");if(r){for(var i=0;i<t.length;i++){r.addListener(t[i],e)}}}else if(n.getLength()>0){n.addModifiedCB(CommandMgr_CommandTriggerModifiedCB,this);this.createCommandTrigger(e,n)}else{e.execute();this.registry.unregister(e)}};CommandMgr.prototype.createCommandTrigger=function(e,t){var n=0;var r=0;var i=0;var s=0;var o="";o=t.getValueDirect().join("");n=o.lastIndexOf("/");if(n!=-1){var u=o.substring(0,n);var a=bridgeworks.registry.find(u);if(a){var f=false;var l="";var c="";var h="";var p="";r=o.lastIndexOf("!");if(r>0){o.replace("!","");f=true}r=o.lastIndexOf("=");if(r>0){s=o.lastIndexOf("[");if(s>0){var d=o.lastIndexOf("]",s);c=o.substring(s+1,d-s-1)}var v=FLT_MAX;var i=o.lastIndexOf(",");if(i>0){var p=o.substring(i+1,t.length()-i-1);v=p.parseFloat()}i=i==-1?o.length:i;h=o.substring(r+1,r+(i-r))}else{s=o.lastIndexOf("[");if(s>0){var d=o.lastIndexOf("]",s);c=o.substring(s+1,d-s-1)}}r=s==-1?r==-1?o.length():r:s;l=o.substring(n+1,r);var m=a.getAttribute(l);var g=this.createAttribute(m,h);if(g){var y=-1;if(c!=""){y=parseInt(c)}var b=e.numResponses;var w=new AttributeTrigger(m,g,e,y,f,b);e.setTrigger(w)}o=u+"/"+l;console.debug(t);console.debug("\n")}}};CommandMgr.prototype.createAttribute=function(e,t){var n=null;if(e){var r=e.attrType;var i=e.getLength();n=new NumberAttr;n.setValueDirect(parseFloat(t))}return n};AttributeTrigger.prototype=new Command;AttributeTrigger.prototype.constructor=AttributeTrigger;AttributeTrigger.prototype.execute=function(){if(this.target){var e=this.trigger.attrType;switch(e){case eAttrType.StringAttr:{var t=[];var n=[];this.input.getValue(t);this.trigger.getValue(n);var r=t[0]==n[0]?true:false;r=this.not?!r:r;if(r){var i=this.executionCount.getValueDirect()-1;this.executionCount.setValueDirect(i)}if(this.executionCount==0){this.target=null}}break;default:{var t=[];var n=[];this.input.getValue(t);this.trigger.getValue(n);if(this.item!=-1){var r=t[this.item]==n[0]||this.lastValues[this.item]>t[this.item]&&t[this.item]<n[0]||this.lastValues[this.item]<t[this.item]&&t[this.item]>n[0];r=this.not?!r:r;if(r){this.target.execute();var i=this.executionCount.getValueDirect()-1;this.executionCount.setValueDirect(i)}}else{var s=this.input.getLength();var o=0;for(var u=0;u<s;++u){var r=t[u]==n[u]||this.lastValues[u]>t[u]&&t[u]<n[u]||this.lastValues[u]<t[u]&&t[u]>n[u];r=this.not?!r:r;if(r){++o}}if(o=s){err=this.target.execute();this.executionCount.setValueDirect(--this.executionCount)}}if(this.executionCount.getValueDirect()==0){this.target=null;this.input.removeModifiedCB(AttributeTrigger_InputModifiedCB,this)}else{this.lastValues=t}}break}}return};BwRegistry.prototype=new AttributeRegistry;BwRegistry.prototype.constructor=BwRegistry;BwRegistry.prototype.find=function(e){if(!e)return null;var t=[];var n=0;while((n=e.indexOf("/"))>-1){t.push(e.substring(0,n));e=e.substring(n+1,e.length)}t.push(e);var r=this.getByName(t[0]);if(r)r=r[0];for(var i=1;i<t.length&&r;i++){r=r.getAttribute(t[i])}return r};BwRegistry.prototype.findContext=function(e,t){};BwRegistry.prototype.registerResource=function(e){if(e.isNode()&&e.getAttribute("orphan").getValueDirect()==false){this.updateTree(e)}};BwRegistry.prototype.finalizeResource=function(e){if(e.isNode()&&e.getParentCount()>0){this.subtreePtr.setValueDirect(e.getParent(0))}};BwRegistry.prototype.register=function(e){AttributeRegistry.prototype.register.call(this,e)};BwRegistry.prototype.unregister=function(e){AttributeRegistry.prototype.unregister.call(this,e)};BwRegistry.prototype.clear=function(){this.rootPtr.setValueDirect(null);this.subtreePtr.setValueDirect(null);this.sgPointer.setValueDirect(null);AttributeRegistry.prototype.clear.call(this)};BwRegistry.prototype.updateTree=function(e){var t=this.rootPtr.getValueDirect();var n=this.subtreePtr.getValueDirect();if(t==null){t=n=e}else{if(n){n.addChild(e)}else{t.addChild(e)}n=e}this.rootPtr.setValueDirect(t);this.subtreePtr.setValueDirect(n)};BwRegistry.prototype.updateMaxAnimationTime=function(){};BwRegistry.prototype.formatContext=function(e,t){};BwRegistry.prototype.sgPointerModified=function(){var e=this.find(this.sgPointer.getValueDirect().join(""));if(e){this.subtreePtr.setValueDirect(e)}};BwSceneInspector.prototype=new SceneInspector;BwSceneInspector.prototype.constructor=BwSceneInspector;BwSceneInspector.prototype.evaluate=function(){SceneInspector.prototype.evaluate.call(this)};BwSceneInspector.prototype.translate=function(e){if(e.x==0&&e.y==0&&e.z==0){return}var t=this.translationSensitivity.getValueDirect();e.x*=t.x;e.y*=t.y;e.z*=t.z;var n=[e.x,e.y,e.z];var r=new AttributeSetParams(-1,-1,0,true,false);this.translationDelta.setValue(n,r);this.evaluate();var i=[0,0,0];this.translationDelta.setValue(i,r);this.invertedTranslationDelta.setValue(i,r)};BwSceneInspector.prototype.pan=function(e){if(e.x==0&&e.y==0&&e.z==0){return}if(this.worldUnitsPerPixel.x==0&&this.worldUnitsPerPixel.y==0){var t=this.getWorldUnitsPerPixel(this.pivotDistance.getValueDirect());this.worldUnitsPerPixel.x=t.x;this.worldUnitsPerPixel.y=t.y}var n=this.panSensitivity.getValueDirect();e.x*=n.x*this.worldUnitsPerPixel.x;e.y*=n.y*this.worldUnitsPerPixel.y;e.z*=n.z*this.worldUnitsPerPixel.y;var r=[e.x,e.y,e.z];var i=new AttributeSetParams(-1,-1,0,true,false);this.panDelta.setValue(r,i);if(e.z!=0){var s=this.pivotDistance.getValueDirect();s-=e.z;this.pivotDistance.setValueDirect(s)}this.evaluate();var o=[0,0,0];this.panDelta.setValue(o,i);this.invertedPanDelta.setValue(o,i)};BwSceneInspector.prototype.track=function(e){if(e.x==0&&e.y==0&&e.z==0){return}if(this.camera==null||this.camera.attrType==eAttrType.OrthographicCamera){return}if(this.viewport.width<=0||this.viewport.height<=0){return}if(this.worldUnitsPerPixel.x==0&&this.worldUnitsPerPixel.y==0){var t=this.getWorldUnitsPerPixel(this.pivotDistance.getValueDirect());this.worldUnitsPerPixel.x=t.x;this.worldUnitsPerPixel.y=t.y}var n=this.trackSensitivity.getValueDirect();e.x*=n.x*this.worldUnitsPerPixel.x;e.y*=n.y*this.worldUnitsPerPixel.y;if(e.z!=0){var r=this.camera.getAttribute("position").getValueDirect();var i=this.camera.getAttribute("rotation").getValueDirect();var s=r.y-this.clickPosWorld.y;var o=distanceBetween(r,this.clickPosWorld);var u=Math.sqrt(o*o-s*s);var a=this.camera.getAttribute("zoom").getValueDirect();var f=2*Math.atan2(1,a);var l=f/this.viewport.height;var c=Math.acos(s/o);var h=c+e.z*l;var p=Math.tan(h)*s;var d=p-u;if(c>=toRadians(88)&&c<=toRadians(92)){if(d<0){d=-Math.abs(this.last_d3)}else{d=Math.abs(this.last_d3)}}var m=i;var g=Math.abs(i.z);var y=false;if(g>=90&&g<=270){if(i.x>-45&&i.x<45){y=true}}if(y){d=-d}this.last_d3=d;e.z=d*n.z*(s<0?-1:1);var b=this.camera.getDirectionVectors();v=new Vector3D(b.forward.x,b.forward.y,b.forward.z);v.y=0;v.normalize();var w=subtract3D(this.clickPosWorld,r);w.y=0;w.normalize();var E=cosineAngleBetween(w,v);var S=Math.acos(E);var x=2*Math.atan(this.viewport.width/this.viewport.height*Math.tan(f/2));var T=x/this.viewport.width;var N;var C=this.registry.find("Selector");if(C){N=C.getAttribute("clickPoint").getValueDirect()}var k=Math.abs(this.viewport.width/2-N.x)*T;S=k;var L=Math.tan(S)*d;var A=new Plane(r,b.right);if(pointOnNegativeSideOfPlane(this.clickPosWorld,A)){L*=-1}if(y){L*=-1}e.x+=-L}var O=[e.x,e.y,e.z];var M=new AttributeSetParams(-1,-1,0,true,false);this.trackDelta.setValue(O,M);this.evaluate();var _=[0,0,0];this.trackDelta.setValue(_,M);this.invertedTrackDelta.setValue(_,M)};BwSceneInspector.prototype.rotate=function(e){if(e.x==0&&e.y==0&&e.z==0){return}var t=this.rotationSensitivity.getValueDirect();e.x*=t.x;e.y*=t.y;e.z*=t.z;var n=[e.x,e.y,e.z];var r=new AttributeSetParams(-1,-1,0,true,false);this.rotationDelta.setValue(n,r);this.evaluate();var i=[0,0,0];this.rotationDelta.setValue(i,r);this.invertedRotationDelta.setValue(i,r)};BwSceneInspector.prototype.zoom=function(e){if(e==0){return}if(!this.camera){return}switch(this.camera.className){case"PerspectiveCamera":{var t=this.camera.getAttribute("zoom").getValueDirect();t+=e*this.zoomSensitivity.getValueDirect();if(t<0)t=.05;this.camera.getAttribute("zoom").setValueDirect(t)}break;case"OrthographicCamera":{var n=this.camera.getAttribute("width").getValueDirect();n+=e*this.zoomSensitivity.getValueDirect();if(n<0)n=0;this.camera.getAttribute("width").setValueDirect(n)}break}};BwSceneInspector.prototype.getWorldUnitsPerPixel=function(e){var t=0;var n=0;var r=this.registry.find("Selector");if(r){var i=r.selections.viewports[r.selections.viewports.length-1];if(this.camera){switch(this.camera.attrType){case eAttrType.PerspectiveCamera:{var s=this.camera.getAttribute("zoom").getValueDirect();var o=worldUnitsPerPixelPersp(i,s,e);t=o.x;n=o.y}break;case eAttrType.OrthographicCamera:{var u=this.camera.getAttribute("width").getValueDirect();var o=worldUnitsPerPixelOrtho(i,u);t=o.x;n=o.y}break}}}return{x:t,y:n}};ObjectInspector.prototype=new ArcballInspector;ObjectInspector.prototype.constructor=ObjectInspector;ObjectInspector.prototype.applyCameraRelativeRotation=function(e){var t;var n=null;var r=null;var i=null;var s=null;var o=null;var u=this.viewport;var a=this.camera;n=e.worldCenter.getValueDirect();i=a.getTransform();i.invert();projection=a.projectionMatrix;r=toScreenSpace(n,i,projection,u);this.sphereCenter.setValueDirect(r.x,r.y,0);this.sphereRadius.setValueDirect(.75);o=e.getTransform();this.worldTransform.setValueDirect(o);i=a.getTransform();this.viewTransform.setValueDirect(i)};ObjectInspector.prototype.applyCameraRelativeTranslation=function(e){var t=this.camera;var n=this.translationDelta.getValueDirect();if(n.x==0&&n.y==0&&n.z==0){return}var r=t.getSectorTransform();r.invert();var i=e.sectorWorldCenter.getValueDirect();var s=t.sectorWorldPosition.getValueDirect();var o=new Vector3D(i.x-s.x,i.y-s.y,i.z-s.z);o.normalize();var u=this.viewport;var a=this.pointView.getValueDirect();var f=new Vector3D(a.x,a.y,a.z);var l=null;var c=new Vector3D(1,0,0);var h=new Vector3D(0,1,0);var p=new Vector3D(o.x,o.y,o.z);var d=new Vector3D(a.x,a.y,a.z);var v=e.motionParent;var m=null;if(v){m=v.getTransform();m.invert()}var g=-1;var y=-1;switch(t.attrType){case eAttrType.PerspectiveCamera:{y=t.zoom.getValueDirect();g=worldUnitsPerPixelPersp(u,y,f.z)}break;case eAttrType.OrthographicCamera:{y=t.width.getValueDirect();g=worldUnitsPerPixelOrtho(u,y)}break;default:break}c.multiplyScalar(g.x);c.multiplyScalar(-n.x);h.multiplyScalar(g.y);h.multiplyScalar(n.y);p.multiplyScalar(g.y);p.multiplyScalar(n.z);d.addVector(c);d.addVector(h);r.invert();if(m){r=r.multiply(m);p=m.transform(p.x,p.y,p.z,0)}f=r.transform(f.x,f.y,f.z,1);d=r.transform(d.x,d.y,d.z,1);l=new Vector3D(d.x,d.y,d.z);l.subtractVector(f);l.addVector(p);var b=new AttributeSetParams(-1,-1,eAttrSetOp.Add,true,true);var w=[l.x,l.y,l.z];e.sectorPosition.setValue(w,b);var E=e.sectorPosition.getValueDirect();console.debug("selected.sectorPosition: "+E.x+", "+E.y+", "+E.z)};ObjectInspector.prototype.translationDeltaModified=function(){var e=null;for(var t=0;t<this.selectedObjects.length;t++){e=this.selectedObjects[t];if(!e){continue}var n=e.getAttribute("moveable").getValueDirect();if(!n){continue}this.applyCameraRelativeTranslation(e)}var r=[0,0,0];var i=new AttributeSetParams(0,0,0,true,false);this.translationDelta.setValue(r,i)};ObjectInspector.prototype.rotationDeltaModified=function(){var e=null;for(var t=0;t<this.selectedObjects.length;t++){e=this.selectedObjects[t];if(!e){continue}var n=e.moveable.getValueDirect();if(!n){continue}this.applyCameraRelativeRotation(e);var r=this.mouseNow.getValueDirect();var i=this.rotationDelta.getValueDirect();r.x-=i.x;r.y-=i.y;this.mouseNow.setValueDirect(r.y,r.x);this.evaluate()}};ObjectInspector.prototype.rotationNowModified=function(){if(this.selectedObjects==null||this.selectedObjects==undefined)return;var e=null;for(var t=0;t<this.selectedObjects.length;t++){e=this.selectedObjects[t];var n=e.moveable.getValueDirect();if(n){this.applyCameraRelativeRotation(e);var r=this.rotationNow.getValueDirect();this.mouseNow.setValueDirect(r.y,r.x);this.evaluate()}}};ObjectInspector.prototype.runSelectionOccurred=function(){var e=this.registry.find("Selector");var t=this.registry.find("ViewportMgr");if(!e||!t){return}var n=e.getAttribute("clickPoint").getValueDirect();var r=t.getViewportAtScreenXY(n.x,n.y);this.viewport=r.viewport;this.camera=r.camera;this.selectedObjects=e.selections.models.slice();var i=this.resultQuat;var s=this.quatAtMouseDown;var o=this.mouseDown;var u=this.mouseNow;var a=null;var f=null;var l=null;var c=null;var h=null;var p=null;var d=null;var v=null;var m=null;var g=0;var y=0;for(var b=0;b<this.selectedObjects.length;b++){i.removeAllTargets();o.setValueDirect(n.x,n.y);u.setValueDirect(n.x,n.y);for(var w=0;w<this.selectedObjects.length;w++){a=this.selectedObjects[w];c=getInspectionGroup(a);if(c&&(h=c.getChild(2))){var E=[true];var S=new AttributeSetParams(-1,-1,eAttrSetOp.Replace,true,true);h.enabled.setValue(E,S);v=h.rotationQuat;i.addTarget(v);var x=v.getValueDirect();s.setValueDirect(x);var T=a.bbox;var N=T.min.getValueDirect();var C=T.max.getValueDirect();g=new Vector3D(N.x,N.y,N.z);g.addVector(C);g.multiplyScalar(.5);var k=a.pivot.getValueDirect();if(a.pivotAboutGeometricCenter.getValueDirect()){k=g}var L=new Vector3D(k.x,k.y,k.z);L.multiplyScalar(-1);E=[k.x,k.y,k.z];c.getChild(0).translation.setValue(E,S);var A=a.worldScale.getValueDirect();var O=new Vector3D(1/A.x,1/A.y,1/A.z);E[0]=O.x;E[1]=O.y;E[2]=O.z;c.getChild(1).scale.setValue(E,S);E[0]=A.x;E[1]=A.y;E[2]=A.z;c.getChild(3).scale.setValue(E,S);E[0]=L.x;E[1]=L.y;E[2]=L.z;c.getChild(4).translation.setValue(E,S)}}}};ObjectInspector.prototype.runSelectionCleared=function(){this.selectedObjects=[]};ConnectionMgr.prototype=new AttributeContainer;ConnectionMgr.prototype.constructor=ConnectionMgr;ConnectionMgr.prototype.connectSceneInspection=function(e,t){if(!e||!t)return;var n=e.getCamera();if(n==t){return}else if(n){this.disconnectSceneInspection(e,n)}t.getAttribute("sectorPosition").addTarget(e.getAttribute("viewPosition"),eAttrSetOp.Replace,null,true);t.getAttribute("rotation").addTarget(e.getAttribute("viewRotation"),eAttrSetOp.Replace,null,true);e.getAttribute("resultPosition").addTarget(t.getAttribute("sectorPosition"),eAttrSetOp.Replace,null,false);e.getAttribute("resultRotation").addTarget(t.getAttribute("rotation"),eAttrSetOp.Replace,null,false);e.setCamera(t)};ConnectionMgr.prototype.disconnectAllTargets=function(e,t){if(e){var n=e.getAttributeCount();for(var r=0;r<n;r++){var i=e.getAttributeAt(r);if(i){i.removeAllTargets()}}}};ConnectionMgr.prototype.disconnectSceneInspection=function(e,t){if(!e||!t)return;t.getAttribute("sectorPosition").removeTarget(e.getAttribute("viewPosition"));t.getAttribute("rotation").removeTarget(e.getAttribute("viewRotation"));e.getAttribute("resultPosition").removeTarget(t.getAttribute("sectorPosition"));e.getAttribute("resultRotation").removeTarget(t.getAttribute("rotation"));e.setCamera(null)};ConnectionMgr.prototype.connectMapProjectionCalculator=function(e,t){if(!e||!t)return;e.getAttribute("resultPosition").addTarget(t.getAttribute("position"));e.evaluate()};ConnectionMgr.prototype.disconnectMapProjectionCalculator=function(e,t){if(!e||!t)return;e.getAttribute("resultPosition").removeTarget(t.getAttribute("position"))};ConnectionMgr.prototype.connectDissolve=function(e,t){if(!e||!t)return;var n=t.getAttribute("dissolve");if(n){var r=e.getAttribute("resultValues");if(r){var i=r.getAt(0);if(i){i.addTarget(n)}}}};ConnectionMgr.prototype.disconnectDissolve=function(e,t){if(!e||!t)return;var n=t.getAttribute("dissolve");if(n){var r=e.getAttribute("resultValues");if(r){var i=r.getAt(0);if(i){i.removeTarget(n)}}}};ConnectionMgr.prototype.connectWalkSimulation=function(e,t){ConnectionMgr.prototype.connectSceneInspection.call(null,e,t)};ConnectionMgr.prototype.disconnectWalkSimulation=function(e,t){ConnectionMgr.prototype.disconnectSceneInspection.call(null,e,t)};ConnectionMgr.prototype.connectModelsToMorph=function(e,t,n){if(!e||!t)return;var r=this.registry.find("AttributeFactory");var i=t.getAttribute("vertices").getValueDirect();for(var s=0;s<e.geometry.length;s++){var o=e.geometryIndices[s];if(!o)continue;var u=r.create("MorphEffector");u.getAttribute("renderAndRelease").setValueDirect(true);u.getAttribute("morphIncr").setValueDirect(n);var a=e.geometry[s].getAttribute("vertices").getValueDirect();u.getAttribute("sourceVertices").setValueDirect(a);var f=[];for(var l=0;l<o.length;l++){var c=o[l];if(c*3+2<i.length){f.push(i[c*3]);f.push(i[c*3+1]);f.push(i[c*3+2])}else{f.push(a[l*3]);f.push(a[l*3+1]);f.push(a[l*3+2])}}u.getAttribute("targetVertices").setValueDirect(f);u.getAttribute("resultVertices").addTarget(e.geometry[s].getAttribute("vertices"))}};RenderAgent.prototype=new Agent;RenderAgent.prototype.constructor=RenderAgent;var ePlayState={Unknown:-1,Play:0,Pause:1,Stop:2};RenderAgent.prototype.render=function(){this.timer.stop();var e=this.timer.getTime();this.timer.start();this.timeIncrement.setValueDirect(e);var t=this.elapsedTimeInSecs.getValueDirect()+e;this.elapsedTimeInSecs.setValueDirect(t);this.frameRate.setValueDirect(1/e);this.animateEvaluators(e);this.executeRenderDirectives()};RenderAgent.prototype.animateEvaluators=function(e){var t=this.registry.getByType(eAttrType.Evaluator);for(var n=0;n<t.length;n++){this.animateEvaluator(t[n],e)}};RenderAgent.prototype.animateEvaluator=function(e,t){var n=e.getAttribute("enabled").getValueDirect();var r=e.getAttribute("expired").getValueDirect();var i=e.getAttribute("orphan").getValueDirect();if(n&&!r){switch(e.className){case"KeyframeInterpolator":{var s=new AttributeSetParams(-1,-1,eAttrSetOp.Add,true,true);e.getAttribute("time").setValue(t,s)}break;case"ObjectMover":case"AnimalMover":{e.getAttribute("timeIncrement").setValueDirect(t)}}if(!i)e.evaluate()}if(r&&e.getAttribute("renderAndRelease").getValueDirect()){this.registry.unregister(e)}};RenderAgent.prototype.executeRenderDirectives=function(){var e=this.registry.getByType(eAttrType.RenderDirective);if(e){this.bridgeworks.viewportMgr.layoutDirectives(e);for(var t=0;t<e.length;t++){e[t].getAttribute("timeIncrement").setValueDirect(this.timeIncrement.getValueDirect());e[t].execute()}}};RenderAgent.prototype.globalTimeInSecsModified=function(){var e=this.globalTimeInSecs.getValueDirect();this.elapsedTimeInSecs.setValueDirect(e);if(this.registry){var t=this.registry.getByType(eAttrType.Evaluator);if(t){for(var n=0;n<t.length;n++){var r=t[n];if(r){var i=r.getAttribute("time");if(i){var s=r.getAttribute("globalTimeSyncEnabled");if(s&&s.getValueDirect()||!s){i.setValueDirect(e)}}r.evaluate()}}}var o=this.registry.getByType(eAttrType.Model);if(o){for(var n=0;n<o.length;n++){setInspectionGroupActivationState(o[n],false)}}}};RenderAgent.prototype.setEvaluatorPlayState=function(e,t){if(!e){return this.setEvaluatorPlayState(t)}var n=e.getAttribute("enabled");switch(t){case ePlayState.Play:{n.setValueDirect(true)}break;case ePlayState.Pause:{n.setValueDirect(false)}break;case ePlayState.Stop:{n.setValueDirect(false);switch(e.className){case"KeyframeInterpolator":{e.getAttribute("time").setValueDirect(0);e.evaluate()}}}break}clearObjectPositionMap()};RenderAgent.prototype.setEvaluatorsPlayState=function(e){if(this.registry){var t=this.registry.getByType(eAttrType.Evaluator);if(t){for(i=0;i<t.length;i++){var n=t[i];var r=n.attrType;var s=n.getAttribute("orphan").getValueDirect();if(!s){this.setEvaluatorPlayState(n,e)}}}}};RenderAgent.prototype.setDesiredFrameRate=function(e){this.desiredFrameRate.setValueDirect(e)};var FRAME_RATE_DEFAULT=30;var FRAME_RATE_MAX=FRAME_RATE_DEFAULT*32;var FRAME_RATE_MIN=FRAME_RATE_DEFAULT*-32;RenderController.prototype=new AttributeContainer;RenderController.prototype.constructor=RenderController;RenderController.prototype.fastForward=function(){this.play();var e=this.renderAgent.frameRate.getValueDirect();if(e<0){this.renderAgent.desiredFrameRate.setValueDirect(FRAME_RATE_DEFAULT)}if(e<FRAME_RATE_MAX){this.renderAgent.desiredFrameRate.setValueDirect(Math.abs(this.renderAgent.frameRate)*2)}else{this.renderAgent.desiredFrameRate.setValueDirect(FRAME_RATE_MAX)}};RenderController.prototype.pause=function(){this.renderAgent.desiredFrameRate.setValueDirect(FRAME_RATE_DEFAULT);this.renderAgent.setEvaluatorsPlayState(ePlayState.Pause)};RenderController.prototype.play=function(){this.renderAgent.desiredFrameRate.setValueDirect(FRAME_RATE_DEFAULT);this.renderAgent.setEvaluatorsPlayState(ePlayState.Play)};RenderController.prototype.rewind=function(){this.play();var e=this.renderAgent.frameRate.getValueDirect();if(e>0){this.renderAgent.desiredFrameRate.setValueDirect(FRAME_RATE_DEFAULT)}if(e>FRAME_RATE_MIN){this.renderAgent.desiredFrameRate.setValueDirect(Math.abs(this.renderAgent.frameRate)*-2)}else{this.renderAgent.desiredFrameRate.setValueDirect(FRAME_RATE_MIN)}};RenderController.prototype.stop=function(){this.renderAgent.setEvaluatorsPlayState(ePlayState.Stop);this.renderAgent.desiredFrameRate.setValueDirect(1)};SelectionListener.prototype=new EventListener;SelectionListener.prototype.constructor=SelectionListener;SelectionListener.prototype.setRayPick=function(e){this.rayPick=e;var t=this.rayPick.getAttribute("clickPoint");this.registerAttribute(t,"clickPoint");t.addModifiedCB(SelectionListener_ClickPointModifiedCB,this)};SelectionListener.prototype.eventPerformed=function(e){switch(e.type){case eEventType.MouseMove:{if(e.inputId&MOUSEEVENT_LEFT_BUTTON||e.inputId&MOUSEEVENT_MIDDLE_BUTTON||e.inputId&MOUSEEVENT_RIGHT_BUTTON)return}break}this.clearSelections();this.getAttribute("clickPoint").setValueDirect(e.x,e.y)};SelectionListener.prototype.registerSelection=function(e,t){if(this.selected)return;this.selected=e;var n=this.selected.getContainer();this.registerAttribute(this.selected,"Selected");this.selected.setContainer(n);var r=e.getAttribute("name").getValueDirect().join("");this.selectedName.setValueDirect(r);if(t>=0){this.selectedElement.setValueDirect(t);this.selected.registerAttribute(this.selectedElement,"selectedElement")}};SelectionListener.prototype.clearSelections=function(){this.selections.clear();this.selectedElement.setValueDirect(-1);if(this.selected){if(this.selected.getAttribute("selectedElement")){this.selected.unregisterAttribute(this.selectedElement)}this.selectedName.setValueDirect("");this.unregisterAttribute(this.selected);this.selected=null}this.selectionCleared.pulse()};SelectionListener.prototype.processPick=function(e){for(var t=0;t<e.path.length;t++){var n=e.path[t];var r=n.getAttribute("selectable");var i=n.getAttribute("show");var s=n.getAttribute("flipPolygons");if(r&&r.getValueDirect()==false||i&&i.getValueDirect()==false||s&&s.getValueDirect()==true){continue}var o=-1;switch(n.attrType){case eAttrType.PerspectiveCamera:case eAttrType.OrthographicCamera:{this.selections.cameras.push(n)}break;case eAttrType.DirectionalLight:case eAttrType.PointLight:case eAttrType.SpotLight:{this.selections.lights.push(n)}break;case eAttrType.Model:{this.selections.models.push(n);this.registerSelection(n,o)}break;case eAttrType.Surface:{this.selections.surfaces.push(n)}break;case eAttrType.Label:{this.selections.labels.push(n);this.registerRasterComponentSelection(n,o)}}}if(this.selected){this.pointObject.setValueDirect(e.intersectRecord.pointModel.x,e.intersectRecord.pointModel.y,e.intersectRecord.pointModel.z);this.pointWorld.setValueDirect(e.intersectRecord.pointWorld.x,e.intersectRecord.pointWorld.y,e.intersectRecord.pointWorld.z);this.pointView.setValueDirect(e.intersectRecord.pointView.x,e.intersectRecord.pointView.y,e.intersectRecord.pointView.z);this.triIndex.setValueDirect(e.intersectRecord.triIndex);this.distance.setValueDirect(e.intersectRecord.distance)}return this.selected?true:false};SelectionListener.prototype.processPicks=function(e){for(var t=0;t<e.length;t++){if(this.processPick(e[t])==true){return true}}return false};SelectionListener.prototype.registerRasterComponentSelection=function(e,t){if(this.selected){var n=this.selected;if(n){var r=e.renderedSlot.getValueDirect();var i=n.renderedSlot.getValueDirect();if(r>i){return this.registerSelection(e,t,true)}}}else{this.registerSelection(e,t)}};SelectionListener.prototype.clickPointModified=function(){var e=this.getAttribute("clickPoint").getValueDirect();var t=this.registry.find("ViewportMgr");var n=t.getViewportAtScreenXY(e.x,e.y);this.selections.viewports.push(n.viewport);this.rayPick.getAttribute("viewport").setValueDirect(n.viewport.x,n.viewport.y,n.viewport.width,n.viewport.height);this.rayPick.getAttribute("camera").setValueDirect(n.camera);var r=this.registry.getAttribute("rootPtr").getValueDirect();this.rayPick.execute(r);if(this.rayPick.picked.length>0){this.processPicks(this.rayPick.picked);this.selectionOccurred.pulse()}this.updateDistanceFromScreenCenter(r);this.updateSceneInspectionCamera(n.camera)};SelectionListener.prototype.updateDistanceFromScreenCenter=function(e){if(this.computePivotDistance.getValueDirect()==false){return}var t=this.registry.find("Bridgeworks");if(!t)return;var n=t.canvas.width/2;var r=t.canvas.height/2;var i=this.rayPick.getAttribute("clickPoint").getValueDirect();var s=new AttributeSetParams(-1,-1,0,false,false);this.rayPick.getAttribute("clickPoint").setValueDirect(n,r,s);this.rayPick.execute(e);var o=false;for(var u=0;u<this.rayPick.picked.length&&!o;u++){if(this.rayPick.picked[u].intersectRecord.distance!=0){this.distanceFromScreenCenter.setValueDirect(this.rayPick.picked[u].intersectRecord.distance);o=true;break}}this.rayPick.getAttribute("clickPoint").setValueDirect(i.x,i.y,s)};SelectionListener.prototype.updateSceneInspectionCamera=function(e){var t=this.registry.find("SceneInspector");if(t){if(t.getCamera()==e)return;var n=this.registry.find("ConnectionMgr");if(n){n.disconnectSceneInspection(t,t.getCamera());n.connectSceneInspection(t,e)}}};ViewportLayout.prototype=new AttributeContainer;ViewportLayout.prototype.constructor=ViewportLayout;ViewportLayout.prototype.initialize=function(){};ViewportLayout.prototype.layoutDirectives=function(e){};GridLayout.prototype=new ViewportLayout;GridLayout.prototype.constructor=GridLayout;GridLayout.prototype.initialize=function(){this.rows.setValueDirect(1);this.cols.setValueDirect(1);ViewportLayout.prototype.initialize.call(this)};GridLayout.prototype.layoutDirectives=function(e){if(!e){return}var t=this.width.getValueDirect();var n=this.height.getValueDirect();var r=this.rows.getValueDirect();var i=this.cols.getValueDirect();if(t<=0||n<=0||r<=0||i<=0){return}var s=0;var o=0;var u=t/i;var a=n/r;var f=new Array(4);var l=e.length;for(var c=0,h=0;c<r&&h<l;c++){for(var p=0;p<i&&h<l;p++,h++){f[0]=s;f[1]=o;f[2]=u;f[3]=a;e[h].getAttribute("viewport").setValue(f);s+=u}s=0;o+=a}};ViewportMgr.prototype=new AttributeContainer;ViewportMgr.prototype.constructor=ViewportMgr;ViewportMgr.prototype.initLayout=function(){var e=this.layout.getValueDirect();if(e){e.initialize()}};ViewportMgr.prototype.layoutDirectives=function(e){var t=this.layout.getValueDirect();if(t){t.layoutDirectives(e)}};ViewportMgr.prototype.getViewportAtScreenXY=function(e,t){var n=this.width.getValueDirect();var r=this.height.getValueDirect();e=clamp(e,0,n);t=clamp(t,0,r);var i=this.registry.getByType(eAttrType.Camera);var s=n;var o=r;var u,a;for(var f=0;f<i.length;f++){if(i[f].viewport.containsPoint(e,t)&&i[f].viewport.width<=s&&i[f].viewport.height<=o){u=i[f];a=i[f].viewport;s=i[f].viewport.width;o=i[f].viewport.height}}return{viewport:a,camera:u}};RasterComponentEventListener.prototype=new EventListener;RasterComponentEventListener.prototype.constructor=Command;RasterComponentEventListener.prototype.eventPerformed=function(e){var t=this.enabled.getValueDirect();if(!t){return}var n,r,i;for(var s=0;s<this.rcs.length;s++){if(!this.isListening(this.rcs[s])){continue}r=this.rcsSelectionState[s];n=this.rcs[s].eventPerformed(e);if(this.styleMgr){if(n){this.styleMgr.eventPerformed(e,this.rcs[s]);switch(e.type){case eEventType.MouseLeftClick:{if(this.isListeningEvent(this.rcs[s],eEventType.ElementFocus)&&this.rcs[s].hasFocus.getValueDirect()<=0){this.selectionEvent.synchronize(e);this.selectionEvent.type=eEventType.ElementFocus;i=m_rcs[s].eventPerformed(this.selectionEvent);this.styleMgr.eventPerformed(this.selectionEvent,this.rcs[s]);this.rcs[s].hasFocus.setValueDirect(1)}}break;case eEventType.MouseMove:{if(this.isListeningEvent(this.rcs[s],eEventType.ElementSelected)&&this.rcs[s].selected.getValueDirect()<=0){this.selectionEvent.synchronize(e);this.selectionEvent.type=eEventType.ElementSelected;i=this.rcs[s].eventPerformed(this.selectionEvent);this.styleMgr.eventPerformed(this.selectionEvent,this.rcs[s]);this.rcs[s].selected.setValueDirect(1)}if(!r&&this.isListeningEvent(this.rcs[s],eEventType.MouseOver)){this.selectionEvent.synchronize(e);this.selectionEvent.type=eEventType.MouseOver;i=this.rcs[s].eventPerformed(this.selectionEvent);this.styleMgr.eventPerformed(this.selectionEvent,this.rcs[s])}}break}}else{switch(e.type){case eEventType.MouseLeftDown:case eEventType.MouseLeftClick:case eEventType.MouseLeftDblClick:case eEventType.MouseMiddleDown:case eEventType.MouseMiddleClick:case eEventType.MouseMiddleDblClick:case eEventType.MouseRightDown:case eEventType.MouseRightClick:case eEventType.MouseRightDblClick:case eEventType.MouseWheelDown:case eEventType.MouseBothDown:{if(this.isListeningEvent(this.rcs[s],eEventType.ElementBlur)&&this.rcs[s].hasFocus.getValueDirect()>0){this.selectionEvent.synchronize(e);this.selectionEvent.type=eEventType.ElementBlur;i=this.rcs[s].eventPerformed(this.selectionEvent);this.styleMgr.eventPerformed(this.selectionEvent,this.rcs[s]);this.rcs[s].hasFocus.setValueDirect(-1)}}break;case eEventType.MouseMove:{if(this.isListeningEvent(this.rcs[s],eEventType.ElementUnselected)&&this.rcs[s].selected.getValueDirect()>0){this.selectionEvent.synchronize(e);this.selectionEvent.type=eEventType.ElementUnselected;i=this.rcs[s].eventPerformed(this.selectionEvent);this.styleMgr.eventPerformed(this.selectionEvent,this.rcs[s]);this.rcs[s].selected.setValueDirect(-1)}if(r&&this.isListeningEvent(this.rcs[s],eEventType.MouseOut)){this.selectionEvent.synchronize(e);this.selectionEvent.type=eEventType.MouseOut;i=this.rcs[s].eventPerformed(this.selectionEvent);this.styleMgr.eventPerformed(this.selectionEvent,this.rcs[s])}}break}}}this.rcsSelectionState[s]=n}};RasterComponentEventListener.prototype.registerComponent=function(e,t){if(e){if(t){var n=this.rcs.indexOf(t);if(n<0)n=this.rcs.length;this.rcs.splice(n,0,e);this.rcsSelectionState.splice(n,0,e)}else{this.rcs.push(e);this.rcsSelectionState.push(e)}}};RasterComponentEventListener.prototype.unregisterComponent=function(e){if(e){this.rcs.splice(this.rcs.indexOf(e),1)}};RasterComponentEventListener.prototype.Listen=function(e){if(e){this.rcListenMap[e]=true}};RasterComponentEventListener.prototype.Ignore=function(e){if(e){this.rcListenMap[e]=false}};RasterComponentEventListener.prototype.listenEvent=function(e,t){if(e){if(this.rcEventMap[e]==undefined){this.rcEventMap[e]=new Array}this.rcEventMap[e].push(t)}};RasterComponentEventListener.prototype.ignoreEvent=function(e,t){if(e){if(this.rcEventMap[e]){this.rcEventMap[e].splice(this.rcEventMap[e].indexOf(t),1)}}};RasterComponentEventListener.prototype.setStyleMgr=function(e){this.styleMgr=e};RasterComponentEventListener.prototype.setSelectionState=function(e,t){this.rcsSelectionState[e]=t};RasterComponentEventListener.prototype.getComponent=function(e){if(e<this.rcs.length){return this.rcs[e]}return null};RasterComponentEventListener.prototype.isListening=function(e){if(e){if(this.rcListenMap[e]){return this.rcListenMap[e]}}return false};RasterComponentEventListener.prototype.isListeningEvent=function(e,t){if(e){if(this.rcEventMap[e]){if(this.rcEventMap[e].indexOf(t)>=0)return true}}return false};var g_objPosMap={};SerializeCommand.prototype=new Command;SerializeCommand.prototype.constructor=SerializeCommand;SerializeCommand.prototype.execute=function(){if(this.directive){this.serializeScene()}};SerializeCommand.prototype.serializeScene=function(){var e;var t=null;var n=null;var r=new Context;var i;this.serialized='<?xml version="1.0" encoding="UTF-8"?><?bw onload="initialize"?><Session broadcast="false">';var s=bridgeworks.registry;if(s){var o=this.registry.find("AttributeFactory");var u=o.create("Serializer");var a=new XMLSerializer;u.serializeMinimum.setValueDirect(true);var f=s.getObjectCount();var e;for(e=0;e<f;e++){t=s.getObject(e);if(!t)continue;if(t.attrType>eAttrType.DeviceHandler&&t.attrType<eAttrType.DeviceHandler_End){r.attribute=t;u.serialize(r.attribute,r.item,r.attributeName,r.container);var l=a.serializeToString(u.DOM);if(l=="<__InitialRoot/>")continue;this.serialized+=l}else if(t.attrType>eAttrType.Node&&t.attrType<eAttrType.Node_End){if(t.getParentCount()==0){this.directive.execute(t);this.serialized+=this.directive.serialized}}else if(t.attrType>eAttrType.Directive&&t.attrType<eAttrType.Directive_End){r.attribute=t;u.serialize(r.attribute,r.item,r.attributeName,r.container);var l=a.serializeToString(u.DOM);if(l=="<__InitialRoot/>")continue;this.serialized+=l}else if(t.className=="SelectionListener"){var c=t.getAttribute("computePivotDistance").getValueDirect();this.serialized+='<Set target="Selector" computePivotDistance="';this.serialized+=c?"true":"false";this.serialized+='"/>'}}for(e=0;e<f;e++){t=s.getObject(e);if(!t)continue;if(t.className=="DisconnectAttributes"){r.attribute=t;u.serialize(r.attribute,r.item,r.attributeName,r.container);var l=a.serializeToString(u.DOM);if(l=="<__InitialRoot/>")continue;this.serialized+=l}}for(e=0;e<f;e++){t=s.getObject(e);if(!t)continue;if(t.attrType>eAttrType.Command&&t.attrType<eAttrType.Command_End&&t.className!="DisconnectAttributes"){r.attribute=t;u.serialize(r.attribute,r.item,r.attributeName,r.container);var l=a.serializeToString(u.DOM);if(l=="<__InitialRoot/>")continue;this.serialized+=l}}}this.serialized+="</Session>";serializedScene+=this.serialized;console.log(this.serialized);return};SerializeCommand.prototype.undo=function(){};SerializeCommand.prototype.setRegistry=function(e){var t=bridgeworks.registry.find("AttributeFactory");this.directive=t.create("SerializeDirective");Command.prototype.setRegistry.call(this,e)};SerializeCommand.prototype.getSerialized=function(){return this.serialized};ScreenCaptureCommand.prototype=new Command;ScreenCaptureCommand.prototype.constructor=ScreenCaptureCommand;ScreenCaptureCommand.prototype.execute=function(){var e=this.registry.find("Bridgeworks");e.eventMgr.addListener(eEventType.RenderBegin,this);e.eventMgr.addListener(eEventType.RenderEnd,this)};ScreenCaptureCommand.prototype.screenCapture=function(e){var t=document.getElementById(e);var n=t.toDataURL("image/png");cimageData=n;var r=n.lastIndexOf(",")+1;n=n.substr(r);imgeData=Base64Binary.decode(n)};ScreenCaptureCommand.prototype.get2DElementCanvas=function(e){var t=document.createElement("canvas");t.id="canvas2D";t.width=e.width;t.height=e.height;var n=t.getContext("2d");var r=this.registry.getByType(eAttrType.Label);var i="black";var s="data:image/svg+xml,"+"<svg xmlns='http://www.w3.org/2000/svg' width='"+t.width+"' height='"+t.height+"'>"+"<foreignObject width='100%' height='100%'>"+"<div xmlns='http://www.w3.org/1999/xhtml' style='background:"+i+";'>";for(var o=0;o<r.length;o++){var u=r[o].htmlLabel.style;s+="<span style='position:absolute; "+"font-family:"+u.fontFamily+"; "+"font-size:"+u.fontSize+"; "+"font-weight:"+u.fontWeight+"; "+"color:"+u.color+"; "+"background-color:"+u.backgroundColor+"; "+"text-shadow:"+u.textShadow+"; "+"visibility:"+u.visibility+"; "+"left:"+u.left+"; "+"top:"+u.top+"; "+"padding-left:"+u.paddingLeft+"; "+"padding-right:"+u.paddingRight+"; "+"padding-top:"+u.paddingTop+"; "+"padding-bottom:"+u.paddingBottom+"; "+"'>"+r[o].text.getValueDirect().join("")+"</span>"}s+="</div>"+"</foreignObject>"+"</svg>";var a=new Image;a.src=s;n.fillStyle=i;n.fillRect(0,0,t.width,t.height);n.drawImage(a,0,0);return{canvas:t,maskColor:i}};ScreenCaptureCommand.prototype.eventPerformed=function(e){switch(e.type){case eEventType.RenderBegin:{var t=this.registry.find("ScreenCaptureRect");var n=this.registry.find("ScreenCaptureTexture");if(t&&n){var r=this.get2DElementCanvas(document.getElementById(this.canvasId.getValueDirect().join("")));n.textureObj.setImageWithCanvas(r.canvas);n.imageSet=true;t.setTexture(n);t.enabled.setValueDirect(true)}}break;case eEventType.RenderEnd:{this.screenCapture(this.canvasId.getValueDirect().join(""));var t=this.registry.find("ScreenCaptureRect");if(t){t.enabled.setValueDirect(false)}}break}};ExportCommand.prototype=new Command;ExportCommand.prototype.constructor=ExportCommand;ExportCommand.prototype.execute=function(){if(!this.targetNode)return;var e=this.url.getValueDirect().join("");switch(getFileExtension(e)){case"stl":this.exportSTL(this.targetNode,e);break;default:break}};ExportCommand.prototype.exportSTL=function(e,t){var n=e.name.getValueDirect().join("");var r=[];var i=[];for(var s=0;s<e.geometry.length;s++){var o=e.geometry[s];switch(o.attrType){case eAttrType.TriList:{r=r.concat(o.vertices.getValueDirect());i=i.concat(o.vertices.getValueDirect())}break}}if(r.length==0)return;var u=FLT_MAX,a=FLT_MAX,f=FLT_MAX;for(var s=0;s<r.length;s+=3){u=Math.min(u,r[s]);a=Math.min(a,r[s+1]);f=Math.min(f,r[s+2])}if(u<0){u=Math.abs(u);for(var s=0;s<r.length;s+=3){r[s]+=u}}if(a<0){a=Math.abs(a);for(var s=0;s<r.length;s+=3){r[s+1]+=a}}if(f<0){f=Math.abs(f);for(var s=0;s<r.length;s+=3){r[s+2]+=f}}var l="";l+="solid "+n+"\r\n";for(var c=0,h=0;c<r.length&&h<i.length;c+=9,h+=9){l+="   facet normal "+i[h].toExponential()+" "+i[h+1].toExponential()+" "+i[h+2].toExponential()+"\r\n";l+="      outer loop\r\n";l+="         vertex "+r[c].toExponential()+" "+r[c+1].toExponential()+" "+r[c+2].toExponential()+"\r\n";l+="         vertex "+r[c+3].toExponential()+" "+r[c+4].toExponential()+" "+r[c+5].toExponential()+"\r\n";l+="         vertex "+r[c+6].toExponential()+" "+r[c+7].toExponential()+" "+r[c+8].toExponential()+"\r\n";l+="      endloop\r\n";l+="   end facet\r\n"}l+="endsolid "+n;var p=new Blob([l],{type:"text/plain"});saveAs(p,t)};MorphCommand.prototype=new Command;MorphCommand.prototype.constructor=MorphCommand;MorphCommand.prototype.execute=function(){if(this.sourceModel&&this.targetModel){var e=this.registry.find("ConnectionMgr");if(e){e.connectModelsToMorph(this.sourceModel,this.targetModel,this.morphIncr.getValueDirect())}}};SnapToCommand.prototype=new Command;SnapToCommand.prototype.constructor=SnapToCommand;SnapToCommand.prototype.execute=function(){if(this.socketModel&&this.plugModel){this.snapTo(this.socketModel,this.plugModel)}};SnapToCommand.prototype.snapTo=function(e,t){t.setMotionParent(e);t.getAttribute("position").setValueDirect(0,0,0);t.getAttribute("rotation").setValueDirect(0,0,0);zeroInspectionGroup(t);var n=new Matrix4x4;var r=new Matrix4x4;var i=this.socketConnector.getAttribute("normal").getValueDirect();i=n.transform(i.x,i.y,i.z,0);i=new Vector3D(i.x,i.y,i.z);i.normalize();var s=this.plugConnector.getAttribute("normal").getValueDirect();s=new Vector3D(s.x,s.y,s.z);s.normalize();var o=crossProduct(i,s);var u=cosineAngleBetween(i,s);angleBetween=180-toDegrees(Math.acos(u));if(angleBetween>0){var a=new Matrix4x4;a.loadRotation(o.x,o.y,o.z,angleBetween);r=a}var f=this.plugConnector.getAttribute("pin1").getAttribute("center").getValueDirect();var l=this.socketConnector.getAttribute("slot1").getAttribute("center").getValueDirect();var c=this.plugConnector.getAttribute("pin2").getAttribute("center").getValueDirect();var h=this.socketConnector.getAttribute("slot2").getAttribute("center").getValueDirect();f=r.transform(f.x,f.y,f.z,1);l=n.transform(l.x,l.y,l.z,1);c=r.transform(c.x,c.y,c.z,1);h=n.transform(h.x,h.y,h.z,1);var p,d;switch(this.slot.getValueDirect()){case 1:p=new Vector3D(c.x-f.x,c.y-f.y,c.z-f.z);d=new Vector3D(h.x-l.x,h.y-l.y,h.z-l.z);break;case 2:p=new Vector3D(f.x-c.x,f.y-c.y,f.z-c.z);d=new Vector3D(l.x-h.x,l.y-h.y,l.z-h.z);break;default:return}u=cosineAngleBetween(p,d);angleBetween=toDegrees(Math.acos(u));if(angleBetween>0){var a=new Matrix4x4;a.loadRotation(s.x,s.y,s.z,angleBetween);r=r.multiply(a)}var v=r.getRotationAngles();t.getAttribute("rotation").setValueDirect(v.x,v.y,v.z);var m,g;switch(this.slot.getValueDirect()){case 1:m=this.plugConnector.getAttribute("pin1").getAttribute("center").getValueDirect();g=this.socketConnector.getAttribute("slot1").getAttribute("center").getValueDirect();break;case 2:m=this.plugConnector.getAttribute("pin2").getAttribute("center").getValueDirect();g=this.socketConnector.getAttribute("slot2").getAttribute("center").getValueDirect();break;default:return}m=new Vector3D(m.x,m.y,m.z);g=n.transform(g.x,g.y,g.z,1);var y=dotProduct(m,s);i.multiplyScalar(y);t.getAttribute("sectorPosition").setValueDirect(g.x+d.x/2+i.x,g.y+d.y/2+i.y,g.z+d.z/2+i.z)};var eLWObjectTokens={COLR:1129270354,DIFF:1145652806,LUMI:1280658761,SPEC:1397769539,TRAN:1414676814};LWObjectHandler.prototype=new ContentHandler;LWObjectHandler.prototype.constructor=LWObjectHandler;LWObjectHandler.prototype.addObjectHandler=function(e,t){this.lwo2DataHandlers.push(e);this.lwo2DataHandlersData.push(t)};LWObjectHandler.prototype.parseFileStream=function(e){var t=formFullPath(e,this.contentDirectory.getValueDirect().join(""));var n=loadBinaryResource(t);if(n==null){return-2}var r=new BinaryParser(n,true);if(r.readUInt8()!=70||r.readUInt8()!=79||r.readUInt8()!=82||r.readUInt8()!=77){return-1}var i=r.readUInt32();if(r.readUInt8()!=76||r.readUInt8()!=87||r.readUInt8()!=79||r.readUInt8()!=50){return-1}i-=4;var s=new LWO2Data;s.contentDir=this.contentDirectory.getValueDirect().join("");var o=e.lastIndexOf("/");var u=e.lastIndexOf(".");s.name=e.substring(o+1,u);while(i>0){i-=this.parseChunk(r,s)}for(var a=0;a<this.lwo2DataHandlers.length;a++){this.lwo2DataHandlers[a](s,this.lwo2DataHandlersData[a])}return 0};LWObjectHandler.prototype.parseChunk=function(e,t){var n=0;var r=e.readUInt32();var i=e.readUInt32();switch(r){case 1279351122:{var s=e.readUInt16();n+=2;var o=e.readUInt16();n+=2;var u=e.readFloat32();n+=4;var a=e.readFloat32();n+=4;var f=e.readFloat32();n+=4;var l=this.readString(e);n+=l.bytesRead;if(i>n){var c=e.readUInt16();n+=2}t.addLayer(s);t.currentLayer().name=l.string;t.currentLayer().pivot.x=u;t.currentLayer().pivot.y=a;t.currentLayer().pivot.z=f}break;case 1347310675:{var h=i/12;for(var p=0;p<h;p++){var u=e.readFloat32();n+=4;var a=e.readFloat32();n+=4;var f=e.readFloat32();n+=4;t.currentLayer().pnts[p]=new Vector3D;t.currentLayer().pnts[p].x=u;t.currentLayer().pnts[p].y=a;t.currentLayer().pnts[p].z=f}}break;case 1347374163:{var d=e.readUInt32();n+=4;var o,v;while(i>n){var m=[];o=e.readUInt16();n+=2;v=o&1023;for(var p=0;p<v;p++){var g=this.readVariableLengthIndex(e);n+=g.bytesRead;m.push(g.index)}t.currentLayer().pols.push(m)}}break;case 1413564243:{while(i>n){var y=this.readString(e);n+=y.bytesRead;t.tags.push(y.string)}}break;case 1347699015:{var d=e.readUInt32();n+=4;while(i>n){var b=new LWO2PTAGData;var g=this.readVariableLengthIndex(e);n+=g.bytesRead;b.poly=g.index;b.tag=e.readUInt16();n+=2;switch(d){case 1398100550:{t.currentLayer().putPtag(b);t.currentLayer().ptagsSURFMaxIndex=Math.max(b.tag,t.currentLayer().ptagsSURFMaxIndex)}break}}}break;case 1447903568:{var d=e.readUInt32();n+=4;var w=e.readUInt16();n+=2;var l=this.readString(e);n+=l.bytesRead;var E,S,x;while(i>n){var g=this.readVariableLengthIndex(e);n+=g.bytesRead;switch(d){case 1415075158:{E=e.readFloat32();n+=4;S=e.readFloat32();n+=4;var T=new LWO2VMAPData;T.vertex=g.index;T.u=E;T.v=S;t.currentLayer().putVmap("TXUV",l.string,T)}break;default:{for(var p=0;p<w;p++){x=e.readFloat32();n+=4}}break}}}break;case 1447903556:{var d=e.readUInt32();n+=4;var w=e.readUInt16();n+=2;var l=this.readString(e);n+=l.bytesRead;var E,S,x;while(i>n){var N=this.readVariableLengthIndex(e);n+=N.bytesRead;var C=this.readVariableLengthIndex(e);n+=C.bytesRead;switch(d){case 1415075158:{E=e.readFloat32();n+=4;S=e.readFloat32();n+=4;var k=new LWO2VMADData;k.vertex=N.index;k.poly=C.index;k.u=E;k.v=S;t.currentLayer().putVmad("TXUV",l.string,k)}break;default:{for(var p=0;p<w;p++){x=e.readFloat32();n+=4}}break}}}break;case 1398100550:{var l=this.readString(e);n+=l.bytesRead;var L=this.readString(e);n+=L.bytesRead;t.addSurface(l.string,L.string);while(i>n){n+=this.parseSubChunk(e,t)}}break;case 1129072976:{var g=e.readUInt32();n+=4;t.addClip(g);t.subChunkContext=r;while(i>n){n+=this.parseSubChunk(e,t)}}break;case 1162761804:{var g=this.readVariableLengthIndex(e);n+=g.bytesRead;t.addEnvelope(g.index);while(i>n){n+=this.parseSubChunk(e,t)}}break;default:{while(i>n){e.readUInt8();n++}}break}if(i&1){e.readUInt8();n++}n+=8;return n};LWObjectHandler.prototype.parseSubChunk=function(e,t){var n=0;var r=e.readUInt32();n+=4;var i=e.readUInt16();n+=2;switch(r){case 1129270354:{t.currentSurface().color.x=e.readFloat32();n+=4;t.currentSurface().color.y=e.readFloat32();n+=4;t.currentSurface().color.z=e.readFloat32();n+=4;if(i>n-6){var s=this.readVariableLengthIndex(e);n+=s.bytesRead}}break;case 1145652806:{t.currentSurface().diffuseLevel=e.readFloat32();n+=4;if(i>n-6){var s=this.readVariableLengthIndex(e);n+=s.bytesRead}}break;case 1280658761:{t.currentSurface().luminosityLevel=e.readFloat32();n+=4;if(i>n-6){var s=this.readVariableLengthIndex(e);n+=s.bytesRead}}break;case 1397769539:{t.currentSurface().specularLevel=e.readFloat32();n+=4;if(i>n-6){var s=this.readVariableLengthIndex(e);n+=s.bytesRead}}break;case 1414676814:{t.currentSurface().transparencyLevel=e.readFloat32();n+=4;if(i>n-6){var s=this.readVariableLengthIndex(e);n+=s.bytesRead}}break;case 1196183379:{t.currentSurface().glossiness=e.readFloat32();n+=4;if(i>n-6){var s=this.readVariableLengthIndex(e);n+=s.bytesRead}}break;case 1397310533:{t.currentSurface().doubleSided=e.readUInt16()==3?true:false;n+=2}break;case 1397571918:{t.currentSurface().smoothingAngle=e.readFloat32();n+=4}break;case 1398032716:case 1095649613:case 1230194001:{var o=this.readString(e);n+=o.bytesRead;while(i>n-6){e.readUInt8();n+=1}t.currentClip().type=r;t.currentClip().setFilename(o.string)}break;case 1313163073:{var u=e.readUInt16();n+=2;if(t.subChunkContext=="IMAP"){t.currentSurface().currentBlock().negative=u}else if(t.subChunkContext=="CLIP"){t.currentClip().negative=u}}break;case 1112297291:{t.currentSurface().addBlock()}break;case 1229799760:{var a=this.readString(e);n+=a.bytesRead;t.currentSurface().currentBlock().type="IMAP";t.currentSurface().currentBlock().ordinal=a.string;t.subChunkContext="IMAP"}break;case 1128808782:{var f=e.readUInt32();n+=4;if(t.subChunkContext=="IMAP"){t.currentSurface().currentBlock().channel=f}}break;case 1162756418:{t.currentSurface().currentBlock().enable=e.readUInt16();n+=2}break;case 1330659651:{t.currentSurface().currentBlock().opacityType=e.readUInt16();n+=2;t.currentSurface().currentBlock().opacity=e.readFloat32();n+=4;if(i>n-6){var l=this.readVariableLengthIndex(e);n+=l.bytesRead;t.currentSurface().currentBlock().opacityEnvelope=l.index}}break;case 1414349136:{}break;case 1129206866:{t.currentSurface().currentBlock().center.x=e.readFloat32();n+=4;t.currentSurface().currentBlock().center.y=e.readFloat32();n+=4;t.currentSurface().currentBlock().center.z=e.readFloat32();n+=4;while(i>n-6){var s=this.readVariableLengthIndex(e);n+=s.bytesRead}}break;case 1397316165:{t.currentSurface().currentBlock().size.x=e.readFloat32();n+=4;t.currentSurface().currentBlock().size.y=e.readFloat32();n+=4;t.currentSurface().currentBlock().size.z=e.readFloat32();n+=4;while(i>n-6){var s=this.readVariableLengthIndex(e);n+=s.bytesRead}}break;case 1129535827:{t.currentSurface().currentBlock().coordSys=e.readUInt16();n+=2}break;case 1347571530:{t.currentSurface().currentBlock().projMode=e.readUInt16();n+=2}break;case 1096304979:{var c=e.readUInt16();n+=2;if(t.subChunkContext=="IMAP"){t.currentSurface().currentBlock().axis=c}}break;case 1229799751:{var h=this.readVariableLengthIndex(e);n+=h.bytesRead;t.currentSurface().currentBlock().imageIndex=h.index}break;case 1465008464:{t.currentSurface().currentBlock().widthWrap=e.readUInt16();n+=2;t.currentSurface().currentBlock().heightWrap=e.readUInt16();n+=2}break;case 1465012311:{t.currentSurface().currentBlock().widthWrapAmt=e.readFloat32();n+=4;if(i>n-6){var s=this.readVariableLengthIndex(e);n+=s.bytesRead}}break;case 1465012296:{t.currentSurface().currentBlock().heightWrapAmt=e.readFloat32();n+=4;if(i>n-6){var s=this.readVariableLengthIndex(e);n+=s.bytesRead}}break;case 1447903568:{var p=this.readString(e);n+=p.bytesRead;t.currentSurface().currentBlock().uvMapName=p.string}break;case 1415139397:{t.currentEnvelope().userFormat=e.readUInt8();n+=1;t.currentEnvelope().type=e.readUInt8();n+=1}break;case 1347568928:{t.currentEnvelope().preBehavior=e.readUInt16();n+=2}break;{}break;{}break;case 1347375956:{t.currentEnvelope().postBehavior=e.readUInt16();n+=2}break;default:{while(i>n-6){e.readUInt8();n+=1}}break}if(i&1){e.readUInt8();n+=1}return n};LWObjectHandler.prototype.readString=function(e){var t="";var n=0;var r=0;do{n=e.readUInt8();r++;t+=String.fromCharCode(n)}while(n);if(r&1){e.readUInt8();r++}return{string:t,bytesRead:r}};LWObjectHandler.prototype.readVariableLengthIndex=function(e){var t=0;var n=new Array(4);var r=0;n[0]=e.readUInt8();r++;n[1]=e.readUInt8();r++;if(n[0]<65280){t=n[0]<<8|n[1]}else{n[2]=e.readUInt8();r++;n[3]=e.readUInt8();r++;t=n[1]<<16|n[2]<<8|n[3]}return{index:t,bytesRead:r}};LWObjectHandler.prototype.matchesType=function(e){return e=="lwo"};LWObjectBuilder.prototype=new ContentBuilder;LWObjectBuilder.prototype.constructor=LWObjectBuilder;LWObjectBuilder.prototype.visitHandler=function(e){e.addObjectHandler(LWObjectBuilder_ObjectHandler,this)};LWObjectBuilder.prototype.finalize=function(){};LWObjectBuilder.prototype.matchesType=function(e){return e=="lwo"};LWObjectBuilder.prototype.allocateModel=function(e){var t=null;var n=this.layer;if(n==0){for(var r=0;r<e.layers.length;r++){if(!this.models[0]){var i=this.registry.find("AttributeFactory");t=i.create("Model");this.models.push(t)}else t=this.models[0];this.describeModel(e,e.layers[r],t)}}else if(n<=e.layers.length){if(!this.models[0]){var i=this.registry.find("AttributeFactory");t=i.create("Model");this.models.push(t)}else t=this.models[0];this.describeModel(e,e.layers[n-1],t)}};LWObjectBuilder.prototype.describeModel=function(e,t,n){var r=this.registry.find("AttributeFactory");var i=n.getAttribute("name");if(n.getAttributeModificationCount(i)==0){var s=e.name;if(e.layers.length>1){s+=":Layer"+this.layer}i.setValueDirect(s)}var o=n.getAttribute("pivot");if(n.getAttributeModificationCount(o)==0){o.setValue(t.pivot.v())}var u=t.ptagsSURFMaxIndex+1;var a=new Array(u);var f=new Array(u);var l=new Array(u);var c=new Array(u);for(var h=0;h<u;h++){a[h]=[];f[h]=[];l[h]=[];c[h]=[]}var p,d;var v=t.ptagsSURF.length;for(var m=0;m<v;m++){p=t.ptagsSURF[m].poly;d=t.ptagsSURF[m].tag;switch(t.pols[p].length){case 3:a[d].push(p);break;case 2:f[d].push(p);break;case 1:l[d].push(p);break;default:c[d].push(p);break}}var g=new Array(u);for(var d=0;d<u;d++){g[d]=this.allocateSurface(e,t,d);n.addSurface(g[d])}var y=new Array(t.pnts.length*3);for(var b=0;b<t.pnts.length;b++){y[b*3]=t.pnts[b].x;y[b*3+1]=t.pnts[b].y;y[b*3+2]=t.pnts[b].z}n.getAttribute("vertices").setValue(y);var w=[];var E=[];var S=[];var x=[];var T=[];var N=[];var C=[];var k=[];var L=new Vector3D;var A=new Vector3D;w.length=t.pnts.length;for(var h=0;h<w.length;h++){w[h]=[]}E.length=u;S.length=u;x.length=u;T.length=u;N.length=u;C.length=u;k.length=u;for(var d=0;d<g.length;d++){var O=[];var M=[];E[d]=[];S[d]=[];x[d]=new Pair;x[d].first=x[d].second=0;T[d]=[];k[d]=[];var _=c[d];var D=_.length;for(var p=0;p<D;p++){var P=new JSM.Polygon;var H=t.pols[_[p]];for(var B=0;B<H.length;B++){var j=t.pnts[H[B]];O.push([j.x,j.y,j.z]);P.AddVertex(j.x,j.y,j.z)}var F=JSM.PolygonTriangulate(P);for(var h=0;h<F.length;h++){var I=[];I.push(H[F[h][0]]);I.push(H[F[h][1]]);I.push(H[F[h][2]]);t.pols.push(I);a[d].push(t.pols.length-1)}}O=[];_=a[d];D=_.length;for(var p=0;p<D;p++){var H=t.pols[_[p]];for(var B=0;B<3;B++){var j=t.pnts[H[B]];O.push(j.x);O.push(j.y);O.push(j.z);S[d].push(H[B]);x[d].first=Math.min(H[B],x[d].first);x[d].second=Math.min(H[B],x[d].second);T[d].push(_[p])}var q=H[0];var R=H[1];var U=H[2];var z=t.pnts[q];var W=t.pnts[R];var X=t.pnts[U];L.load(W.x-z.x,W.y-z.y,W.z-z.z);A.load(X.x-z.x,X.y-z.y,X.z-z.z);var V=crossProduct(L,A);V.normalize();M.push(V.x);M.push(V.y);M.push(V.z);M.push(V.x);M.push(V.y);M.push(V.z);M.push(V.x);M.push(V.y);M.push(V.z);E[d].push(new Pair(q,V));E[d].push(new Pair(R,V));E[d].push(new Pair(U,V));w[q].push(V);w[R].push(V);w[U].push(V);k[d].push(V);k[d].push(V);k[d].push(V)}if(O.length){var $=r.create("TriList");n.addGeometry($,S[d],g[d]);$.getAttribute("vertices").setValue(O);$.getAttribute("normals").setValue(M);N[d]=$;C[d]=O}O=[];_=f[d];D=_.length;for(var p=0;p<D;p++){var H=t.pols[p];if(H.length<2)continue;for(var B=0;B<2;B++){var j=t.pnts[H[B]];O.push(j.x);O.push(j.y);O.push(j.z)}}if(O.length){var J=r.create("LineList");n.addGeometry(J,null,g[d]);J.getAttribute("vertices").setValue(O)}O=[];_=l[d];D=_.length;for(var p=0;p<D;p++){var H=t.pols[p];var j=t.pnts[H[0]];O.push(j.x);O.push(j.y);O.push(j.z)}if(O.length){var K=r.create("PointList");n.addGeometry(K,null,g[d]);K.getAttribute("vertices").setValue(O)}}var Q=[];for(var d=0;d<g.length;d++){if(!N[d])continue;var G=e.getSurface(e.tags[d]);if(!G)continue;var Y=G.smoothingAngle;if(Y<=0)continue;var Z=Math.cos(Y);Q.length=E[d].length;for(var h=0;h<Q.length;h++){Q[h]=new Vector3D}for(var et=0;et<E[d].length;et++){var tt=E[d][et].first;var nt=E[d][et].second;for(var rt=0;rt<w[tt].length;rt++){var it=w[tt][rt];var st=cosineAngleBetween(nt,it);if(Math.acos(st)<=Y){Q[et].x+=it.x;Q[et].y+=it.y;Q[et].z+=it.z}}Q[et].normalize()}var ot=[];for(var h=0;h<Q.length;h++){ot.push(Q[h].x);ot.push(Q[h].y);ot.push(Q[h].z)}Q.length=0;N[d].getAttribute("normals").setValue(ot)}for(var d=0;d<g.length;d++){var ut=e.getSurface(g[d].getAttribute("name").getValueDirect().join(""));if(ut){var at=this.loadTextures(e,t,ut,g[d]);for(var h=0;h<at.length;h++){var ft=this.calculateTextureCoords(e,t,at[h].second,C[d],k[d],S[d],T[d]);if(ft){N[d].getUVCoords(at[h].first).setValueDirect(ft)}}}}};LWObjectBuilder.prototype.allocateSurface=function(e,t,n){var r=this.registry.find("AttributeFactory");surface=r.create("Surface");var i=e.tags[n];surface.getAttribute("name").setValueDirect(i);this.describeSurface(e.getSurface(i),surface);return surface};LWObjectBuilder.prototype.describeSurface=function(e,t){if(!e)return;var n=[];n.push(e.color.x);n.push(e.color.y);n.push(e.color.z);n.push(1);t.getAttribute("color").setValue(n);t.getAttribute("ambientLevel").setValueDirect(e.diffuseLevel);t.getAttribute("diffuseLevel").setValueDirect(e.diffuseLevel);t.getAttribute("specularLevel").setValueDirect(e.specularLevel);t.getAttribute("emissiveLevel").setValueDirect(e.luminosityLevel);t.getAttribute("glossiness").setValueDirect(e.glossiness);t.getAttribute("opacity").setValueDirect(1-e.transparencyLevel);t.getAttribute("doubleSided").setValueDirect(e.doubleSided?true:false)};LWObjectBuilder.prototype.loadTextures=function(e,t,n,r){var i=[];var s=[];for(var o=0;o<n.blocks.length;o++){var u=n.blocks[o];if(u.type!="IMAP")continue;if(!s[u.channel]){s[u.channel]=[]}s[u.channel].push(u)}if(s[eLWObjectTokens.COLR]){this.allocateTextures(eTextureType.Color,e,t,s[eLWObjectTokens.COLR],r,i)}if(s[eLWObjectTokens.DIFF]){this.allocateTextures(eTextureType.Diffuse,e,t,s[eLWObjectTokens.DIFF],r,i)}if(s[eLWObjectTokens.LUMI]){this.allocateTextures(eTextureType.Luminosity,e,t,s[eLWObjectTokens.LUMI],r,i)}if(s[eLWObjectTokens.SPEC]){this.allocateTextures(eTextureType.Specular,e,t,s[eLWObjectTokens.SPEC],r,i)}if(s[eLWObjectTokens.TRAN]){this.allocateTextures(eTextureType.Transparency,e,t,s[eLWObjectTokens.TRAN],r,i)}return i};LWObjectBuilder.prototype.allocateTextures=function(e,t,n,r,i,s){for(var o=0;o<r.length;o++){var u=r[o];if(u.opacityType!=0&&u.opacityType!=7)continue;var a=t.clips[u.imageIndex];if(!a)continue;var f=null;if(o+1<r.length){if(r[o+1].opacityType==5){f=t.clips[r[o+1].imageIndex]}}var l,c;switch(u.widthWrap){case 0:l=eTextureWrap.None;break;case 1:l=eTextureWrap.Repeat;break;case 2:l=eTextureWrap.Mirror;break;case 3:l=eTextureWrap.Clamp;break}switch(u.heightWrap){case 0:c=eTextureWrap.None;break;case 1:c=eTextureWrap.Repeat;break;case 2:c=eTextureWrap.Mirror;break;case 3:c=eTextureWrap.Clamp;break}var h=a.getFilename();var p=h.lastIndexOf("/");h=p===-1?h:h.substring(p+1);var d=t.contentDir+"images/"+h;var v=u.negative?true:false;if(this.invertAlpha&&(e==eTextureType.Transparency||e==eTextureType.Diffuse||e==eTextureType.Luminosity||e==eTextureType.Specularity)){v=!v}var m=false;if(f){m=r[o+1].negative?true:false;if(this.invertAlpha){m=!m}}var g=null;var y=this.registry.find("AttributeFactory");g=y.create("MediaTexture");g.getAttribute("name").setValueDirect("");g.getAttribute("textureType").setValueDirect(e);g.getAttribute("opacity").setValueDirect(u.opacity);g.getAttribute("widthWrap").setValueDirect(l);g.getAttribute("heightWrap").setValueDirect(c);g.getAttribute("mipmappingEnabled").setValueDirect(false);g.getAttribute("imageFilename").setValueDirect(d);g.getAttribute("negateImage").setValueDirect(v);g.getAttribute("negateAlpha").setValueDirect(m);if(f){g.getAttribute("alphaFilename").setValueDirect(t.contentDir+f.getFilename())}s.push(new Pair(g,u));i.addTexture(g)}};LWObjectBuilder.prototype.calculateTextureCoords=function(e,t,n,r,i,s,o){if(!e||!t||!n||!r||!i||!s||!o){return null}var u=[];var a=r.length/3;switch(n.projMode){case 0:case 1:case 2:{var f,l,c;for(f=0,l=0,c=0;f<a;f++,l+=3,c+=2){c=this.mapXYZtoUV(r[l],r[l+1],r[l+2],n.center,n.size,n.projMode,n.axis,n.widthWrapAmt,n.heightWrapAmt);u.push(c.u);u.push(c.v)}}break;case 3:{var f,l,c;for(f=0,l=0,c=0;f<a;f++,l+=3,c+=2){polyNormal=i[f];if(Math.acos(cosineAngleBetween(polyNormal,new Vector3D(1,0,0)))<=QUARTERPI||Math.acos(cosineAngleBetween(polyNormal,new Vector3D(-1,0,0)))<=QUARTERPI){axis=0}else if(Math.acos(cosineAngleBetween(polyNormal,new Vector3D(0,1,0)))<=QUARTERPI||Math.acos(cosineAngleBetween(polyNormal,new Vector3D(0,-1,0)))<=QUARTERPI){axis=1}else{axis=2}c=this.mapXYZtoUV(r[l],r[l+1],r[l+2],n.center,n.size,0,axis,n.widthWrapAmt,n.heightWrapAmt);u.push(c.u);u.push(c.v)}}break;case 5:{var h=t.getVmap("TXUV",n.uvMapName);var p=t.getVmad("TXUV",n.uvMapName);var f,d,v,c,m;for(f=0,c=0;f<a;f++,c+=2){d=s[f];v=o[f];m=false;if(p&&p.length){for(var g=0;g<p.length;g++){if(p[g].poly>v){break}if(p[g].poly==v){if(p[g].vertex==d){u[c]=p[g].u;u[c+1]=p[g].v;m=true;break}}}if(m){continue}}if(h&&h.length){for(var y=0;y<h.length;y++){if(h[y].vertex>d){break}if(h[y].vertex==d){u[c]=h[y].u;u[c+1]=h[y].v;m=true;break}}}if(!m){u[c]=0;u[c+1]=0}}}break;default:{}break}return u};LWObjectBuilder.prototype.mapXYZtoUV=function(e,t,n,r,i,s,o,u,a){var f,l;var c;var h=0;var p=0;switch(s){case 0:switch(o){case 0:h=(n-r.z)/i.z+.5;p=(t-r.y)/i.y+.5;break;case 1:h=(e-r.x)/i.x+.5;p=(n-r.z)/i.z+.5;break;case 2:default:h=(e-r.x)/i.x+.5;p=(t-r.y)/i.y+.5;break}break;case 1:e-=r.x;t-=r.y;n-=r.z;switch(o){case 0:f=XYZtoH(n,e,t);h=f/(TWOPI*u);p=e/i.x+.5;break;case 1:f=XYZtoH(e,t,n);h=f/(TWOPI*u);p=t/i.y+.5;break;case 2:default:f=XYZtoH(-e,n,-t);h=f/(TWOPI*u);p=-n/i.z+.5;break}h=modf(h).fractionalPart;if(h<0)h+=1;break;case 2:e-=r.x;t-=r.y;n-=r.z;switch(o){case 0:var d=XYZtoHP(n,e,-t);f=d.heading;l=d.pitch;break;case 1:var d=XYZtoHP(-e,t,n);f=d.heading;l=d.pitch;break;case 2:default:var d=XYZtoHP(-e,n,-t);f=d.heading;l=d.pitch;break}h=modf(1-f/TWOPI*u).fractionalPart;p=1-modf(.5-l/Math.PI*a).fractionalPart;break}return{u:h,v:p}};LWSceneHandler.prototype=new ContentHandler;LWSceneHandler.prototype.constructor=LWSceneHandler;LWSceneHandler.prototype.addTokenHandler=function(e,t){this.tokenHandlers.push(e);this.tokenHandlersData.push(t)};LWSceneHandler.prototype.parseFileStream=function(e){var t=formFullPath(e,this.contentDirectory.getValueDirect().join(""));var n=loadTextResource(t);if(n==null){return-2}var r=new TextParser(n);var i;while(i=r.readLineTokens()){if(i.length==0)continue;if(i[0].indexOf('"')!=-1){i.push(i[0].substring(1,i[0].length-1));i[0]="String"}for(var s=0;s<this.tokenHandlers.length;s++){this.tokenHandlers[s](i,this.tokenHandlersData[s])}}for(var s=0;s<this.tokenHandlers.length;s++){this.tokenHandlers[s](new Array("EOF"),this.tokenHandlersData[s])}};LWSceneBuilder.prototype=new ContentBuilder;LWSceneBuilder.prototype.constructor=LWSceneBuilder;LWSceneBuilder.prototype.visitHandler=function(e){e.addTokenHandler(LWSceneBuilder_TokenHandler,this)};LWSceneBuilder.prototype.finalize=function(){};LWSceneBuilder.prototype.matchesType=function(e){return e=="lws"||e=="mot"};LWSceneBuilder.prototype.handleToken=function(e,t){switch(e){case"LWSC":this.handleSceneToken(t);break;case"LWMO":this.handleMotionToken(t);break;default:this.handleCommandToken(e,t);break}};LWSceneBuilder.prototype.handleSceneToken=function(e){this.allocateSceneGraph()};LWSceneBuilder.prototype.handleMotionToken=function(e){};LWSceneBuilder.prototype.handleCommandToken=function(e,t){this.allocateSceneElement(e,t)};LWSceneBuilder.prototype.allocateSceneGraph=function(){this.root=this.factory.create("Isolator");this.root.name.setValueDirect("Root");this.root.isolateLights.setValueDirect(true);this.registry.rootPtr.setValueDirect(this.root);this.evaluatorsGroup=this.factory.create("Group");this.evaluatorsGroup.name.setValueDirect("Evaluators");this.root.addChild(this.evaluatorsGroup);this.camerasSelector=this.factory.create("Selector");this.camerasSelector.name.setValueDirect("Cameras");this.camerasSelector.selectee.setValueDirect(0);this.root.addChild(this.camerasSelector);this.lightsGroup=this.factory.create("Group");this.lightsGroup.name.setValueDirect("Lights");this.root.addChild(this.lightsGroup);this.modelsGroup=this.factory.create("Group");this.modelsGroup.name.setValueDirect("Models");this.root.addChild(this.modelsGroup);this.renderDirective=this.factory.create("RenderDirective");this.renderDirective.name.setValueDirect("RenderDirective");this.renderDirective.rootNode.setValueDirect(this.root);return true};LWSceneBuilder.prototype.allocateSceneElement=function(e,t){switch(e){case"LoadObjectLayer":{var n=this.factory.create("Model");this.currElement=n;var r=t[0];n.layer.setValueDirect(r);var i=t.slice(1).join();i=addSlashAfterDriveSpecifier(i);n.url.setValueDirect(i);n.disableOnDissolve.setValueDirect(false);this.models.push(n);this.modelsGroup.addChild(n);finalizeModel(n,this.factory);this.objectBones.push(new Array)}break;case"ObjectMotion":{var s=this.factory.create("KeyframeInterpolator");s.name.setValueDirect("Motion");this.evaluators.push(s);this.evaluatorsGroup.addChild(s)}break;case"NumChannels":{if(this.evaluators.length>0){var s=this.evaluators[this.evaluators.length-1];var o=parseInt(t[0]);this.initializeKeyframeInterpolator(s,o);var u=this.currElement||this.registry.find(s.getAttribute("target").getValueDirect().join(""));if(u){switch(o){case 1:this.attachDissolveInterpolator(s,u);break;default:this.attachKeyframeInterpolator(s,u);break}}}}break;case"Channel":{this.currChannel=parseInt(t[0])}break;case"Key":{if(this.evaluators.length>0){var s=this.evaluators[this.evaluators.length-1];var a=s.channels.getAt(this.currChannel);var f=new KeyframeAttr;for(var l=0;l<t.length;l++){switch(l){case 0:{var c=parseFloat(t[l]);if(this.currChannel==3||this.currChannel==4||this.currChannel==5){c=toDegrees(c)}f.value.setValueDirect(c)}break;case 1:{f.time.setValueDirect(parseFloat(t[l]))}break;case 2:{var h=parseInt(t[l]);switch(h){case 0:f.shape.setValueDirect(eKeyframeShape.TCB);break;case 1:f.shape.setValueDirect(eKeyframeShape.Hermite);break;case 2:f.shape.setValueDirect(eKeyframeShape.Bezier1D);break;case 3:f.shape.setValueDirect(eKeyframeShape.Linear);break;case 4:f.shape.setValueDirect(eKeyframeShape.Stepped);break;case 5:f.shape.setValueDirect(eKeyframeShape.Bezier2D);break;default:f.shape.setValueDirect(eKeyframeShape.Linear);break}}break;case 3:case 4:case 5:case 6:case 7:case 8:f.params.getAt(l-3).setValueDirect(parseFloat(t[l]));break;default:break}}a.push_back(f)}}break;case"Behaviors":{if(this.evaluators.length>0){var s=this.evaluators[this.evaluators.length-1];s.preBehaviors.getAt(this.currChannel).setValueDirect(parseInt(t[0]));s.postBehaviors.getAt(this.currChannel).setValueDirect(parseInt(t[1]))}}break;case"ObjectDissolve":{if(t[0]=="(envelope)"){var s=this.factory.create("KeyframeInterpolator");s.name.setValueDirect("Dissolve");this.initializeKeyframeInterpolator(s,1);this.attachDissolveInterpolator(s,this.models[this.models.length-1]);this.evaluators.push(s);this.evaluatorsGroup.addChild(s)}else{if(this.models.length>0){this.models[this.models.length-1].dissolve.setValueDirect(parseFloat(t[0]))}}}break;case"AddCamera":{var p=this.factory.create("PerspectiveCamera");this.currElement=p;this.cameras.push(p);this.camerasSelector.addChild(p)}break;case"CameraName":{if(this.cameras.length>0){this.cameras[this.cameras.length-1].name.setValueDirect(t[0])}}break;case"CameraMotion":{var s=this.factory.create("KeyframeInterpolator");s.name.setValueDirect("Motion");this.evaluators.push(s);this.evaluatorsGroup.addChild(s)}break;case"ZoomFactor":{if(this.cameras.length>0){this.cameras[this.cameras.length-1].zoom.setValueDirect(parseFloat(t[0]))}}break;case"AmbientColor":{this.ambientLightDesc.colorR=parseFloat(t[0]);this.ambientLightDesc.colorG=parseFloat(t[1]);this.ambientLightDesc.colorB=parseFloat(t[2])}break;case"AmbientIntensity":{var d=this.factory.create("GlobalIllumination");d.name.setValueDirect("GLight");var v=parseFloat(t[0]);d.ambient.setValueDirect(this.ambientLightDesc.colorR*v,this.ambientLightDesc.colorG*v,this.ambientLightDesc.colorB*v,1);this.lightsGroup.addChild(d)}break;case"GlobalLightIntensity":{this.globalLightDesc.intensity=parseFloat(t[0])}break;case"AddLight":{var m=new TLWSCv3LightDesc;m.range=Math.sqrt(FLT_MAX);this.lightDescs.push(m);this.currElement=null}break;case"LightName":{if(this.lightDescs.length>0){this.lightDescs[this.lightDescs.length-1].name=t[0]}}break;case"LightMotion":{var s=this.factory.create("KeyframeInterpolator");s.name.setValueDirect("Motion");if(this.lightDescs.length>0){this.lightDescs[this.lightDescs.length-1].motion=s}this.evaluators.push(s);this.evaluatorsGroup.addChild(s)}break;case"LightColor":{if(this.lightDescs.length>0){this.lightDescs[this.lightDescs.length-1].colorR=parseFloat(t[0]);this.lightDescs[this.lightDescs.length-1].colorG=parseFloat(t[1]);this.lightDescs[this.lightDescs.length-1].colorB=parseFloat(t[2])}}break;case"LightIntensity":{if(this.lightDescs.length>0){this.lightDescs[this.lightDescs.length-1].intensity=parseFloat(t[0])}}break;case"LightRange":{if(this.lightDescs.length>0){this.lightDescs[this.lightDescs.length-1].range=parseFloat(t[0])}}break;case"LightConeAngle":{if(this.lightDescs.length>0){this.lightDescs[this.lightDescs.length-1].coneAngle=parseFloat(t[0])}}break;case"LightEdgeAngle":{if(this.lightDescs.length>0){this.lightDescs[this.lightDescs.length-1].edgeAngle=parseFloat(t[0])}}break;case"LightType":{if(this.lightDescs.length>0){this.lightDescs[this.lightDescs.length-1].type=parseInt(t[0])}}break;case"AddNullObject":{var g=this.factory.create("NullObject");this.currElement=g;this.models.push(g);this.modelsGroup.addChild(g);if(t[0]){g.name.setValueDirect(t[0])}}break;case"PivotPosition":{if(this.currElement){this.currElement.pivot.setValueDirect(parseFloat(t[0]),parseFloat(t[1]),parseFloat(t[2]))}}break;case"BoneFalloffType":{this.boneFalloffType=parseInt(t[0])}break;case"AddBone":{var y=this.factory.create("Bone");y.falloffType.setValueDirect(this.boneFalloffType);this.currElement=y;this.bones.push(y);this.objectBones[this.objectBones.length-1].push(y)}break;case"BoneName":{var y=this.bones.length>0?this.bones[this.bones.length-1]:null;if(y){var b=0;var w="";for(var l=0;l<this.bones.length;l++){if(t[0]==this.bones[l].name.getValueDirect().join("")){b++}}if(b>0){t[0]+="("+b+1+")"}y.name.setValueDirect(t[0])}}break;case"BoneRestPosition":{var y=this.bones.length>0?this.bones[this.bones.length-1]:null;if(y){y.restPosition.setValueDirect(parseFloat(t[0]),parseFloat(t[1]),parseFloat(t[2]))}}break;case"BoneRestDirection":{var y=this.bones.length>0?this.bones[this.bones.length-1]:null;if(y){y.restRotation.setValueDirect(parseFloat(t[1]),parseFloat(t[0]),parseFloat(t[2]))}}break;case"BoneRestLength":{var y=this.bones.length>0?this.bones[this.bones.length-1]:null;if(y){y.restLength.setValueDirect(parseFloat(t[0]))}}break;case"BoneStrength":{var y=this.bones.length>0?this.bones[this.bones.length-1]:null;if(y){y.strength.setValueDirect(parseFloat(t[0]))}}break;case"BoneScaleBoneStrength":{var y=this.bones.length>0?this.bones[this.bones.length-1]:null;if(y){y.scaleBoneStrength.setValueDirect(parseFloat(t[0]))}}break;case"BoneMotion":{var s=this.factory.create("KeyframeInterpolator");s.name.setValueDirect("Motion");if(this.bones.length>0){this.bones[this.bones.length-1].motion=s}this.evaluators.push(s);this.evaluatorsGroup.addChild(s)}break;case"ParentItem":{if(this.currElement){this.parentItems.push(new Pair(this.currElement,t[0]))}else{if(this.lightDescs.length>0){this.lightDescs[this.lightDescs.length-1].parentItem=t[0]}}};case"GridSize":{this.sceneData.gridSize=parseFloat(t[0])};case"NearClipDistance":{if(this.cameras.length>0){this.cameras[this.cameras.length-1].nearDistance.setValueDirect(parseFloat(t[0]))}}break;case"FramesPerSecond":{this.sceneData.fps=parseFloat(t[0])}break;case"BackdropColor":{this.sceneData.backgroundColorR=parseFloat(t[0]);this.sceneData.backgroundColorG=parseFloat(t[1]);this.sceneData.backgroundColorB=parseFloat(t[2])}break;case"}":{this.currChannel=0;if(this.imagePath!=""){if(this.parsingBgImage){this.renderDirective.backgroundImageFilename.setValueDirect(this.imagePath);this.parsingBgImage=false}else if(this.parsingFgImage){this.renderDirective.foregroundImageFilename.setValueDirect(this.imagePath);this.parsingFgImage=false}else if(this.parsingFgAlphaImage){this.renderDirective.foregroundAlphaImageFilename.setValueDirect(this.imagePath);this.parsingFgAlphaImage=false}this.imagePath=""}}break;case"String":{if(this.parsingBgImage||this.parsingFgImage||this.parsingFgAlphaImage){this.imagePath=t[0]}}break;case"BGImage":{this.parsingBgImage=true}break;case"FGImage":{this.parsingFgImage=true}break;case"FGAlphaImage":{this.parsingFgAlphaImage=true}break;case"EOF":{this.finalize()}break;default:{}break}};LWSceneBuilder.prototype.finalize=function(){var e=[];for(var t=0;t<this.models.length;t++){var n=this.models[t].name.getValueDirect().join("");if(e[n]==undefined){e[n]=new Array}e[n].push(this.models[t])}for(var n in e){if(e[n].length>1){for(var t=0;t<e[n].length;t++){e[n][t].name.setValueDirect(n+" ("+(t+1)+")")}}}var r,i;for(var t=0;t<this.cameras.length;t++){var s=this.cameras[t].zoom.getValueDirect();r=this.sceneData.gridSize*.1*s;i=r*1e5;this.cameras[t].nearDistance.setValueDirect(r);this.cameras[t].farDistance.setValueDirect(i)}for(var t=0;t<this.lightDescs.length;t++){var o=this.allocateLight(this.lightDescs[t]);if(this.lightDescs[t].parentItem){this.parentItems.push(new Pair(o,this.lightDescs[t].parentItem))}this.lights.push(o);this.lightsGroup.addChild(o)}for(var t=0;t<this.parentItems.length;t++){this.setParentItem(this.parentItems[t].first,this.parentItems[t].second)}for(var t=0;t<this.models.length;t++){var u=this.models[t];if(u.bones.length>0){this.attachBoneEffectors(u,u.bones)}}for(var t=0;t<this.evaluators.length;t++){this.evaluators[t].evaluate()}};LWSceneBuilder.prototype.allocateLight=function(e){var t=null;switch(e.type){case 0:case 3:t=this.factory.create("DirectionalLight");break;case 1:t=this.factory.create("PointLight");break;case 2:case 4:t=this.factory.create("SpotLight");break}if(!t)return null;if(e.motion){this.attachKeyframeInterpolator(e.motion,t)}t.name.setValueDirect(e.name);var n=e.colorR*e.intensity*this.globalLightDesc.intensity;var r=e.colorR*e.intensity*this.globalLightDesc.intensity;var i=e.colorR*e.intensity*this.globalLightDesc.intensity;var s=1;t.ambient.setValueDirect(this.ambientLightDesc.colorR*this.ambientLightDesc.intensity,this.ambientLightDesc.colorG*this.ambientLightDesc.intensity,this.ambientLightDesc.colorB*this.ambientLightDesc.intensity,1);t.diffuse.setValueDirect(n,r,i,s);t.specular.setValueDirect(n,r,i,s);switch(e.type){case 0:case 3:break;case 1:t.range.setValueDirect(e.range);break;case 2:case 4:t.range.setValueDirect(e.range);t.innerConeDegrees.setValueDirect(e.coneAngle);t.outerConeDegrees.setValueDirect(e.edgeAngle);t.coneFalloff.setValueDirect(1);break}return t};LWSceneBuilder.prototype.initializeKeyframeInterpolator=function(e,t){e.setNumChannels(t)};LWSceneBuilder.prototype.attachKeyframeInterpolator=function(e,t){if(!e||!t)return;var n=e.getAttribute("channels").vector.length;for(var r=0;r<n;r++){var i=e.getAttribute("resultValues").getAt(r);switch(r){case 0:i.addElementTarget(t.getAttribute("position"),0,0);break;case 1:i.addElementTarget(t.getAttribute("position"),0,1);break;case 2:i.addElementTarget(t.getAttribute("position"),0,2);break;case 3:i.addElementTarget(t.getAttribute("rotation"),0,1);break;case 4:i.addElementTarget(t.getAttribute("rotation"),0,0);break;case 5:i.addElementTarget(t.getAttribute("rotation"),0,2);break;case 6:i.addElementTarget(t.getAttribute("scale"),0,0);break;case 7:i.addElementTarget(t.getAttribute("scale"),0,1);break;case 8:i.addElementTarget(t.getAttribute("scale"),0,2);break}}e.getAttribute("time").setValueDirect(0)};LWSceneBuilder.prototype.attachDissolveInterpolator=function(e,t){if(!e||!t)return;var n=e.getAttribute("resultValues").getAt(0);n.addElementTarget(t.getAttribute("dissolve"),0,0)};LWSceneBuilder.prototype.attachBoneEffectors=function(e,t){for(var n=0;n<e.geometry.length;n++){var r=e.geometry[n];var i=this.factory.create("BoneEffector");this.evaluators.push(i);this.evaluatorsGroup.addChild(i);for(var s=0;s<t.length;s++){i.addBoneHierarchy(t[s])}var o=r.getAttribute("vertices");var u=o.getValueDirect();var a=r.getAttribute("normals");var f=a.getValueDirect();i.getAttribute("vertices").setValueDirect(u);i.getAttribute("normals").setValueDirect(f);i.getAttribute("resultVertices").addTarget(o);i.getAttribute("resultNormals").addTarget(a)}};LWSceneBuilder.prototype.setParentItem=function(e,t){var n=hexStrToULong(t.substring(1));var r=null;switch(t.charAt(0)){case"1":{r=this.models[n];if(e.attrType==eAttrType.Bone){r.bones.push(e)}}break;case"2":{r=this.lights[n]}break;case"3":{r=this.cameras[n]}break;case"4":{var i=hexStrToULong(t.substring(1,4));var s=hexStrToULong(t.substring(4));if(this.bones.length>i){var o=e;var u=null;if(this.objectBones.length>s&&this.objectBones[s].length>i){u=this.objectBones[s][i]}if(u&&o){u.addChild(o)}}}break;default:return}switch(e.attrType){case eAttrType.Bone:break;default:e.setMotionParent(r);break}};AttributeFactory.prototype=new AttributeContainer;AttributeFactory.prototype.constructor=AttributeFactory;AttributeFactory.prototype.create=function(e){var t=null;var n=this.newResourceProcs[e];if(n){t=n(e,this)}if(!t)return null;var r=this.configureProcs[e];if(r){r(t,this)}if(t.isContainer()){if(!t.getAttribute("name"))t.registerAttribute(new StringAttr(""),"name");if(!t.getAttribute("userData"))t.registerAttribute(new StringAttr(""),"userData")}if(this.registry){this.registry.register(t);t.setRegistry(this.registry)}return t};AttributeFactory.prototype.finalize=function(e,t){var n=this.finalizeProcs[e];if(n){n(t,this)}};AttributeFactory.prototype.initializeNewResourceMap=function(){this.newResourceProcs["Styles"]=newAttribute;this.newResourceProcs["StyleMap"]=newAttribute;this.newResourceProcs["StylesMap"]=newAttribute;this.newResourceProcs["LabelStyle"]=newAttribute;this.newResourceProcs["IconStyle"]=newAttribute;this.newResourceProcs["FontStyle"]=newAttribute;this.newResourceProcs["HTMLLabelStyle"]=newAttribute;this.newResourceProcs["BalloonTipLabelStyle"]=newAttribute;this.newResourceProcs["RenderableElementStyle"]=newAttribute;this.newResourceProcs["Serializer"]=newAttribute;this.newResourceProcs["Bone"]=newAttribute;this.newResourceProcs["DirectionalLight"]=newSGNode;this.newResourceProcs["GlobalIllumination"]=newSGNode;this.newResourceProcs["Group"]=newSGNode;this.newResourceProcs["Isolator"]=newSGNode;this.newResourceProcs["Label"]=newSGNode;this.newResourceProcs["HTMLLabel"]=newSGNode;this.newResourceProcs["BalloonTipLabel"]=newSGNode;this.newResourceProcs["LineList"]=newSGNode;this.newResourceProcs["MediaTexture"]=newSGNode;this.newResourceProcs["Model"]=newModel;this.newResourceProcs["OrthographicCamera"]=newSGNode;this.newResourceProcs["PerspectiveCamera"]=newSGNode;this.newResourceProcs["PointLight"]=newSGNode;this.newResourceProcs["PointList"]=newSGNode;this.newResourceProcs["QuaternionRotate"]=newSGNode;this.newResourceProcs["Rotate"]=newSGNode;this.newResourceProcs["Scale"]=newSGNode;this.newResourceProcs["Selector"]=newSGNode;this.newResourceProcs["Surface"]=newSGNode;this.newResourceProcs["Translate"]=newSGNode;this.newResourceProcs["Transform"]=newSGNode;this.newResourceProcs["TriList"]=newSGNode;this.newResourceProcs["NullObject"]=newSGNode;this.newResourceProcs["Material"]=newSGNode;this.newResourceProcs["Cube"]=newSGNode;this.newResourceProcs["ScreenRect"]=newSGNode;this.newResourceProcs["BBoxDirective"]=newSGDirective;this.newResourceProcs["RayPickDirective"]=newSGDirective;this.newResourceProcs["RenderDirective"]=newSGDirective;this.newResourceProcs["SerializeDirective"]=newSGDirective;this.newResourceProcs["UpdateDirective"]=newSGDirective;this.newResourceProcs["CollideDirective"]=newSGDirective;this.newResourceProcs["HighlightDirective"]=newSGDirective;this.newResourceProcs["BBoxLocator"]=newBBoxLocator;this.newResourceProcs["KeyframeInterpolator"]=newKeyframeInterpolator;this.newResourceProcs["MapProjectionCalculator"]=newMapProjectionCalculator;this.newResourceProcs["ObjectInspector"]=newObjectInspector;this.newResourceProcs["SceneInspector"]=newSceneInspector;this.newResourceProcs["TargetObserver"]=newTargetObserver;this.newResourceProcs["AnimalMover"]=newAnimalMover;this.newResourceProcs["WalkSimulator"]=newWalkSimulator;this.newResourceProcs["MorphEffector"]=newMorphEffector;this.newResourceProcs["BoneEffector"]=newBoneEffector;this.newResourceProcs["AppendNode"]=newCommand;this.newResourceProcs["AutoInterpolate"]=newCommand;this.newResourceProcs["CommandSequence"]=newCommand;this.newResourceProcs["ConnectAttributes"]=newCommand;this.newResourceProcs["ConnectOutputs"]=newCommand;this.newResourceProcs["DisconnectAttributes"]=newCommand;this.newResourceProcs["DisconnectOutputs"]=newCommand;this.newResourceProcs["Export"]=newCommand;this.newResourceProcs["Locate"]=newCommand;this.newResourceProcs["MotionInterpolate"]=newCommand;this.newResourceProcs["Pause"]=newCommand;this.newResourceProcs["Play"]=newCommand;this.newResourceProcs["Remove"]=newCommand;this.newResourceProcs["ScreenCapture"]=newCommand;this.newResourceProcs["Serialize"]=newCommand;this.newResourceProcs["Set"]=newCommand;this.newResourceProcs["Stop"]=newCommand;this.newResourceProcs["Morph"]=newCommand;this.newResourceProcs["SnapTo"]=newCommand;this.newResourceProcs["MouseHandler"]=newDeviceHandler;this.newResourceProcs["KeyboardHandler"]=newDeviceHandler};AttributeFactory.prototype.initializeConfigureMap=function(){this.configureProcs["Model"]=configureModel;this.configureProcs["BBoxDirective"]=configureDirective;this.configureProcs["RayPickDirective"]=configureDirective;this.configureProcs["RenderDirective"]=configureDirective;this.configureProcs["SerializeDirective"]=configureDirective;this.configureProcs["UpdateDirective"]=configureDirective;this.configureProcs["CollideDirective"]=configureDirective;this.configureProcs["HighlightDirective"]=configureDirective};AttributeFactory.prototype.initializeFinalizeMap=function(){this.finalizeProcs["Model"]=finalizeModel;this.finalizeProcs["BBoxDirective"]=finalizeDirective;this.finalizeProcs["RayPickDirective"]=finalizeDirective;this.finalizeProcs["RenderDirective"]=finalizeDirective;this.finalizeProcs["SerializeDirective"]=finalizeDirective;this.finalizeProcs["UpdateDirective"]=finalizeDirective;this.finalizeProcs["CollideDirective"]=finalizeDirective;this.finalizeProcs["HighlightDirective"]=finalizeDirective;this.finalizeProcs["KeyframeInterpolator"]=finalizeEvaluator;this.finalizeProcs["AppendNode"]=finalizeCommand;this.finalizeProcs["AutoInterpolate"]=finalizeCommand;this.finalizeProcs["CommandSequence"]=finalizeCommand;this.finalizeProcs["ConnectAttributes"]=finalizeCommand;this.finalizeProcs["ConnectOutputs"]=finalizeCommand;this.finalizeProcs["DisconnectAttributes"]=finalizeCommand;this.finalizeProcs["DisconnectOutputs"]=finalizeCommand;this.finalizeProcs["Export"]=finalizeCommand;this.finalizeProcs["Locate"]=finalizeCommand;this.finalizeProcs["MotionInterpolate"]=finalizeCommand;this.finalizeProcs["Pause"]=finalizeCommand;this.finalizeProcs["Play"]=finalizeCommand;this.finalizeProcs["Remove"]=finalizeCommand;this.finalizeProcs["ScreenCapture"]=finalizeCommand;this.finalizeProcs["Serialize"]=finalizeCommand;this.finalizeProcs["Set"]=finalizeCommand;this.finalizeProcs["Stop"]=finalizeCommand;this.finalizeProcs["Morph"]=finalizeCommand;this.finalizeProcs["SnapTo"]=finalizeCommand;this.finalizeProcs["MouseHandler"]=finalizeDeviceHandler;this.finalizeProcs["KeyboardHandler"]=finalizeDeviceHandler};AttributeFactory.prototype.setRegistry=function(e){this.registry=e};AttributeFactory.prototype.setGraphMgr=function(e){this.graphMgr=e};Bridgeworks.prototype=new AttributeContainer;Bridgeworks.prototype.constructor=Bridgeworks;Bridgeworks.prototype.get=function(e){return this.registry.find(e)};Bridgeworks.prototype.handleEvent=function(e,t){var n=null;switch(getObjectClassName(e)){case"MouseEvent":{var r=getElementAbsolutePos(this.canvas);e.canvasX=e.clientX-r.x;e.canvasY=e.clientY-r.y;n=this.eventAdapter.createMouseEvent(e)}break;case"KeyboardEvent":{n=this.eventAdapter.createKeyboardEvent(e,t)}break;default:break}if(n){this.eventMgr.processEvent(n)}};Bridgeworks.prototype.initRegistry=function(){this.registry.register(this);this.registry.register(this.graphMgr);this.registry.register(this.factory);this.registry.register(this.eventAdapter);this.registry.register(this.eventMgr);this.registry.register(this.commandMgr);this.registry.register(this.connectionMgr);this.registry.register(this.viewportMgr);this.registry.register(this.selector);this.registry.register(this.renderAgent);this.registry.register(this.layout);this.registry.register(this.mapProjectionCalculator);this.registry.registerByName(this.renderAgent,"AnimationAgent")};Bridgeworks.prototype.initEventListeners=function(){this.eventMgr.addListener(eEventType.MouseLeftDown,this.selector);this.eventMgr.addListener(eEventType.MouseMiddleDown,this.selector);this.eventMgr.addListener(eEventType.MouseRightDown,this.selector);this.eventMgr.addListener(eEventType.MouseBothDown,this.selector);this.eventMgr.addListener(eEventType.MouseHover,this.selector);this.eventMgr.addListener(eEventType.MouseLeftDown,this.rasterComponentEventListener);this.eventMgr.addListener(eEventType.MouseLeftUp,this.rasterComponentEventListener);this.eventMgr.addListener(eEventType.MouseLeftClick,this.rasterComponentEventListener);this.eventMgr.addListener(eEventType.MouseLeftDblClick,this.rasterComponentEventListener);this.eventMgr.addListener(eEventType.MouseMiddleDown,this.rasterComponentEventListener);this.eventMgr.addListener(eEventType.MouseMiddleUp,this.rasterComponentEventListener);this.eventMgr.addListener(eEventType.MouseMiddleClick,this.rasterComponentEventListener);this.eventMgr.addListener(eEventType.MouseMiddleDblClick,this.rasterComponentEventListener);this.eventMgr.addListener(eEventType.MouseRightDown,this.rasterComponentEventListener);this.eventMgr.addListener(eEventType.MouseRightUp,this.rasterComponentEventListener);this.eventMgr.addListener(eEventType.MouseRightClick,this.rasterComponentEventListener);this.eventMgr.addListener(eEventType.MouseRightDblClick,this.rasterComponentEventListener);this.eventMgr.addListener(eEventType.MouseWheelDown,this.rasterComponentEventListener);this.eventMgr.addListener(eEventType.MouseWheelUp,this.rasterComponentEventListener);this.eventMgr.addListener(eEventType.MouseBothDown,this.rasterComponentEventListener);this.eventMgr.addListener(eEventType.MouseHover,this.rasterComponentEventListener);this.eventMgr.addListener(eEventType.MouseMove,this.rasterComponentEventListener)};Bridgeworks.prototype.onLoadModified=function(){this.renderAgent.stop();this.selector.stop();this.rasterComponentEventListener.stop();this.commandMgr.clearCommandSequenceStack();this.eventMgr.clearEvents();$("#RasterComponents").empty();this.selector.clearSelections();this.selector.getAttribute("lastSelectedName").setValueDirect("");this.viewportMgr.initLayout();this.registry.clear();this.initEventListeners();this.initRegistry();this.renderAgent.getAttribute("globalTimeInSecs").setValueDirect(0);this.graphMgr.reset();this.renderAgent.start();this.selector.start();this.rasterComponentEventListener.start();console.debug("TODO: "+arguments.callee.name)};Bridgeworks.prototype.resize=function(e,t){this.canvas.width=e;this.canvas.height=t;this.renderContext.setViewport(this.canvas.offsetLeft,this.canvas.offsetTop,e,t);this.viewportMgr.getAttribute("width").setValueDirect(e);this.viewportMgr.getAttribute("height").setValueDirect(t)};Bridgeworks.prototype.render=function(){this.eventMgr.processEvent(new Event(eEventType.RenderBegin));this.renderContext.clear();this.renderAgent.render();this.eventMgr.processEvent(new Event(eEventType.RenderEnd))};Bridgeworks.prototype.setRenderContext=function(e){this.renderContext=e;this.graphMgr.setRenderContext(e)};Bridgeworks.prototype.updateScene=function(e){var t=new String(e);var n=t.substr(t.length-3,3);if(n=="xml"){e=loadXMLResource(this.contentDir+"/"+e)}this.parser.parse(e)};(function(){function u(e,t){if(t.src){i.ajax({url:t.src,async:false,dataType:"script"})}else{i.globalEval(t.text||t.textContent||t.innerHTML||"")}if(t.parentNode){t.parentNode.removeChild(t)}}function a(){return+(new Date)}function p(e,t){return e[0]&&parseInt(i.curCSS(e[0],t,true),10)||0}function g(){return false}function y(){return true}function w(e){var t=RegExp("(^|\\.)"+e.type+"(\\.|$)"),n=true,r=[];i.each(i.data(this,"events").live||[],function(n,s){if(t.test(s.type)){var o=i(e.target).closest(s.data)[0];if(o){r.push({elem:o,fn:s})}}});r.sort(function(e,t){return i.data(e.elem,"closest")-i.data(t.elem,"closest")});i.each(r,function(){if(this.fn.call(this.elem,e,this.fn.data)===false){return n=false}});return n}function E(e,t){return["live",e,t.replace(/\./g,"`").replace(/ /g,"|")].join(".")}function x(){if(S){return}S=true;if(document.addEventListener){document.addEventListener("DOMContentLoaded",function(){document.removeEventListener("DOMContentLoaded",arguments.callee,false);i.ready()},false)}else{if(document.attachEvent){document.attachEvent("onreadystatechange",function(){if(document.readyState==="complete"){document.detachEvent("onreadystatechange",arguments.callee);i.ready()}});if(document.documentElement.doScroll&&e==e.top){(function(){if(i.isReady){return}try{document.documentElement.doScroll("left")}catch(e){setTimeout(arguments.callee,0);return}i.ready()})()}}}i.event.add(e,"load",i.ready)}function A(e,t){var n={};i.each(L.concat.apply([],L.slice(0,t)),function(){n[this]=e});return n}var e=this,t,n=e.jQuery,r=e.$,i=e.jQuery=e.$=function(e,t){return new i.fn.init(e,t)},s=/^[^<]*(<(.|\s)+>)[^>]*$|^#([\w-]+)$/,o=/^.[^:#\[\.,]*$/;i.fn=i.prototype={init:function(e,t){e=e||document;if(e.nodeType){this[0]=e;this.length=1;this.context=e;return this}if(typeof e==="string"){var n=s.exec(e);if(n&&(n[1]||!t)){if(n[1]){e=i.clean([n[1]],t)}else{var r=document.getElementById(n[3]);if(r&&r.id!=n[3]){return i().find(e)}var o=i(r||[]);o.context=document;o.selector=e;return o}}else{return i(t).find(e)}}else{if(i.isFunction(e)){return i(document).ready(e)}}if(e.selector&&e.context){this.selector=e.selector;this.context=e.context}return this.setArray(i.isArray(e)?e:i.makeArray(e))},selector:"",jquery:"1.3.2",size:function(){return this.length},get:function(e){return e===t?Array.prototype.slice.call(this):this[e]},pushStack:function(e,t,n){var r=i(e);r.prevObject=this;r.context=this.context;if(t==="find"){r.selector=this.selector+(this.selector?" ":"")+n}else{if(t){r.selector=this.selector+"."+t+"("+n+")"}}return r},setArray:function(e){this.length=0;Array.prototype.push.apply(this,e);return this},each:function(e,t){return i.each(this,e,t)},index:function(e){return i.inArray(e&&e.jquery?e[0]:e,this)},attr:function(e,n,r){var s=e;if(typeof e==="string"){if(n===t){return this[0]&&i[r||"attr"](this[0],e)}else{s={};s[e]=n}}return this.each(function(t){for(e in s){i.attr(r?this.style:this,e,i.prop(this,s[e],r,t,e))}})},css:function(e,n){if((e=="width"||e=="height")&&parseFloat(n)<0){n=t}return this.attr(e,n,"curCSS")},text:function(e){if(typeof e!=="object"&&e!=null){return this.empty().append((this[0]&&this[0].ownerDocument||document).createTextNode(e))}var t="";i.each(e||this,function(){i.each(this.childNodes,function(){if(this.nodeType!=8){t+=this.nodeType!=1?this.nodeValue:i.fn.text([this])}})});return t},wrapAll:function(e){if(this[0]){var t=i(e,this[0].ownerDocument).clone();if(this[0].parentNode){t.insertBefore(this[0])}t.map(function(){var e=this;while(e.firstChild){e=e.firstChild}return e}).append(this)}return this},wrapInner:function(e){return this.each(function(){i(this).contents().wrapAll(e)})},wrap:function(e){return this.each(function(){i(this).wrapAll(e)})},append:function(){return this.domManip(arguments,true,function(e){if(this.nodeType==1){this.appendChild(e)}})},prepend:function(){return this.domManip(arguments,true,function(e){if(this.nodeType==1){this.insertBefore(e,this.firstChild)}})},before:function(){return this.domManip(arguments,false,function(e){this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,false,function(e){this.parentNode.insertBefore(e,this.nextSibling)})},end:function(){return this.prevObject||i([])},push:[].push,sort:[].sort,splice:[].splice,find:function(e){if(this.length===1){var t=this.pushStack([],"find",e);t.length=0;i.find(e,this[0],t);return t}else{return this.pushStack(i.unique(i.map(this,function(t){return i.find(e,t)})),"find",e)}},clone:function(e){var t=this.map(function(){if(!i.support.noCloneEvent&&!i.isXMLDoc(this)){var e=this.outerHTML;if(!e){var t=this.ownerDocument.createElement("div");t.appendChild(this.cloneNode(true));e=t.innerHTML}return i.clean([e.replace(/ jQuery\d+="(?:\d+|null)"/g,"").replace(/^\s*/,"")])[0]}else{return this.cloneNode(true)}});if(e===true){var n=this.find("*").andSelf(),r=0;t.find("*").andSelf().each(function(){if(this.nodeName!==n[r].nodeName){return}var e=i.data(n[r],"events");for(var t in e){for(var s in e[t]){i.event.add(this,t,e[t][s],e[t][s].data)}}r++})}return t},filter:function(e){return this.pushStack(i.isFunction(e)&&i.grep(this,function(t,n){return e.call(t,n)})||i.multiFilter(e,i.grep(this,function(e){return e.nodeType===1})),"filter",e)},closest:function(e){var t=i.expr.match.POS.test(e)?i(e):null,n=0;return this.map(function(){var r=this;while(r&&r.ownerDocument){if(t?t.index(r)>-1:i(r).is(e)){i.data(r,"closest",n);return r}r=r.parentNode;n++}})},not:function(e){if(typeof e==="string"){if(o.test(e)){return this.pushStack(i.multiFilter(e,this,true),"not",e)}else{e=i.multiFilter(e,this)}}var n=e.length&&e[e.length-1]!==t&&!e.nodeType;return this.filter(function(){return n?i.inArray(this,e)<0:this!=e})},add:function(e){return this.pushStack(i.unique(i.merge(this.get(),typeof e==="string"?i(e):i.makeArray(e))))},is:function(e){return!!e&&i.multiFilter(e,this).length>0},hasClass:function(e){return!!e&&this.is("."+e)},val:function(e){if(e===t){var n=this[0];if(n){if(i.nodeName(n,"option")){return(n.attributes.value||{}).specified?n.value:n.text}if(i.nodeName(n,"select")){var r=n.selectedIndex,s=[],o=n.options,u=n.type=="select-one";if(r<0){return null}for(var a=u?r:0,f=u?r+1:o.length;a<f;a++){var l=o[a];if(l.selected){e=i(l).val();if(u){return e}s.push(e)}}return s}return(n.value||"").replace(/\r/g,"")}return t}if(typeof e==="number"){e+=""}return this.each(function(){if(this.nodeType!=1){return}if(i.isArray(e)&&/radio|checkbox/.test(this.type)){this.checked=i.inArray(this.value,e)>=0||i.inArray(this.name,e)>=0}else{if(i.nodeName(this,"select")){var t=i.makeArray(e);i("option",this).each(function(){this.selected=i.inArray(this.value,t)>=0||i.inArray(this.text,t)>=0});if(!t.length){this.selectedIndex=-1}}else{this.value=e}}})},html:function(e){return e===t?this[0]?this[0].innerHTML.replace(/ jQuery\d+="(?:\d+|null)"/g,""):null:this.empty().append(e)},replaceWith:function(e){return this.after(e).remove()},eq:function(e){return this.slice(e,+e+1)},slice:function(){return this.pushStack(Array.prototype.slice.apply(this,arguments),"slice",Array.prototype.slice.call(arguments).join(","))},map:function(e){return this.pushStack(i.map(this,function(t,n){return e.call(t,n,t)}))},andSelf:function(){return this.add(this.prevObject)},domManip:function(e,t,n){function l(e,n){return t&&i.nodeName(e,"table")&&i.nodeName(n,"tr")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}if(this[0]){var r=(this[0].ownerDocument||this[0]).createDocumentFragment(),s=i.clean(e,this[0].ownerDocument||this[0],r),o=r.firstChild;if(o){for(var a=0,f=this.length;a<f;a++){n.call(l(this[a],o),this.length>1||a>0?r.cloneNode(true):r)}}if(s){i.each(s,u)}}return this}};i.fn.init.prototype=i.fn;i.extend=i.fn.extend=function(){var e=arguments[0]||{},n=1,r=arguments.length,s=false,o;if(typeof e==="boolean"){s=e;e=arguments[1]||{};n=2}if(typeof e!=="object"&&!i.isFunction(e)){e={}}if(r==n){e=this;--n}for(;n<r;n++){if((o=arguments[n])!=null){for(var u in o){var a=e[u],f=o[u];if(e===f){continue}if(s&&f&&typeof f==="object"&&!f.nodeType){e[u]=i.extend(s,a||(f.length!=null?[]:{}),f)}else{if(f!==t){e[u]=f}}}}}return e};var f=/z-?index|font-?weight|opacity|zoom|line-?height/i,l=document.defaultView||{},c=Object.prototype.toString;i.extend({noConflict:function(t){e.$=r;if(t){e.jQuery=n}return i},isFunction:function(e){return c.call(e)==="[object Function]"},isArray:function(e){return c.call(e)==="[object Array]"},isXMLDoc:function(e){return e.nodeType===9&&e.documentElement.nodeName!=="HTML"||!!e.ownerDocument&&i.isXMLDoc(e.ownerDocument)},globalEval:function(e){if(e&&/\S/.test(e)){var t=document.getElementsByTagName("head")[0]||document.documentElement,n=document.createElement("script");n.type="text/javascript";if(i.support.scriptEval){n.appendChild(document.createTextNode(e))}else{n.text=e}t.insertBefore(n,t.firstChild);t.removeChild(n)}},nodeName:function(e,t){return e.nodeName&&e.nodeName.toUpperCase()==t.toUpperCase()},each:function(e,n,r){var i,s=0,o=e.length;if(r){if(o===t){for(i in e){if(n.apply(e[i],r)===false){break}}}else{for(;s<o;){if(n.apply(e[s++],r)===false){break}}}}else{if(o===t){for(i in e){if(n.call(e[i],i,e[i])===false){break}}}else{for(var u=e[0];s<o&&n.call(u,s,u)!==false;u=e[++s]){}}}return e},prop:function(e,t,n,r,s){if(i.isFunction(t)){t=t.call(e,r)}return typeof t==="number"&&n=="curCSS"&&!f.test(s)?t+"px":t},className:{add:function(e,t){i.each((t||"").split(/\s+/),function(t,n){if(e.nodeType==1&&!i.className.has(e.className,n)){e.className+=(e.className?" ":"")+n}})},remove:function(e,n){if(e.nodeType==1){e.className=n!==t?i.grep(e.className.split(/\s+/),function(e){return!i.className.has(n,e)}).join(" "):""}},has:function(e,t){return e&&i.inArray(t,(e.className||e).toString().split(/\s+/))>-1}},swap:function(e,t,n){var r={};for(var i in t){r[i]=e.style[i];e.style[i]=t[i]}n.call(e);for(var i in t){e.style[i]=r[i]}},css:function(e,t,n,r){if(t=="width"||t=="height"){var s,o={position:"absolute",visibility:"hidden",display:"block"},u=t=="width"?["Left","Right"]:["Top","Bottom"];function a(){s=t=="width"?e.offsetWidth:e.offsetHeight;if(r==="border"){return}i.each(u,function(){if(!r){s-=parseFloat(i.curCSS(e,"padding"+this,true))||0}if(r==="margin"){s+=parseFloat(i.curCSS(e,"margin"+this,true))||0}else{s-=parseFloat(i.curCSS(e,"border"+this+"Width",true))||0}})}if(e.offsetWidth!==0){a()}else{i.swap(e,o,a)}return Math.max(0,Math.round(s))}return i.curCSS(e,t,n)},curCSS:function(e,t,n){var r,s=e.style;if(t=="opacity"&&!i.support.opacity){r=i.attr(s,"opacity");return r==""?"1":r}if(t.match(/float/i)){t=T}if(!n&&s&&s[t]){r=s[t]}else{if(l.getComputedStyle){if(t.match(/float/i)){t="float"}t=t.replace(/([A-Z])/g,"-$1").toLowerCase();var o=l.getComputedStyle(e,null);if(o){r=o.getPropertyValue(t)}if(t=="opacity"&&r==""){r="1"}}else{if(e.currentStyle){var u=t.replace(/\-(\w)/g,function(e,t){return t.toUpperCase()});r=e.currentStyle[t]||e.currentStyle[u];if(!/^\d+(px)?$/i.test(r)&&/^\d/.test(r)){var a=s.left,f=e.runtimeStyle.left;e.runtimeStyle.left=e.currentStyle.left;s.left=r||0;r=s.pixelLeft+"px";s.left=a;e.runtimeStyle.left=f}}}}return r},clean:function(e,t,n){t=t||document;if(typeof t.createElement==="undefined"){t=t.ownerDocument||t[0]&&t[0].ownerDocument||document}if(!n&&e.length===1&&typeof e[0]==="string"){var r=/^<(\w+)\s*\/?>$/.exec(e[0]);if(r){return[t.createElement(r[1])]}}var s=[],o=[],u=t.createElement("div");i.each(e,function(e,n){if(typeof n==="number"){n+=""}if(!n){return}if(typeof n==="string"){n=n.replace(/(<(\w+)[^>]*?)\/>/g,function(e,t,n){return n.match(/^(abbr|br|col|img|input|link|meta|param|hr|area|embed)$/i)?e:t+"></"+n+">"});var r=n.replace(/^\s+/,"").substring(0,10).toLowerCase();var o=!r.indexOf("<opt")&&[1,"<select multiple='multiple'>","</select>"]||!r.indexOf("<leg")&&[1,"<fieldset>","</fieldset>"]||r.match(/^<(thead|tbody|tfoot|colg|cap)/)&&[1,"<table>","</table>"]||!r.indexOf("<tr")&&[2,"<table><tbody>","</tbody></table>"]||(!r.indexOf("<td")||!r.indexOf("<th"))&&[3,"<table><tbody><tr>","</tr></tbody></table>"]||!r.indexOf("<col")&&[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"]||!i.support.htmlSerialize&&[1,"div<div>","</div>"]||[0,"",""];u.innerHTML=o[1]+n+o[2];while(o[0]--){u=u.lastChild}if(!i.support.tbody){var a=/<tbody/i.test(n),f=!r.indexOf("<table")&&!a?u.firstChild&&u.firstChild.childNodes:o[1]=="<table>"&&!a?u.childNodes:[];for(var l=f.length-1;l>=0;--l){if(i.nodeName(f[l],"tbody")&&!f[l].childNodes.length){f[l].parentNode.removeChild(f[l])}}}if(!i.support.leadingWhitespace&&/^\s/.test(n)){u.insertBefore(t.createTextNode(n.match(/^\s*/)[0]),u.firstChild)}n=i.makeArray(u.childNodes)}if(n.nodeType){s.push(n)}else{s=i.merge(s,n)}});if(n){for(var a=0;s[a];a++){if(i.nodeName(s[a],"script")&&(!s[a].type||s[a].type.toLowerCase()==="text/javascript")){o.push(s[a].parentNode?s[a].parentNode.removeChild(s[a]):s[a])}else{if(s[a].nodeType===1){s.splice.apply(s,[a+1,0].concat(i.makeArray(s[a].getElementsByTagName("script"))))}n.appendChild(s[a])}}return o}return s},attr:function(e,n,r){if(!e||e.nodeType==3||e.nodeType==8){return t}var s=!i.isXMLDoc(e),o=r!==t;n=s&&i.props[n]||n;if(e.tagName){var u=/href|src|style/.test(n);if(n=="selected"&&e.parentNode){e.parentNode.selectedIndex}if(n in e&&s&&!u){if(o){if(n=="type"&&i.nodeName(e,"input")&&e.parentNode){throw"type property can't be changed"}e[n]=r}if(i.nodeName(e,"form")&&e.getAttributeNode(n)){return e.getAttributeNode(n).nodeValue}if(n=="tabIndex"){var a=e.getAttributeNode("tabIndex");return a&&a.specified?a.value:e.nodeName.match(/(button|input|object|select|textarea)/i)?0:e.nodeName.match(/^(a|area)$/i)&&e.href?0:t}return e[n]}if(!i.support.style&&s&&n=="style"){return i.attr(e.style,"cssText",r)}if(o){e.setAttribute(n,""+r)}var f=!i.support.hrefNormalized&&s&&u?e.getAttribute(n,2):e.getAttribute(n);return f===null?t:f}if(!i.support.opacity&&n=="opacity"){if(o){e.zoom=1;e.filter=(e.filter||"").replace(/alpha\([^)]*\)/,"")+(parseInt(r)+""=="NaN"?"":"alpha(opacity="+r*100+")")}return e.filter&&e.filter.indexOf("opacity=")>=0?parseFloat(e.filter.match(/opacity=([^)]*)/)[1])/100+"":""}n=n.replace(/-([a-z])/ig,function(e,t){return t.toUpperCase()});if(o){e[n]=r}return e[n]},trim:function(e){return(e||"").replace(/^\s+|\s+$/g,"")},makeArray:function(e){var t=[];if(e!=null){var n=e.length;if(n==null||typeof e==="string"||i.isFunction(e)||e.setInterval){t[0]=e}else{while(n){t[--n]=e[n]}}}return t},inArray:function(e,t){for(var n=0,r=t.length;n<r;n++){if(t[n]===e){return n}}return-1},merge:function(e,t){var n=0,r,s=e.length;if(!i.support.getAll){while((r=t[n++])!=null){if(r.nodeType!=8){e[s++]=r}}}else{while((r=t[n++])!=null){e[s++]=r}}return e},unique:function(e){var t=[],n={};try{for(var r=0,s=e.length;r<s;r++){var o=i.data(e[r]);if(!n[o]){n[o]=true;t.push(e[r])}}}catch(u){t=e}return t},grep:function(e,t,n){var r=[];for(var i=0,s=e.length;i<s;i++){if(!n!=!t(e[i],i)){r.push(e[i])}}return r},map:function(e,t){var n=[];for(var r=0,i=e.length;r<i;r++){var s=t(e[r],r);if(s!=null){n[n.length]=s}}return n.concat.apply([],n)}});var h=navigator.userAgent.toLowerCase();i.browser={version:(h.match(/.+(?:rv|it|ra|ie)[\/: ]([\d.]+)/)||[0,"0"])[1],safari:/webkit/.test(h),opera:/opera/.test(h),msie:/msie/.test(h)&&!/opera/.test(h),mozilla:/mozilla/.test(h)&&!/(compatible|webkit)/.test(h)};i.each({parent:function(e){return e.parentNode},parents:function(e){return i.dir(e,"parentNode")},next:function(e){return i.nth(e,2,"nextSibling")},prev:function(e){return i.nth(e,2,"previousSibling")},nextAll:function(e){return i.dir(e,"nextSibling")},prevAll:function(e){return i.dir(e,"previousSibling")},siblings:function(e){return i.sibling(e.parentNode.firstChild,e)},children:function(e){return i.sibling(e.firstChild)},contents:function(e){return i.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:i.makeArray(e.childNodes)}},function(e,t){i.fn[e]=function(n){var r=i.map(this,t);if(n&&typeof n=="string"){r=i.multiFilter(n,r)}return this.pushStack(i.unique(r),e,n)}});i.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){i.fn[e]=function(n){var r=[],s=i(n);for(var o=0,u=s.length;o<u;o++){var a=(o>0?this.clone(true):this).get();i.fn[t].apply(i(s[o]),a);r=r.concat(a)}return this.pushStack(r,e,n)}});i.each({removeAttr:function(e){i.attr(this,e,"");if(this.nodeType==1){this.removeAttribute(e)}},addClass:function(e){i.className.add(this,e)},removeClass:function(e){i.className.remove(this,e)},toggleClass:function(e,t){if(typeof t!=="boolean"){t=!i.className.has(this,e)}i.className[t?"add":"remove"](this,e)},remove:function(e){if(!e||i.filter(e,[this]).length){i("*",this).add([this]).each(function(){i.event.remove(this);i.removeData(this)});if(this.parentNode){this.parentNode.removeChild(this)}}},empty:function(){i(this).children().remove();while(this.firstChild){this.removeChild(this.firstChild)}}},function(e,t){i.fn[e]=function(){return this.each(t,arguments)}});var d="jQuery"+a(),v=0,m={};i.extend({cache:{},data:function(n,r,s){n=n==e?m:n;var o=n[d];if(!o){o=n[d]=++v}if(r&&!i.cache[o]){i.cache[o]={}}if(s!==t){i.cache[o][r]=s}return r?i.cache[o][r]:o},removeData:function(t,n){t=t==e?m:t;var r=t[d];if(n){if(i.cache[r]){delete i.cache[r][n];n="";for(n in i.cache[r]){break}if(!n){i.removeData(t)}}}else{try{delete t[d]}catch(s){if(t.removeAttribute){t.removeAttribute(d)}}delete i.cache[r]}},queue:function(e,t,n){if(e){t=(t||"fx")+"queue";var r=i.data(e,t);if(!r||i.isArray(n)){r=i.data(e,t,i.makeArray(n))}else{if(n){r.push(n)}}}return r},dequeue:function(e,n){var r=i.queue(e,n),s=r.shift();if(!n||n==="fx"){s=r[0]}if(s!==t){s.call(e)}}});i.fn.extend({data:function(e,n){var r=e.split(".");r[1]=r[1]?"."+r[1]:"";if(n===t){var s=this.triggerHandler("getData"+r[1]+"!",[r[0]]);if(s===t&&this.length){s=i.data(this[0],e)}return s===t&&r[1]?this.data(r[0]):s}else{return this.trigger("setData"+r[1]+"!",[r[0],n]).each(function(){i.data(this,e,n)})}},removeData:function(e){return this.each(function(){i.removeData(this,e)})},queue:function(e,n){if(typeof e!=="string"){n=e;e="fx"}if(n===t){return i.queue(this[0],e)}return this.each(function(){var t=i.queue(this,e,n);if(e=="fx"&&t.length==1){t[0].call(this)}})},dequeue:function(e){return this.each(function(){i.dequeue(this,e)})}});(function(){function p(e,t,n,r,i,s){var o=e=="previousSibling"&&!s;for(var u=0,a=r.length;u<a;u++){var f=r[u];if(f){if(o&&f.nodeType===1){f.sizcache=n;f.sizset=u}f=f[e];var l=false;while(f){if(f.sizcache===n){l=r[f.sizset];break}if(f.nodeType===1&&!s){f.sizcache=n;f.sizset=u}if(f.nodeName===t){l=f;break}f=f[e]}r[u]=l}}}function d(e,t,n,r,i,s){var u=e=="previousSibling"&&!s;for(var a=0,f=r.length;a<f;a++){var l=r[a];if(l){if(u&&l.nodeType===1){l.sizcache=n;l.sizset=a}l=l[e];var c=false;while(l){if(l.sizcache===n){c=r[l.sizset];break}if(l.nodeType===1){if(!s){l.sizcache=n;l.sizset=a}if(typeof t!=="string"){if(l===t){c=true;break}}else{if(o.filter(t,[l]).length>0){c=l;break}}}l=l[e]}r[a]=c}}}var n=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^[\]]*\]|['"][^'"]*['"]|[^[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?/g,r=0,s=Object.prototype.toString;var o=function(e,t,r,i){r=r||[];t=t||document;if(t.nodeType!==1&&t.nodeType!==9){return[]}if(!e||typeof e!=="string"){return r}var f=[],c,p,d,y,b,w,E=true;n.lastIndex=0;while((c=n.exec(e))!==null){f.push(c[1]);if(c[2]){w=RegExp.rightContext;break}}if(f.length>1&&a.exec(e)){if(f.length===2&&u.relative[f[0]]){p=g(f[0]+f[1],t)}else{p=u.relative[f[0]]?[t]:o(f.shift(),t);while(f.length){e=f.shift();if(u.relative[e]){e+=f.shift()}p=g(e,p)}}}else{var S=i?{expr:f.pop(),set:l(i)}:o.find(f.pop(),f.length===1&&t.parentNode?t.parentNode:t,m(t));p=o.filter(S.expr,S.set);if(f.length>0){d=l(p)}else{E=false}while(f.length){var x=f.pop(),T=x;if(!u.relative[x]){x=""}else{T=f.pop()}if(T==null){T=t}u.relative[x](d,T,m(t))}}if(!d){d=p}if(!d){throw"Syntax error, unrecognized expression: "+(x||e)}if(s.call(d)==="[object Array]"){if(!E){r.push.apply(r,d)}else{if(t.nodeType===1){for(var N=0;d[N]!=null;N++){if(d[N]&&(d[N]===true||d[N].nodeType===1&&v(t,d[N]))){r.push(p[N])}}}else{for(var N=0;d[N]!=null;N++){if(d[N]&&d[N].nodeType===1){r.push(p[N])}}}}}else{l(d,r)}if(w){o(w,t,r,i);if(h){hasDuplicate=false;r.sort(h);if(hasDuplicate){for(var N=1;N<r.length;N++){if(r[N]===r[N-1]){r.splice(N--,1)}}}}}return r};o.matches=function(e,t){return o(e,null,null,t)};o.find=function(e,t,n){var r,i;if(!e){return[]}for(var s=0,o=u.order.length;s<o;s++){var a=u.order[s],i;if(i=u.match[a].exec(e)){var f=RegExp.leftContext;if(f.substr(f.length-1)!=="\\"){i[1]=(i[1]||"").replace(/\\/g,"");r=u.find[a](i,t,n);if(r!=null){e=e.replace(u.match[a],"");break}}}}if(!r){r=t.getElementsByTagName("*")}return{set:r,expr:e}};o.filter=function(e,n,r,i){var s=e,o=[],a=n,f,l,c=n&&n[0]&&m(n[0]);while(e&&n.length){for(var h in u.filter){if((f=u.match[h].exec(e))!=null){var p=u.filter[h],d,v;l=false;if(a==o){o=[]}if(u.preFilter[h]){f=u.preFilter[h](f,a,r,o,i,c);if(!f){l=d=true}else{if(f===true){continue}}}if(f){for(var g=0;(v=a[g])!=null;g++){if(v){d=p(v,f,g,a);var y=i^!!d;if(r&&d!=null){if(y){l=true}else{a[g]=false}}else{if(y){o.push(v);l=true}}}}}if(d!==t){if(!r){a=o}e=e.replace(u.match[h],"");if(!l){return[]}break}}}if(e==s){if(l==null){throw"Syntax error, unrecognized expression: "+e}else{break}}s=e}return a};var u=o.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF_-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF_-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF_-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF_-]|\\.)+)\s*(?:(\S?=)\s*(['"]*)(.*?)\3|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*_-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\((even|odd|[\dn+-]*)\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF_-]|\\.)+)(?:\((['"]*)((?:\([^\)]+\)|[^\2\(\)]*)+)\2\))?/},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(e){return e.getAttribute("href")}},relative:{"+":function(e,t,n){var r=typeof t==="string",i=r&&!/\W/.test(t),s=r&&!i;if(i&&!n){t=t.toUpperCase()}for(var u=0,a=e.length,f;u<a;u++){if(f=e[u]){while((f=f.previousSibling)&&f.nodeType!==1){}e[u]=s||f&&f.nodeName===t?f||false:f===t}}if(s){o.filter(t,e,true)}},">":function(e,t,n){var r=typeof t==="string";if(r&&!/\W/.test(t)){t=n?t:t.toUpperCase();for(var i=0,s=e.length;i<s;i++){var u=e[i];if(u){var a=u.parentNode;e[i]=a.nodeName===t?a:false}}}else{for(var i=0,s=e.length;i<s;i++){var u=e[i];if(u){e[i]=r?u.parentNode:u.parentNode===t}}if(r){o.filter(t,e,true)}}},"":function(e,t,n){var i=r++,s=d;if(!t.match(/\W/)){var o=t=n?t:t.toUpperCase();s=p}s("parentNode",t,i,e,o,n)},"~":function(e,t,n){var i=r++,s=d;if(typeof t==="string"&&!t.match(/\W/)){var o=t=n?t:t.toUpperCase();s=p}s("previousSibling",t,i,e,o,n)}},find:{ID:function(e,t,n){if(typeof t.getElementById!=="undefined"&&!n){var r=t.getElementById(e[1]);return r?[r]:[]}},NAME:function(e,t,n){if(typeof t.getElementsByName!=="undefined"){var r=[],i=t.getElementsByName(e[1]);for(var s=0,o=i.length;s<o;s++){if(i[s].getAttribute("name")===e[1]){r.push(i[s])}}return r.length===0?null:r}},TAG:function(e,t){return t.getElementsByTagName(e[1])}},preFilter:{CLASS:function(e,t,n,r,i,s){e=" "+e[1].replace(/\\/g,"")+" ";if(s){return e}for(var o=0,u;(u=t[o])!=null;o++){if(u){if(i^(u.className&&(" "+u.className+" ").indexOf(e)>=0)){if(!n){r.push(u)}}else{if(n){t[o]=false}}}}return false},ID:function(e){return e[1].replace(/\\/g,"")},TAG:function(e,t){for(var n=0;t[n]===false;n++){}return t[n]&&m(t[n])?e[1]:e[1].toUpperCase()},CHILD:function(e){if(e[1]=="nth"){var t=/(-?)(\d*)n((?:\+|-)?\d*)/.exec(e[2]=="even"&&"2n"||e[2]=="odd"&&"2n+1"||!/\D/.test(e[2])&&"0n+"+e[2]||e[2]);e[2]=t[1]+(t[2]||1)-0;e[3]=t[3]-0}e[0]=r++;return e},ATTR:function(e,t,n,r,i,s){var o=e[1].replace(/\\/g,"");if(!s&&u.attrMap[o]){e[1]=u.attrMap[o]}if(e[2]==="~="){e[4]=" "+e[4]+" "}return e},PSEUDO:function(e,t,r,i,s){if(e[1]==="not"){if(e[3].match(n).length>1||/^\w/.test(e[3])){e[3]=o(e[3],null,null,t)}else{var a=o.filter(e[3],t,r,true^s);if(!r){i.push.apply(i,a)}return false}}else{if(u.match.POS.test(e[0])||u.match.CHILD.test(e[0])){return true}}return e},POS:function(e){e.unshift(true);return e}},filters:{enabled:function(e){return e.disabled===false&&e.type!=="hidden"},disabled:function(e){return e.disabled===true},checked:function(e){return e.checked===true},selected:function(e){e.parentNode.selectedIndex;return e.selected===true},parent:function(e){return!!e.firstChild},empty:function(e){return!e.firstChild},has:function(e,t,n){return!!o(n[3],e).length},header:function(e){return/h\d/i.test(e.nodeName)},text:function(e){return"text"===e.type},radio:function(e){return"radio"===e.type},checkbox:function(e){return"checkbox"===e.type},file:function(e){return"file"===e.type},password:function(e){return"password"===e.type},submit:function(e){return"submit"===e.type},image:function(e){return"image"===e.type},reset:function(e){return"reset"===e.type},button:function(e){return"button"===e.type||e.nodeName.toUpperCase()==="BUTTON"},input:function(e){return/input|select|textarea|button/i.test(e.nodeName)}},setFilters:{first:function(e,t){return t===0},last:function(e,t,n,r){return t===r.length-1},even:function(e,t){return t%2===0},odd:function(e,t){return t%2===1},lt:function(e,t,n){return t<n[3]-0},gt:function(e,t,n){return t>n[3]-0},nth:function(e,t,n){return n[3]-0==t},eq:function(e,t,n){return n[3]-0==t}},filter:{PSEUDO:function(e,t,n,r){var i=t[1],s=u.filters[i];if(s){return s(e,n,t,r)}else{if(i==="contains"){return(e.textContent||e.innerText||"").indexOf(t[3])>=0}else{if(i==="not"){var o=t[3];for(var n=0,a=o.length;n<a;n++){if(o[n]===e){return false}}return true}}}},CHILD:function(e,t){var n=t[1],r=e;switch(n){case"only":case"first":while(r=r.previousSibling){if(r.nodeType===1){return false}}if(n=="first"){return true}r=e;case"last":while(r=r.nextSibling){if(r.nodeType===1){return false}}return true;case"nth":var i=t[2],s=t[3];if(i==1&&s==0){return true}var o=t[0],u=e.parentNode;if(u&&(u.sizcache!==o||!e.nodeIndex)){var a=0;for(r=u.firstChild;r;r=r.nextSibling){if(r.nodeType===1){r.nodeIndex=++a}}u.sizcache=o}var f=e.nodeIndex-s;if(i==0){return f==0}else{return f%i==0&&f/i>=0}}},ID:function(e,t){return e.nodeType===1&&e.getAttribute("id")===t},TAG:function(e,t){return t==="*"&&e.nodeType===1||e.nodeName===t},CLASS:function(e,t){return(" "+(e.className||e.getAttribute("class"))+" ").indexOf(t)>-1},ATTR:function(e,t){var n=t[1],r=u.attrHandle[n]?u.attrHandle[n](e):e[n]!=null?e[n]:e.getAttribute(n),i=r+"",s=t[2],o=t[4];return r==null?s==="!=":s==="="?i===o:s==="*="?i.indexOf(o)>=0:s==="~="?(" "+i+" ").indexOf(o)>=0:!o?i&&r!==false:s==="!="?i!=o:s==="^="?i.indexOf(o)===0:s==="$="?i.substr(i.length-o.length)===o:s==="|="?i===o||i.substr(0,o.length+1)===o+"-":false},POS:function(e,t,n,r){var i=t[2],s=u.setFilters[i];if(s){return s(e,n,t,r)}}}};var a=u.match.POS;for(var f in u.match){u.match[f]=RegExp(u.match[f].source+/(?![^\[]*\])(?![^\(]*\))/.source)}var l=function(e,t){e=Array.prototype.slice.call(e);if(t){t.push.apply(t,e);return t}return e};try{Array.prototype.slice.call(document.documentElement.childNodes)}catch(c){l=function(e,t){var n=t||[];if(s.call(e)==="[object Array]"){Array.prototype.push.apply(n,e)}else{if(typeof e.length==="number"){for(var r=0,i=e.length;r<i;r++){n.push(e[r])}}else{for(var r=0;e[r];r++){n.push(e[r])}}}return n}}var h;if(document.documentElement.compareDocumentPosition){h=function(e,t){var n=e.compareDocumentPosition(t)&4?-1:e===t?0:1;if(n===0){hasDuplicate=true}return n}}else{if("sourceIndex"in document.documentElement){h=function(e,t){var n=e.sourceIndex-t.sourceIndex;if(n===0){hasDuplicate=true}return n}}else{if(document.createRange){h=function(e,t){var n=e.ownerDocument.createRange(),r=t.ownerDocument.createRange();n.selectNode(e);n.collapse(true);r.selectNode(t);r.collapse(true);var i=n.compareBoundaryPoints(Range.START_TO_END,r);if(i===0){hasDuplicate=true}return i}}}}(function(){var e=document.createElement("form"),n="script"+(new Date).getTime();e.innerHTML="<input name='"+n+"'/>";var r=document.documentElement;r.insertBefore(e,r.firstChild);if(!!document.getElementById(n)){u.find.ID=function(e,n,r){if(typeof n.getElementById!=="undefined"&&!r){var i=n.getElementById(e[1]);return i?i.id===e[1]||typeof i.getAttributeNode!=="undefined"&&i.getAttributeNode("id").nodeValue===e[1]?[i]:t:[]}};u.filter.ID=function(e,t){var n=typeof e.getAttributeNode!=="undefined"&&e.getAttributeNode("id");return e.nodeType===1&&n&&n.nodeValue===t}}r.removeChild(e)})();(function(){var e=document.createElement("div");e.appendChild(document.createComment(""));if(e.getElementsByTagName("*").length>0){u.find.TAG=function(e,t){var n=t.getElementsByTagName(e[1]);if(e[1]==="*"){var r=[];for(var i=0;n[i];i++){if(n[i].nodeType===1){r.push(n[i])}}n=r}return n}}e.innerHTML="<a href='#'></a>";if(e.firstChild&&typeof e.firstChild.getAttribute!=="undefined"&&e.firstChild.getAttribute("href")!=="#"){u.attrHandle.href=function(e){return e.getAttribute("href",2)}}})();if(document.querySelectorAll){(function(){var e=o,t=document.createElement("div");t.innerHTML="<p class='TEST'></p>";if(t.querySelectorAll&&t.querySelectorAll(".TEST").length===0){return}o=function(t,n,r,i){n=n||document;if(!i&&n.nodeType===9&&!m(n)){try{return l(n.querySelectorAll(t),r)}catch(s){}}return e(t,n,r,i)};o.find=e.find;o.filter=e.filter;o.selectors=e.selectors;o.matches=e.matches})()}if(document.getElementsByClassName&&document.documentElement.getElementsByClassName){(function(){var e=document.createElement("div");e.innerHTML="<div class='test e'></div><div class='test'></div>";if(e.getElementsByClassName("e").length===0){return}e.lastChild.className="e";if(e.getElementsByClassName("e").length===1){return}u.order.splice(1,0,"CLASS");u.find.CLASS=function(e,t,n){if(typeof t.getElementsByClassName!=="undefined"&&!n){return t.getElementsByClassName(e[1])}}})()}var v=document.compareDocumentPosition?function(e,t){return e.compareDocumentPosition(t)&16}:function(e,t){return e!==t&&(e.contains?e.contains(t):true)};var m=function(e){return e.nodeType===9&&e.documentElement.nodeName!=="HTML"||!!e.ownerDocument&&m(e.ownerDocument)};var g=function(e,t){var n=[],r="",i,s=t.nodeType?[t]:t;while(i=u.match.PSEUDO.exec(e)){r+=i[0];e=e.replace(u.match.PSEUDO,"")}e=u.relative[e]?e+"*":e;for(var a=0,f=s.length;a<f;a++){o(e,s[a],n)}return o.filter(r,n)};i.find=o;i.filter=o.filter;i.expr=o.selectors;i.expr[":"]=i.expr.filters;o.selectors.filters.hidden=function(e){return e.offsetWidth===0||e.offsetHeight===0};o.selectors.filters.visible=function(e){return e.offsetWidth>0||e.offsetHeight>0};o.selectors.filters.animated=function(e){return i.grep(i.timers,function(t){return e===t.elem}).length};i.multiFilter=function(e,t,n){if(n){e=":not("+e+")"}return o.matches(e,t)};i.dir=function(e,t){var n=[],r=e[t];while(r&&r!=document){if(r.nodeType==1){n.push(r)}r=r[t]}return n};i.nth=function(e,t,n,r){t=t||1;var i=0;for(;e;e=e[n]){if(e.nodeType==1&&++i==t){break}}return e};i.sibling=function(e,t){var n=[];for(;e;e=e.nextSibling){if(e.nodeType==1&&e!=t){n.push(e)}}return n};return;e.Sizzle=o})();i.event={add:function(n,r,s,o){if(n.nodeType==3||n.nodeType==8){return}if(n.setInterval&&n!=e){n=e}if(!s.guid){s.guid=this.guid++}if(o!==t){var u=s;s=this.proxy(u);s.data=o}var a=i.data(n,"events")||i.data(n,"events",{}),f=i.data(n,"handle")||i.data(n,"handle",function(){return typeof i!=="undefined"&&!i.event.triggered?i.event.handle.apply(arguments.callee.elem,arguments):t});f.elem=n;i.each(r.split(/\s+/),function(e,t){var r=t.split(".");t=r.shift();s.type=r.slice().sort().join(".");var u=a[t];if(i.event.specialAll[t]){i.event.specialAll[t].setup.call(n,o,r)}if(!u){u=a[t]={};if(!i.event.special[t]||i.event.special[t].setup.call(n,o,r)===false){if(n.addEventListener){n.addEventListener(t,f,false)}else{if(n.attachEvent){n.attachEvent("on"+t,f)}}}}u[s.guid]=s;i.event.global[t]=true});n=null},guid:1,global:{},remove:function(e,n,r){if(e.nodeType==3||e.nodeType==8){return}var s=i.data(e,"events"),o,u;if(s){if(n===t||typeof n==="string"&&n.charAt(0)=="."){for(var a in s){this.remove(e,a+(n||""))}}else{if(n.type){r=n.handler;n=n.type}i.each(n.split(/\s+/),function(t,n){var u=n.split(".");n=u.shift();var a=RegExp("(^|\\.)"+u.slice().sort().join(".*\\.")+"(\\.|$)");if(s[n]){if(r){delete s[n][r.guid]}else{for(var f in s[n]){if(a.test(s[n][f].type)){delete s[n][f]}}}if(i.event.specialAll[n]){i.event.specialAll[n].teardown.call(e,u)}for(o in s[n]){break}if(!o){if(!i.event.special[n]||i.event.special[n].teardown.call(e,u)===false){if(e.removeEventListener){e.removeEventListener(n,i.data(e,"handle"),false)}else{if(e.detachEvent){e.detachEvent("on"+n,i.data(e,"handle"))}}}o=null;delete s[n]}}})}for(o in s){break}if(!o){var f=i.data(e,"handle");if(f){f.elem=null}i.removeData(e,"events");i.removeData(e,"handle")}}},trigger:function(e,n,r,s){var o=e.type||e;if(!s){e=typeof e==="object"?e[d]?e:i.extend(i.Event(o),e):i.Event(o);if(o.indexOf("!")>=0){e.type=o=o.slice(0,-1);e.exclusive=true}if(!r){e.stopPropagation();if(this.global[o]){i.each(i.cache,function(){if(this.events&&this.events[o]){i.event.trigger(e,n,this.handle.elem)}})}}if(!r||r.nodeType==3||r.nodeType==8){return t}e.result=t;e.target=r;n=i.makeArray(n);n.unshift(e)}e.currentTarget=r;var u=i.data(r,"handle");if(u){u.apply(r,n)}if((!r[o]||i.nodeName(r,"a")&&o=="click")&&r["on"+o]&&r["on"+o].apply(r,n)===false){e.result=false}if(!s&&r[o]&&!e.isDefaultPrevented()&&!(i.nodeName(r,"a")&&o=="click")){this.triggered=true;try{r[o]()}catch(a){}}this.triggered=false;if(!e.isPropagationStopped()){var f=r.parentNode||r.ownerDocument;if(f){i.event.trigger(e,n,f,true)}}},handle:function(n){var r,s;n=arguments[0]=i.event.fix(n||e.event);n.currentTarget=this;var o=n.type.split(".");n.type=o.shift();r=!o.length&&!n.exclusive;var u=RegExp("(^|\\.)"+o.slice().sort().join(".*\\.")+"(\\.|$)");s=(i.data(this,"events")||{})[n.type];for(var a in s){var f=s[a];if(r||u.test(f.type)){n.handler=f;n.data=f.data;var l=f.apply(this,arguments);if(l!==t){n.result=l;if(l===false){n.preventDefault();n.stopPropagation()}}if(n.isImmediatePropagationStopped()){break}}}},props:"altKey attrChange attrName bubbles button cancelable charCode clientX clientY ctrlKey currentTarget data detail eventPhase fromElement handler keyCode metaKey newValue originalTarget pageX pageY prevValue relatedNode relatedTarget screenX screenY shiftKey srcElement target toElement view wheelDelta which".split(" "),fix:function(e){if(e[d]){return e}var t=e;e=i.Event(t);for(var n=this.props.length,r;n;){r=this.props[--n];e[r]=t[r]}if(!e.target){e.target=e.srcElement||document}if(e.target.nodeType==3){e.target=e.target.parentNode}if(!e.relatedTarget&&e.fromElement){e.relatedTarget=e.fromElement==e.target?e.toElement:e.fromElement}if(e.pageX==null&&e.clientX!=null){var s=document.documentElement,o=document.body;e.pageX=e.clientX+(s&&s.scrollLeft||o&&o.scrollLeft||0)-(s.clientLeft||0);e.pageY=e.clientY+(s&&s.scrollTop||o&&o.scrollTop||0)-(s.clientTop||0)}if(!e.which&&(e.charCode||e.charCode===0?e.charCode:e.keyCode)){e.which=e.charCode||e.keyCode}if(!e.metaKey&&e.ctrlKey){e.metaKey=e.ctrlKey}if(!e.which&&e.button){e.which=e.button&1?1:e.button&2?3:e.button&4?2:0}return e},proxy:function(e,t){t=t||function(){return e.apply(this,arguments)};t.guid=e.guid=e.guid||t.guid||this.guid++;return t},special:{ready:{setup:x,teardown:function(){}}},specialAll:{live:{setup:function(e,t){i.event.add(this,t[0],w)},teardown:function(e){if(e.length){var t=0,n=RegExp("(^|\\.)"+e[0]+"(\\.|$)");i.each(i.data(this,"events").live||{},function(){if(n.test(this.type)){t++}});if(t<1){i.event.remove(this,e[0],w)}}}}}};i.Event=function(e){if(!this.preventDefault){return new i.Event(e)}if(e&&e.type){this.originalEvent=e;this.type=e.type}else{this.type=e}this.timeStamp=a();this[d]=true};i.Event.prototype={preventDefault:function(){this.isDefaultPrevented=y;var e=this.originalEvent;if(!e){return}if(e.preventDefault){e.preventDefault()}e.returnValue=false},stopPropagation:function(){this.isPropagationStopped=y;var e=this.originalEvent;if(!e){return}if(e.stopPropagation){e.stopPropagation()}e.cancelBubble=true},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=y;this.stopPropagation()},isDefaultPrevented:g,isPropagationStopped:g,isImmediatePropagationStopped:g};var b=function(e){var t=e.relatedTarget;while(t&&t!=this){try{t=t.parentNode}catch(n){t=this}}if(t!=this){e.type=e.data;i.event.handle.apply(this,arguments)}};i.each({mouseover:"mouseenter",mouseout:"mouseleave"},function(e,t){i.event.special[t]={setup:function(){i.event.add(this,e,b,t)},teardown:function(){i.event.remove(this,e,b)}}});i.fn.extend({bind:function(e,t,n){return e=="unload"?this.one(e,t,n):this.each(function(){i.event.add(this,e,n||t,n&&t)})},one:function(e,t,n){var r=i.event.proxy(n||t,function(e){i(this).unbind(e,r);return(n||t).apply(this,arguments)});return this.each(function(){i.event.add(this,e,r,n&&t)})},unbind:function(e,t){return this.each(function(){i.event.remove(this,e,t)})},trigger:function(e,t){return this.each(function(){i.event.trigger(e,t,this)})},triggerHandler:function(e,t){if(this[0]){var n=i.Event(e);n.preventDefault();n.stopPropagation();i.event.trigger(n,t,this[0]);return n.result}},toggle:function(e){var t=arguments,n=1;while(n<t.length){i.event.proxy(e,t[n++])}return this.click(i.event.proxy(e,function(e){this.lastToggle=(this.lastToggle||0)%n;e.preventDefault();return t[this.lastToggle++].apply(this,arguments)||false}))},hover:function(e,t){return this.mouseenter(e).mouseleave(t)},ready:function(e){x();if(i.isReady){e.call(document,i)}else{i.readyList.push(e)}return this},live:function(e,t){var n=i.event.proxy(t);n.guid+=this.selector+e;i(document).bind(E(e,this.selector),this.selector,n);return this},die:function(e,t){i(document).unbind(E(e,this.selector),t?{guid:t.guid+this.selector+e}:null);return this}});i.extend({isReady:false,readyList:[],ready:function(){if(!i.isReady){i.isReady=true;if(i.readyList){i.each(i.readyList,function(){this.call(document,i)});i.readyList=null}i(document).triggerHandler("ready")}}});var S=false;i.each("blur,focus,load,resize,scroll,unload,click,dblclick,mousedown,mouseup,mousemove,mouseover,mouseout,mouseenter,mouseleave,change,select,submit,keydown,keypress,keyup,error".split(","),function(e,t){i.fn[t]=function(e){return e?this.bind(t,e):this.trigger(t)}});i(e).bind("unload",function(){for(var e in i.cache){if(e!=1&&i.cache[e].handle){i.event.remove(i.cache[e].handle.elem)}}});(function(){i.support={};var t=document.documentElement,n=document.createElement("script"),r=document.createElement("div"),s="script"+(new Date).getTime();r.style.display="none";r.innerHTML='   <link/><table></table><a href="/a" style="color:red;float:left;opacity:.5;">a</a><select><option>text</option></select><object><param/></object>';var o=r.getElementsByTagName("*"),u=r.getElementsByTagName("a")[0];if(!o||!o.length||!u){return}i.support={leadingWhitespace:r.firstChild.nodeType==3,tbody:!r.getElementsByTagName("tbody").length,objectAll:!!r.getElementsByTagName("object")[0].getElementsByTagName("*").length,htmlSerialize:!!r.getElementsByTagName("link").length,style:/red/.test(u.getAttribute("style")),hrefNormalized:u.getAttribute("href")==="/a",opacity:u.style.opacity==="0.5",cssFloat:!!u.style.cssFloat,scriptEval:false,noCloneEvent:true,boxModel:null};n.type="text/javascript";try{n.appendChild(document.createTextNode("window."+s+"=1;"))}catch(a){}t.insertBefore(n,t.firstChild);if(e[s]){i.support.scriptEval=true;delete e[s]}t.removeChild(n);if(r.attachEvent&&r.fireEvent){r.attachEvent("onclick",function(){i.support.noCloneEvent=false;r.detachEvent("onclick",arguments.callee)});r.cloneNode(true).fireEvent("onclick")}i(function(){var e=document.createElement("div");e.style.width=e.style.paddingLeft="1px";document.body.appendChild(e);i.boxModel=i.support.boxModel=e.offsetWidth===2;document.body.removeChild(e).style.display="none"})})();var T=i.support.cssFloat?"cssFloat":"styleFloat";i.props={"for":"htmlFor","class":"className","float":T,cssFloat:T,styleFloat:T,readonly:"readOnly",maxlength:"maxLength",cellspacing:"cellSpacing",rowspan:"rowSpan",tabindex:"tabIndex"};i.fn.extend({_load:i.fn.load,load:function(e,t,n){if(typeof e!=="string"){return this._load(e)}var r=e.indexOf(" ");if(r>=0){var s=e.slice(r,e.length);e=e.slice(0,r)}var o="GET";if(t){if(i.isFunction(t)){n=t;t=null}else{if(typeof t==="object"){t=i.param(t);o="POST"}}}var u=this;i.ajax({url:e,type:o,dataType:"html",data:t,complete:function(e,t){if(t=="success"||t=="notmodified"){u.html(s?i("<div/>").append(e.responseText.replace(/<script(.|\s)*?\/script>/g,"")).find(s):e.responseText)}if(n){u.each(n,[e.responseText,t,e])}}});return this},serialize:function(){return i.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?i.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||/select|textarea/i.test(this.nodeName)||/text|hidden|password|search/i.test(this.type))}).map(function(e,t){var n=i(this).val();return n==null?null:i.isArray(n)?i.map(n,function(e,n){return{name:t.name,value:e}}):{name:t.name,value:n}}).get()}});i.each("ajaxStart,ajaxStop,ajaxComplete,ajaxError,ajaxSuccess,ajaxSend".split(","),function(e,t){i.fn[t]=function(e){return this.bind(t,e)}});var N=a();i.extend({get:function(e,t,n,r){if(i.isFunction(t)){n=t;t=null}return i.ajax({type:"GET",url:e,data:t,success:n,dataType:r})},getScript:function(e,t){return i.get(e,null,t,"script")},getJSON:function(e,t,n){return i.get(e,t,n,"json")},post:function(e,t,n,r){if(i.isFunction(t)){n=t;t={}}return i.ajax({type:"POST",url:e,data:t,success:n,dataType:r})},ajaxSetup:function(e){i.extend(i.ajaxSettings,e)},ajaxSettings:{url:location.href,global:true,type:"GET",contentType:"application/x-www-form-urlencoded",processData:true,async:true,xhr:function(){return e.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest},accepts:{xml:"application/xml, text/xml",html:"text/html",script:"text/javascript, application/javascript",json:"application/json, text/javascript",text:"text/plain",_default:"*/*"}},lastModified:{},ajax:function(n){function E(){if(n.success){n.success(u,o)}if(n.global){i.event.trigger("ajaxSuccess",[g,n])}}function S(){if(n.complete){n.complete(g,o)}if(n.global){i.event.trigger("ajaxComplete",[g,n])}if(n.global&&!--i.active){i.event.trigger("ajaxStop")}}n=i.extend(true,n,i.extend(true,{},i.ajaxSettings,n));var r,s=/=\?(&|$)/g,o,u,f=n.type.toUpperCase();if(n.data&&n.processData&&typeof n.data!=="string"){n.data=i.param(n.data)}if(n.dataType=="jsonp"){if(f=="GET"){if(!n.url.match(s)){n.url+=(n.url.match(/\?/)?"&":"?")+(n.jsonp||"callback")+"=?"}}else{if(!n.data||!n.data.match(s)){n.data=(n.data?n.data+"&":"")+(n.jsonp||"callback")+"=?"}}n.dataType="json"}if(n.dataType=="json"&&(n.data&&n.data.match(s)||n.url.match(s))){r="jsonp"+N++;if(n.data){n.data=(n.data+"").replace(s,"="+r+"$1")}n.url=n.url.replace(s,"="+r+"$1");n.dataType="script";e[r]=function(n){u=n;E();S();e[r]=t;try{delete e[r]}catch(i){}if(p){p.removeChild(d)}}}if(n.dataType=="script"&&n.cache==null){n.cache=false}if(n.cache===false&&f=="GET"){var l=a();var c=n.url.replace(/(\?|&)_=.*?(&|$)/,"$1_="+l+"$2");n.url=c+(c==n.url?(n.url.match(/\?/)?"&":"?")+"_="+l:"")}if(n.data&&f=="GET"){n.url+=(n.url.match(/\?/)?"&":"?")+n.data;n.data=null}if(n.global&&!(i.active++)){i.event.trigger("ajaxStart")}var h=/^(\w+:)?\/\/([^\/?#]+)/.exec(n.url);if(n.dataType=="script"&&f=="GET"&&h&&(h[1]&&h[1]!=location.protocol||h[2]!=location.host)){var p=document.getElementsByTagName("head")[0];var d=document.createElement("script");d.src=n.url;if(n.scriptCharset){d.charset=n.scriptCharset}if(!r){var v=false;d.onload=d.onreadystatechange=function(){if(!v&&(!this.readyState||this.readyState=="loaded"||this.readyState=="complete")){v=true;E();S();d.onload=d.onreadystatechange=null;p.removeChild(d)}}}p.appendChild(d);return t}var m=false;var g=n.xhr();if(n.username){g.open(f,n.url,n.async,n.username,n.password)}else{g.open(f,n.url,n.async)}try{if(n.data){g.setRequestHeader("Content-Type",n.contentType)}if(n.ifModified){g.setRequestHeader("If-Modified-Since",i.lastModified[n.url]||"Thu, 01 Jan 1970 00:00:00 GMT")}g.setRequestHeader("X-Requested-With","XMLHttpRequest");g.setRequestHeader("Accept",n.dataType&&n.accepts[n.dataType]?n.accepts[n.dataType]+", */*":n.accepts._default)}catch(y){}if(n.beforeSend&&n.beforeSend(g,n)===false){if(n.global&&!--i.active){i.event.trigger("ajaxStop")}g.abort();return false}if(n.global){i.event.trigger("ajaxSend",[g,n])}var b=function(e){if(g.readyState==0){if(w){clearInterval(w);w=null;if(n.global&&!--i.active){i.event.trigger("ajaxStop")}}}else{if(!m&&g&&(g.readyState==4||e=="timeout")){m=true;if(w){clearInterval(w);w=null}o=e=="timeout"?"timeout":!i.httpSuccess(g)?"error":n.ifModified&&i.httpNotModified(g,n.url)?"notmodified":"success";if(o=="success"){try{u=i.httpData(g,n.dataType,n)}catch(t){o="parsererror"}}if(o=="success"){var s;try{s=g.getResponseHeader("Last-Modified")}catch(t){}if(n.ifModified&&s){i.lastModified[n.url]=s}if(!r){E()}}else{i.handleError(n,g,o)}S();if(e){g.abort()}if(n.async){g=null}}}};if(n.async){var w=setInterval(b,13);if(n.timeout>0){setTimeout(function(){if(g&&!m){b("timeout")}},n.timeout)}}try{g.send(n.data)}catch(y){i.handleError(n,g,null,y)}if(!n.async){b()}return g},handleError:function(e,t,n,r){if(e.error){e.error(t,n,r)}if(e.global){i.event.trigger("ajaxError",[t,e,r])}},active:0,httpSuccess:function(e){try{return!e.status&&location.protocol=="file:"||e.status>=200&&e.status<300||e.status==304||e.status==1223}catch(t){}return false},httpNotModified:function(e,t){try{var n=e.getResponseHeader("Last-Modified");return e.status==304||n==i.lastModified[t]}catch(r){}return false},httpData:function(t,n,r){var s=t.getResponseHeader("content-type"),o=n=="xml"||!n&&s&&s.indexOf("xml")>=0,u=o?t.responseXML:t.responseText;if(o&&u.documentElement.tagName=="parsererror"){throw"parsererror"}if(r&&r.dataFilter){u=r.dataFilter(u,n)}if(typeof u==="string"){if(n=="script"){i.globalEval(u)}if(n=="json"){u=e["eval"]("("+u+")")}}return u},param:function(e){function n(e,n){t[t.length]=encodeURIComponent(e)+"="+encodeURIComponent(n)}var t=[];if(i.isArray(e)||e.jquery){i.each(e,function(){n(this.name,this.value)})}else{for(var r in e){if(i.isArray(e[r])){i.each(e[r],function(){n(r,this)})}else{n(r,i.isFunction(e[r])?e[r]():e[r])}}}return t.join("&").replace(/%20/g,"+")}});var C={},k,L=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]];i.fn.extend({show:function(e,t){if(e){return this.animate(A("show",3),e,t)}else{for(var n=0,r=this.length;n<r;n++){var s=i.data(this[n],"olddisplay");this[n].style.display=s||"";if(i.css(this[n],"display")==="none"){var o=this[n].tagName,u;if(C[o]){u=C[o]}else{var a=i("<"+o+" />").appendTo("body");u=a.css("display");if(u==="none"){u="block"}a.remove();C[o]=u}i.data(this[n],"olddisplay",u)}}for(var n=0,r=this.length;n<r;n++){this[n].style.display=i.data(this[n],"olddisplay")||""}return this}},hide:function(e,t){if(e){return this.animate(A("hide",3),e,t)}else{for(var n=0,r=this.length;n<r;n++){var s=i.data(this[n],"olddisplay");if(!s&&s!=="none"){i.data(this[n],"olddisplay",i.css(this[n],"display"))}}for(var n=0,r=this.length;n<r;n++){this[n].style.display="none"}return this}},_toggle:i.fn.toggle,toggle:function(e,t){var n=typeof e==="boolean";return i.isFunction(e)&&i.isFunction(t)?this._toggle.apply(this,arguments):e==null||n?this.each(function(){var t=n?e:i(this).is(":hidden");i(this)[t?"show":"hide"]()}):this.animate(A("toggle",3),e,t)},fadeTo:function(e,t,n){return this.animate({opacity:t},e,n)},animate:function(e,t,n,r){var s=i.speed(t,n,r);return this[s.queue===false?"each":"queue"](function(){var t=i.extend({},s),n,r=this.nodeType==1&&i(this).is(":hidden"),o=this;for(n in e){if(e[n]=="hide"&&r||e[n]=="show"&&!r){return t.complete.call(this)}if((n=="height"||n=="width")&&this.style){t.display=i.css(this,"display");t.overflow=this.style.overflow}}if(t.overflow!=null){this.style.overflow="hidden"}t.curAnim=i.extend({},e);i.each(e,function(n,s){var u=new i.fx(o,t,n);if(/toggle|show|hide/.test(s)){u[s=="toggle"?r?"show":"hide":s](e)}else{var a=s.toString().match(/^([+-]=)?([\d+-.]+)(.*)$/),f=u.cur(true)||0;if(a){var l=parseFloat(a[2]),c=a[3]||"px";if(c!="px"){o.style[n]=(l||1)+c;f=(l||1)/u.cur(true)*f;o.style[n]=f+c}if(a[1]){l=(a[1]=="-="?-1:1)*l+f}u.custom(f,l,c)}else{u.custom(f,s,"")}}});return true})},stop:function(e,t){var n=i.timers;if(e){this.queue([])}this.each(function(){for(var e=n.length-1;e>=0;e--){if(n[e].elem==this){if(t){n[e](true)}n.splice(e,1)}}});if(!t){this.dequeue()}return this}});i.each({slideDown:A("show",1),slideUp:A("hide",1),slideToggle:A("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"}},function(e,t){i.fn[e]=function(e,n){return this.animate(t,e,n)}});i.extend({speed:function(e,t,n){var r=typeof e==="object"?e:{complete:n||!n&&t||i.isFunction(e)&&e,duration:e,easing:n&&t||t&&!i.isFunction(t)&&t};r.duration=i.fx.off?0:typeof r.duration==="number"?r.duration:i.fx.speeds[r.duration]||i.fx.speeds._default;r.old=r.complete;r.complete=function(){if(r.queue!==false){i(this).dequeue()}if(i.isFunction(r.old)){r.old.call(this)}};return r},easing:{linear:function(e,t,n,r){return n+r*e},swing:function(e,t,n,r){return(-Math.cos(e*Math.PI)/2+.5)*r+n}},timers:[],fx:function(e,t,n){this.options=t;this.elem=e;this.prop=n;if(!t.orig){t.orig={}}}});i.fx.prototype={update:function(){if(this.options.step){this.options.step.call(this.elem,this.now,this)}(i.fx.step[this.prop]||i.fx.step._default)(this);if((this.prop=="height"||this.prop=="width")&&this.elem.style){this.elem.style.display="block"}},cur:function(e){if(this.elem[this.prop]!=null&&(!this.elem.style||this.elem.style[this.prop]==null)){return this.elem[this.prop]}var t=parseFloat(i.css(this.elem,this.prop,e));return t&&t>-1e4?t:parseFloat(i.curCSS(this.elem,this.prop))||0},custom:function(e,n,r){function o(e){return s.step(e)}this.startTime=a();this.start=e;this.end=n;this.unit=r||this.unit||"px";this.now=this.start;this.pos=this.state=0;var s=this;o.elem=this.elem;if(o()&&i.timers.push(o)&&!k){k=setInterval(function(){var e=i.timers;for(var n=0;n<e.length;n++){if(!e[n]()){e.splice(n--,1)}}if(!e.length){clearInterval(k);k=t}},13)}},show:function(){this.options.orig[this.prop]=i.attr(this.elem.style,this.prop);this.options.show=true;this.custom(this.prop=="width"||this.prop=="height"?1:0,this.cur());i(this.elem).show()},hide:function(){this.options.orig[this.prop]=i.attr(this.elem.style,this.prop);this.options.hide=true;this.custom(this.cur(),0)},step:function(e){var t=a();if(e||t>=this.options.duration+this.startTime){this.now=this.end;this.pos=this.state=1;this.update();this.options.curAnim[this.prop]=true;var n=true;for(var r in this.options.curAnim){if(this.options.curAnim[r]!==true){n=false}}if(n){if(this.options.display!=null){this.elem.style.overflow=this.options.overflow;this.elem.style.display=this.options.display;if(i.css(this.elem,"display")=="none"){this.elem.style.display="block"}}if(this.options.hide){i(this.elem).hide()}if(this.options.hide||this.options.show){for(var s in this.options.curAnim){i.attr(this.elem.style,s,this.options.orig[s])}}this.options.complete.call(this.elem)}return false}else{var o=t-this.startTime;this.state=o/this.options.duration;this.pos=i.easing[this.options.easing||(i.easing.swing?"swing":"linear")](this.state,o,0,1,this.options.duration);this.now=this.start+(this.end-this.start)*this.pos;this.update()}return true}};i.extend(i.fx,{speeds:{slow:600,fast:200,_default:400},step:{opacity:function(e){i.attr(e.elem.style,"opacity",e.now)},_default:function(e){if(e.elem.style&&e.elem.style[e.prop]!=null){e.elem.style[e.prop]=e.now+e.unit}else{e.elem[e.prop]=e.now}}}});if(document.documentElement.getBoundingClientRect){i.fn.offset=function(){if(!this[0]){return{top:0,left:0}}if(this[0]===this[0].ownerDocument.body){return i.offset.bodyOffset(this[0])}var e=this[0].getBoundingClientRect(),t=this[0].ownerDocument,n=t.body,r=t.documentElement,s=r.clientTop||n.clientTop||0,o=r.clientLeft||n.clientLeft||0,u=e.top+(self.pageYOffset||i.boxModel&&r.scrollTop||n.scrollTop)-s,a=e.left+(self.pageXOffset||i.boxModel&&r.scrollLeft||n.scrollLeft)-o;return{top:u,left:a}}}else{i.fn.offset=function(){if(!this[0]){return{top:0,left:0}}if(this[0]===this[0].ownerDocument.body){return i.offset.bodyOffset(this[0])}i.offset.initialized||i.offset.initialize();var e=this[0],t=e.offsetParent,n=e,r=e.ownerDocument,s,o=r.documentElement,u=r.body,a=r.defaultView,f=a.getComputedStyle(e,null),l=e.offsetTop,c=e.offsetLeft;while((e=e.parentNode)&&e!==u&&e!==o){s=a.getComputedStyle(e,null);l-=e.scrollTop,c-=e.scrollLeft;if(e===t){l+=e.offsetTop,c+=e.offsetLeft;if(i.offset.doesNotAddBorder&&!(i.offset.doesAddBorderForTableAndCells&&/^t(able|d|h)$/i.test(e.tagName))){l+=parseInt(s.borderTopWidth,10)||0,c+=parseInt(s.borderLeftWidth,10)||0}n=t,t=e.offsetParent}if(i.offset.subtractsBorderForOverflowNotVisible&&s.overflow!=="visible"){l+=parseInt(s.borderTopWidth,10)||0,c+=parseInt(s.borderLeftWidth,10)||0}f=s}if(f.position==="relative"||f.position==="static"){l+=u.offsetTop,c+=u.offsetLeft}if(f.position==="fixed"){l+=Math.max(o.scrollTop,u.scrollTop),c+=Math.max(o.scrollLeft,u.scrollLeft)}return{top:l,left:c}}}i.offset={initialize:function(){if(this.initialized){return}var e=document.body,t=document.createElement("div"),n,r,i,s,o,u,a=e.style.marginTop,f='<div style="position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;"><div></div></div><table style="position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;" cellpadding="0" cellspacing="0"><tr><td></td></tr></table>';o={position:"absolute",top:0,left:0,margin:0,border:0,width:"1px",height:"1px",visibility:"hidden"};for(u in o){t.style[u]=o[u]}t.innerHTML=f;e.insertBefore(t,e.firstChild);n=t.firstChild,r=n.firstChild,s=n.nextSibling.firstChild.firstChild;this.doesNotAddBorder=r.offsetTop!==5;this.doesAddBorderForTableAndCells=s.offsetTop===5;n.style.overflow="hidden",n.style.position="relative";this.subtractsBorderForOverflowNotVisible=r.offsetTop===-5;e.style.marginTop="1px";this.doesNotIncludeMarginInBodyOffset=e.offsetTop===0;e.style.marginTop=a;e.removeChild(t);this.initialized=true},bodyOffset:function(e){i.offset.initialized||i.offset.initialize();var t=e.offsetTop,n=e.offsetLeft;if(i.offset.doesNotIncludeMarginInBodyOffset){t+=parseInt(i.curCSS(e,"marginTop",true),10)||0,n+=parseInt(i.curCSS(e,"marginLeft",true),10)||0}return{top:t,left:n}}};i.fn.extend({position:function(){var e=0,t=0,n;if(this[0]){var r=this.offsetParent(),i=this.offset(),s=/^body|html$/i.test(r[0].tagName)?{top:0,left:0}:r.offset();i.top-=p(this,"marginTop");i.left-=p(this,"marginLeft");s.top+=p(r,"borderTopWidth");s.left+=p(r,"borderLeftWidth");n={top:i.top-s.top,left:i.left-s.left}}return n},offsetParent:function(){var e=this[0].offsetParent||document.body;while(e&&!/^body|html$/i.test(e.tagName)&&i.css(e,"position")=="static"){e=e.offsetParent}return i(e)}});i.each(["Left","Top"],function(n,r){var s="scroll"+r;i.fn[s]=function(r){if(!this[0]){return null}return r!==t?this.each(function(){this==e||this==document?e.scrollTo(!n?r:i(e).scrollLeft(),n?r:i(e).scrollTop()):this[s]=r}):this[0]==e||this[0]==document?self[n?"pageYOffset":"pageXOffset"]||i.boxModel&&document.documentElement[s]||document.body[s]:this[0][s]}});i.each(["Height","Width"],function(n,r){var s=n?"Left":"Top",o=n?"Right":"Bottom",u=r.toLowerCase();i.fn["inner"+r]=function(){return this[0]?i.css(this[0],u,false,"padding"):null};i.fn["outer"+r]=function(e){return this[0]?i.css(this[0],u,false,e?"margin":"border"):null};var a=r.toLowerCase();i.fn[a]=function(n){return this[0]==e?document.compatMode=="CSS1Compat"&&document.documentElement["client"+r]||document.body["client"+r]:this[0]==document?Math.max(document.documentElement["client"+r],document.body["scroll"+r],document.documentElement["scroll"+r],document.body["offset"+r],document.documentElement["offset"+r]):n===t?this.length?i.css(this[0],a):null:this.css(a,typeof n==="string"?n:n+"px")}})})();(function(e){e.fn.hoverIntent=function(t,n){var r={sensitivity:7,interval:100,timeout:0};r=e.extend(r,n?{over:t,out:n}:t);var i,s,o,u;var a=function(e){i=e.pageX;s=e.pageY};var f=function(t,n){n.hoverIntent_t=clearTimeout(n.hoverIntent_t);if(Math.abs(o-i)+Math.abs(u-s)<r.sensitivity){e(n).unbind("mousemove",a);n.hoverIntent_s=1;return r.over.apply(n,[t])}else{o=i;u=s;n.hoverIntent_t=setTimeout(function(){f(t,n)},r.interval)}};var l=function(e,t){t.hoverIntent_t=clearTimeout(t.hoverIntent_t);t.hoverIntent_s=0;return r.out.apply(t,[e])};var c=function(t){var n=(t.type=="mouseover"?t.fromElement:t.toElement)||t.relatedTarget;while(n&&n!=this){try{n=n.parentNode}catch(t){n=this}}if(n==this){return false}var i=jQuery.extend({},t);var s=this;if(s.hoverIntent_t){s.hoverIntent_t=clearTimeout(s.hoverIntent_t)}if(t.type=="mouseover"){o=i.pageX;u=i.pageY;e(s).bind("mousemove",a);if(s.hoverIntent_s!=1){s.hoverIntent_t=setTimeout(function(){f(i,s)},r.interval)}}else{e(s).unbind("mousemove",a);if(s.hoverIntent_s==1){s.hoverIntent_t=setTimeout(function(){l(i,s)},r.timeout)}}};return this.mouseover(c).mouseout(c)}})(jQuery);(function(e){e.fn.bgIframe=e.fn.bgiframe=function(t){if(e.browser.msie&&/6.0/.test(navigator.userAgent)){t=e.extend({top:"auto",left:"auto",width:"auto",height:"auto",opacity:true,src:"javascript:false;"},t||{});var n=function(e){return e&&e.constructor==Number?e+"px":e},r='<iframe class="bgiframe"frameborder="0"tabindex="-1"src="'+t.src+'"'+'style="display:block;position:absolute;z-index:-1;'+(t.opacity!==false?"filter:Alpha(Opacity='0');":"")+"top:"+(t.top=="auto"?"expression(((parseInt(this.parentNode.currentStyle.borderTopWidth)||0)*-1)+'px')":n(t.top))+";"+"left:"+(t.left=="auto"?"expression(((parseInt(this.parentNode.currentStyle.borderLeftWidth)||0)*-1)+'px')":n(t.left))+";"+"width:"+(t.width=="auto"?"expression(this.parentNode.offsetWidth+'px')":n(t.width))+";"+"height:"+(t.height=="auto"?"expression(this.parentNode.offsetHeight+'px')":n(t.height))+";"+'"/>';return this.each(function(){if(e("> iframe.bgiframe",this).length==0)this.insertBefore(document.createElement(r),this.firstChild)})}return this}})(jQuery);jQuery.bt={version:"0.9.5-rc1"};(function($){jQuery.fn.bt=function(content,options){function drawIt(e,t){this.moveTo(e[0].x,e[0].y);for(i=1;i<e.length;i++){if(e[i-1].type=="arcStart"){this.quadraticCurveTo(round5(e[i].x,t),round5(e[i].y,t),round5(e[(i+1)%e.length].x,t),round5(e[(i+1)%e.length].y,t));i++}else{this.lineTo(round5(e[i].x,t),round5(e[i].y,t))}}}function round5(e,t){var n;t=numb(t);if(t%2){n=e}else{n=Math.round(e-.5)+.5}return n}function numb(e){return parseInt(e)||0}function arrayRemove(e,t){var n,r=new Array;for(n in e){if(e[n]!=t){r.push(e[n])}}return r}function canvasSupport(){var e=false;try{e=!!document.createElement("canvas").getContext("2d")}catch(t){e=!!document.createElement("canvas").getContext}return e}function shadowSupport(){try{var e=navigator.userAgent.toLowerCase();if(/webkit/.test(e)){return true}else{if(/gecko|mozilla/.test(e)&&parseFloat(e.match(/firefox\/(\d+(?:\.\d+)+)/)[1])>=3.1){return true}}}catch(t){}return false}function betweenPoint(e,t,n){var r,i;if(e.x==t.x){r=e.y<t.y?e.y+n:e.y-n;return{x:e.x,y:r}}else{if(e.y==t.y){i=e.x<t.x?e.x+n:e.x-n;return{x:i,y:e.y}}}}function centerPoint(e,t,n){var r=t.x==e.x?n.x:e.x;var i=t.y==e.y?n.y:e.y;var s,o;if(e.x<n.x){if(e.y>n.y){s=Math.PI/180*180;o=Math.PI/180*90}else{s=Math.PI/180*90;o=0}}else{if(e.y>n.y){s=Math.PI/180*270;o=Math.PI/180*180}else{s=0;o=Math.PI/180*270}}return{x:r,y:i,type:"center",startAngle:s,endAngle:o}}function findIntersect(e,t,n,r,i,s,o,u){if(i==o){return findIntersectY(e,t,n,r,i)}if(s==u){return findIntersectX(e,t,n,r,s)}var a=(t-r)/(e-n);var f=t-a*e;var l=(s-u)/(i-o);var c=s-l*i;var h=(c-f)/(a-l);var p=a*h+f;return{x:h,y:p}}function findIntersectY(e,t,n,r,i){if(t==r){return{x:i,y:t}}var s=(t-r)/(e-n);var o=t-s*e;var u=s*i+o;return{x:i,y:u}}function findIntersectX(e,t,n,r,i){if(e==n){return{x:e,y:i}}var s=(t-r)/(e-n);var o=t-s*e;var u=(i-o)/s;return{x:u,y:i}}if(typeof content!="string"){var contentSelect=true;options=content;content=false}else{var contentSelect=false}if(jQuery.fn.hoverIntent&&jQuery.bt.defaults.trigger=="hover"){jQuery.bt.defaults.trigger="hoverIntent"}return this.each(function(index){var opts=jQuery.extend(false,jQuery.bt.defaults,jQuery.bt.options,options);opts.spikeLength=numb(opts.spikeLength);opts.spikeGirth=numb(opts.spikeGirth);opts.overlap=numb(opts.overlap);var ajaxTimeout=false;if(opts.killTitle){$(this).find("[title]").andSelf().each(function(){if(!$(this).attr("bt-xTitle")){$(this).attr("bt-xTitle",$(this).attr("title")).attr("title","")}})}if(typeof opts.trigger=="string"){opts.trigger=[opts.trigger]}if(opts.trigger[0]=="hoverIntent"){var hoverOpts=jQuery.extend(opts.hoverIntentOpts,{over:function(){this.btOn()},out:function(){this.btOff()}});$(this).hoverIntent(hoverOpts)}else{if(opts.trigger[0]=="hover"){$(this).hover(function(){this.btOn()},function(){this.btOff()})}else{if(opts.trigger[0]=="now"){if($(this).hasClass("bt-active")){this.btOff()}else{this.btOn()}}else{if(opts.trigger[0]=="none"){}else{if(opts.trigger.length>1&&opts.trigger[0]!=opts.trigger[1]){$(this).bind(opts.trigger[0],function(){this.btOn()}).bind(opts.trigger[1],function(){this.btOff()})}else{$(this).bind(opts.trigger[0],function(){if($(this).hasClass("bt-active")){this.btOff()}else{this.btOn()}})}}}}}this.btOn=function(){if(typeof $(this).data("bt-box")=="object"){this.btOff()}opts.preBuild.apply(this);$(jQuery.bt.vars.closeWhenOpenStack).btOff();$(this).addClass("bt-active "+opts.activeClass);if(contentSelect&&opts.ajaxPath==null){if(opts.killTitle){$(this).attr("title",$(this).attr("bt-xTitle"))}content=$.isFunction(opts.contentSelector)?opts.contentSelector.apply(this):eval(opts.contentSelector);if(opts.killTitle){$(this).attr("title","")}}if(opts.ajaxPath!=null&&content==false){if(typeof opts.ajaxPath=="object"){var url=eval(opts.ajaxPath[0]);url+=opts.ajaxPath[1]?" "+opts.ajaxPath[1]:""}else{var url=opts.ajaxPath}var off=url.indexOf(" ");if(off>=0){var selector=url.slice(off,url.length);url=url.slice(0,off)}var cacheData=opts.ajaxCache?$(document.body).data("btCache-"+url.replace(/\./g,"")):null;if(typeof cacheData=="string"){content=selector?$("<div/>").append(cacheData.replace(/<script(.|\s)*?\/script>/g,"")).find(selector):cacheData}else{var target=this;var ajaxOpts=jQuery.extend(false,{type:opts.ajaxType,data:opts.ajaxData,cache:opts.ajaxCache,url:url,complete:function(e,t){if(t=="success"||t=="notmodified"){if(opts.ajaxCache){$(document.body).data("btCache-"+url.replace(/\./g,""),e.responseText)}ajaxTimeout=false;content=selector?$("<div/>").append(e.responseText.replace(/<script(.|\s)*?\/script>/g,"")).find(selector):e.responseText}else{if(t=="timeout"){ajaxTimeout=true}content=opts.ajaxError.replace(/%error/g,e.statusText)}if($(target).hasClass("bt-active")){target.btOn()}}},opts.ajaxOpts);jQuery.ajax(ajaxOpts);content=opts.ajaxLoading}}var shadowMarginX=0;var shadowMarginY=0;var shadowShiftX=0;var shadowShiftY=0;if(opts.shadow&&!shadowSupport()){opts.shadow=false;jQuery.extend(opts,opts.noShadowOpts)}if(opts.shadow){if(opts.shadowBlur>Math.abs(opts.shadowOffsetX)){shadowMarginX=opts.shadowBlur*2}else{shadowMarginX=opts.shadowBlur+Math.abs(opts.shadowOffsetX)}shadowShiftX=opts.shadowBlur-opts.shadowOffsetX>0?opts.shadowBlur-opts.shadowOffsetX:0;if(opts.shadowBlur>Math.abs(opts.shadowOffsetY)){shadowMarginY=opts.shadowBlur*2}else{shadowMarginY=opts.shadowBlur+Math.abs(opts.shadowOffsetY)}shadowShiftY=opts.shadowBlur-opts.shadowOffsetY>0?opts.shadowBlur-opts.shadowOffsetY:0}if(opts.offsetParent){var offsetParent=$(opts.offsetParent);var offsetParentPos=offsetParent.offset();var pos=$(this).offset();var top=numb(pos.top)-numb(offsetParentPos.top)+numb($(this).css("margin-top"))-shadowShiftY;var left=numb(pos.left)-numb(offsetParentPos.left)+numb($(this).css("margin-left"))-shadowShiftX}else{var offsetParent=$(this).css("position")=="absolute"?$(this).parents().eq(0).offsetParent():$(this).offsetParent();var pos=$(this).btPosition();var top=numb(pos.top)+numb($(this).css("margin-top"))-shadowShiftY;var left=numb(pos.left)+numb($(this).css("margin-left"))-shadowShiftX}var width=$(this).btOuterWidth();var height=$(this).outerHeight();if(typeof content=="object"){var original=content;var clone=$(original).clone(true).show();var origClones=$(original).data("bt-clones")||[];origClones.push(clone);$(original).data("bt-clones",origClones);$(clone).data("bt-orig",original);$(this).data("bt-content-orig",{original:original,clone:clone});content=clone}if(typeof content=="null"||content==""){return}var $text=$('<div class="bt-content"></div>').append(content).css({padding:opts.padding,position:"absolute",width:opts.shrinkToFit?"auto":opts.width,zIndex:opts.textzIndex,left:shadowShiftX,top:shadowShiftY}).css(opts.cssStyles);var $box=$('<div class="bt-wrapper"></div>').append($text).addClass(opts.cssClass).css({position:"absolute",width:opts.width,zIndex:opts.wrapperzIndex,visibility:"hidden"}).appendTo(offsetParent);if(jQuery.fn.bgiframe){$text.bgiframe();$box.bgiframe()}$(this).data("bt-box",$box);var scrollTop=numb($(document).scrollTop());var scrollLeft=numb($(document).scrollLeft());var docWidth=numb($(window).width());var docHeight=numb($(window).height());var winRight=scrollLeft+docWidth;var winBottom=scrollTop+docHeight;var space=new Object;var thisOffset=$(this).offset();space.top=thisOffset.top-scrollTop;space.bottom=docHeight-(thisOffset+height-scrollTop);space.left=thisOffset.left-scrollLeft;space.right=docWidth-(thisOffset.left+width-scrollLeft);var textOutHeight=numb($text.outerHeight());var textOutWidth=numb($text.btOuterWidth());if(opts.positions.constructor==String){opts.positions=opts.positions.replace(/ /,"").split(",")}if(opts.positions[0]=="most"){var position="top";for(var pig in space){position=space[pig]>space[position]?pig:position}}else{for(var x in opts.positions){var position=opts.positions[x];if((position=="left"||position=="right")&&space[position]>textOutWidth+opts.spikeLength){break}else{if((position=="top"||position=="bottom")&&space[position]>textOutHeight+opts.spikeLength){break}}}}var horiz=left+(width-textOutWidth)*.5;var vert=top+(height-textOutHeight)*.5;var points=new Array;var textTop,textLeft,textRight,textBottom,textTopSpace,textBottomSpace,textLeftSpace,textRightSpace,crossPoint,textCenter,spikePoint;switch(position){case"top":$text.css("margin-bottom",opts.spikeLength+"px");$box.css({top:top-$text.outerHeight(true)+opts.overlap,left:horiz});textRightSpace=winRight-opts.windowMargin-($text.offset().left+$text.btOuterWidth(true));var xShift=shadowShiftX;if(textRightSpace<0){$box.css("left",numb($box.css("left"))+textRightSpace+"px");xShift-=textRightSpace}textLeftSpace=$text.offset().left+numb($text.css("margin-left"))-(scrollLeft+opts.windowMargin);if(textLeftSpace<0){$box.css("left",numb($box.css("left"))-textLeftSpace+"px");xShift+=textLeftSpace}textTop=$text.btPosition().top+numb($text.css("margin-top"));textLeft=$text.btPosition().left+numb($text.css("margin-left"));textRight=textLeft+$text.btOuterWidth();textBottom=textTop+$text.outerHeight();textCenter={x:textLeft+$text.btOuterWidth()*opts.centerPointX,y:textTop+$text.outerHeight()*opts.centerPointY};points[points.length]=spikePoint={y:textBottom+opts.spikeLength,x:(textRight-textLeft)*.5+xShift,type:"spike"};crossPoint=findIntersectX(spikePoint.x,spikePoint.y,textCenter.x,textCenter.y,textBottom);crossPoint.x=crossPoint.x<textLeft+opts.spikeGirth/2+opts.cornerRadius?textLeft+opts.spikeGirth/2+opts.cornerRadius:crossPoint.x;crossPoint.x=crossPoint.x>textRight-opts.spikeGirth/2-opts.cornerRadius?textRight-opts.spikeGirth/2-opts.CornerRadius:crossPoint.x;points[points.length]={x:crossPoint.x-opts.spikeGirth/2,y:textBottom,type:"join"};points[points.length]={x:textLeft,y:textBottom,type:"corner"};points[points.length]={x:textLeft,y:textTop,type:"corner"};points[points.length]={x:textRight,y:textTop,type:"corner"};points[points.length]={x:textRight,y:textBottom,type:"corner"};points[points.length]={x:crossPoint.x+opts.spikeGirth/2,y:textBottom,type:"join"};points[points.length]=spikePoint;break;case"left":$text.css("margin-right",opts.spikeLength+"px");$box.css({top:vert+"px",left:left-$text.btOuterWidth(true)+opts.overlap+"px"});textBottomSpace=winBottom-opts.windowMargin-($text.offset().top+$text.outerHeight(true));var yShift=shadowShiftY;if(textBottomSpace<0){$box.css("top",numb($box.css("top"))+textBottomSpace+"px");yShift-=textBottomSpace}textTopSpace=$text.offset().top+numb($text.css("margin-top"))-(scrollTop+opts.windowMargin);if(textTopSpace<0){$box.css("top",numb($box.css("top"))-textTopSpace+"px");yShift+=textTopSpace}textTop=$text.btPosition().top+numb($text.css("margin-top"));textLeft=$text.btPosition().left+numb($text.css("margin-left"));textRight=textLeft+$text.btOuterWidth();textBottom=textTop+$text.outerHeight();textCenter={x:textLeft+$text.btOuterWidth()*opts.centerPointX,y:textTop+$text.outerHeight()*opts.centerPointY};points[points.length]=spikePoint={x:textRight+opts.spikeLength,y:(textBottom-textTop)*.5+yShift,type:"spike"};crossPoint=findIntersectY(spikePoint.x,spikePoint.y,textCenter.x,textCenter.y,textRight);crossPoint.y=crossPoint.y<textTop+opts.spikeGirth/2+opts.cornerRadius?textTop+opts.spikeGirth/2+opts.cornerRadius:crossPoint.y;crossPoint.y=crossPoint.y>textBottom-opts.spikeGirth/2-opts.cornerRadius?textBottom-opts.spikeGirth/2-opts.cornerRadius:crossPoint.y;points[points.length]={x:textRight,y:crossPoint.y+opts.spikeGirth/2,type:"join"};points[points.length]={x:textRight,y:textBottom,type:"corner"};points[points.length]={x:textLeft,y:textBottom,type:"corner"};points[points.length]={x:textLeft,y:textTop,type:"corner"};points[points.length]={x:textRight,y:textTop,type:"corner"};points[points.length]={x:textRight,y:crossPoint.y-opts.spikeGirth/2,type:"join"};points[points.length]=spikePoint;break;case"bottom":$text.css("margin-top",opts.spikeLength+"px");$box.css({top:top+height-opts.overlap,left:horiz});textRightSpace=winRight-opts.windowMargin-($text.offset().left+$text.btOuterWidth(true));var xShift=shadowShiftX;if(textRightSpace<0){$box.css("left",numb($box.css("left"))+textRightSpace+"px");xShift-=textRightSpace}textLeftSpace=$text.offset().left+numb($text.css("margin-left"))-(scrollLeft+opts.windowMargin);if(textLeftSpace<0){$box.css("left",numb($box.css("left"))-textLeftSpace+"px");xShift+=textLeftSpace}textTop=$text.btPosition().top+numb($text.css("margin-top"));textLeft=$text.btPosition().left+numb($text.css("margin-left"));textRight=textLeft+$text.btOuterWidth();textBottom=textTop+$text.outerHeight();textCenter={x:textLeft+$text.btOuterWidth()*opts.centerPointX,y:textTop+$text.outerHeight()*opts.centerPointY};points[points.length]=spikePoint={x:(textRight-textLeft)*.5+xShift,y:shadowShiftY,type:"spike"};crossPoint=findIntersectX(spikePoint.x,spikePoint.y,textCenter.x,textCenter.y,textTop);crossPoint.x=crossPoint.x<textLeft+opts.spikeGirth/2+opts.cornerRadius?textLeft+opts.spikeGirth/2+opts.cornerRadius:crossPoint.x;crossPoint.x=crossPoint.x>textRight-opts.spikeGirth/2-opts.cornerRadius?textRight-opts.spikeGirth/2-opts.cornerRadius:crossPoint.x;points[points.length]={x:crossPoint.x+opts.spikeGirth/2,y:textTop,type:"join"};points[points.length]={x:textRight,y:textTop,type:"corner"};points[points.length]={x:textRight,y:textBottom,type:"corner"};points[points.length]={x:textLeft,y:textBottom,type:"corner"};points[points.length]={x:textLeft,y:textTop,type:"corner"};points[points.length]={x:crossPoint.x-opts.spikeGirth/2,y:textTop,type:"join"};points[points.length]=spikePoint;break;case"right":$text.css("margin-left",opts.spikeLength+"px");$box.css({top:vert+"px",left:left+width-opts.overlap+"px"});textBottomSpace=winBottom-opts.windowMargin-($text.offset().top+$text.outerHeight(true));var yShift=shadowShiftY;if(textBottomSpace<0){$box.css("top",numb($box.css("top"))+textBottomSpace+"px");yShift-=textBottomSpace}textTopSpace=$text.offset().top+numb($text.css("margin-top"))-(scrollTop+opts.windowMargin);if(textTopSpace<0){$box.css("top",numb($box.css("top"))-textTopSpace+"px");yShift+=textTopSpace}textTop=$text.btPosition().top+numb($text.css("margin-top"));textLeft=$text.btPosition().left+numb($text.css("margin-left"));textRight=textLeft+$text.btOuterWidth();textBottom=textTop+$text.outerHeight();textCenter={x:textLeft+$text.btOuterWidth()*opts.centerPointX,y:textTop+$text.outerHeight()*opts.centerPointY};points[points.length]=spikePoint={x:shadowShiftX,y:(textBottom-textTop)*.5+yShift,type:"spike"};crossPoint=findIntersectY(spikePoint.x,spikePoint.y,textCenter.x,textCenter.y,textLeft);crossPoint.y=crossPoint.y<textTop+opts.spikeGirth/2+opts.cornerRadius?textTop+opts.spikeGirth/2+opts.cornerRadius:crossPoint.y;crossPoint.y=crossPoint.y>textBottom-opts.spikeGirth/2-opts.cornerRadius?textBottom-opts.spikeGirth/2-opts.cornerRadius:crossPoint.y;points[points.length]={x:textLeft,y:crossPoint.y-opts.spikeGirth/2,type:"join"};points[points.length]={x:textLeft,y:textTop,type:"corner"};points[points.length]={x:textRight,y:textTop,type:"corner"};points[points.length]={x:textRight,y:textBottom,type:"corner"};points[points.length]={x:textLeft,y:textBottom,type:"corner"};points[points.length]={x:textLeft,y:crossPoint.y+opts.spikeGirth/2,type:"join"};points[points.length]=spikePoint;break}var canvas=document.createElement("canvas");$(canvas).attr("width",numb($text.btOuterWidth(true))+opts.strokeWidth*2+shadowMarginX).attr("height",numb($text.outerHeight(true))+opts.strokeWidth*2+shadowMarginY).appendTo($box).css({position:"absolute",zIndex:opts.boxzIndex});if(typeof G_vmlCanvasManager!="undefined"){canvas=G_vmlCanvasManager.initElement(canvas)}if(opts.cornerRadius>0){var newPoints=new Array;var newPoint;for(var i=0;i<points.length;i++){if(points[i].type=="corner"){newPoint=betweenPoint(points[i],points[(i-1)%points.length],opts.cornerRadius);newPoint.type="arcStart";newPoints[newPoints.length]=newPoint;newPoints[newPoints.length]=points[i];newPoint=betweenPoint(points[i],points[(i+1)%points.length],opts.cornerRadius);newPoint.type="arcEnd";newPoints[newPoints.length]=newPoint}else{newPoints[newPoints.length]=points[i]}}points=newPoints}var ctx=canvas.getContext("2d");if(opts.shadow&&opts.shadowOverlap!==true){var shadowOverlap=numb(opts.shadowOverlap);switch(position){case"top":if(opts.shadowOffsetX+opts.shadowBlur-shadowOverlap>0){$box.css("top",numb($box.css("top"))-(opts.shadowOffsetX+opts.shadowBlur-shadowOverlap))}break;case"right":if(shadowShiftX-shadowOverlap>0){$box.css("left",numb($box.css("left"))+shadowShiftX-shadowOverlap)}break;case"bottom":if(shadowShiftY-shadowOverlap>0){$box.css("top",numb($box.css("top"))+shadowShiftY-shadowOverlap)}break;case"left":if(opts.shadowOffsetY+opts.shadowBlur-shadowOverlap>0){$box.css("left",numb($box.css("left"))-(opts.shadowOffsetY+opts.shadowBlur-shadowOverlap))}break}}drawIt.apply(ctx,[points],opts.strokeWidth);ctx.fillStyle=opts.fill;if(opts.shadow){ctx.shadowOffsetX=opts.shadowOffsetX;ctx.shadowOffsetY=opts.shadowOffsetY;ctx.shadowBlur=opts.shadowBlur;ctx.shadowColor=opts.shadowColor}ctx.closePath();ctx.fill();if(opts.strokeWidth>0){ctx.shadowColor="rgba(0, 0, 0, 0)";ctx.lineWidth=opts.strokeWidth;ctx.strokeStyle=opts.strokeStyle;ctx.beginPath();drawIt.apply(ctx,[points],opts.strokeWidth);ctx.closePath();ctx.stroke()}opts.preShow.apply(this,[$box[0]]);$box.css({display:"none",visibility:"visible"});opts.showTip.apply(this,[$box[0]]);if(opts.overlay){var overlay=$('<div class="bt-overlay"></div>').css({position:"absolute",backgroundColor:"blue",top:top,left:left,width:width,height:height,opacity:".2"}).appendTo(offsetParent);$(this).data("overlay",overlay)}if(opts.ajaxPath!=null&&opts.ajaxCache==false||ajaxTimeout){content=false}if(opts.clickAnywhereToClose){jQuery.bt.vars.clickAnywhereStack.push(this);$(document).click(jQuery.bt.docClick)}if(opts.closeWhenOthersOpen){jQuery.bt.vars.closeWhenOpenStack.push(this)}opts.postShow.apply(this,[$box[0]])};this.btOff=function(){var e=$(this).data("bt-box");opts.preHide.apply(this,[e]);var t=this;t.btCleanup=function(){var e=$(t).data("bt-box");var n=$(t).data("bt-content-orig");var r=$(t).data("bt-overlay");if(typeof e=="object"){$(e).remove();$(t).removeData("bt-box")}if(typeof n=="object"){var s=$(n.original).data("bt-clones");$(n).data("bt-clones",arrayRemove(s,n.clone))}if(typeof r=="object"){$(r).remove();$(t).removeData("bt-overlay")}jQuery.bt.vars.clickAnywhereStack=arrayRemove(jQuery.bt.vars.clickAnywhereStack,t);jQuery.bt.vars.closeWhenOpenStack=arrayRemove(jQuery.bt.vars.closeWhenOpenStack,t);$(t).removeClass("bt-active "+opts.activeClass);opts.postHide.apply(t)};opts.hideTip.apply(this,[e,t.btCleanup])};var refresh=this.btRefresh=function(){this.btOff();this.btOn()}})};jQuery.fn.btPosition=function(){function e(e,t){return e[0]&&parseInt(jQuery.curCSS(e[0],t,true),10)||0}var t=0,n=0,r;if(this[0]){var i=this.offsetParent(),s=this.offset(),o=/^body|html$/i.test(i[0].tagName)?{top:0,left:0}:i.offset();s.top-=e(this,"marginTop");s.left-=e(this,"marginLeft");o.top+=e(i,"borderTopWidth");o.left+=e(i,"borderLeftWidth");r={top:s.top-o.top,left:s.left-o.left}}return r};jQuery.fn.btOuterWidth=function(e){function t(e,t){return e[0]&&parseInt(jQuery.curCSS(e[0],t,true),10)||0}return this["innerWidth"]()+t(this,"borderLeftWidth")+t(this,"borderRightWidth")+(e?t(this,"marginLeft")+t(this,"marginRight"):0)};jQuery.fn.btOn=function(){return this.each(function(e){if(jQuery.isFunction(this.btOn)){this.btOn()}})};jQuery.fn.btOff=function(){return this.each(function(e){if(jQuery.isFunction(this.btOff)){this.btOff()}})};jQuery.bt.vars={clickAnywhereStack:[],closeWhenOpenStack:[]};jQuery.bt.docClick=function(e){if(!e){var e=window.event}if(!$(e.target).parents().andSelf().filter(".bt-wrapper, .bt-active").length&&jQuery.bt.vars.clickAnywhereStack.length){$(jQuery.bt.vars.clickAnywhereStack).btOff();$(document).unbind("click",jQuery.bt.docClick)}};jQuery.bt.defaults={trigger:"hover",clickAnywhereToClose:true,closeWhenOthersOpen:false,shrinkToFit:false,width:"200px",padding:"10px",spikeGirth:10,spikeLength:15,overlap:0,overlay:false,killTitle:true,textzIndex:9999,boxzIndex:9998,wrapperzIndex:9997,offsetParent:null,positions:["most"],fill:"rgb(255, 255, 102)",windowMargin:10,strokeWidth:1,strokeStyle:"#000",cornerRadius:5,centerPointX:.5,centerPointY:.5,shadow:false,shadowOffsetX:2,shadowOffsetY:2,shadowBlur:3,shadowColor:"#000",shadowOverlap:false,noShadowOpts:{strokeStyle:"#999"},cssClass:"",cssStyles:{},activeClass:"bt-active",contentSelector:"$(this).attr('title')",ajaxPath:null,ajaxError:"<strong>ERROR:</strong> <em>%error</em>",ajaxLoading:"<blink>Loading...</blink>",ajaxData:{},ajaxType:"GET",ajaxCache:true,ajaxOpts:{},preBuild:function(){},preShow:function(e){},showTip:function(e){$(e).show()},postShow:function(e){},preHide:function(e){},hideTip:function(e,t){$(e).hide();t()},postHide:function(){},hoverIntentOpts:{interval:300,timeout:500}};jQuery.bt.options={}})(jQuery);var THREE={REVISION:"69"};if(typeof module==="object"){module.exports=THREE}if(Math.sign===undefined){Math.sign=function(e){return e<0?-1:e>0?1:0}}THREE.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2};THREE.CullFaceNone=0;THREE.CullFaceBack=1;THREE.CullFaceFront=2;THREE.CullFaceFrontBack=3;THREE.FrontFaceDirectionCW=0;THREE.FrontFaceDirectionCCW=1;THREE.BasicShadowMap=0;THREE.PCFShadowMap=1;THREE.PCFSoftShadowMap=2;THREE.FrontSide=0;THREE.BackSide=1;THREE.DoubleSide=2;THREE.NoShading=0;THREE.FlatShading=1;THREE.SmoothShading=2;THREE.NoColors=0;THREE.FaceColors=1;THREE.VertexColors=2;THREE.NoBlending=0;THREE.NormalBlending=1;THREE.AdditiveBlending=2;THREE.SubtractiveBlending=3;THREE.MultiplyBlending=4;THREE.CustomBlending=5;THREE.AddEquation=100;THREE.SubtractEquation=101;THREE.ReverseSubtractEquation=102;THREE.MinEquation=103;THREE.MaxEquation=104;THREE.ZeroFactor=200;THREE.OneFactor=201;THREE.SrcColorFactor=202;THREE.OneMinusSrcColorFactor=203;THREE.SrcAlphaFactor=204;THREE.OneMinusSrcAlphaFactor=205;THREE.DstAlphaFactor=206;THREE.OneMinusDstAlphaFactor=207;THREE.DstColorFactor=208;THREE.OneMinusDstColorFactor=209;THREE.SrcAlphaSaturateFactor=210;THREE.MultiplyOperation=0;THREE.MixOperation=1;THREE.AddOperation=2;THREE.UVMapping=function(){};THREE.CubeReflectionMapping=function(){};THREE.CubeRefractionMapping=function(){};THREE.SphericalReflectionMapping=function(){};THREE.SphericalRefractionMapping=function(){};THREE.RepeatWrapping=1e3;THREE.ClampToEdgeWrapping=1001;THREE.MirroredRepeatWrapping=1002;THREE.NearestFilter=1003;THREE.NearestMipMapNearestFilter=1004;THREE.NearestMipMapLinearFilter=1005;THREE.LinearFilter=1006;THREE.LinearMipMapNearestFilter=1007;THREE.LinearMipMapLinearFilter=1008;THREE.UnsignedByteType=1009;THREE.ByteType=1010;THREE.ShortType=1011;THREE.UnsignedShortType=1012;THREE.IntType=1013;THREE.UnsignedIntType=1014;THREE.FloatType=1015;THREE.UnsignedShort4444Type=1016;THREE.UnsignedShort5551Type=1017;THREE.UnsignedShort565Type=1018;THREE.AlphaFormat=1019;THREE.RGBFormat=1020;THREE.RGBAFormat=1021;THREE.LuminanceFormat=1022;THREE.LuminanceAlphaFormat=1023;THREE.RGB_S3TC_DXT1_Format=2001;THREE.RGBA_S3TC_DXT1_Format=2002;THREE.RGBA_S3TC_DXT3_Format=2003;THREE.RGBA_S3TC_DXT5_Format=2004;THREE.RGB_PVRTC_4BPPV1_Format=2100;THREE.RGB_PVRTC_2BPPV1_Format=2101;THREE.RGBA_PVRTC_4BPPV1_Format=2102;THREE.RGBA_PVRTC_2BPPV1_Format=2103;THREE.Color=function(e){if(arguments.length===3){return this.setRGB(arguments[0],arguments[1],arguments[2])}return this.set(e)};THREE.Color.prototype={constructor:THREE.Color,r:1,g:1,b:1,set:function(e){if(e instanceof THREE.Color){this.copy(e)}else if(typeof e==="number"){this.setHex(e)}else if(typeof e==="string"){this.setStyle(e)}return this},setHex:function(e){e=Math.floor(e);this.r=(e>>16&255)/255;this.g=(e>>8&255)/255;this.b=(e&255)/255;return this},setRGB:function(e,t,n){this.r=e;this.g=t;this.b=n;return this},setHSL:function(e,t,n){if(t===0){this.r=this.g=this.b=n}else{var r=function(e,t,n){if(n<0)n+=1;if(n>1)n-=1;if(n<1/6)return e+(t-e)*6*n;if(n<1/2)return t;if(n<2/3)return e+(t-e)*6*(2/3-n);return e};var i=n<=.5?n*(1+t):n+t-n*t;var s=2*n-i;this.r=r(s,i,e+1/3);this.g=r(s,i,e);this.b=r(s,i,e-1/3)}return this},setStyle:function(e){if(/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.test(e)){var t=/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.exec(e);this.r=Math.min(255,parseInt(t[1],10))/255;this.g=Math.min(255,parseInt(t[2],10))/255;this.b=Math.min(255,parseInt(t[3],10))/255;return this}if(/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.test(e)){var t=/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.exec(e);this.r=Math.min(100,parseInt(t[1],10))/100;this.g=Math.min(100,parseInt(t[2],10))/100;this.b=Math.min(100,parseInt(t[3],10))/100;return this}if(/^\#([0-9a-f]{6})$/i.test(e)){var t=/^\#([0-9a-f]{6})$/i.exec(e);this.setHex(parseInt(t[1],16));return this}if(/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(e)){var t=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(e);this.setHex(parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3],16));return this}if(/^(\w+)$/i.test(e)){this.setHex(THREE.ColorKeywords[e]);return this}},copy:function(e){this.r=e.r;this.g=e.g;this.b=e.b;return this},copyGammaToLinear:function(e){this.r=e.r*e.r;this.g=e.g*e.g;this.b=e.b*e.b;return this},copyLinearToGamma:function(e){this.r=Math.sqrt(e.r);this.g=Math.sqrt(e.g);this.b=Math.sqrt(e.b);return this},convertGammaToLinear:function(){var e=this.r,t=this.g,n=this.b;this.r=e*e;this.g=t*t;this.b=n*n;return this},convertLinearToGamma:function(){this.r=Math.sqrt(this.r);this.g=Math.sqrt(this.g);this.b=Math.sqrt(this.b);return this},getHex:function(){return this.r*255<<16^this.g*255<<8^this.b*255<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){var t=e||{h:0,s:0,l:0};var n=this.r,r=this.g,i=this.b;var s=Math.max(n,r,i);var o=Math.min(n,r,i);var u,a;var f=(o+s)/2;if(o===s){u=0;a=0}else{var l=s-o;a=f<=.5?l/(s+o):l/(2-s-o);switch(s){case n:u=(r-i)/l+(r<i?6:0);break;case r:u=(i-n)/l+2;break;case i:u=(n-r)/l+4;break}u/=6}t.h=u;t.s=a;t.l=f;return t},getStyle:function(){return"rgb("+(this.r*255|0)+","+(this.g*255|0)+","+(this.b*255|0)+")"},offsetHSL:function(e,t,n){var r=this.getHSL();r.h+=e;r.s+=t;r.l+=n;this.setHSL(r.h,r.s,r.l);return this},add:function(e){this.r+=e.r;this.g+=e.g;this.b+=e.b;return this},addColors:function(e,t){this.r=e.r+t.r;this.g=e.g+t.g;this.b=e.b+t.b;return this},addScalar:function(e){this.r+=e;this.g+=e;this.b+=e;return this},multiply:function(e){this.r*=e.r;this.g*=e.g;this.b*=e.b;return this},multiplyScalar:function(e){this.r*=e;this.g*=e;this.b*=e;return this},lerp:function(e,t){this.r+=(e.r-this.r)*t;this.g+=(e.g-this.g)*t;this.b+=(e.b-this.b)*t;return this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e){this.r=e[0];this.g=e[1];this.b=e[2];return this},toArray:function(){return[this.r,this.g,this.b]},clone:function(){return(new THREE.Color).setRGB(this.r,this.g,this.b)}};THREE.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};THREE.Quaternion=function(e,t,n,r){this._x=e||0;this._y=t||0;this._z=n||0;this._w=r!==undefined?r:1};THREE.Quaternion.prototype={constructor:THREE.Quaternion,_x:0,_y:0,_z:0,_w:0,get x(){return this._x},set x(e){this._x=e;this.onChangeCallback()},get y(){return this._y},set y(e){this._y=e;this.onChangeCallback()},get z(){return this._z},set z(e){this._z=e;this.onChangeCallback()},get w(){return this._w},set w(e){this._w=e;this.onChangeCallback()},set:function(e,t,n,r){this._x=e;this._y=t;this._z=n;this._w=r;this.onChangeCallback();return this},copy:function(e){this._x=e.x;this._y=e.y;this._z=e.z;this._w=e.w;this.onChangeCallback();return this},setFromEuler:function(e,t){if(e instanceof THREE.Euler===false){throw new Error("THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.")}var n=Math.cos(e._x/2);var r=Math.cos(e._y/2);var i=Math.cos(e._z/2);var s=Math.sin(e._x/2);var o=Math.sin(e._y/2);var u=Math.sin(e._z/2);if(e.order==="XYZ"){this._x=s*r*i+n*o*u;this._y=n*o*i-s*r*u;this._z=n*r*u+s*o*i;this._w=n*r*i-s*o*u}else if(e.order==="YXZ"){this._x=s*r*i+n*o*u;this._y=n*o*i-s*r*u;this._z=n*r*u-s*o*i;this._w=n*r*i+s*o*u}else if(e.order==="ZXY"){this._x=s*r*i-n*o*u;this._y=n*o*i+s*r*u;this._z=n*r*u+s*o*i;this._w=n*r*i-s*o*u}else if(e.order==="ZYX"){this._x=s*r*i-n*o*u;this._y=n*o*i+s*r*u;this._z=n*r*u-s*o*i;this._w=n*r*i+s*o*u}else if(e.order==="YZX"){this._x=s*r*i+n*o*u;this._y=n*o*i+s*r*u;this._z=n*r*u-s*o*i;this._w=n*r*i-s*o*u}else if(e.order==="XZY"){this._x=s*r*i-n*o*u;this._y=n*o*i-s*r*u;this._z=n*r*u+s*o*i;this._w=n*r*i+s*o*u}if(t!==false)this.onChangeCallback();return this},setFromAxisAngle:function(e,t){var n=t/2,r=Math.sin(n);this._x=e.x*r;this._y=e.y*r;this._z=e.z*r;this._w=Math.cos(n);this.onChangeCallback();return this},setFromRotationMatrix:function(e){var t=e.elements,n=t[0],r=t[4],i=t[8],s=t[1],o=t[5],u=t[9],a=t[2],f=t[6],l=t[10],c=n+o+l,h;if(c>0){h=.5/Math.sqrt(c+1);this._w=.25/h;this._x=(f-u)*h;this._y=(i-a)*h;this._z=(s-r)*h}else if(n>o&&n>l){h=2*Math.sqrt(1+n-o-l);this._w=(f-u)/h;this._x=.25*h;this._y=(r+s)/h;this._z=(i+a)/h}else if(o>l){h=2*Math.sqrt(1+o-n-l);this._w=(i-a)/h;this._x=(r+s)/h;this._y=.25*h;this._z=(u+f)/h}else{h=2*Math.sqrt(1+l-n-o);this._w=(s-r)/h;this._x=(i+a)/h;this._y=(u+f)/h;this._z=.25*h}this.onChangeCallback();return this},setFromUnitVectors:function(){var e,t;var n=1e-6;return function(i,s){if(e===undefined)e=new THREE.Vector3;t=i.dot(s)+1;if(t<n){t=0;if(Math.abs(i.x)>Math.abs(i.z)){e.set(-i.y,i.x,0)}else{e.set(0,-i.z,i.y)}}else{e.crossVectors(i,s)}this._x=e.x;this._y=e.y;this._z=e.z;this._w=t;this.normalize();return this}}(),inverse:function(){this.conjugate().normalize();return this},conjugate:function(){this._x*=-1;this._y*=-1;this._z*=-1;this.onChangeCallback();return this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();if(e===0){this._x=0;this._y=0;this._z=0;this._w=1}else{e=1/e;this._x=this._x*e;this._y=this._y*e;this._z=this._z*e;this._w=this._w*e}this.onChangeCallback();return this},multiply:function(e,t){if(t!==undefined){console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead.");return this.multiplyQuaternions(e,t)}return this.multiplyQuaternions(this,e)},multiplyQuaternions:function(e,t){var n=e._x,r=e._y,i=e._z,s=e._w;var o=t._x,u=t._y,a=t._z,f=t._w;this._x=n*f+s*o+r*a-i*u;this._y=r*f+s*u+i*o-n*a;this._z=i*f+s*a+n*u-r*o;this._w=s*f-n*o-r*u-i*a;this.onChangeCallback();return this},multiplyVector3:function(e){console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead.");return e.applyQuaternion(this)},slerp:function(e,t){if(t===0)return this;if(t===1)return this.copy(e);var n=this._x,r=this._y,i=this._z,s=this._w;var o=s*e._w+n*e._x+r*e._y+i*e._z;if(o<0){this._w=-e._w;this._x=-e._x;this._y=-e._y;this._z=-e._z;o=-o}else{this.copy(e)}if(o>=1){this._w=s;this._x=n;this._y=r;this._z=i;return this}var u=Math.acos(o);var a=Math.sqrt(1-o*o);if(Math.abs(a)<.001){this._w=.5*(s+this._w);this._x=.5*(n+this._x);this._y=.5*(r+this._y);this._z=.5*(i+this._z);return this}var f=Math.sin((1-t)*u)/a,l=Math.sin(t*u)/a;this._w=s*f+this._w*l;this._x=n*f+this._x*l;this._y=r*f+this._y*l;this._z=i*f+this._z*l;this.onChangeCallback();return this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){if(t===undefined)t=0;this._x=e[t];this._y=e[t+1];this._z=e[t+2];this._w=e[t+3];this.onChangeCallback();return this},toArray:function(e,t){if(e===undefined)e=[];if(t===undefined)t=0;e[t]=this._x;e[t+1]=this._y;e[t+2]=this._z;e[t+3]=this._w;return e},onChange:function(e){this.onChangeCallback=e;return this},onChangeCallback:function(){},clone:function(){return new THREE.Quaternion(this._x,this._y,this._z,this._w)}};THREE.Quaternion.slerp=function(e,t,n,r){return n.copy(e).slerp(t,r)};THREE.Vector2=function(e,t){this.x=e||0;this.y=t||0};THREE.Vector2.prototype={constructor:THREE.Vector2,set:function(e,t){this.x=e;this.y=t;return this},setX:function(e){this.x=e;return this},setY:function(e){this.y=e;return this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},copy:function(e){this.x=e.x;this.y=e.y;return this},add:function(e,t){if(t!==undefined){console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead.");return this.addVectors(e,t)}this.x+=e.x;this.y+=e.y;return this},addVectors:function(e,t){this.x=e.x+t.x;this.y=e.y+t.y;return this},addScalar:function(e){this.x+=e;this.y+=e;return this},sub:function(e,t){if(t!==undefined){console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.");return this.subVectors(e,t)}this.x-=e.x;this.y-=e.y;return this},subVectors:function(e,t){this.x=e.x-t.x;this.y=e.y-t.y;return this},multiply:function(e){this.x*=e.x;this.y*=e.y;return this},multiplyScalar:function(e){this.x*=e;this.y*=e;return this},divide:function(e){this.x/=e.x;this.y/=e.y;return this},divideScalar:function(e){if(e!==0){var t=1/e;this.x*=t;this.y*=t}else{this.x=0;this.y=0}return this},min:function(e){if(this.x>e.x){this.x=e.x}if(this.y>e.y){this.y=e.y}return this},max:function(e){if(this.x<e.x){this.x=e.x}if(this.y<e.y){this.y=e.y}return this},clamp:function(e,t){if(this.x<e.x){this.x=e.x}else if(this.x>t.x){this.x=t.x}if(this.y<e.y){this.y=e.y}else if(this.y>t.y){this.y=t.y}return this},clampScalar:function(){var e,t;return function(n,r){if(e===undefined){e=new THREE.Vector2;t=new THREE.Vector2}e.set(n,n);t.set(r,r);return this.clamp(e,t)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this},roundToZero:function(){this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x);this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y);return this},negate:function(){this.x=-this.x;this.y=-this.y;return this},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,n=this.y-e.y;return t*t+n*n},setLength:function(e){var t=this.length();if(t!==0&&e!==t){this.multiplyScalar(e/t)}return this},lerp:function(e,t){this.x+=(e.x-this.x)*t;this.y+=(e.y-this.y)*t;return this},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){if(t===undefined)t=0;this.x=e[t];this.y=e[t+1];return this},toArray:function(e,t){if(e===undefined)e=[];if(t===undefined)t=0;e[t]=this.x;e[t+1]=this.y;return e},clone:function(){return new THREE.Vector2(this.x,this.y)}};THREE.Vector3=function(e,t,n){this.x=e||0;this.y=t||0;this.z=n||0};THREE.Vector3.prototype={constructor:THREE.Vector3,set:function(e,t,n){this.x=e;this.y=t;this.z=n;return this},setX:function(e){this.x=e;return this},setY:function(e){this.y=e;return this},setZ:function(e){this.z=e;return this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},copy:function(e){this.x=e.x;this.y=e.y;this.z=e.z;return this},add:function(e,t){if(t!==undefined){console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead.");return this.addVectors(e,t)}this.x+=e.x;this.y+=e.y;this.z+=e.z;return this},addScalar:function(e){this.x+=e;this.y+=e;this.z+=e;return this},addVectors:function(e,t){this.x=e.x+t.x;this.y=e.y+t.y;this.z=e.z+t.z;return this},sub:function(e,t){if(t!==undefined){console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.");return this.subVectors(e,t)}this.x-=e.x;this.y-=e.y;this.z-=e.z;return this},subVectors:function(e,t){this.x=e.x-t.x;this.y=e.y-t.y;this.z=e.z-t.z;return this},multiply:function(e,t){if(t!==undefined){console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead.");return this.multiplyVectors(e,t)}this.x*=e.x;this.y*=e.y;this.z*=e.z;return this},multiplyScalar:function(e){this.x*=e;this.y*=e;this.z*=e;return this},multiplyVectors:function(e,t){this.x=e.x*t.x;this.y=e.y*t.y;this.z=e.z*t.z;return this},applyEuler:function(){var e;return function(t){if(t instanceof THREE.Euler===false){console.error("THREE.Vector3: .applyEuler() now expects a Euler rotation rather than a Vector3 and order.")}if(e===undefined)e=new THREE.Quaternion;this.applyQuaternion(e.setFromEuler(t));return this}}(),applyAxisAngle:function(){var e;return function(t,n){if(e===undefined)e=new THREE.Quaternion;this.applyQuaternion(e.setFromAxisAngle(t,n));return this}}(),applyMatrix3:function(e){var t=this.x;var n=this.y;var r=this.z;var i=e.elements;this.x=i[0]*t+i[3]*n+i[6]*r;this.y=i[1]*t+i[4]*n+i[7]*r;this.z=i[2]*t+i[5]*n+i[8]*r;return this},applyMatrix4:function(e){var t=this.x,n=this.y,r=this.z;var i=e.elements;this.x=i[0]*t+i[4]*n+i[8]*r+i[12];this.y=i[1]*t+i[5]*n+i[9]*r+i[13];this.z=i[2]*t+i[6]*n+i[10]*r+i[14];return this},applyProjection:function(e){var t=this.x,n=this.y,r=this.z;var i=e.elements;var s=1/(i[3]*t+i[7]*n+i[11]*r+i[15]);this.x=(i[0]*t+i[4]*n+i[8]*r+i[12])*s;this.y=(i[1]*t+i[5]*n+i[9]*r+i[13])*s;this.z=(i[2]*t+i[6]*n+i[10]*r+i[14])*s;return this},applyQuaternion:function(e){var t=this.x;var n=this.y;var r=this.z;var i=e.x;var s=e.y;var o=e.z;var u=e.w;var a=u*t+s*r-o*n;var f=u*n+o*t-i*r;var l=u*r+i*n-s*t;var c=-i*t-s*n-o*r;this.x=a*u+c*-i+f*-o-l*-s;this.y=f*u+c*-s+l*-i-a*-o;this.z=l*u+c*-o+a*-s-f*-i;return this},project:function(){var e;return function(t){if(e===undefined)e=new THREE.Matrix4;e.multiplyMatrices(t.projectionMatrix,e.getInverse(t.matrixWorld));return this.applyProjection(e)}}(),unproject:function(){var e;return function(t){if(e===undefined)e=new THREE.Matrix4;e.multiplyMatrices(t.matrixWorld,e.getInverse(t.projectionMatrix));return this.applyProjection(e)}}(),transformDirection:function(e){var t=this.x,n=this.y,r=this.z;var i=e.elements;this.x=i[0]*t+i[4]*n+i[8]*r;this.y=i[1]*t+i[5]*n+i[9]*r;this.z=i[2]*t+i[6]*n+i[10]*r;this.normalize();return this},divide:function(e){this.x/=e.x;this.y/=e.y;this.z/=e.z;return this},divideScalar:function(e){if(e!==0){var t=1/e;this.x*=t;this.y*=t;this.z*=t}else{this.x=0;this.y=0;this.z=0}return this},min:function(e){if(this.x>e.x){this.x=e.x}if(this.y>e.y){this.y=e.y}if(this.z>e.z){this.z=e.z}return this},max:function(e){if(this.x<e.x){this.x=e.x}if(this.y<e.y){this.y=e.y}if(this.z<e.z){this.z=e.z}return this},clamp:function(e,t){if(this.x<e.x){this.x=e.x}else if(this.x>t.x){this.x=t.x}if(this.y<e.y){this.y=e.y}else if(this.y>t.y){this.y=t.y}if(this.z<e.z){this.z=e.z}else if(this.z>t.z){this.z=t.z}return this},clampScalar:function(){var e,t;return function(n,r){if(e===undefined){e=new THREE.Vector3;t=new THREE.Vector3}e.set(n,n,n);t.set(r,r,r);return this.clamp(e,t)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);return this},roundToZero:function(){this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x);this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y);this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();if(t!==0&&e!==t){this.multiplyScalar(e/t)}return this},lerp:function(e,t){this.x+=(e.x-this.x)*t;this.y+=(e.y-this.y)*t;this.z+=(e.z-this.z)*t;return this},cross:function(e,t){if(t!==undefined){console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead.");return this.crossVectors(e,t)}var n=this.x,r=this.y,i=this.z;this.x=r*e.z-i*e.y;this.y=i*e.x-n*e.z;this.z=n*e.y-r*e.x;return this},crossVectors:function(e,t){var n=e.x,r=e.y,i=e.z;var s=t.x,o=t.y,u=t.z;this.x=r*u-i*o;this.y=i*s-n*u;this.z=n*o-r*s;return this},projectOnVector:function(){var e,t;return function(n){if(e===undefined)e=new THREE.Vector3;e.copy(n).normalize();t=this.dot(e);return this.copy(e).multiplyScalar(t)}}(),projectOnPlane:function(){var e;return function(t){if(e===undefined)e=new THREE.Vector3;e.copy(this).projectOnVector(t);return this.sub(e)}}(),reflect:function(){var e;return function(t){if(e===undefined)e=new THREE.Vector3;return this.sub(e.copy(t).multiplyScalar(2*this.dot(t)))}}(),angleTo:function(e){var t=this.dot(e)/(this.length()*e.length());return Math.acos(THREE.Math.clamp(t,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x;var n=this.y-e.y;var r=this.z-e.z;return t*t+n*n+r*r},setEulerFromRotationMatrix:function(e,t){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(e,t){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition().");return this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale().");return this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn().");return this.setFromMatrixColumn(e,t)},setFromMatrixPosition:function(e){this.x=e.elements[12];this.y=e.elements[13];this.z=e.elements[14];return this},setFromMatrixScale:function(e){var t=this.set(e.elements[0],e.elements[1],e.elements[2]).length();var n=this.set(e.elements[4],e.elements[5],e.elements[6]).length();var r=this.set(e.elements[8],e.elements[9],e.elements[10]).length();this.x=t;this.y=n;this.z=r;return this},setFromMatrixColumn:function(e,t){var n=e*4;var r=t.elements;this.x=r[n];this.y=r[n+1];this.z=r[n+2];return this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){if(t===undefined)t=0;this.x=e[t];this.y=e[t+1];this.z=e[t+2];return this},toArray:function(e,t){if(e===undefined)e=[];if(t===undefined)t=0;e[t]=this.x;e[t+1]=this.y;e[t+2]=this.z;return e},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)}};THREE.Vector4=function(e,t,n,r){this.x=e||0;this.y=t||0;this.z=n||0;this.w=r!==undefined?r:1};THREE.Vector4.prototype={constructor:THREE.Vector4,set:function(e,t,n,r){this.x=e;this.y=t;this.z=n;this.w=r;return this},setX:function(e){this.x=e;return this},setY:function(e){this.y=e;return this},setZ:function(e){this.z=e;return this},setW:function(e){this.w=e;return this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},copy:function(e){this.x=e.x;this.y=e.y;this.z=e.z;this.w=e.w!==undefined?e.w:1;return this},add:function(e,t){if(t!==undefined){console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead.");return this.addVectors(e,t)}this.x+=e.x;this.y+=e.y;this.z+=e.z;this.w+=e.w;return this},addScalar:function(e){this.x+=e;this.y+=e;this.z+=e;this.w+=e;return this},addVectors:function(e,t){this.x=e.x+t.x;this.y=e.y+t.y;this.z=e.z+t.z;this.w=e.w+t.w;return this},sub:function(e,t){if(t!==undefined){console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.");return this.subVectors(e,t)}this.x-=e.x;this.y-=e.y;this.z-=e.z;this.w-=e.w;return this},subVectors:function(e,t){this.x=e.x-t.x;this.y=e.y-t.y;this.z=e.z-t.z;this.w=e.w-t.w;return this},multiplyScalar:function(e){this.x*=e;this.y*=e;this.z*=e;this.w*=e;return this},applyMatrix4:function(e){var t=this.x;var n=this.y;var r=this.z;var i=this.w;var s=e.elements;this.x=s[0]*t+s[4]*n+s[8]*r+s[12]*i;this.y=s[1]*t+s[5]*n+s[9]*r+s[13]*i;this.z=s[2]*t+s[6]*n+s[10]*r+s[14]*i;this.w=s[3]*t+s[7]*n+s[11]*r+s[15]*i;return this},divideScalar:function(e){if(e!==0){var t=1/e;this.x*=t;this.y*=t;this.z*=t;this.w*=t}else{this.x=0;this.y=0;this.z=0;this.w=1}return this},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);if(t<1e-4){this.x=1;this.y=0;this.z=0}else{this.x=e.x/t;this.y=e.y/t;this.z=e.z/t}return this},setAxisAngleFromRotationMatrix:function(e){var t,n,r,i,s=.01,o=.1,u=e.elements,a=u[0],f=u[4],l=u[8],c=u[1],h=u[5],p=u[9],d=u[2],v=u[6],m=u[10];if(Math.abs(f-c)<s&&Math.abs(l-d)<s&&Math.abs(p-v)<s){if(Math.abs(f+c)<o&&Math.abs(l+d)<o&&Math.abs(p+v)<o&&Math.abs(a+h+m-3)<o){this.set(1,0,0,0);return this}t=Math.PI;var g=(a+1)/2;var y=(h+1)/2;var b=(m+1)/2;var w=(f+c)/4;var E=(l+d)/4;var S=(p+v)/4;if(g>y&&g>b){if(g<s){n=0;r=.707106781;i=.707106781}else{n=Math.sqrt(g);r=w/n;i=E/n}}else if(y>b){if(y<s){n=.707106781;r=0;i=.707106781}else{r=Math.sqrt(y);n=w/r;i=S/r}}else{if(b<s){n=.707106781;r=.707106781;i=0}else{i=Math.sqrt(b);n=E/i;r=S/i}}this.set(n,r,i,t);return this}var x=Math.sqrt((v-p)*(v-p)+(l-d)*(l-d)+(c-f)*(c-f));if(Math.abs(x)<.001)x=1;this.x=(v-p)/x;this.y=(l-d)/x;this.z=(c-f)/x;this.w=Math.acos((a+h+m-1)/2);return this},min:function(e){if(this.x>e.x){this.x=e.x}if(this.y>e.y){this.y=e.y}if(this.z>e.z){this.z=e.z}if(this.w>e.w){this.w=e.w}return this},max:function(e){if(this.x<e.x){this.x=e.x}if(this.y<e.y){this.y=e.y}if(this.z<e.z){this.z=e.z}if(this.w<e.w){this.w=e.w}return this},clamp:function(e,t){if(this.x<e.x){this.x=e.x}else if(this.x>t.x){this.x=t.x}if(this.y<e.y){this.y=e.y}else if(this.y>t.y){this.y=t.y}if(this.z<e.z){this.z=e.z}else if(this.z>t.z){this.z=t.z}if(this.w<e.w){this.w=e.w}else if(this.w>t.w){this.w=t.w}return this},clampScalar:function(){var e,t;return function(n,r){if(e===undefined){e=new THREE.Vector4;t=new THREE.Vector4}e.set(n,n,n,n);t.set(r,r,r,r);return this.clamp(e,t)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);this.w=Math.floor(this.w);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);this.w=Math.ceil(this.w);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);this.w=Math.round(this.w);return this},roundToZero:function(){this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x);this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y);this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z);this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;this.w=-this.w;return this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();if(t!==0&&e!==t){this.multiplyScalar(e/t)}return this},lerp:function(e,t){this.x+=(e.x-this.x)*t;this.y+=(e.y-this.y)*t;this.z+=(e.z-this.z)*t;this.w+=(e.w-this.w)*t;return this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){if(t===undefined)t=0;this.x=e[t];this.y=e[t+1];this.z=e[t+2];this.w=e[t+3];return this},toArray:function(e,t){if(e===undefined)e=[];if(t===undefined)t=0;e[t]=this.x;e[t+1]=this.y;e[t+2]=this.z;e[t+3]=this.w;return e},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w)}};THREE.Euler=function(e,t,n,r){this._x=e||0;this._y=t||0;this._z=n||0;this._order=r||THREE.Euler.DefaultOrder};THREE.Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];THREE.Euler.DefaultOrder="XYZ";THREE.Euler.prototype={constructor:THREE.Euler,_x:0,_y:0,_z:0,_order:THREE.Euler.DefaultOrder,get x(){return this._x},set x(e){this._x=e;this.onChangeCallback()},get y(){return this._y},set y(e){this._y=e;this.onChangeCallback()},get z(){return this._z},set z(e){this._z=e;this.onChangeCallback()},get order(){return this._order},set order(e){this._order=e;this.onChangeCallback()},set:function(e,t,n,r){this._x=e;this._y=t;this._z=n;this._order=r||this._order;this.onChangeCallback();return this},copy:function(e){this._x=e._x;this._y=e._y;this._z=e._z;this._order=e._order;this.onChangeCallback();return this},setFromRotationMatrix:function(e,t){var n=THREE.Math.clamp;var r=e.elements;var i=r[0],s=r[4],o=r[8];var u=r[1],a=r[5],f=r[9];var l=r[2],c=r[6],h=r[10];t=t||this._order;if(t==="XYZ"){this._y=Math.asin(n(o,-1,1));if(Math.abs(o)<.99999){this._x=Math.atan2(-f,h);this._z=Math.atan2(-s,i)}else{this._x=Math.atan2(c,a);this._z=0}}else if(t==="YXZ"){this._x=Math.asin(-n(f,-1,1));if(Math.abs(f)<.99999){this._y=Math.atan2(o,h);this._z=Math.atan2(u,a)}else{this._y=Math.atan2(-l,i);this._z=0}}else if(t==="ZXY"){this._x=Math.asin(n(c,-1,1));if(Math.abs(c)<.99999){this._y=Math.atan2(-l,h);this._z=Math.atan2(-s,a)}else{this._y=0;this._z=Math.atan2(u,i)}}else if(t==="ZYX"){this._y=Math.asin(-n(l,-1,1));if(Math.abs(l)<.99999){this._x=Math.atan2(c,h);this._z=Math.atan2(u,i)}else{this._x=0;this._z=Math.atan2(-s,a)}}else if(t==="YZX"){this._z=Math.asin(n(u,-1,1));if(Math.abs(u)<.99999){this._x=Math.atan2(-f,a);this._y=Math.atan2(-l,i)}else{this._x=0;this._y=Math.atan2(o,h)}}else if(t==="XZY"){this._z=Math.asin(-n(s,-1,1));if(Math.abs(s)<.99999){this._x=Math.atan2(c,a);this._y=Math.atan2(o,i)}else{this._x=Math.atan2(-f,h);this._y=0}}else{console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+t)}this._order=t;this.onChangeCallback();return this},setFromQuaternion:function(e,t,n){var r=THREE.Math.clamp;var i=e.x*e.x;var s=e.y*e.y;var o=e.z*e.z;var u=e.w*e.w;t=t||this._order;if(t==="XYZ"){this._x=Math.atan2(2*(e.x*e.w-e.y*e.z),u-i-s+o);this._y=Math.asin(r(2*(e.x*e.z+e.y*e.w),-1,1));this._z=Math.atan2(2*(e.z*e.w-e.x*e.y),u+i-s-o)}else if(t==="YXZ"){this._x=Math.asin(r(2*(e.x*e.w-e.y*e.z),-1,1));this._y=Math.atan2(2*(e.x*e.z+e.y*e.w),u-i-s+o);this._z=Math.atan2(2*(e.x*e.y+e.z*e.w),u-i+s-o)}else if(t==="ZXY"){this._x=Math.asin(r(2*(e.x*e.w+e.y*e.z),-1,1));this._y=Math.atan2(2*(e.y*e.w-e.z*e.x),u-i-s+o);this._z=Math.atan2(2*(e.z*e.w-e.x*e.y),u-i+s-o)}else if(t==="ZYX"){this._x=Math.atan2(2*(e.x*e.w+e.z*e.y),u-i-s+o);this._y=Math.asin(r(2*(e.y*e.w-e.x*e.z),-1,1));this._z=Math.atan2(2*(e.x*e.y+e.z*e.w),u+i-s-o)}else if(t==="YZX"){this._x=Math.atan2(2*(e.x*e.w-e.z*e.y),u-i+s-o);this._y=Math.atan2(2*(e.y*e.w-e.x*e.z),u+i-s-o);this._z=Math.asin(r(2*(e.x*e.y+e.z*e.w),-1,1))}else if(t==="XZY"){this._x=Math.atan2(2*(e.x*e.w+e.y*e.z),u-i+s-o);this._y=Math.atan2(2*(e.x*e.z+e.y*e.w),u+i-s-o);this._z=Math.asin(r(2*(e.z*e.w-e.x*e.y),-1,1))}else{console.warn("THREE.Euler: .setFromQuaternion() given unsupported order: "+t)}this._order=t;if(n!==false)this.onChangeCallback();return this},reorder:function(){var e=new THREE.Quaternion;return function(t){e.setFromEuler(this);this.setFromQuaternion(e,t)}}(),equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){this._x=e[0];this._y=e[1];this._z=e[2];if(e[3]!==undefined)this._order=e[3];this.onChangeCallback();return this},toArray:function(){return[this._x,this._y,this._z,this._order]},onChange:function(e){this.onChangeCallback=e;return this},onChangeCallback:function(){},clone:function(){return new THREE.Euler(this._x,this._y,this._z,this._order)}};THREE.Line3=function(e,t){this.start=e!==undefined?e:new THREE.Vector3;this.end=t!==undefined?t:new THREE.Vector3};THREE.Line3.prototype={constructor:THREE.Line3,set:function(e,t){this.start.copy(e);this.end.copy(t);return this},copy:function(e){this.start.copy(e.start);this.end.copy(e.end);return this},center:function(e){var t=e||new THREE.Vector3;return t.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){var t=e||new THREE.Vector3;return t.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){var n=t||new THREE.Vector3;return this.delta(n).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(){var e=new THREE.Vector3;var t=new THREE.Vector3;return function(n,r){e.subVectors(n,this.start);t.subVectors(this.end,this.start);var i=t.dot(t);var s=t.dot(e);var o=s/i;if(r){o=THREE.Math.clamp(o,0,1)}return o}}(),closestPointToPoint:function(e,t,n){var r=this.closestPointToPointParameter(e,t);var i=n||new THREE.Vector3;return this.delta(i).multiplyScalar(r).add(this.start)},applyMatrix4:function(e){this.start.applyMatrix4(e);this.end.applyMatrix4(e);return this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)},clone:function(){return(new THREE.Line3).copy(this)}};THREE.Box2=function(e,t){this.min=e!==undefined?e:new THREE.Vector2(Infinity,Infinity);this.max=t!==undefined?t:new THREE.Vector2(-Infinity,-Infinity)};THREE.Box2.prototype={constructor:THREE.Box2,set:function(e,t){this.min.copy(e);this.max.copy(t);return this},setFromPoints:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++){this.expandByPoint(e[t])}return this},setFromCenterAndSize:function(){var e=new THREE.Vector2;return function(t,n){var r=e.copy(n).multiplyScalar(.5);this.min.copy(t).sub(r);this.max.copy(t).add(r);return this}}(),copy:function(e){this.min.copy(e.min);this.max.copy(e.max);return this},makeEmpty:function(){this.min.x=this.min.y=Infinity;this.max.x=this.max.y=-Infinity;return this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(e){var t=e||new THREE.Vector2;return t.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){var t=e||new THREE.Vector2;return t.subVectors(this.max,this.min)},expandByPoint:function(e){this.min.min(e);this.max.max(e);return this},expandByVector:function(e){this.min.sub(e);this.max.add(e);return this},expandByScalar:function(e){this.min.addScalar(-e);this.max.addScalar(e);return this},containsPoint:function(e){if(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y){return false}return true},containsBox:function(e){if(this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y){return true}return false},getParameter:function(e,t){var n=t||new THREE.Vector2;return n.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(e){if(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y){return false}return true},clampPoint:function(e,t){var n=t||new THREE.Vector2;return n.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new THREE.Vector2;return function(t){var n=e.copy(t).clamp(this.min,this.max);return n.sub(t).length()}}(),intersect:function(e){this.min.max(e.min);this.max.min(e.max);return this},union:function(e){this.min.min(e.min);this.max.max(e.max);return this},translate:function(e){this.min.add(e);this.max.add(e);return this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new THREE.Box2).copy(this)}};THREE.Box3=function(e,t){this.min=e!==undefined?e:new THREE.Vector3(Infinity,Infinity,Infinity);this.max=t!==undefined?t:new THREE.Vector3(-Infinity,-Infinity,-Infinity)};THREE.Box3.prototype={constructor:THREE.Box3,set:function(e,t){this.min.copy(e);this.max.copy(t);return this},setFromPoints:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++){this.expandByPoint(e[t])}return this},setFromCenterAndSize:function(){var e=new THREE.Vector3;return function(t,n){var r=e.copy(n).multiplyScalar(.5);this.min.copy(t).sub(r);this.max.copy(t).add(r);return this}}(),setFromObject:function(){var e=new THREE.Vector3;return function(t){var n=this;t.updateMatrixWorld(true);this.makeEmpty();t.traverse(function(t){var r=t.geometry;if(r!==undefined){if(r instanceof THREE.Geometry){var i=r.vertices;for(var s=0,o=i.length;s<o;s++){e.copy(i[s]);e.applyMatrix4(t.matrixWorld);n.expandByPoint(e)}}else if(r instanceof THREE.BufferGeometry&&r.attributes["position"]!==undefined){var u=r.attributes["position"].array;for(var s=0,o=u.length;s<o;s+=3){e.set(u[s],u[s+1],u[s+2]);e.applyMatrix4(t.matrixWorld);n.expandByPoint(e)}}}});return this}}(),copy:function(e){this.min.copy(e.min);this.max.copy(e.max);return this},makeEmpty:function(){this.min.x=this.min.y=this.min.z=Infinity;this.max.x=this.max.y=this.max.z=-Infinity;return this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(e){var t=e||new THREE.Vector3;return t.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){var t=e||new THREE.Vector3;return t.subVectors(this.max,this.min)},expandByPoint:function(e){this.min.min(e);this.max.max(e);return this},expandByVector:function(e){this.min.sub(e);this.max.add(e);return this},expandByScalar:function(e){this.min.addScalar(-e);this.max.addScalar(e);return this},containsPoint:function(e){if(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z){return false}return true},containsBox:function(e){if(this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z){return true}return false},getParameter:function(e,t){var n=t||new THREE.Vector3;return n.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(e){if(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z){return false}return true},clampPoint:function(e,t){var n=t||new THREE.Vector3;return n.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new THREE.Vector3;return function(t){var n=e.copy(t).clamp(this.min,this.max);return n.sub(t).length()}}(),getBoundingSphere:function(){var e=new THREE.Vector3;return function(t){var n=t||new THREE.Sphere;n.center=this.center();n.radius=this.size(e).length()*.5;return n}}(),intersect:function(e){this.min.max(e.min);this.max.min(e.max);return this},union:function(e){this.min.min(e.min);this.max.max(e.max);return this},applyMatrix4:function(){var e=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];return function(t){e[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t);e[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t);e[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t);e[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t);e[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t);e[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t);e[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t);e[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t);this.makeEmpty();this.setFromPoints(e);return this}}(),translate:function(e){this.min.add(e);this.max.add(e);return this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new THREE.Box3).copy(this)}};THREE.Matrix3=function(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]);if(arguments.length>0){console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}};THREE.Matrix3.prototype={constructor:THREE.Matrix3,set:function(e,t,n,r,i,s,o,u,a){var f=this.elements;f[0]=e;f[3]=t;f[6]=n;f[1]=r;f[4]=i;f[7]=s;f[2]=o;f[5]=u;f[8]=a;return this},identity:function(){this.set(1,0,0,0,1,0,0,0,1);return this},copy:function(e){var t=e.elements;this.set(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8]);return this},multiplyVector3:function(e){console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead.");return e.applyMatrix3(this)},multiplyVector3Array:function(e){console.warn("THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.");return this.applyToVector3Array(e)},applyToVector3Array:function(){var e=new THREE.Vector3;return function(t,n,r){if(n===undefined)n=0;if(r===undefined)r=t.length;for(var i=0,s=n,o;i<r;i+=3,s+=3){e.x=t[s];e.y=t[s+1];e.z=t[s+2];e.applyMatrix3(this);t[s]=e.x;t[s+1]=e.y;t[s+2]=e.z}return t}}(),multiplyScalar:function(e){var t=this.elements;t[0]*=e;t[3]*=e;t[6]*=e;t[1]*=e;t[4]*=e;t[7]*=e;t[2]*=e;t[5]*=e;t[8]*=e;return this},determinant:function(){var e=this.elements;var t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],o=e[5],u=e[6],a=e[7],f=e[8];return t*s*f-t*o*a-n*i*f+n*o*u+r*i*a-r*s*u},getInverse:function(e,t){var n=e.elements;var r=this.elements;r[0]=n[10]*n[5]-n[6]*n[9];r[1]=-n[10]*n[1]+n[2]*n[9];r[2]=n[6]*n[1]-n[2]*n[5];r[3]=-n[10]*n[4]+n[6]*n[8];r[4]=n[10]*n[0]-n[2]*n[8];r[5]=-n[6]*n[0]+n[2]*n[4];r[6]=n[9]*n[4]-n[5]*n[8];r[7]=-n[9]*n[0]+n[1]*n[8];r[8]=n[5]*n[0]-n[1]*n[4];var i=n[0]*r[0]+n[1]*r[3]+n[2]*r[6];if(i===0){var s="Matrix3.getInverse(): can't invert matrix, determinant is 0";if(t||false){throw new Error(s)}else{console.warn(s)}this.identity();return this}this.multiplyScalar(1/i);return this},transpose:function(){var e,t=this.elements;e=t[1];t[1]=t[3];t[3]=e;e=t[2];t[2]=t[6];t[6]=e;e=t[5];t[5]=t[7];t[7]=e;return this},flattenToArrayOffset:function(e,t){var n=this.elements;e[t]=n[0];e[t+1]=n[1];e[t+2]=n[2];e[t+3]=n[3];e[t+4]=n[4];e[t+5]=n[5];e[t+6]=n[6];e[t+7]=n[7];e[t+8]=n[8];return e},getNormalMatrix:function(e){this.getInverse(e).transpose();return this},transposeIntoArray:function(e){var t=this.elements;e[0]=t[0];e[1]=t[3];e[2]=t[6];e[3]=t[1];e[4]=t[4];e[5]=t[7];e[6]=t[2];e[7]=t[5];e[8]=t[8];return this},fromArray:function(e){this.elements.set(e);return this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]},clone:function(){return(new THREE.Matrix3).fromArray(this.elements)}};THREE.Matrix4=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);if(arguments.length>0){console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}};THREE.Matrix4.prototype={constructor:THREE.Matrix4,set:function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){var m=this.elements;m[0]=e;m[4]=t;m[8]=n;m[12]=r;m[1]=i;m[5]=s;m[9]=o;m[13]=u;m[2]=a;m[6]=f;m[10]=l;m[14]=c;m[3]=h;m[7]=p;m[11]=d;m[15]=v;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},copy:function(e){this.elements.set(e.elements);return this},extractPosition:function(e){console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition().");return this.copyPosition(e)},copyPosition:function(e){var t=this.elements;var n=e.elements;t[12]=n[12];t[13]=n[13];t[14]=n[14];return this},extractRotation:function(){var e=new THREE.Vector3;return function(t){var n=this.elements;var r=t.elements;var i=1/e.set(r[0],r[1],r[2]).length();var s=1/e.set(r[4],r[5],r[6]).length();var o=1/e.set(r[8],r[9],r[10]).length();n[0]=r[0]*i;n[1]=r[1]*i;n[2]=r[2]*i;n[4]=r[4]*s;n[5]=r[5]*s;n[6]=r[6]*s;n[8]=r[8]*o;n[9]=r[9]*o;n[10]=r[10]*o;return this}}(),makeRotationFromEuler:function(e){if(e instanceof THREE.Euler===false){console.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.")}var t=this.elements;var n=e.x,r=e.y,i=e.z;var s=Math.cos(n),o=Math.sin(n);var u=Math.cos(r),a=Math.sin(r);var f=Math.cos(i),l=Math.sin(i);if(e.order==="XYZ"){var c=s*f,h=s*l,p=o*f,d=o*l;t[0]=u*f;t[4]=-u*l;t[8]=a;t[1]=h+p*a;t[5]=c-d*a;t[9]=-o*u;t[2]=d-c*a;t[6]=p+h*a;t[10]=s*u}else if(e.order==="YXZ"){var v=u*f,m=u*l,g=a*f,y=a*l;t[0]=v+y*o;t[4]=g*o-m;t[8]=s*a;t[1]=s*l;t[5]=s*f;t[9]=-o;t[2]=m*o-g;t[6]=y+v*o;t[10]=s*u}else if(e.order==="ZXY"){var v=u*f,m=u*l,g=a*f,y=a*l;t[0]=v-y*o;t[4]=-s*l;t[8]=g+m*o;t[1]=m+g*o;t[5]=s*f;t[9]=y-v*o;t[2]=-s*a;t[6]=o;t[10]=s*u}else if(e.order==="ZYX"){var c=s*f,h=s*l,p=o*f,d=o*l;t[0]=u*f;t[4]=p*a-h;t[8]=c*a+d;t[1]=u*l;t[5]=d*a+c;t[9]=h*a-p;t[2]=-a;t[6]=o*u;t[10]=s*u}else if(e.order==="YZX"){var b=s*u,w=s*a,E=o*u,S=o*a;t[0]=u*f;t[4]=S-b*l;t[8]=E*l+w;t[1]=l;t[5]=s*f;t[9]=-o*f;t[2]=-a*f;t[6]=w*l+E;t[10]=b-S*l}else if(e.order==="XZY"){var b=s*u,w=s*a,E=o*u,S=o*a;t[0]=u*f;t[4]=-l;t[8]=a*f;t[1]=b*l+S;t[5]=s*f;t[9]=w*l-E;t[2]=E*l-w;t[6]=o*f;t[10]=S*l+b}t[3]=0;t[7]=0;t[11]=0;t[12]=0;t[13]=0;t[14]=0;t[15]=1;return this},setRotationFromQuaternion:function(e){console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion().");return this.makeRotationFromQuaternion(e)},makeRotationFromQuaternion:function(e){var t=this.elements;var n=e.x,r=e.y,i=e.z,s=e.w;var o=n+n,u=r+r,a=i+i;var f=n*o,l=n*u,c=n*a;var h=r*u,p=r*a,d=i*a;var v=s*o,m=s*u,g=s*a;t[0]=1-(h+d);t[4]=l-g;t[8]=c+m;t[1]=l+g;t[5]=1-(f+d);t[9]=p-v;t[2]=c-m;t[6]=p+v;t[10]=1-(f+h);t[3]=0;t[7]=0;t[11]=0;t[12]=0;t[13]=0;t[14]=0;t[15]=1;return this},lookAt:function(){var e=new THREE.Vector3;var t=new THREE.Vector3;var n=new THREE.Vector3;return function(r,i,s){var o=this.elements;n.subVectors(r,i).normalize();if(n.length()===0){n.z=1}e.crossVectors(s,n).normalize();if(e.length()===0){n.x+=1e-4;e.crossVectors(s,n).normalize()}t.crossVectors(n,e);o[0]=e.x;o[4]=t.x;o[8]=n.x;o[1]=e.y;o[5]=t.y;o[9]=n.y;o[2]=e.z;o[6]=t.z;o[10]=n.z;return this}}(),multiply:function(e,t){if(t!==undefined){console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead.");return this.multiplyMatrices(e,t)}return this.multiplyMatrices(this,e)},multiplyMatrices:function(e,t){var n=e.elements;var r=t.elements;var i=this.elements;var s=n[0],o=n[4],u=n[8],a=n[12];var f=n[1],l=n[5],c=n[9],h=n[13];var p=n[2],d=n[6],v=n[10],m=n[14];var g=n[3],y=n[7],b=n[11],w=n[15];var E=r[0],S=r[4],x=r[8],T=r[12];var N=r[1],C=r[5],k=r[9],L=r[13];var A=r[2],O=r[6],M=r[10],_=r[14];var D=r[3],P=r[7],H=r[11],B=r[15];i[0]=s*E+o*N+u*A+a*D;i[4]=s*S+o*C+u*O+a*P;i[8]=s*x+o*k+u*M+a*H;i[12]=s*T+o*L+u*_+a*B;i[1]=f*E+l*N+c*A+h*D;i[5]=f*S+l*C+c*O+h*P;i[9]=f*x+l*k+c*M+h*H;i[13]=f*T+l*L+c*_+h*B;i[2]=p*E+d*N+v*A+m*D;i[6]=p*S+d*C+v*O+m*P;i[10]=p*x+d*k+v*M+m*H;i[14]=p*T+d*L+v*_+m*B;i[3]=g*E+y*N+b*A+w*D;i[7]=g*S+y*C+b*O+w*P;i[11]=g*x+y*k+b*M+w*H;i[15]=g*T+y*L+b*_+w*B;return this},multiplyToArray:function(e,t,n){var r=this.elements;this.multiplyMatrices(e,t);n[0]=r[0];n[1]=r[1];n[2]=r[2];n[3]=r[3];n[4]=r[4];n[5]=r[5];n[6]=r[6];n[7]=r[7];n[8]=r[8];n[9]=r[9];n[10]=r[10];n[11]=r[11];n[12]=r[12];n[13]=r[13];n[14]=r[14];n[15]=r[15];return this},multiplyScalar:function(e){var t=this.elements;t[0]*=e;t[4]*=e;t[8]*=e;t[12]*=e;t[1]*=e;t[5]*=e;t[9]*=e;t[13]*=e;t[2]*=e;t[6]*=e;t[10]*=e;t[14]*=e;t[3]*=e;t[7]*=e;t[11]*=e;t[15]*=e;return this},multiplyVector3:function(e){console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead.");return e.applyProjection(this)},multiplyVector4:function(e){console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead.");return e.applyMatrix4(this)},multiplyVector3Array:function(e){console.warn("THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.");return this.applyToVector3Array(e)},applyToVector3Array:function(){var e=new THREE.Vector3;return function(t,n,r){if(n===undefined)n=0;if(r===undefined)r=t.length;for(var i=0,s=n,o;i<r;i+=3,s+=3){e.x=t[s];e.y=t[s+1];e.z=t[s+2];e.applyMatrix4(this);t[s]=e.x;t[s+1]=e.y;t[s+2]=e.z}return t}}(),rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead.");e.transformDirection(this)},crossVector:function(e){console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead.");return e.applyMatrix4(this)},determinant:function(){var e=this.elements;var t=e[0],n=e[4],r=e[8],i=e[12];var s=e[1],o=e[5],u=e[9],a=e[13];var f=e[2],l=e[6],c=e[10],h=e[14];var p=e[3],d=e[7],v=e[11],m=e[15];return p*(+i*u*l-r*a*l-i*o*c+n*a*c+r*o*h-n*u*h)+d*(+t*u*h-t*a*c+i*s*c-r*s*h+r*a*f-i*u*f)+v*(+t*a*l-t*o*h-i*s*l+n*s*h+i*o*f-n*a*f)+m*(-r*o*f-t*u*l+t*o*c+r*s*l-n*s*c+n*u*f)},transpose:function(){var e=this.elements;var t;t=e[1];e[1]=e[4];e[4]=t;t=e[2];e[2]=e[8];e[8]=t;t=e[6];e[6]=e[9];e[9]=t;t=e[3];e[3]=e[12];e[12]=t;t=e[7];e[7]=e[13];e[13]=t;t=e[11];e[11]=e[14];e[14]=t;return this},flattenToArrayOffset:function(e,t){var n=this.elements;e[t]=n[0];e[t+1]=n[1];e[t+2]=n[2];e[t+3]=n[3];e[t+4]=n[4];e[t+5]=n[5];e[t+6]=n[6];e[t+7]=n[7];e[t+8]=n[8];e[t+9]=n[9];e[t+10]=n[10];e[t+11]=n[11];e[t+12]=n[12];e[t+13]=n[13];e[t+14]=n[14];e[t+15]=n[15];return e},getPosition:function(){var e=new THREE.Vector3;return function(){console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");var t=this.elements;return e.set(t[12],t[13],t[14])}}(),setPosition:function(e){var t=this.elements;t[12]=e.x;t[13]=e.y;t[14]=e.z;return this},getInverse:function(e,t){var n=this.elements;var r=e.elements;var i=r[0],s=r[4],o=r[8],u=r[12];var a=r[1],f=r[5],l=r[9],c=r[13];var h=r[2],p=r[6],d=r[10],v=r[14];var m=r[3],g=r[7],y=r[11],b=r[15];n[0]=l*v*g-c*d*g+c*p*y-f*v*y-l*p*b+f*d*b;n[4]=u*d*g-o*v*g-u*p*y+s*v*y+o*p*b-s*d*b;n[8]=o*c*g-u*l*g+u*f*y-s*c*y-o*f*b+s*l*b;n[12]=u*l*p-o*c*p-u*f*d+s*c*d+o*f*v-s*l*v;n[1]=c*d*m-l*v*m-c*h*y+a*v*y+l*h*b-a*d*b;n[5]=o*v*m-u*d*m+u*h*y-i*v*y-o*h*b+i*d*b;n[9]=u*l*m-o*c*m-u*a*y+i*c*y+o*a*b-i*l*b;n[13]=o*c*h-u*l*h+u*a*d-i*c*d-o*a*v+i*l*v;n[2]=f*v*m-c*p*m+c*h*g-a*v*g-f*h*b+a*p*b;n[6]=u*p*m-s*v*m-u*h*g+i*v*g+s*h*b-i*p*b;n[10]=s*c*m-u*f*m+u*a*g-i*c*g-s*a*b+i*f*b;n[14]=u*f*h-s*c*h-u*a*p+i*c*p+s*a*v-i*f*v;n[3]=l*p*m-f*d*m-l*h*g+a*d*g+f*h*y-a*p*y;n[7]=s*d*m-o*p*m+o*h*g-i*d*g-s*h*y+i*p*y;n[11]=o*f*m-s*l*m-o*a*g+i*l*g+s*a*y-i*f*y;n[15]=s*l*h-o*f*h+o*a*p-i*l*p-s*a*d+i*f*d;var w=i*n[0]+a*n[4]+h*n[8]+m*n[12];if(w==0){var E="Matrix4.getInverse(): can't invert matrix, determinant is 0";if(t||false){throw new Error(E)}else{console.warn(E)}this.identity();return this}this.multiplyScalar(1/w);return this},translate:function(e){console.warn("THREE.Matrix4: .translate() has been removed.")},rotateX:function(e){console.warn("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(e){console.warn("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(e){console.warn("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(e,t){console.warn("THREE.Matrix4: .rotateByAxis() has been removed.")},scale:function(e){var t=this.elements;var n=e.x,r=e.y,i=e.z;t[0]*=n;t[4]*=r;t[8]*=i;t[1]*=n;t[5]*=r;t[9]*=i;t[2]*=n;t[6]*=r;t[10]*=i;t[3]*=n;t[7]*=r;t[11]*=i;return this},getMaxScaleOnAxis:function(){var e=this.elements;var t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];var n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6];var r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,Math.max(n,r)))},makeTranslation:function(e,t,n){this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1);return this},makeRotationX:function(e){var t=Math.cos(e),n=Math.sin(e);this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1);return this},makeRotationY:function(e){var t=Math.cos(e),n=Math.sin(e);this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1);return this},makeRotationZ:function(e){var t=Math.cos(e),n=Math.sin(e);this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1);return this},makeRotationAxis:function(e,t){var n=Math.cos(t);var r=Math.sin(t);var i=1-n;var s=e.x,o=e.y,u=e.z;var a=i*s,f=i*o;this.set(a*s+n,a*o-r*u,a*u+r*o,0,a*o+r*u,f*o+n,f*u-r*s,0,a*u-r*o,f*u+r*s,i*u*u+n,0,0,0,0,1);return this},makeScale:function(e,t,n){this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1);return this},compose:function(e,t,n){this.makeRotationFromQuaternion(t);this.scale(n);this.setPosition(e);return this},decompose:function(){var e=new THREE.Vector3;var t=new THREE.Matrix4;return function(n,r,i){var s=this.elements;var o=e.set(s[0],s[1],s[2]).length();var u=e.set(s[4],s[5],s[6]).length();var a=e.set(s[8],s[9],s[10]).length();var f=this.determinant();if(f<0){o=-o}n.x=s[12];n.y=s[13];n.z=s[14];t.elements.set(this.elements);var l=1/o;var c=1/u;var h=1/a;t.elements[0]*=l;t.elements[1]*=l;t.elements[2]*=l;t.elements[4]*=c;t.elements[5]*=c;t.elements[6]*=c;t.elements[8]*=h;t.elements[9]*=h;t.elements[10]*=h;r.setFromRotationMatrix(t);i.x=o;i.y=u;i.z=a;return this}}(),makeFrustum:function(e,t,n,r,i,s){var o=this.elements;var u=2*i/(t-e);var a=2*i/(r-n);var f=(t+e)/(t-e);var l=(r+n)/(r-n);var c=-(s+i)/(s-i);var h=-2*s*i/(s-i);o[0]=u;o[4]=0;o[8]=f;o[12]=0;o[1]=0;o[5]=a;o[9]=l;o[13]=0;o[2]=0;o[6]=0;o[10]=c;o[14]=h;o[3]=0;o[7]=0;o[11]=-1;o[15]=0;return this},makePerspective:function(e,t,n,r){var i=n*Math.tan(THREE.Math.degToRad(e*.5));var s=-i;var o=s*t;var u=i*t;return this.makeFrustum(o,u,s,i,n,r)},makeOrthographic:function(e,t,n,r,i,s){var o=this.elements;var u=t-e;var a=n-r;var f=s-i;var l=(t+e)/u;var c=(n+r)/a;var h=(s+i)/f;o[0]=2/u;o[4]=0;o[8]=0;o[12]=-l;o[1]=0;o[5]=2/a;o[9]=0;o[13]=-c;o[2]=0;o[6]=0;o[10]=-2/f;o[14]=-h;o[3]=0;o[7]=0;o[11]=0;o[15]=1;return this},fromArray:function(e){this.elements.set(e);return this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]},clone:function(){return(new THREE.Matrix4).fromArray(this.elements)}};THREE.Ray=function(e,t){this.origin=e!==undefined?e:new THREE.Vector3;this.direction=t!==undefined?t:new THREE.Vector3};THREE.Ray.prototype={constructor:THREE.Ray,set:function(e,t){this.origin.copy(e);this.direction.copy(t);return this},copy:function(e){this.origin.copy(e.origin);this.direction.copy(e.direction);return this},at:function(e,t){var n=t||new THREE.Vector3;return n.copy(this.direction).multiplyScalar(e).add(this.origin)},recast:function(){var e=new THREE.Vector3;return function(t){this.origin.copy(this.at(t,e));return this}}(),closestPointToPoint:function(e,t){var n=t||new THREE.Vector3;n.subVectors(e,this.origin);var r=n.dot(this.direction);if(r<0){return n.copy(this.origin)}return n.copy(this.direction).multiplyScalar(r).add(this.origin)},distanceToPoint:function(){var e=new THREE.Vector3;return function(t){var n=e.subVectors(t,this.origin).dot(this.direction);if(n<0){return this.origin.distanceTo(t)}e.copy(this.direction).multiplyScalar(n).add(this.origin);return e.distanceTo(t)}}(),distanceSqToSegment:function(e,t,n,r){var i=e.clone().add(t).multiplyScalar(.5);var s=t.clone().sub(e).normalize();var o=e.distanceTo(t)*.5;var u=this.origin.clone().sub(i);var a=-this.direction.dot(s);var f=u.dot(this.direction);var l=-u.dot(s);var c=u.lengthSq();var h=Math.abs(1-a*a);var p,d,v,m;if(h>=0){p=a*l-f;d=a*f-l;m=o*h;if(p>=0){if(d>=-m){if(d<=m){var g=1/h;p*=g;d*=g;v=p*(p+a*d+2*f)+d*(a*p+d+2*l)+c}else{d=o;p=Math.max(0,-(a*d+f));v=-p*p+d*(d+2*l)+c}}else{d=-o;p=Math.max(0,-(a*d+f));v=-p*p+d*(d+2*l)+c}}else{if(d<=-m){p=Math.max(0,-(-a*o+f));d=p>0?-o:Math.min(Math.max(-o,-l),o);v=-p*p+d*(d+2*l)+c}else if(d<=m){p=0;d=Math.min(Math.max(-o,-l),o);v=d*(d+2*l)+c}else{p=Math.max(0,-(a*o+f));d=p>0?o:Math.min(Math.max(-o,-l),o);v=-p*p+d*(d+2*l)+c}}}else{d=a>0?-o:o;p=Math.max(0,-(a*d+f));v=-p*p+d*(d+2*l)+c}if(n){n.copy(this.direction.clone().multiplyScalar(p).add(this.origin))}if(r){r.copy(s.clone().multiplyScalar(d).add(i))}return v},isIntersectionSphere:function(e){return this.distanceToPoint(e.center)<=e.radius},intersectSphere:function(){var e=new THREE.Vector3;return function(t,n){e.subVectors(t.center,this.origin);var r=e.dot(this.direction);var i=e.dot(e)-r*r;var s=t.radius*t.radius;if(i>s)return null;var o=Math.sqrt(s-i);var u=r-o;var a=r+o;if(u<0&&a<0)return null;if(u<0)return this.at(a,n);return this.at(u,n)}}(),isIntersectionPlane:function(e){var t=e.distanceToPoint(this.origin);if(t===0){return true}var n=e.normal.dot(this.direction);if(n*t<0){return true}return false},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(t==0){if(e.distanceToPoint(this.origin)==0){return 0}return null}var n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null},intersectPlane:function(e,t){var n=this.distanceToPlane(e);if(n===null){return null}return this.at(n,t)},isIntersectionBox:function(){var e=new THREE.Vector3;return function(t){return this.intersectBox(t,e)!==null}}(),intersectBox:function(e,t){var n,r,i,s,o,u;var a=1/this.direction.x,f=1/this.direction.y,l=1/this.direction.z;var c=this.origin;if(a>=0){n=(e.min.x-c.x)*a;r=(e.max.x-c.x)*a}else{n=(e.max.x-c.x)*a;r=(e.min.x-c.x)*a}if(f>=0){i=(e.min.y-c.y)*f;s=(e.max.y-c.y)*f}else{i=(e.max.y-c.y)*f;s=(e.min.y-c.y)*f}if(n>s||i>r)return null;if(i>n||n!==n)n=i;if(s<r||r!==r)r=s;if(l>=0){o=(e.min.z-c.z)*l;u=(e.max.z-c.z)*l}else{o=(e.max.z-c.z)*l;u=(e.min.z-c.z)*l}if(n>u||o>r)return null;if(o>n||n!==n)n=o;if(u<r||r!==r)r=u;if(r<0)return null;return this.at(n>=0?n:r,t)},intersectTriangle:function(){var e=new THREE.Vector3;var t=new THREE.Vector3;var n=new THREE.Vector3;var r=new THREE.Vector3;return function(i,s,o,u,a){t.subVectors(s,i);n.subVectors(o,i);r.crossVectors(t,n);var f=this.direction.dot(r);var l;if(f>0){if(u)return null;l=1}else if(f<0){l=-1;f=-f}else{return null}e.subVectors(this.origin,i);var c=l*this.direction.dot(n.crossVectors(e,n));if(c<0){return null}var h=l*this.direction.dot(t.cross(e));if(h<0){return null}if(c+h>f){return null}var p=-l*e.dot(r);if(p<0){return null}return this.at(p/f,a)}}(),applyMatrix4:function(e){this.direction.add(this.origin).applyMatrix4(e);this.origin.applyMatrix4(e);this.direction.sub(this.origin);this.direction.normalize();return this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)},clone:function(){return(new THREE.Ray).copy(this)}};THREE.Sphere=function(e,t){this.center=e!==undefined?e:new THREE.Vector3;this.radius=t!==undefined?t:0};THREE.Sphere.prototype={constructor:THREE.Sphere,set:function(e,t){this.center.copy(e);this.radius=t;return this},setFromPoints:function(){var e=new THREE.Box3;return function(t,n){var r=this.center;if(n!==undefined){r.copy(n)}else{e.setFromPoints(t).center(r)}var i=0;for(var s=0,o=t.length;s<o;s++){i=Math.max(i,r.distanceToSquared(t[s]))}this.radius=Math.sqrt(i);return this}}(),copy:function(e){this.center.copy(e.center);this.radius=e.radius;return this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},clampPoint:function(e,t){var n=this.center.distanceToSquared(e);var r=t||new THREE.Vector3;r.copy(e);if(n>this.radius*this.radius){r.sub(this.center).normalize();r.multiplyScalar(this.radius).add(this.center)}return r},getBoundingBox:function(e){var t=e||new THREE.Box3;t.set(this.center,this.center);t.expandByScalar(this.radius);return t},applyMatrix4:function(e){this.center.applyMatrix4(e);this.radius=this.radius*e.getMaxScaleOnAxis();return this},translate:function(e){this.center.add(e);return this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius},clone:function(){return(new THREE.Sphere).copy(this)}};THREE.Frustum=function(e,t,n,r,i,s){this.planes=[e!==undefined?e:new THREE.Plane,t!==undefined?t:new THREE.Plane,n!==undefined?n:new THREE.Plane,r!==undefined?r:new THREE.Plane,i!==undefined?i:new THREE.Plane,s!==undefined?s:new THREE.Plane]};THREE.Frustum.prototype={constructor:THREE.Frustum,set:function(e,t,n,r,i,s){var o=this.planes;o[0].copy(e);o[1].copy(t);o[2].copy(n);o[3].copy(r);o[4].copy(i);o[5].copy(s);return this},copy:function(e){var t=this.planes;for(var n=0;n<6;n++){t[n].copy(e.planes[n])}return this},setFromMatrix:function(e){var t=this.planes;var n=e.elements;var r=n[0],i=n[1],s=n[2],o=n[3];var u=n[4],a=n[5],f=n[6],l=n[7];var c=n[8],h=n[9],p=n[10],d=n[11];var v=n[12],m=n[13],g=n[14],y=n[15];t[0].setComponents(o-r,l-u,d-c,y-v).normalize();t[1].setComponents(o+r,l+u,d+c,y+v).normalize();t[2].setComponents(o+i,l+a,d+h,y+m).normalize();t[3].setComponents(o-i,l-a,d-h,y-m).normalize();t[4].setComponents(o-s,l-f,d-p,y-g).normalize();t[5].setComponents(o+s,l+f,d+p,y+g).normalize();return this},intersectsObject:function(){var e=new THREE.Sphere;return function(t){var n=t.geometry;if(n.boundingSphere===null)n.computeBoundingSphere();e.copy(n.boundingSphere);e.applyMatrix4(t.matrixWorld);return this.intersectsSphere(e)}}(),intersectsSphere:function(e){var t=this.planes;var n=e.center;var r=-e.radius;for(var i=0;i<6;i++){var s=t[i].distanceToPoint(n);if(s<r){return false}}return true},intersectsBox:function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(n){var r=this.planes;for(var i=0;i<6;i++){var s=r[i];e.x=s.normal.x>0?n.min.x:n.max.x;t.x=s.normal.x>0?n.max.x:n.min.x;e.y=s.normal.y>0?n.min.y:n.max.y;t.y=s.normal.y>0?n.max.y:n.min.y;e.z=s.normal.z>0?n.min.z:n.max.z;t.z=s.normal.z>0?n.max.z:n.min.z;var o=s.distanceToPoint(e);var u=s.distanceToPoint(t);if(o<0&&u<0){return false}}return true}}(),containsPoint:function(e){var t=this.planes;for(var n=0;n<6;n++){if(t[n].distanceToPoint(e)<0){return false}}return true},clone:function(){return(new THREE.Frustum).copy(this)}};THREE.Plane=function(e,t){this.normal=e!==undefined?e:new THREE.Vector3(1,0,0);this.constant=t!==undefined?t:0};THREE.Plane.prototype={constructor:THREE.Plane,set:function(e,t){this.normal.copy(e);this.constant=t;return this},setComponents:function(e,t,n,r){this.normal.set(e,t,n);this.constant=r;return this},setFromNormalAndCoplanarPoint:function(e,t){this.normal.copy(e);this.constant=-t.dot(this.normal);return this},setFromCoplanarPoints:function(){var e=new THREE.Vector3;var t=new THREE.Vector3;return function(n,r,i){var s=e.subVectors(i,r).cross(t.subVectors(n,r)).normalize();this.setFromNormalAndCoplanarPoint(s,n);return this}}(),copy:function(e){this.normal.copy(e.normal);this.constant=e.constant;return this},normalize:function(){var e=1/this.normal.length();this.normal.multiplyScalar(e);this.constant*=e;return this},negate:function(){this.constant*=-1;this.normal.negate();return this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return this.orthoPoint(e,t).sub(e).negate()},orthoPoint:function(e,t){var n=this.distanceToPoint(e);var r=t||new THREE.Vector3;return r.copy(this.normal).multiplyScalar(n)},isIntersectionLine:function(e){var t=this.distanceToPoint(e.start);var n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0},intersectLine:function(){var e=new THREE.Vector3;return function(t,n){var r=n||new THREE.Vector3;var i=t.delta(e);var s=this.normal.dot(i);if(s==0){if(this.distanceToPoint(t.start)==0){return r.copy(t.start)}return undefined}var o=-(t.start.dot(this.normal)+this.constant)/s;if(o<0||o>1){return undefined}return r.copy(i).multiplyScalar(o).add(t.start)}}(),coplanarPoint:function(e){var t=e||new THREE.Vector3;return t.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var e=new THREE.Vector3;var t=new THREE.Vector3;var n=new THREE.Matrix3;return function(r,i){var s=i||n.getNormalMatrix(r);var o=e.copy(this.normal).applyMatrix3(s);var u=this.coplanarPoint(t);u.applyMatrix4(r);this.setFromNormalAndCoplanarPoint(o,u);return this}}(),translate:function(e){this.constant=this.constant-e.dot(this.normal);return this},equals:function(e){return e.normal.equals(this.normal)&&e.constant==this.constant},clone:function(){return(new THREE.Plane).copy(this)}};THREE.Math={generateUUID:function(){var e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");var t=new Array(36);var n=0,r;return function(){for(var i=0;i<36;i++){if(i==8||i==13||i==18||i==23){t[i]="-"}else if(i==14){t[i]="4"}else{if(n<=2)n=33554432+Math.random()*16777216|0;r=n&15;n=n>>4;t[i]=e[i==19?r&3|8:r]}}return t.join("")}}(),clamp:function(e,t,n){return e<t?t:e>n?n:e},clampBottom:function(e,t){return e<t?t:e},mapLinear:function(e,t,n,r,i){return r+(e-t)*(i-r)/(n-t)},smoothstep:function(e,t,n){if(e<=t)return 0;if(e>=n)return 1;e=(e-t)/(n-t);return e*e*(3-2*e)},smootherstep:function(e,t,n){if(e<=t)return 0;if(e>=n)return 1;e=(e-t)/(n-t);return e*e*e*(e*(e*6-15)+10)},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(){var e=Math.PI/180;return function(t){return t*e}}(),radToDeg:function(){var e=180/Math.PI;return function(t){return t*e}}(),isPowerOfTwo:function(e){return(e&e-1)===0&&e!==0}};THREE.Spline=function(e){function h(e,t,n,r,i,s,o){var u=(n-e)*.5,a=(r-t)*.5;return(2*(t-n)+u+a)*o+(-3*(t-n)-2*u-a)*s+u*i+t}this.points=e;var t=[],n={x:0,y:0,z:0},r,i,s,o,u,a,f,l,c;this.initFromArray=function(e){this.points=[];for(var t=0;t<e.length;t++){this.points[t]={x:e[t][0],y:e[t][1],z:e[t][2]}}};this.getPoint=function(e){r=(this.points.length-1)*e;i=Math.floor(r);s=r-i;t[0]=i===0?i:i-1;t[1]=i;t[2]=i>this.points.length-2?this.points.length-1:i+1;t[3]=i>this.points.length-3?this.points.length-1:i+2;a=this.points[t[0]];f=this.points[t[1]];l=this.points[t[2]];c=this.points[t[3]];o=s*s;u=s*o;n.x=h(a.x,f.x,l.x,c.x,s,o,u);n.y=h(a.y,f.y,l.y,c.y,s,o,u);n.z=h(a.z,f.z,l.z,c.z,s,o,u);return n};this.getControlPointsArray=function(){var e,t,n=this.points.length,r=[];for(e=0;e<n;e++){t=this.points[e];r[e]=[t.x,t.y,t.z]}return r};this.getLength=function(e){var t,n,r,i,s=0,o=0,u=0,a=new THREE.Vector3,f=new THREE.Vector3,l=[],c=0;l[0]=0;if(!e)e=100;r=this.points.length*e;a.copy(this.points[0]);for(t=1;t<r;t++){n=t/r;i=this.getPoint(n);f.copy(i);c+=f.distanceTo(a);a.copy(i);s=(this.points.length-1)*n;o=Math.floor(s);if(o!=u){l[o]=c;u=o}}l[l.length]=c;return{chunks:l,total:c}};this.reparametrizeByArcLength=function(e){var t,n,r,i,s,o,u,a,f,l=[],c=new THREE.Vector3,h=this.getLength();l.push(c.copy(this.points[0]).clone());for(t=1;t<this.points.length;t++){u=h.chunks[t]-h.chunks[t-1];a=Math.ceil(e*u/h.total);i=(t-1)/(this.points.length-1);s=t/(this.points.length-1);for(n=1;n<a-1;n++){r=i+n*(1/a)*(s-i);f=this.getPoint(r);l.push(c.copy(f).clone())}l.push(c.copy(this.points[t]).clone())}this.points=l};};THREE.Triangle=function(e,t,n){this.a=e!==undefined?e:new THREE.Vector3;this.b=t!==undefined?t:new THREE.Vector3;this.c=n!==undefined?n:new THREE.Vector3};THREE.Triangle.normal=function(){var e=new THREE.Vector3;return function(t,n,r,i){var s=i||new THREE.Vector3;s.subVectors(r,n);e.subVectors(t,n);s.cross(e);var o=s.lengthSq();if(o>0){return s.multiplyScalar(1/Math.sqrt(o))}return s.set(0,0,0)}}();THREE.Triangle.barycoordFromPoint=function(){var e=new THREE.Vector3;var t=new THREE.Vector3;var n=new THREE.Vector3;return function(r,i,s,o,u){e.subVectors(o,i);t.subVectors(s,i);n.subVectors(r,i);var a=e.dot(e);var f=e.dot(t);var l=e.dot(n);var c=t.dot(t);var h=t.dot(n);var p=a*c-f*f;var d=u||new THREE.Vector3;if(p==0){return d.set(-2,-1,-1)}var v=1/p;var m=(c*l-f*h)*v;var g=(a*h-f*l)*v;return d.set(1-m-g,g,m)}}();THREE.Triangle.containsPoint=function(){var e=new THREE.Vector3;return function(t,n,r,i){var s=THREE.Triangle.barycoordFromPoint(t,n,r,i,e);return s.x>=0&&s.y>=0&&s.x+s.y<=1}}();THREE.Triangle.prototype={constructor:THREE.Triangle,set:function(e,t,n){this.a.copy(e);this.b.copy(t);this.c.copy(n);return this},setFromPointsAndIndices:function(e,t,n,r){this.a.copy(e[t]);this.b.copy(e[n]);this.c.copy(e[r]);return this},copy:function(e){this.a.copy(e.a);this.b.copy(e.b);this.c.copy(e.c);return this},area:function(){var e=new THREE.Vector3;var t=new THREE.Vector3;return function(){e.subVectors(this.c,this.b);t.subVectors(this.a,this.b);return e.cross(t).length()*.5}}(),midpoint:function(e){var t=e||new THREE.Vector3;return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(e){return THREE.Triangle.normal(this.a,this.b,this.c,e)},plane:function(e){var t=e||new THREE.Plane;return t.setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(e,t){return THREE.Triangle.barycoordFromPoint(e,this.a,this.b,this.c,t)},containsPoint:function(e){return THREE.Triangle.containsPoint(e,this.a,this.b,this.c)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)},clone:function(){return(new THREE.Triangle).copy(this)}};THREE.Clock=function(e){this.autoStart=e!==undefined?e:true;this.startTime=0;this.oldTime=0;this.elapsedTime=0;this.running=false};THREE.Clock.prototype={constructor:THREE.Clock,start:function(){this.startTime=self.performance!==undefined&&self.performance.now!==undefined?self.performance.now():Date.now();this.oldTime=this.startTime;this.running=true},stop:function(){this.getElapsedTime();this.running=false},getElapsedTime:function(){this.getDelta();return this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running){this.start()}if(this.running){var t=self.performance!==undefined&&self.performance.now!==undefined?self.performance.now():Date.now();e=.001*(t-this.oldTime);this.oldTime=t;this.elapsedTime+=e}return e}};THREE.EventDispatcher=function(){};THREE.EventDispatcher.prototype={constructor:THREE.EventDispatcher,apply:function(e){e.addEventListener=THREE.EventDispatcher.prototype.addEventListener;e.hasEventListener=THREE.EventDispatcher.prototype.hasEventListener;e.removeEventListener=THREE.EventDispatcher.prototype.removeEventListener;e.dispatchEvent=THREE.EventDispatcher.prototype.dispatchEvent},addEventListener:function(e,t){if(this._listeners===undefined)this._listeners={};var n=this._listeners;if(n[e]===undefined){n[e]=[]}if(n[e].indexOf(t)===-1){n[e].push(t)}},hasEventListener:function(e,t){if(this._listeners===undefined)return false;var n=this._listeners;if(n[e]!==undefined&&n[e].indexOf(t)!==-1){return true}return false},removeEventListener:function(e,t){if(this._listeners===undefined)return;var n=this._listeners;var r=n[e];if(r!==undefined){var i=r.indexOf(t);if(i!==-1){r.splice(i,1)}}},dispatchEvent:function(e){if(this._listeners===undefined)return;var t=this._listeners;var n=t[e.type];if(n!==undefined){e.target=this;var r=[];var i=n.length;for(var s=0;s<i;s++){r[s]=n[s]}for(var s=0;s<i;s++){r[s].call(this,e)}}}};(function(e){e.Raycaster=function(t,n,r,i){this.ray=new e.Ray(t,n);this.near=r||0;this.far=i||Infinity;this.params={Sprite:{},Mesh:{},PointCloud:{threshold:1},LOD:{},Line:{}}};var t=function(e,t){return e.distance-t.distance};var n=function(e,t,r,i){e.raycast(t,r);if(i===true){var s=e.children;for(var o=0,u=s.length;o<u;o++){n(s[o],t,r,true)}}};e.Raycaster.prototype={constructor:e.Raycaster,precision:1e-4,linePrecision:1,set:function(e,t){this.ray.set(e,t)},intersectObject:function(e,r){var i=[];n(e,this,i,r);i.sort(t);return i},intersectObjects:function(e,r){var i=[];if(e instanceof Array===false){console.log("THREE.Raycaster.intersectObjects: objects is not an Array.");return i}for(var s=0,o=e.length;s<o;s++){n(e[s],this,i,r)}i.sort(t);return i}}})(THREE);THREE.Object3D=function(){Object.defineProperty(this,"id",{value:THREE.Object3DIdCount++});this.uuid=THREE.Math.generateUUID();this.name="";this.type="Object3D";this.parent=undefined;this.children=[];this.up=THREE.Object3D.DefaultUp.clone();var e=this;var t=new THREE.Vector3;var n=new THREE.Euler;var r=new THREE.Quaternion;var i=new THREE.Vector3(1,1,1);var s=function(){r.setFromEuler(n,false)};var o=function(){n.setFromQuaternion(r,undefined,false)};n.onChange(s);r.onChange(o);Object.defineProperties(this,{position:{enumerable:true,value:t},rotation:{enumerable:true,value:n},quaternion:{enumerable:true,value:r},scale:{enumerable:true,value:i}});this.renderDepth=null;this.rotationAutoUpdate=true;this.matrix=new THREE.Matrix4;this.matrixWorld=new THREE.Matrix4;this.matrixAutoUpdate=true;this.matrixWorldNeedsUpdate=false;this.visible=true;this.castShadow=false;this.receiveShadow=false;this.frustumCulled=true;this.userData={}};THREE.Object3D.DefaultUp=new THREE.Vector3(0,1,0);THREE.Object3D.prototype={constructor:THREE.Object3D,get eulerOrder(){console.warn("THREE.Object3D: .eulerOrder has been moved to .rotation.order.");return this.rotation.order},set eulerOrder(e){console.warn("THREE.Object3D: .eulerOrder has been moved to .rotation.order.");this.rotation.order=e},get useQuaternion(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set useQuaternion(e){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},applyMatrix:function(e){this.matrix.multiplyMatrices(e,this.matrix);this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,true)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(){var e=new THREE.Quaternion;return function(t,n){e.setFromAxisAngle(t,n);this.quaternion.multiply(e);return this}}(),rotateX:function(){var e=new THREE.Vector3(1,0,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateY:function(){var e=new THREE.Vector3(0,1,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateZ:function(){var e=new THREE.Vector3(0,0,1);return function(t){return this.rotateOnAxis(e,t)}}(),translateOnAxis:function(){var e=new THREE.Vector3;return function(t,n){e.copy(t).applyQuaternion(this.quaternion);this.position.add(e.multiplyScalar(n));return this}}(),translate:function(e,t){console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead.");return this.translateOnAxis(t,e)},translateX:function(){var e=new THREE.Vector3(1,0,0);return function(t){return this.translateOnAxis(e,t)}}(),translateY:function(){var e=new THREE.Vector3(0,1,0);return function(t){return this.translateOnAxis(e,t)}}(),translateZ:function(){var e=new THREE.Vector3(0,0,1);return function(t){return this.translateOnAxis(e,t)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var e=new THREE.Matrix4;return function(t){return t.applyMatrix4(e.getInverse(this.matrixWorld))}}(),lookAt:function(){var e=new THREE.Matrix4;return function(t){e.lookAt(t,this.position,this.up);this.quaternion.setFromRotationMatrix(e)}}(),add:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++){this.add(arguments[t])}return this}if(e===this){console.error("THREE.Object3D.add:",e,"can't be added as a child of itself.");return this}if(e instanceof THREE.Object3D){if(e.parent!==undefined){e.parent.remove(e)}e.parent=this;e.dispatchEvent({type:"added"});this.children.push(e)}else{console.error("THREE.Object3D.add:",e,"is not an instance of THREE.Object3D.")}return this},remove:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++){this.remove(arguments[t])}}var n=this.children.indexOf(e);if(n!==-1){e.parent=undefined;e.dispatchEvent({type:"removed"});this.children.splice(n,1)}},getChildByName:function(e,t){console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName().");return this.getObjectByName(e,t)},getObjectById:function(e,t){if(this.id===e)return this;for(var n=0,r=this.children.length;n<r;n++){var i=this.children[n];var s=i.getObjectById(e,t);if(s!==undefined){return s}}return undefined},getObjectByName:function(e,t){if(this.name===e)return this;for(var n=0,r=this.children.length;n<r;n++){var i=this.children[n];var s=i.getObjectByName(e,t);if(s!==undefined){return s}}return undefined},getWorldPosition:function(e){var t=e||new THREE.Vector3;this.updateMatrixWorld(true);return t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var e=new THREE.Vector3;var t=new THREE.Vector3;return function(n){var r=n||new THREE.Quaternion;this.updateMatrixWorld(true);this.matrixWorld.decompose(e,r,t);return r}}(),getWorldRotation:function(){var e=new THREE.Quaternion;return function(t){var n=t||new THREE.Euler;this.getWorldQuaternion(e);return n.setFromQuaternion(e,this.rotation.order,false)}}(),getWorldScale:function(){var e=new THREE.Vector3;var t=new THREE.Quaternion;return function(n){var r=n||new THREE.Vector3;this.updateMatrixWorld(true);this.matrixWorld.decompose(e,t,r);return r}}(),getWorldDirection:function(){var e=new THREE.Quaternion;return function(t){var n=t||new THREE.Vector3;this.getWorldQuaternion(e);return n.set(0,0,1).applyQuaternion(e)}}(),raycast:function(){},traverse:function(e){e(this);for(var t=0,n=this.children.length;t<n;t++){this.children[t].traverse(e)}},traverseVisible:function(e){if(this.visible===false)return;e(this);for(var t=0,n=this.children.length;t<n;t++){this.children[t].traverseVisible(e)}},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale);this.matrixWorldNeedsUpdate=true},updateMatrixWorld:function(e){if(this.matrixAutoUpdate===true)this.updateMatrix();if(this.matrixWorldNeedsUpdate===true||e===true){if(this.parent===undefined){this.matrixWorld.copy(this.matrix)}else{this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)}this.matrixWorldNeedsUpdate=false;e=true}for(var t=0,n=this.children.length;t<n;t++){this.children[t].updateMatrixWorld(e)}},toJSON:function(){var e={metadata:{version:4.3,type:"Object",generator:"ObjectExporter"}};var t={};var n=function(n){if(e.geometries===undefined){e.geometries=[]}if(t[n.uuid]===undefined){var r=n.toJSON();delete r.metadata;t[n.uuid]=r;e.geometries.push(r)}return n.uuid};var r={};var i=function(t){if(e.materials===undefined){e.materials=[]}if(r[t.uuid]===undefined){var n=t.toJSON();delete n.metadata;r[t.uuid]=n;e.materials.push(n)}return t.uuid};var s=function(e){var t={};t.uuid=e.uuid;t.type=e.type;if(e.name!=="")t.name=e.name;if(JSON.stringify(e.userData)!=="{}")t.userData=e.userData;if(e.visible!==true)t.visible=e.visible;if(e instanceof THREE.PerspectiveCamera){t.fov=e.fov;t.aspect=e.aspect;t.near=e.near;t.far=e.far}else if(e instanceof THREE.OrthographicCamera){t.left=e.left;t.right=e.right;t.top=e.top;t.bottom=e.bottom;t.near=e.near;t.far=e.far}else if(e instanceof THREE.AmbientLight){t.color=e.color.getHex()}else if(e instanceof THREE.DirectionalLight){t.color=e.color.getHex();t.intensity=e.intensity}else if(e instanceof THREE.PointLight){t.color=e.color.getHex();t.intensity=e.intensity;t.distance=e.distance}else if(e instanceof THREE.SpotLight){t.color=e.color.getHex();t.intensity=e.intensity;t.distance=e.distance;t.angle=e.angle;t.exponent=e.exponent}else if(e instanceof THREE.HemisphereLight){t.color=e.color.getHex();t.groundColor=e.groundColor.getHex()}else if(e instanceof THREE.Mesh){t.geometry=n(e.geometry);t.material=i(e.material)}else if(e instanceof THREE.Line){t.geometry=n(e.geometry);t.material=i(e.material)}else if(e instanceof THREE.Sprite){t.material=i(e.material)}t.matrix=e.matrix.toArray();if(e.children.length>0){t.children=[];for(var r=0;r<e.children.length;r++){t.children.push(s(e.children[r]))}}return t};e.object=s(this);return e},clone:function(e,t){if(e===undefined)e=new THREE.Object3D;if(t===undefined)t=true;e.name=this.name;e.up.copy(this.up);e.position.copy(this.position);e.quaternion.copy(this.quaternion);e.scale.copy(this.scale);e.renderDepth=this.renderDepth;e.rotationAutoUpdate=this.rotationAutoUpdate;e.matrix.copy(this.matrix);e.matrixWorld.copy(this.matrixWorld);e.matrixAutoUpdate=this.matrixAutoUpdate;e.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate;e.visible=this.visible;e.castShadow=this.castShadow;e.receiveShadow=this.receiveShadow;e.frustumCulled=this.frustumCulled;e.userData=JSON.parse(JSON.stringify(this.userData));if(t===true){for(var n=0;n<this.children.length;n++){var r=this.children[n];e.add(r.clone())}}return e}};THREE.EventDispatcher.prototype.apply(THREE.Object3D.prototype);THREE.Object3DIdCount=0;THREE.Projector=function(){console.warn("THREE.Projector has been moved to /examples/renderers/Projector.js.");this.projectVector=function(e,t){console.warn("THREE.Projector: .projectVector() is now vector.project().");e.project(t)};this.unprojectVector=function(e,t){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject().");e.unproject(t)};this.pickingRay=function(e,t){console.error("THREE.Projector: .pickingRay() has been removed.")}};THREE.Face3=function(e,t,n,r,i,s){this.a=e;this.b=t;this.c=n;this.normal=r instanceof THREE.Vector3?r:new THREE.Vector3;this.vertexNormals=r instanceof Array?r:[];this.color=i instanceof THREE.Color?i:new THREE.Color;this.vertexColors=i instanceof Array?i:[];this.vertexTangents=[];this.materialIndex=s!==undefined?s:0};THREE.Face3.prototype={constructor:THREE.Face3,clone:function(){var e=new THREE.Face3(this.a,this.b,this.c);e.normal.copy(this.normal);e.color.copy(this.color);e.materialIndex=this.materialIndex;for(var t=0,n=this.vertexNormals.length;t<n;t++){e.vertexNormals[t]=this.vertexNormals[t].clone()}for(var t=0,n=this.vertexColors.length;t<n;t++){e.vertexColors[t]=this.vertexColors[t].clone()}for(var t=0,n=this.vertexTangents.length;t<n;t++){e.vertexTangents[t]=this.vertexTangents[t].clone()}return e}};THREE.Face4=function(e,t,n,r,i,s,o){console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead.");return new THREE.Face3(e,t,n,i,s,o)};THREE.BufferAttribute=function(e,t){this.array=e;this.itemSize=t;this.needsUpdate=false};THREE.BufferAttribute.prototype={constructor:THREE.BufferAttribute,get length(){return this.array.length},copyAt:function(e,t,n){e*=this.itemSize;n*=t.itemSize;for(var r=0,i=this.itemSize;r<i;r++){this.array[e+r]=t.array[n+r]}},set:function(e){this.array.set(e);return this},setX:function(e,t){this.array[e*this.itemSize]=t;return this},setY:function(e,t){this.array[e*this.itemSize+1]=t;return this},setZ:function(e,t){this.array[e*this.itemSize+2]=t;return this},setXY:function(e,t,n){e*=this.itemSize;this.array[e]=t;this.array[e+1]=n;return this},setXYZ:function(e,t,n,r){e*=this.itemSize;this.array[e]=t;this.array[e+1]=n;this.array[e+2]=r;return this},setXYZW:function(e,t,n,r,i){e*=this.itemSize;this.array[e]=t;this.array[e+1]=n;this.array[e+2]=r;this.array[e+3]=i;return this},clone:function(){return new THREE.BufferAttribute(new this.array.constructor(this.array),this.itemSize)}};THREE.Int8Attribute=function(e,t){console.warn("THREE.Int8Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(e,t)};THREE.Uint8Attribute=function(e,t){console.warn("THREE.Uint8Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(e,t)};THREE.Uint8ClampedAttribute=function(e,t){console.warn("THREE.Uint8ClampedAttribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(e,t)};THREE.Int16Attribute=function(e,t){console.warn("THREE.Int16Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(e,t)};THREE.Uint16Attribute=function(e,t){console.warn("THREE.Uint16Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(e,t)};THREE.Int32Attribute=function(e,t){console.warn("THREE.Int32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(e,t)};THREE.Uint32Attribute=function(e,t){console.warn("THREE.Uint32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(e,t)};THREE.Float32Attribute=function(e,t){console.warn("THREE.Float32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(e,t)};THREE.Float64Attribute=function(e,t){console.warn("THREE.Float64Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(e,t)};THREE.BufferGeometry=function(){Object.defineProperty(this,"id",{value:THREE.GeometryIdCount++});this.uuid=THREE.Math.generateUUID();this.name="";this.type="BufferGeometry";this.attributes={};this.attributesKeys=[];this.drawcalls=[];this.offsets=this.drawcalls;this.boundingBox=null;this.boundingSphere=null};THREE.BufferGeometry.prototype={constructor:THREE.BufferGeometry,addAttribute:function(e,t){if(t instanceof THREE.BufferAttribute===false){console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute ).");this.attributes[e]={array:arguments[1],itemSize:arguments[2]};return}this.attributes[e]=t;this.attributesKeys=Object.keys(this.attributes)},getAttribute:function(e){return this.attributes[e]},addDrawCall:function(e,t,n){this.drawcalls.push({start:e,count:t,index:n!==undefined?n:0})},applyMatrix:function(e){var t=this.attributes.position;if(t!==undefined){e.applyToVector3Array(t.array);t.needsUpdate=true}var n=this.attributes.normal;if(n!==undefined){var r=(new THREE.Matrix3).getNormalMatrix(e);r.applyToVector3Array(n.array);n.needsUpdate=true}},center:function(){},fromGeometry:function(e,t){t=t||{vertexColors:THREE.NoColors};var n=e.vertices;var r=e.faces;var i=e.faceVertexUvs;var s=t.vertexColors;var o=i[0].length>0;var u=r[0].vertexNormals.length==3;var a=new Float32Array(r.length*3*3);this.addAttribute("position",new THREE.BufferAttribute(a,3));var f=new Float32Array(r.length*3*3);this.addAttribute("normal",new THREE.BufferAttribute(f,3));if(s!==THREE.NoColors){var l=new Float32Array(r.length*3*3);this.addAttribute("color",new THREE.BufferAttribute(l,3))}if(o===true){var c=new Float32Array(r.length*3*2);this.addAttribute("uv",new THREE.BufferAttribute(c,2))}for(var h=0,p=0,d=0;h<r.length;h++,p+=6,d+=9){var v=r[h];var m=n[v.a];var g=n[v.b];var y=n[v.c];a[d]=m.x;a[d+1]=m.y;a[d+2]=m.z;a[d+3]=g.x;a[d+4]=g.y;a[d+5]=g.z;a[d+6]=y.x;a[d+7]=y.y;a[d+8]=y.z;if(u===true){var b=v.vertexNormals[0];var w=v.vertexNormals[1];var E=v.vertexNormals[2];f[d]=b.x;f[d+1]=b.y;f[d+2]=b.z;f[d+3]=w.x;f[d+4]=w.y;f[d+5]=w.z;f[d+6]=E.x;f[d+7]=E.y;f[d+8]=E.z}else{var S=v.normal;f[d]=S.x;f[d+1]=S.y;f[d+2]=S.z;f[d+3]=S.x;f[d+4]=S.y;f[d+5]=S.z;f[d+6]=S.x;f[d+7]=S.y;f[d+8]=S.z}if(s===THREE.FaceColors){var x=v.color;l[d]=x.r;l[d+1]=x.g;l[d+2]=x.b;l[d+3]=x.r;l[d+4]=x.g;l[d+5]=x.b;l[d+6]=x.r;l[d+7]=x.g;l[d+8]=x.b}else if(s===THREE.VertexColors){var T=v.vertexColors[0];var N=v.vertexColors[1];var C=v.vertexColors[2];l[d]=T.r;l[d+1]=T.g;l[d+2]=T.b;l[d+3]=N.r;l[d+4]=N.g;l[d+5]=N.b;l[d+6]=C.r;l[d+7]=C.g;l[d+8]=C.b}if(o===true){var k=i[0][h][0];var L=i[0][h][1];var A=i[0][h][2];c[p]=k.x;c[p+1]=k.y;c[p+2]=L.x;c[p+3]=L.y;c[p+4]=A.x;c[p+5]=A.y}}this.computeBoundingSphere();return this},computeBoundingBox:function(){var e=new THREE.Vector3;return function(){if(this.boundingBox===null){this.boundingBox=new THREE.Box3}var t=this.attributes.position.array;if(t){var n=this.boundingBox;n.makeEmpty();for(var r=0,i=t.length;r<i;r+=3){e.set(t[r],t[r+1],t[r+2]);n.expandByPoint(e)}}if(t===undefined||t.length===0){this.boundingBox.min.set(0,0,0);this.boundingBox.max.set(0,0,0)}if(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z)){console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.')}}}(),computeBoundingSphere:function(){var e=new THREE.Box3;var t=new THREE.Vector3;return function(){if(this.boundingSphere===null){this.boundingSphere=new THREE.Sphere}var n=this.attributes.position.array;if(n){e.makeEmpty();var r=this.boundingSphere.center;for(var i=0,s=n.length;i<s;i+=3){t.set(n[i],n[i+1],n[i+2]);e.expandByPoint(t)}e.center(r);var o=0;for(var i=0,s=n.length;i<s;i+=3){t.set(n[i],n[i+1],n[i+2]);o=Math.max(o,r.distanceToSquared(t))}this.boundingSphere.radius=Math.sqrt(o);if(isNaN(this.boundingSphere.radius)){console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.')}}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.attributes;if(e.position){var t=e.position.array;if(e.normal===undefined){this.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(t.length),3))}else{var n=e.normal.array;for(var r=0,i=n.length;r<i;r++){n[r]=0}}var n=e.normal.array;var s,o,u,a=new THREE.Vector3,f=new THREE.Vector3,l=new THREE.Vector3,c=new THREE.Vector3,h=new THREE.Vector3;if(e.index){var p=e.index.array;var d=this.offsets.length>0?this.offsets:[{start:0,count:p.length,index:0}];for(var v=0,m=d.length;v<m;++v){var g=d[v].start;var y=d[v].count;var b=d[v].index;for(var r=g,i=g+y;r<i;r+=3){s=(b+p[r])*3;o=(b+p[r+1])*3;u=(b+p[r+2])*3;a.fromArray(t,s);f.fromArray(t,o);l.fromArray(t,u);c.subVectors(l,f);h.subVectors(a,f);c.cross(h);n[s]+=c.x;n[s+1]+=c.y;n[s+2]+=c.z;n[o]+=c.x;n[o+1]+=c.y;n[o+2]+=c.z;n[u]+=c.x;n[u+1]+=c.y;n[u+2]+=c.z}}}else{for(var r=0,i=t.length;r<i;r+=9){a.fromArray(t,r);f.fromArray(t,r+3);l.fromArray(t,r+6);c.subVectors(l,f);h.subVectors(a,f);c.cross(h);n[r]=c.x;n[r+1]=c.y;n[r+2]=c.z;n[r+3]=c.x;n[r+4]=c.y;n[r+5]=c.z;n[r+6]=c.x;n[r+7]=c.y;n[r+8]=c.z}}this.normalizeNormals();e.normal.needsUpdate=true}},computeTangents:function(){function L(e,n,i){f.fromArray(t,e*3);l.fromArray(t,n*3);c.fromArray(t,i*3);h.fromArray(r,e*2);p.fromArray(r,n*2);d.fromArray(r,i*2);v=l.x-f.x;m=c.x-f.x;g=l.y-f.y;y=c.y-f.y;b=l.z-f.z;w=c.z-f.z;E=p.x-h.x;S=d.x-h.x;x=p.y-h.y;T=d.y-h.y;N=1/(E*T-S*x);C.set((T*v-x*m)*N,(T*g-x*y)*N,(T*b-x*w)*N);k.set((E*m-S*v)*N,(E*y-S*g)*N,(E*w-S*b)*N);o[e].add(C);o[n].add(C);o[i].add(C);u[e].add(k);u[n].add(k);u[i].add(k)}function $(e){U.fromArray(n,e*3);z.copy(U);X=o[e];q.copy(X);q.sub(U.multiplyScalar(U.dot(X))).normalize();R.crossVectors(z,X);V=R.dot(u[e]);W=V<0?-1:1;s[e*4]=q.x;s[e*4+1]=q.y;s[e*4+2]=q.z;s[e*4+3]=W}if(this.attributes.index===undefined||this.attributes.position===undefined||this.attributes.normal===undefined||this.attributes.uv===undefined){console.warn("Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");return}var e=this.attributes.index.array;var t=this.attributes.position.array;var n=this.attributes.normal.array;var r=this.attributes.uv.array;var i=t.length/3;if(this.attributes.tangent===undefined){this.addAttribute("tangent",new THREE.BufferAttribute(new Float32Array(4*i),4))}var s=this.attributes.tangent.array;var o=[],u=[];for(var a=0;a<i;a++){o[a]=new THREE.Vector3;u[a]=new THREE.Vector3}var f=new THREE.Vector3,l=new THREE.Vector3,c=new THREE.Vector3,h=new THREE.Vector2,p=new THREE.Vector2,d=new THREE.Vector2,v,m,g,y,b,w,E,S,x,T,N;var C=new THREE.Vector3,k=new THREE.Vector3;var A,O;var M,_;var D,P,H;if(this.drawcalls.length===0){this.addDrawCall(0,e.length,0)}var B=this.drawcalls;for(M=0,_=B.length;M<_;++M){var j=B[M].start;var F=B[M].count;var I=B[M].index;for(A=j,O=j+F;A<O;A+=3){D=I+e[A];P=I+e[A+1];H=I+e[A+2];L(D,P,H)}}var q=new THREE.Vector3,R=new THREE.Vector3;var U=new THREE.Vector3,z=new THREE.Vector3;var W,X,V;for(M=0,_=B.length;M<_;++M){var j=B[M].start;var F=B[M].count;var I=B[M].index;for(A=j,O=j+F;A<O;A+=3){D=I+e[A];P=I+e[A+1];H=I+e[A+2];$(D);$(P);$(H)}}},computeOffsets:function(e){var t=e;if(e===undefined)t=65535;var n=Date.now();var r=this.attributes.index.array;var i=this.attributes.position.array;var s=i.length/3;var o=r.length/3;var u=new Uint16Array(r.length);var a=0;var f=0;var l=[{start:0,count:0,index:0}];var c=l[0];var h=0;var p=0;var d=new Int32Array(6);var v=new Int32Array(i.length);var m=new Int32Array(i.length);for(var g=0;g<i.length;g++){v[g]=-1;m[g]=-1}for(var y=0;y<o;y++){p=0;for(var b=0;b<3;b++){var w=r[y*3+b];if(v[w]==-1){d[b*2]=w;d[b*2+1]=-1;p++}else if(v[w]<c.index){d[b*2]=w;d[b*2+1]=-1;h++}else{d[b*2]=w;d[b*2+1]=v[w]}}var E=f+p;if(E>c.index+t){var S={start:a,count:0,index:f};l.push(S);c=S;for(var x=0;x<6;x+=2){var T=d[x+1];if(T>-1&&T<c.index)d[x+1]=-1}}for(var x=0;x<6;x+=2){var w=d[x];var T=d[x+1];if(T===-1)T=f++;v[w]=T;m[T]=w;u[a++]=T-c.index;c.count++}}this.reorderBuffers(u,m,f);this.offsets=l;return l},merge:function(){console.log("BufferGeometry.merge(): TODO")},normalizeNormals:function(){var e=this.attributes.normal.array;var t,n,r,i;for(var s=0,o=e.length;s<o;s+=3){t=e[s];n=e[s+1];r=e[s+2];i=1/Math.sqrt(t*t+n*n+r*r);e[s]*=i;e[s+1]*=i;e[s+2]*=i}},reorderBuffers:function(e,t,n){var r={};for(var i in this.attributes){if(i=="index")continue;var s=this.attributes[i].array;r[i]=new s.constructor(this.attributes[i].itemSize*n)}for(var o=0;o<n;o++){var u=t[o];for(var i in this.attributes){if(i=="index")continue;var a=this.attributes[i].array;var f=this.attributes[i].itemSize;var l=r[i];for(var c=0;c<f;c++)l[o*f+c]=a[u*f+c]}}this.attributes["index"].array=e;for(var i in this.attributes){if(i=="index")continue;this.attributes[i].array=r[i];this.attributes[i].numItems=this.attributes[i].itemSize*n}},toJSON:function(){var e={metadata:{version:4,type:"BufferGeometry",generator:"BufferGeometryExporter"},uuid:this.uuid,type:this.type,data:{attributes:{}}};var t=this.attributes;var n=this.offsets;var r=this.boundingSphere;for(var i in t){var s=t[i];var o=[],u=s.array;for(var a=0,f=u.length;a<f;a++){o[a]=u[a]}e.data.attributes[i]={itemSize:s.itemSize,type:s.array.constructor.name,array:o}}if(n.length>0){e.data.offsets=JSON.parse(JSON.stringify(n))}if(r!==null){e.data.boundingSphere={center:r.center.toArray(),radius:r.radius}}return e},clone:function(){var e=new THREE.BufferGeometry;for(var t in this.attributes){var n=this.attributes[t];e.addAttribute(t,n.clone())}for(var r=0,i=this.offsets.length;r<i;r++){var s=this.offsets[r];e.offsets.push({start:s.start,index:s.index,count:s.count})}return e},dispose:function(){this.dispatchEvent({type:"dispose"})}};THREE.EventDispatcher.prototype.apply(THREE.BufferGeometry.prototype);THREE.Geometry=function(){Object.defineProperty(this,"id",{value:THREE.GeometryIdCount++});this.uuid=THREE.Math.generateUUID();this.name="";this.type="Geometry";this.vertices=[];this.colors=[];this.faces=[];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphColors=[];this.morphNormals=[];this.skinWeights=[];this.skinIndices=[];this.lineDistances=[];this.boundingBox=null;this.boundingSphere=null;this.hasTangents=false;this.dynamic=true;this.verticesNeedUpdate=false;this.elementsNeedUpdate=false;this.uvsNeedUpdate=false;this.normalsNeedUpdate=false;this.tangentsNeedUpdate=false;this.colorsNeedUpdate=false;this.lineDistancesNeedUpdate=false;this.groupsNeedUpdate=false};THREE.Geometry.prototype={constructor:THREE.Geometry,applyMatrix:function(e){var t=(new THREE.Matrix3).getNormalMatrix(e);for(var n=0,r=this.vertices.length;n<r;n++){var i=this.vertices[n];i.applyMatrix4(e)}for(var n=0,r=this.faces.length;n<r;n++){var s=this.faces[n];s.normal.applyMatrix3(t).normalize();for(var o=0,u=s.vertexNormals.length;o<u;o++){s.vertexNormals[o].applyMatrix3(t).normalize()}}if(this.boundingBox instanceof THREE.Box3){this.computeBoundingBox()}if(this.boundingSphere instanceof THREE.Sphere){this.computeBoundingSphere()}},fromBufferGeometry:function(e){var t=this;var n=e.attributes;var r=n.position.array;var i=n.index!==undefined?n.index.array:undefined;var s=n.normal!==undefined?n.normal.array:undefined;var o=n.color!==undefined?n.color.array:undefined;var u=n.uv!==undefined?n.uv.array:undefined;var a=[];var f=[];for(var l=0,c=0;l<r.length;l+=3,c+=2){t.vertices.push(new THREE.Vector3(r[l],r[l+1],r[l+2]));if(s!==undefined){a.push(new THREE.Vector3(s[l],s[l+1],s[l+2]))}if(o!==undefined){t.colors.push(new THREE.Color(o[l],o[l+1],o[l+2]))}if(u!==undefined){f.push(new THREE.Vector2(u[c],u[c+1]))}}var h=function(e,n,r){var i=s!==undefined?[a[e].clone(),a[n].clone(),a[r].clone()]:[];var u=o!==undefined?[t.colors[e].clone(),t.colors[n].clone(),t.colors[r].clone()]:[];t.faces.push(new THREE.Face3(e,n,r,i,u));t.faceVertexUvs[0].push([f[e],f[n],f[r]])};if(i!==undefined){for(var l=0;l<i.length;l+=3){h(i[l],i[l+1],i[l+2])}}else{for(var l=0;l<r.length/3;l+=3){h(l,l+1,l+2)}}this.computeFaceNormals();if(e.boundingBox!==null){this.boundingBox=e.boundingBox.clone()}if(e.boundingSphere!==null){this.boundingSphere=e.boundingSphere.clone()}return this},center:function(){this.computeBoundingBox();var e=new THREE.Vector3;e.addVectors(this.boundingBox.min,this.boundingBox.max);e.multiplyScalar(-.5);this.applyMatrix((new THREE.Matrix4).makeTranslation(e.x,e.y,e.z));this.computeBoundingBox();return e},computeFaceNormals:function(){var e=new THREE.Vector3,t=new THREE.Vector3;for(var n=0,r=this.faces.length;n<r;n++){var i=this.faces[n];var s=this.vertices[i.a];var o=this.vertices[i.b];var u=this.vertices[i.c];e.subVectors(u,o);t.subVectors(s,o);e.cross(t);e.normalize();i.normal.copy(e)}},computeVertexNormals:function(e){var t,n,r,i,s,o;o=new Array(this.vertices.length);for(t=0,n=this.vertices.length;t<n;t++){o[t]=new THREE.Vector3}if(e){var u,a,f,l;var c=new THREE.Vector3,h=new THREE.Vector3,p=new THREE.Vector3,d=new THREE.Vector3,v=new THREE.Vector3;for(r=0,i=this.faces.length;r<i;r++){s=this.faces[r];u=this.vertices[s.a];a=this.vertices[s.b];f=this.vertices[s.c];c.subVectors(f,a);h.subVectors(u,a);c.cross(h);o[s.a].add(c);o[s.b].add(c);o[s.c].add(c)}}else{for(r=0,i=this.faces.length;r<i;r++){s=this.faces[r];o[s.a].add(s.normal);o[s.b].add(s.normal);o[s.c].add(s.normal)}}for(t=0,n=this.vertices.length;t<n;t++){o[t].normalize()}for(r=0,i=this.faces.length;r<i;r++){s=this.faces[r];s.vertexNormals[0]=o[s.a].clone();s.vertexNormals[1]=o[s.b].clone();s.vertexNormals[2]=o[s.c].clone()}},computeMorphNormals:function(){var e,t,n,r,i;for(n=0,r=this.faces.length;n<r;n++){i=this.faces[n];if(!i.__originalFaceNormal){i.__originalFaceNormal=i.normal.clone()}else{i.__originalFaceNormal.copy(i.normal)}if(!i.__originalVertexNormals)i.__originalVertexNormals=[];for(e=0,t=i.vertexNormals.length;e<t;e++){if(!i.__originalVertexNormals[e]){i.__originalVertexNormals[e]=i.vertexNormals[e].clone()}else{i.__originalVertexNormals[e].copy(i.vertexNormals[e])}}}var s=new THREE.Geometry;s.faces=this.faces;for(e=0,t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={};this.morphNormals[e].faceNormals=[];this.morphNormals[e].vertexNormals=[];var o=this.morphNormals[e].faceNormals;var u=this.morphNormals[e].vertexNormals;var a,f;for(n=0,r=this.faces.length;n<r;n++){a=new THREE.Vector3;f={a:new THREE.Vector3,b:new THREE.Vector3,c:new THREE.Vector3};o.push(a);u.push(f)}}var l=this.morphNormals[e];s.vertices=this.morphTargets[e].vertices;s.computeFaceNormals();s.computeVertexNormals();var a,f;for(n=0,r=this.faces.length;n<r;n++){i=this.faces[n];a=l.faceNormals[n];f=l.vertexNormals[n];a.copy(i.normal);f.a.copy(i.vertexNormals[0]);f.b.copy(i.vertexNormals[1]);f.c.copy(i.vertexNormals[2])}}for(n=0,r=this.faces.length;n<r;n++){i=this.faces[n];i.normal=i.__originalFaceNormal;i.vertexNormals=i.__originalVertexNormals}},computeTangents:function(){function B(e,t,n,r,i,s,o){f=e.vertices[t];l=e.vertices[n];c=e.vertices[r];h=a[i];p=a[s];d=a[o];v=l.x-f.x;m=c.x-f.x;g=l.y-f.y;y=c.y-f.y;b=l.z-f.z;w=c.z-f.z;E=p.x-h.x;S=d.x-h.x;x=p.y-h.y;T=d.y-h.y;N=1/(E*T-S*x);O.set((T*v-x*m)*N,(T*g-x*y)*N,(T*b-x*w)*N);M.set((E*m-S*v)*N,(E*y-S*g)*N,(E*w-S*b)*N);L[t].add(O);L[n].add(O);L[r].add(O);A[t].add(M);A[n].add(M);A[r].add(M)}var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L=[],A=[],O=new THREE.Vector3,M=new THREE.Vector3,_=new THREE.Vector3,D=new THREE.Vector3,P=new THREE.Vector3,H;for(n=0,r=this.vertices.length;n<r;n++){L[n]=new THREE.Vector3;A[n]=new THREE.Vector3}for(e=0,t=this.faces.length;e<t;e++){u=this.faces[e];a=this.faceVertexUvs[0][e];B(this,u.a,u.b,u.c,0,1,2)}var j=["a","b","c","d"];for(e=0,t=this.faces.length;e<t;e++){u=this.faces[e];for(i=0;i<Math.min(u.vertexNormals.length,3);i++){P.copy(u.vertexNormals[i]);o=u[j[i]];C=L[o];_.copy(C);_.sub(P.multiplyScalar(P.dot(C))).normalize();D.crossVectors(u.vertexNormals[i],C);k=D.dot(A[o]);H=k<0?-1:1;u.vertexTangents[i]=new THREE.Vector4(_.x,_.y,_.z,H)}}this.hasTangents=true},computeLineDistances:function(){var e=0;var t=this.vertices;for(var n=0,r=t.length;n<r;n++){if(n>0){e+=t[n].distanceTo(t[n-1])}this.lineDistances[n]=e}},computeBoundingBox:function(){if(this.boundingBox===null){this.boundingBox=new THREE.Box3}this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){if(this.boundingSphere===null){this.boundingSphere=new THREE.Sphere}this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,n){if(e instanceof THREE.Geometry===false){console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e);return}var r,i=this.vertices.length,s=this.vertices,o=e.vertices,u=this.faces,a=e.faces,f=this.faceVertexUvs[0],l=e.faceVertexUvs[0];if(n===undefined)n=0;if(t!==undefined){r=(new THREE.Matrix3).getNormalMatrix(t)}for(var c=0,h=o.length;c<h;c++){var p=o[c];var d=p.clone();if(t!==undefined)d.applyMatrix4(t);s.push(d)}for(c=0,h=a.length;c<h;c++){var v=a[c],m,g,y,b=v.vertexNormals,w=v.vertexColors;m=new THREE.Face3(v.a+i,v.b+i,v.c+i);m.normal.copy(v.normal);if(r!==undefined){m.normal.applyMatrix3(r).normalize()}for(var E=0,S=b.length;E<S;E++){g=b[E].clone();if(r!==undefined){g.applyMatrix3(r).normalize()}m.vertexNormals.push(g)}m.color.copy(v.color);for(var E=0,S=w.length;E<S;E++){y=w[E];m.vertexColors.push(y.clone())}m.materialIndex=v.materialIndex+n;u.push(m)}for(c=0,h=l.length;c<h;c++){var x=l[c],T=[];if(x===undefined){continue}for(var E=0,S=x.length;E<S;E++){T.push(new THREE.Vector2(x[E].x,x[E].y))}f.push(T)}},mergeVertices:function(){var e={};var t=[],n=[];var r,i;var s=4;var o=Math.pow(10,s);var u,a,f;var l,c,h,p,d;for(u=0,a=this.vertices.length;u<a;u++){r=this.vertices[u];i=Math.round(r.x*o)+"_"+Math.round(r.y*o)+"_"+Math.round(r.z*o);if(e[i]===undefined){e[i]=u;t.push(this.vertices[u]);n[u]=t.length-1}else{n[u]=n[e[i]]}}var v=[];for(u=0,a=this.faces.length;u<a;u++){f=this.faces[u];f.a=n[f.a];f.b=n[f.b];f.c=n[f.c];l=[f.a,f.b,f.c];var m=-1;for(var g=0;g<3;g++){if(l[g]==l[(g+1)%3]){m=g;v.push(u);break}}}for(u=v.length-1;u>=0;u--){var y=v[u];this.faces.splice(y,1);for(h=0,p=this.faceVertexUvs.length;h<p;h++){this.faceVertexUvs[h].splice(y,1)}}var b=this.vertices.length-t.length;this.vertices=t;return b},toJSON:function(){function N(e,t,n){return n?e|1<<t:e&~(1<<t)}function C(e){var t=e.x.toString()+e.y.toString()+e.z.toString();if(a[t]!==undefined){return a[t]}a[t]=u.length/3;u.push(e.x,e.y,e.z);return a[t]}function k(e){var t=e.r.toString()+e.g.toString()+e.b.toString();if(l[t]!==undefined){return l[t]}l[t]=f.length;f.push(e.getHex());return l[t]}function L(e){var t=e.x.toString()+e.y.toString();if(h[t]!==undefined){return h[t]}h[t]=c.length/2;c.push(e.x,e.y);return h[t]}var e={metadata:{version:4,type:"BufferGeometry",generator:"BufferGeometryExporter"},uuid:this.uuid,type:this.type};if(this.name!=="")e.name=this.name;if(this.parameters!==undefined){var t=this.parameters;for(var n in t){if(t[n]!==undefined)e[n]=t[n]}return e}var r=[];for(var i=0;i<this.vertices.length;i++){var s=this.vertices[i];r.push(s.x,s.y,s.z)}var o=[];var u=[];var a={};var f=[];var l={};var c=[];var h={};for(var i=0;i<this.faces.length;i++){var p=this.faces[i];var d=false;var v=false;var m=this.faceVertexUvs[0][i]!==undefined;var g=p.normal.length()>0;var y=p.vertexNormals.length>0;var b=p.color.r!==1||p.color.g!==1||p.color.b!==1;var w=p.vertexColors.length>0;var E=0;E=N(E,0,0);E=N(E,1,d);E=N(E,2,v);E=N(E,3,m);E=N(E,4,g);E=N(E,5,y);E=N(E,6,b);E=N(E,7,w);o.push(E);o.push(p.a,p.b,p.c);if(m){var S=this.faceVertexUvs[0][i];o.push(L(S[0]),L(S[1]),L(S[2]))}if(g){o.push(C(p.normal))}if(y){var x=p.vertexNormals;o.push(C(x[0]),C(x[1]),C(x[2]))}if(b){o.push(k(p.color))}if(w){var T=p.vertexColors;o.push(k(T[0]),k(T[1]),k(T[2]))}}e.data={};e.data.vertices=r;e.data.normals=u;if(f.length>0)e.data.colors=f;if(c.length>0)e.data.uvs=[c];e.data.faces=o;return e},clone:function(){var e=new THREE.Geometry;var t=this.vertices;for(var n=0,r=t.length;n<r;n++){e.vertices.push(t[n].clone())}var i=this.faces;for(var n=0,r=i.length;n<r;n++){e.faces.push(i[n].clone())}var s=this.faceVertexUvs[0];for(var n=0,r=s.length;n<r;n++){var o=s[n],u=[];for(var a=0,f=o.length;a<f;a++){u.push(new THREE.Vector2(o[a].x,o[a].y))}e.faceVertexUvs[0].push(u)}return e},dispose:function(){this.dispatchEvent({type:"dispose"})}};THREE.EventDispatcher.prototype.apply(THREE.Geometry.prototype);THREE.GeometryIdCount=0;THREE.Camera=function(){THREE.Object3D.call(this);this.type="Camera";this.matrixWorldInverse=new THREE.Matrix4;this.projectionMatrix=new THREE.Matrix4};THREE.Camera.prototype=Object.create(THREE.Object3D.prototype);THREE.Camera.prototype.getWorldDirection=function(){var e=new THREE.Quaternion;return function(t){var n=t||new THREE.Vector3;this.getWorldQuaternion(e);return n.set(0,0,-1).applyQuaternion(e)}}();THREE.Camera.prototype.lookAt=function(){var e=new THREE.Matrix4;return function(t){e.lookAt(this.position,t,this.up);this.quaternion.setFromRotationMatrix(e)}}();THREE.Camera.prototype.clone=function(e){if(e===undefined)e=new THREE.Camera;THREE.Object3D.prototype.clone.call(this,e);e.matrixWorldInverse.copy(this.matrixWorldInverse);e.projectionMatrix.copy(this.projectionMatrix);return e};THREE.CubeCamera=function(e,t,n){THREE.Object3D.call(this);this.type="CubeCamera";var r=90,i=1;var s=new THREE.PerspectiveCamera(r,i,e,t);s.up.set(0,-1,0);s.lookAt(new THREE.Vector3(1,0,0));this.add(s);var o=new THREE.PerspectiveCamera(r,i,e,t);o.up.set(0,-1,0);o.lookAt(new THREE.Vector3(-1,0,0));this.add(o);var u=new THREE.PerspectiveCamera(r,i,e,t);u.up.set(0,0,1);u.lookAt(new THREE.Vector3(0,1,0));this.add(u);var a=new THREE.PerspectiveCamera(r,i,e,t);a.up.set(0,0,-1);a.lookAt(new THREE.Vector3(0,-1,0));this.add(a);var f=new THREE.PerspectiveCamera(r,i,e,t);f.up.set(0,-1,0);f.lookAt(new THREE.Vector3(0,0,1));this.add(f);var l=new THREE.PerspectiveCamera(r,i,e,t);l.up.set(0,-1,0);l.lookAt(new THREE.Vector3(0,0,-1));this.add(l);this.renderTarget=new THREE.WebGLRenderTargetCube(n,n,{format:THREE.RGBFormat,magFilter:THREE.LinearFilter,minFilter:THREE.LinearFilter});this.updateCubeMap=function(e,t){var n=this.renderTarget;var r=n.generateMipmaps;n.generateMipmaps=false;n.activeCubeFace=0;e.render(t,s,n);n.activeCubeFace=1;e.render(t,o,n);n.activeCubeFace=2;e.render(t,u,n);n.activeCubeFace=3;e.render(t,a,n);n.activeCubeFace=4;e.render(t,f,n);n.generateMipmaps=r;n.activeCubeFace=5;e.render(t,l,n)}};THREE.CubeCamera.prototype=Object.create(THREE.Object3D.prototype);THREE.OrthographicCamera=function(e,t,n,r,i,s){THREE.Camera.call(this);this.type="OrthographicCamera";this.zoom=1;this.left=e;this.right=t;this.top=n;this.bottom=r;this.near=i!==undefined?i:.1;this.far=s!==undefined?s:2e3;this.updateProjectionMatrix()};THREE.OrthographicCamera.prototype=Object.create(THREE.Camera.prototype);THREE.OrthographicCamera.prototype.updateProjectionMatrix=function(){var e=(this.right-this.left)/(2*this.zoom);var t=(this.top-this.bottom)/(2*this.zoom);var n=(this.right+this.left)/2;var r=(this.top+this.bottom)/2;this.projectionMatrix.makeOrthographic(n-e,n+e,r+t,r-t,this.near,this.far)};THREE.OrthographicCamera.prototype.clone=function(){var e=new THREE.OrthographicCamera;THREE.Camera.prototype.clone.call(this,e);e.zoom=this.zoom;e.left=this.left;e.right=this.right;e.top=this.top;e.bottom=this.bottom;e.near=this.near;e.far=this.far;e.projectionMatrix.copy(this.projectionMatrix);return e};THREE.PerspectiveCamera=function(e,t,n,r){THREE.Camera.call(this);this.type="PerspectiveCamera";this.zoom=1;this.fov=e!==undefined?e:50;this.aspect=t!==undefined?t:1;this.near=n!==undefined?n:.1;this.far=r!==undefined?r:2e3;this.updateProjectionMatrix()};THREE.PerspectiveCamera.prototype=Object.create(THREE.Camera.prototype);THREE.PerspectiveCamera.prototype.setLens=function(e,t){if(t===undefined)t=24;this.fov=2*THREE.Math.radToDeg(Math.atan(t/(e*2)));this.updateProjectionMatrix()};THREE.PerspectiveCamera.prototype.setViewOffset=function(e,t,n,r,i,s){this.fullWidth=e;this.fullHeight=t;this.x=n;this.y=r;this.width=i;this.height=s;this.updateProjectionMatrix()};THREE.PerspectiveCamera.prototype.updateProjectionMatrix=function(){var e=THREE.Math.radToDeg(2*Math.atan(Math.tan(THREE.Math.degToRad(this.fov)*.5)/this.zoom));if(this.fullWidth){var t=this.fullWidth/this.fullHeight;var n=Math.tan(THREE.Math.degToRad(e*.5))*this.near;var r=-n;var i=t*r;var s=t*n;var o=Math.abs(s-i);var u=Math.abs(n-r);this.projectionMatrix.makeFrustum(i+this.x*o/this.fullWidth,i+(this.x+this.width)*o/this.fullWidth,n-(this.y+this.height)*u/this.fullHeight,n-this.y*u/this.fullHeight,this.near,this.far)}else{this.projectionMatrix.makePerspective(e,this.aspect,this.near,this.far)}};THREE.PerspectiveCamera.prototype.clone=function(){var e=new THREE.PerspectiveCamera;THREE.Camera.prototype.clone.call(this,e);e.zoom=this.zoom;e.fov=this.fov;e.aspect=this.aspect;e.near=this.near;e.far=this.far;e.projectionMatrix.copy(this.projectionMatrix);return e};THREE.Light=function(e){THREE.Object3D.call(this);this.type="Light";this.color=new THREE.Color(e)};THREE.Light.prototype=Object.create(THREE.Object3D.prototype);THREE.Light.prototype.clone=function(e){if(e===undefined)e=new THREE.Light;THREE.Object3D.prototype.clone.call(this,e);e.color.copy(this.color);return e};THREE.AmbientLight=function(e){THREE.Light.call(this,e);this.type="AmbientLight"};THREE.AmbientLight.prototype=Object.create(THREE.Light.prototype);THREE.AmbientLight.prototype.clone=function(){var e=new THREE.AmbientLight;THREE.Light.prototype.clone.call(this,e);return e};THREE.AreaLight=function(e,t){THREE.Light.call(this,e);this.type="AreaLight";this.normal=new THREE.Vector3(0,-1,0);this.right=new THREE.Vector3(1,0,0);this.intensity=t!==undefined?t:1;this.width=1;this.height=1;this.constantAttenuation=1.5;this.linearAttenuation=.5;this.quadraticAttenuation=.1};THREE.AreaLight.prototype=Object.create(THREE.Light.prototype);THREE.DirectionalLight=function(e,t){THREE.Light.call(this,e);this.type="DirectionalLight";this.position.set(0,1,0);this.target=new THREE.Object3D;this.intensity=t!==undefined?t:1;this.castShadow=false;this.onlyShadow=false;this.shadowCameraNear=50;this.shadowCameraFar=5e3;this.shadowCameraLeft=-500;this.shadowCameraRight=500;this.shadowCameraTop=500;this.shadowCameraBottom=-500;this.shadowCameraVisible=false;this.shadowBias=0;this.shadowDarkness=.5;this.shadowMapWidth=512;this.shadowMapHeight=512;this.shadowCascade=false;this.shadowCascadeOffset=new THREE.Vector3(0,0,-1e3);this.shadowCascadeCount=2;this.shadowCascadeBias=[0,0,0];this.shadowCascadeWidth=[512,512,512];this.shadowCascadeHeight=[512,512,512];this.shadowCascadeNearZ=[-1,.99,.998];this.shadowCascadeFarZ=[.99,.998,1];this.shadowCascadeArray=[];this.shadowMap=null;this.shadowMapSize=null;this.shadowCamera=null;this.shadowMatrix=null};THREE.DirectionalLight.prototype=Object.create(THREE.Light.prototype);THREE.DirectionalLight.prototype.clone=function(){var e=new THREE.DirectionalLight;THREE.Light.prototype.clone.call(this,e);e.target=this.target.clone();e.intensity=this.intensity;e.castShadow=this.castShadow;e.onlyShadow=this.onlyShadow;e.shadowCameraNear=this.shadowCameraNear;e.shadowCameraFar=this.shadowCameraFar;e.shadowCameraLeft=this.shadowCameraLeft;e.shadowCameraRight=this.shadowCameraRight;e.shadowCameraTop=this.shadowCameraTop;e.shadowCameraBottom=this.shadowCameraBottom;e.shadowCameraVisible=this.shadowCameraVisible;e.shadowBias=this.shadowBias;e.shadowDarkness=this.shadowDarkness;e.shadowMapWidth=this.shadowMapWidth;e.shadowMapHeight=this.shadowMapHeight;e.shadowCascade=this.shadowCascade;e.shadowCascadeOffset.copy(this.shadowCascadeOffset);e.shadowCascadeCount=this.shadowCascadeCount;e.shadowCascadeBias=this.shadowCascadeBias.slice(0);e.shadowCascadeWidth=this.shadowCascadeWidth.slice(0);e.shadowCascadeHeight=this.shadowCascadeHeight.slice(0);e.shadowCascadeNearZ=this.shadowCascadeNearZ.slice(0);e.shadowCascadeFarZ=this.shadowCascadeFarZ.slice(0);return e};THREE.HemisphereLight=function(e,t,n){THREE.Light.call(this,e);this.type="HemisphereLight";this.position.set(0,100,0);this.groundColor=new THREE.Color(t);this.intensity=n!==undefined?n:1};THREE.HemisphereLight.prototype=Object.create(THREE.Light.prototype);THREE.HemisphereLight.prototype.clone=function(){var e=new THREE.HemisphereLight;THREE.Light.prototype.clone.call(this,e);e.groundColor.copy(this.groundColor);e.intensity=this.intensity;return e};THREE.PointLight=function(e,t,n){THREE.Light.call(this,e);this.type="PointLight";this.intensity=t!==undefined?t:1;this.distance=n!==undefined?n:0};THREE.PointLight.prototype=Object.create(THREE.Light.prototype);THREE.PointLight.prototype.clone=function(){var e=new THREE.PointLight;THREE.Light.prototype.clone.call(this,e);e.intensity=this.intensity;e.distance=this.distance;return e};THREE.SpotLight=function(e,t,n,r,i){THREE.Light.call(this,e);this.type="SpotLight";this.position.set(0,1,0);this.target=new THREE.Object3D;this.intensity=t!==undefined?t:1;this.distance=n!==undefined?n:0;this.angle=r!==undefined?r:Math.PI/3;this.exponent=i!==undefined?i:10;this.castShadow=false;this.onlyShadow=false;this.shadowCameraNear=50;this.shadowCameraFar=5e3;this.shadowCameraFov=50;this.shadowCameraVisible=false;this.shadowBias=0;this.shadowDarkness=.5;this.shadowMapWidth=512;this.shadowMapHeight=512;this.shadowMap=null;this.shadowMapSize=null;this.shadowCamera=null;this.shadowMatrix=null};THREE.SpotLight.prototype=Object.create(THREE.Light.prototype);THREE.SpotLight.prototype.clone=function(){var e=new THREE.SpotLight;THREE.Light.prototype.clone.call(this,e);e.target=this.target.clone();e.intensity=this.intensity;e.distance=this.distance;e.angle=this.angle;e.exponent=this.exponent;e.castShadow=this.castShadow;e.onlyShadow=this.onlyShadow;e.shadowCameraNear=this.shadowCameraNear;e.shadowCameraFar=this.shadowCameraFar;e.shadowCameraFov=this.shadowCameraFov;e.shadowCameraVisible=this.shadowCameraVisible;e.shadowBias=this.shadowBias;e.shadowDarkness=this.shadowDarkness;e.shadowMapWidth=this.shadowMapWidth;e.shadowMapHeight=this.shadowMapHeight;return e};THREE.Cache=function(){this.files={}};THREE.Cache.prototype={constructor:THREE.Cache,add:function(e,t){this.files[e]=t},get:function(e){return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};THREE.Loader=function(e){this.showStatus=e;this.statusDomElement=e?THREE.Loader.prototype.addStatusElement():null;this.imageLoader=new THREE.ImageLoader;this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){}};THREE.Loader.prototype={constructor:THREE.Loader,crossOrigin:undefined,addStatusElement:function(){var e=document.createElement("div");e.style.position="absolute";e.style.right="0px";e.style.top="0px";e.style.fontSize="0.8em";e.style.textAlign="left";e.style.background="rgba(0,0,0,0.25)";e.style.color="#fff";e.style.width="120px";e.style.padding="0.5em 0.5em 0.5em 0.5em";e.style.zIndex=1e3;e.innerHTML="Loading ...";return e},updateProgress:function(e){var t="Loaded ";if(e.total){t+=(100*e.loaded/e.total).toFixed(0)+"%"}else{t+=(e.loaded/1024).toFixed(2)+" KB"}this.statusDomElement.innerHTML=t},extractUrlBase:function(e){var t=e.split("/");if(t.length===1)return"./";t.pop();return t.join("/")+"/"},initMaterials:function(e,t){var n=[];for(var r=0;r<e.length;++r){n[r]=this.createMaterial(e[r],t)}return n},needsTangents:function(e){for(var t=0,n=e.length;t<n;t++){var r=e[t];if(r instanceof THREE.ShaderMaterial)return true}return false},createMaterial:function(e,t){function r(e){var t=Math.log(e)/Math.LN2;return Math.pow(2,Math.round(t))}function i(e,i,s,o,u,a,f){var l=t+s;var c;var h=THREE.Loader.Handlers.get(l);if(h!==null){c=h.load(l)}else{c=new THREE.Texture;h=n.imageLoader;h.crossOrigin=n.crossOrigin;h.load(l,function(e){if(THREE.Math.isPowerOfTwo(e.width)===false||THREE.Math.isPowerOfTwo(e.height)===false){var t=r(e.width);var n=r(e.height);var i=document.createElement("canvas");i.width=t;i.height=n;var s=i.getContext("2d");s.drawImage(e,0,0,t,n);c.image=i}else{c.image=e}c.needsUpdate=true})}c.sourceFile=s;if(o){c.repeat.set(o[0],o[1]);if(o[0]!==1)c.wrapS=THREE.RepeatWrapping;if(o[1]!==1)c.wrapT=THREE.RepeatWrapping}if(u){c.offset.set(u[0],u[1])}if(a){var p={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping};if(p[a[0]]!==undefined)c.wrapS=p[a[0]];if(p[a[1]]!==undefined)c.wrapT=p[a[1]]}if(f){c.anisotropy=f}e[i]=c}function s(e){return(e[0]*255<<16)+(e[1]*255<<8)+e[2]*255}var n=this;var o="MeshLambertMaterial";var u={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,bumpMap:null,wireframe:false};if(e.shading){var a=e.shading.toLowerCase();if(a==="phong")o="MeshPhongMaterial";else if(a==="basic")o="MeshBasicMaterial"}if(e.blending!==undefined&&THREE[e.blending]!==undefined){u.blending=THREE[e.blending]}if(e.transparent!==undefined||e.opacity<1){u.transparent=e.transparent}if(e.depthTest!==undefined){u.depthTest=e.depthTest}if(e.depthWrite!==undefined){u.depthWrite=e.depthWrite}if(e.visible!==undefined){u.visible=e.visible}if(e.flipSided!==undefined){u.side=THREE.BackSide}if(e.doubleSided!==undefined){u.side=THREE.DoubleSide}if(e.wireframe!==undefined){u.wireframe=e.wireframe}if(e.vertexColors!==undefined){if(e.vertexColors==="face"){u.vertexColors=THREE.FaceColors}else if(e.vertexColors){u.vertexColors=THREE.VertexColors}}if(e.colorDiffuse){u.color=s(e.colorDiffuse)}else if(e.DbgColor){u.color=e.DbgColor}if(e.colorSpecular){u.specular=s(e.colorSpecular)}if(e.colorAmbient){u.ambient=s(e.colorAmbient)}if(e.colorEmissive){u.emissive=s(e.colorEmissive)}if(e.transparency){u.opacity=e.transparency}if(e.specularCoef){u.shininess=e.specularCoef}if(e.mapDiffuse&&t){i(u,"map",e.mapDiffuse,e.mapDiffuseRepeat,e.mapDiffuseOffset,e.mapDiffuseWrap,e.mapDiffuseAnisotropy)}if(e.mapLight&&t){i(u,"lightMap",e.mapLight,e.mapLightRepeat,e.mapLightOffset,e.mapLightWrap,e.mapLightAnisotropy)}if(e.mapBump&&t){i(u,"bumpMap",e.mapBump,e.mapBumpRepeat,e.mapBumpOffset,e.mapBumpWrap,e.mapBumpAnisotropy)}if(e.mapNormal&&t){i(u,"normalMap",e.mapNormal,e.mapNormalRepeat,e.mapNormalOffset,e.mapNormalWrap,e.mapNormalAnisotropy)}if(e.mapSpecular&&t){i(u,"specularMap",e.mapSpecular,e.mapSpecularRepeat,e.mapSpecularOffset,e.mapSpecularWrap,e.mapSpecularAnisotropy)}if(e.mapAlpha&&t){i(u,"alphaMap",e.mapAlpha,e.mapAlphaRepeat,e.mapAlphaOffset,e.mapAlphaWrap,e.mapAlphaAnisotropy)}if(e.mapBumpScale){u.bumpScale=e.mapBumpScale}if(e.mapNormal){var f=THREE.ShaderLib["normalmap"];var l=THREE.UniformsUtils.clone(f.uniforms);l["tNormal"].value=u.normalMap;if(e.mapNormalFactor){l["uNormalScale"].value.set(e.mapNormalFactor,e.mapNormalFactor)}if(u.map){l["tDiffuse"].value=u.map;l["enableDiffuse"].value=true}if(u.specularMap){l["tSpecular"].value=u.specularMap;l["enableSpecular"].value=true}if(u.lightMap){l["tAO"].value=u.lightMap;l["enableAO"].value=true}l["diffuse"].value.setHex(u.color);l["specular"].value.setHex(u.specular);l["ambient"].value.setHex(u.ambient);l["shininess"].value=u.shininess;if(u.opacity!==undefined){l["opacity"].value=u.opacity}var c={fragmentShader:f.fragmentShader,vertexShader:f.vertexShader,uniforms:l,lights:true,fog:true};var h=new THREE.ShaderMaterial(c);if(u.transparent){h.transparent=true}}else{var h=new THREE[o](u)}if(e.DbgName!==undefined)h.name=e.DbgName;return h}};THREE.Loader.Handlers={handlers:[],add:function(e,t){this.handlers.push(e,t)},get:function(e){for(var t=0,n=this.handlers.length;t<n;t+=2){var r=this.handlers[t];var i=this.handlers[t+1];if(r.test(e)){return i}}return null}};THREE.XHRLoader=function(e){this.cache=new THREE.Cache;this.manager=e!==undefined?e:THREE.DefaultLoadingManager};THREE.XHRLoader.prototype={constructor:THREE.XHRLoader,load:function(e,t,n,r){var i=this;var s=i.cache.get(e);if(s!==undefined){if(t)t(s);return}var o=new XMLHttpRequest;o.open("GET",e,true);o.addEventListener("load",function(n){i.cache.add(e,this.response);if(t)t(this.response);i.manager.itemEnd(e)},false);if(n!==undefined){o.addEventListener("progress",function(e){n(e)},false)}if(r!==undefined){o.addEventListener("error",function(e){r(e)},false)}if(this.crossOrigin!==undefined)o.crossOrigin=this.crossOrigin;if(this.responseType!==undefined)o.responseType=this.responseType;o.send(null);i.manager.itemStart(e)},setResponseType:function(e){this.responseType=e},setCrossOrigin:function(e){this.crossOrigin=e}};THREE.ImageLoader=function(e){this.cache=new THREE.Cache;this.manager=e!==undefined?e:THREE.DefaultLoadingManager};THREE.ImageLoader.prototype={constructor:THREE.ImageLoader,load:function(e,t,n,r){var i=this;var s=i.cache.get(e);if(s!==undefined){t(s);return}var o=document.createElement("img");if(t!==undefined){o.addEventListener("load",function(n){i.cache.add(e,this);t(this);i.manager.itemEnd(e)},false)}if(n!==undefined){o.addEventListener("progress",function(e){n(e)},false)}if(r!==undefined){o.addEventListener("error",function(e){r(e)},false)}if(this.crossOrigin!==undefined)o.crossOrigin=this.crossOrigin;o.src=e;i.manager.itemStart(e);return o},setCrossOrigin:function(e){this.crossOrigin=e}};THREE.JSONLoader=function(e){THREE.Loader.call(this,e);this.withCredentials=false};THREE.JSONLoader.prototype=Object.create(THREE.Loader.prototype);THREE.JSONLoader.prototype.load=function(e,t,n){var r=this;n=n&&typeof n==="string"?n:this.extractUrlBase(e);this.onLoadStart();this.loadAjaxJSON(this,e,t,n)};THREE.JSONLoader.prototype.loadAjaxJSON=function(e,t,n,r,i){var s=new XMLHttpRequest;var o=0;s.onreadystatechange=function(){if(s.readyState===s.DONE){if(s.status===200||s.status===0){if(s.responseText){var u=JSON.parse(s.responseText);if(u.metadata!==undefined&&u.metadata.type==="scene"){console.error('THREE.JSONLoader: "'+t+'" seems to be a Scene. Use THREE.SceneLoader instead.');return}var a=e.parse(u,r);n(a.geometry,a.materials)}else{console.error('THREE.JSONLoader: "'+t+'" seems to be unreachable or the file is empty.')}e.onLoadComplete()}else{console.error("THREE.JSONLoader: Couldn't load \""+t+'" ('+s.status+")")}}else if(s.readyState===s.LOADING){if(i){if(o===0){o=s.getResponseHeader("Content-Length")}i({total:o,loaded:s.responseText.length})}}else if(s.readyState===s.HEADERS_RECEIVED){if(i!==undefined){o=s.getResponseHeader("Content-Length")}}};s.open("GET",t,true);s.withCredentials=this.withCredentials;s.send(null)};THREE.JSONLoader.prototype.parse=function(e,t){function s(t){function n(e,t){return e&1<<t}var i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_=e.faces,D=e.vertices,P=e.normals,H=e.colors,B=0;if(e.uvs!==undefined){for(i=0;i<e.uvs.length;i++){if(e.uvs[i].length)B++}for(i=0;i<B;i++){r.faceVertexUvs[i]=[]}}u=0;a=D.length;while(u<a){E=new THREE.Vector3;E.x=D[u++]*t;E.y=D[u++]*t;E.z=D[u++]*t;r.vertices.push(E)}u=0;a=_.length;while(u<a){p=_[u++];d=n(p,0);v=n(p,1);m=n(p,3);g=n(p,4);y=n(p,5);b=n(p,6);w=n(p,7);if(d){x=new THREE.Face3;x.a=_[u];x.b=_[u+1];x.c=_[u+3];T=new THREE.Face3;T.a=_[u+1];T.b=_[u+2];T.c=_[u+3];u+=4;if(v){h=_[u++];x.materialIndex=h;T.materialIndex=h}o=r.faces.length;if(m){for(i=0;i<B;i++){L=e.uvs[i];r.faceVertexUvs[i][o]=[];r.faceVertexUvs[i][o+1]=[];for(s=0;s<4;s++){c=_[u++];O=L[c*2];M=L[c*2+1];A=new THREE.Vector2(O,M);if(s!==2)r.faceVertexUvs[i][o].push(A);if(s!==0)r.faceVertexUvs[i][o+1].push(A)}}}if(g){l=_[u++]*3;x.normal.set(P[l++],P[l++],P[l]);T.normal.copy(x.normal)}if(y){for(i=0;i<4;i++){l=_[u++]*3;k=new THREE.Vector3(P[l++],P[l++],P[l]);if(i!==2)x.vertexNormals.push(k);if(i!==0)T.vertexNormals.push(k)}}if(b){f=_[u++];C=H[f];x.color.setHex(C);T.color.setHex(C)}if(w){for(i=0;i<4;i++){f=_[u++];C=H[f];if(i!==2)x.vertexColors.push(new THREE.Color(C));if(i!==0)T.vertexColors.push(new THREE.Color(C))}}r.faces.push(x);r.faces.push(T)}else{S=new THREE.Face3;S.a=_[u++];S.b=_[u++];S.c=_[u++];if(v){h=_[u++];S.materialIndex=h}o=r.faces.length;if(m){for(i=0;i<B;i++){L=e.uvs[i];r.faceVertexUvs[i][o]=[];for(s=0;s<3;s++){c=_[u++];O=L[c*2];M=L[c*2+1];A=new THREE.Vector2(O,M);r.faceVertexUvs[i][o].push(A)}}}if(g){l=_[u++]*3;S.normal.set(P[l++],P[l++],P[l])}if(y){for(i=0;i<3;i++){l=_[u++]*3;k=new THREE.Vector3(P[l++],P[l++],P[l]);S.vertexNormals.push(k)}}if(b){f=_[u++];S.color.setHex(H[f])}if(w){for(i=0;i<3;i++){f=_[u++];S.vertexColors.push(new THREE.Color(H[f]))}}r.faces.push(S)}}}function o(){var t=e.influencesPerVertex!==undefined?e.influencesPerVertex:2;if(e.skinWeights){for(var n=0,i=e.skinWeights.length;n<i;n+=t){var s=e.skinWeights[n];var o=t>1?e.skinWeights[n+1]:0;var u=t>2?e.skinWeights[n+2]:0;var a=t>3?e.skinWeights[n+3]:0;r.skinWeights.push(new THREE.Vector4(s,o,u,a))}}if(e.skinIndices){for(var n=0,i=e.skinIndices.length;n<i;n+=t){var f=e.skinIndices[n];var l=t>1?e.skinIndices[n+1]:0;var c=t>2?e.skinIndices[n+2]:0;var h=t>3?e.skinIndices[n+3]:0;r.skinIndices.push(new THREE.Vector4(f,l,c,h))}}r.bones=e.bones;if(r.bones&&r.bones.length>0&&(r.skinWeights.length!==r.skinIndices.length||r.skinIndices.length!==r.vertices.length)){console.warn("When skinning, number of vertices ("+r.vertices.length+"), skinIndices ("+r.skinIndices.length+"), and skinWeights ("+r.skinWeights.length+") should match.")}r.animation=e.animation;r.animations=e.animations}function u(t){if(e.morphTargets!==undefined){var n,i,s,o,u,a;for(n=0,i=e.morphTargets.length;n<i;n++){r.morphTargets[n]={};r.morphTargets[n].name=e.morphTargets[n].name;r.morphTargets[n].vertices=[];u=r.morphTargets[n].vertices;a=e.morphTargets[n].vertices;for(s=0,o=a.length;s<o;s+=3){var f=new THREE.Vector3;f.x=a[s]*t;f.y=a[s+1]*t;f.z=a[s+2]*t;u.push(f)}}}if(e.morphColors!==undefined){var n,i,l,c,h,p,d;for(n=0,i=e.morphColors.length;n<i;n++){r.morphColors[n]={};r.morphColors[n].name=e.morphColors[n].name;r.morphColors[n].colors=[];h=r.morphColors[n].colors;p=e.morphColors[n].colors;for(l=0,c=p.length;l<c;l+=3){d=new THREE.Color(16755200);d.setRGB(p[l],p[l+1],p[l+2]);h.push(d)}}}}var n=this,r=new THREE.Geometry,i=e.scale!==undefined?1/e.scale:1;s(i);o();u(i);r.computeFaceNormals();r.computeBoundingSphere();if(e.materials===undefined||e.materials.length===0){return{geometry:r}}else{var a=this.initMaterials(e.materials,t);if(this.needsTangents(a)){r.computeTangents()}return{geometry:r,materials:a}}};THREE.LoadingManager=function(e,t,n){var r=this;var i=0,s=0;this.onLoad=e;this.onProgress=t;this.onError=n;this.itemStart=function(e){s++};this.itemEnd=function(e){i++;if(r.onProgress!==undefined){r.onProgress(e,i,s)}if(i===s&&r.onLoad!==undefined){r.onLoad()}}};THREE.DefaultLoadingManager=new THREE.LoadingManager;THREE.BufferGeometryLoader=function(e){this.manager=e!==undefined?e:THREE.DefaultLoadingManager};THREE.BufferGeometryLoader.prototype={constructor:THREE.BufferGeometryLoader,load:function(e,t,n,r){var i=this;var s=new THREE.XHRLoader;s.setCrossOrigin(this.crossOrigin);s.load(e,function(e){t(i.parse(JSON.parse(e)))},n,r)},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=new THREE.BufferGeometry;var n=e.attributes;for(var r in n){var i=n[r];var s=new self[i.type](i.array);t.addAttribute(r,new THREE.BufferAttribute(s,i.itemSize))}var o=e.offsets;if(o!==undefined){t.offsets=JSON.parse(JSON.stringify(o))}var u=e.boundingSphere;if(u!==undefined){var a=new THREE.Vector3;if(u.center!==undefined){a.fromArray(u.center)}t.boundingSphere=new THREE.Sphere(a,u.radius)}return t}};THREE.MaterialLoader=function(e){this.manager=e!==undefined?e:THREE.DefaultLoadingManager};THREE.MaterialLoader.prototype={constructor:THREE.MaterialLoader,load:function(e,t,n,r){var i=this;var s=new THREE.XHRLoader;s.setCrossOrigin(this.crossOrigin);s.load(e,function(e){t(i.parse(JSON.parse(e)))},n,r)},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=new THREE[e.type];if(e.color!==undefined)t.color.setHex(e.color);if(e.ambient!==undefined)t.ambient.setHex(e.ambient);if(e.emissive!==undefined)t.emissive.setHex(e.emissive);if(e.specular!==undefined)t.specular.setHex(e.specular);if(e.shininess!==undefined)t.shininess=e.shininess;if(e.uniforms!==undefined)t.uniforms=e.uniforms;if(e.vertexShader!==undefined)t.vertexShader=e.vertexShader;if(e.fragmentShader!==undefined)t.fragmentShader=e.fragmentShader;if(e.vertexColors!==undefined)t.vertexColors=e.vertexColors;if(e.shading!==undefined)t.shading=e.shading;if(e.blending!==undefined)t.blending=e.blending;if(e.side!==undefined)t.side=e.side;if(e.opacity!==undefined)t.opacity=e.opacity;if(e.transparent!==undefined)t.transparent=e.transparent;if(e.wireframe!==undefined)t.wireframe=e.wireframe;if(e.materials!==undefined){for(var n=0,r=e.materials.length;n<r;n++){t.materials.push(this.parse(e.materials[n]))}}return t}};THREE.ObjectLoader=function(e){this.manager=e!==undefined?e:THREE.DefaultLoadingManager};THREE.ObjectLoader.prototype={constructor:THREE.ObjectLoader,load:function(e,t,n,r){var i=this;var s=new THREE.XHRLoader(i.manager);s.setCrossOrigin(this.crossOrigin);s.load(e,function(e){t(i.parse(JSON.parse(e)))},n,r)},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=this.parseGeometries(e.geometries);var n=this.parseMaterials(e.materials);var r=this.parseObject(e.object,t,n);return r},parseGeometries:function(e){var t={};if(e!==undefined){var n=new THREE.JSONLoader;var r=new THREE.BufferGeometryLoader;for(var i=0,s=e.length;i<s;i++){var o;var u=e[i];switch(u.type){case"PlaneGeometry":o=new THREE.PlaneGeometry(u.width,u.height,u.widthSegments,u.heightSegments);break;case"BoxGeometry":case"CubeGeometry":o=new THREE.BoxGeometry(u.width,u.height,u.depth,u.widthSegments,u.heightSegments,u.depthSegments);break;case"CircleGeometry":o=new THREE.CircleGeometry(u.radius,u.segments);break;case"CylinderGeometry":o=new THREE.CylinderGeometry(u.radiusTop,u.radiusBottom,u.height,u.radialSegments,u.heightSegments,u.openEnded);break;case"SphereGeometry":o=new THREE.SphereGeometry(u.radius,u.widthSegments,u.heightSegments,u.phiStart,u.phiLength,u.thetaStart,u.thetaLength);break;case"IcosahedronGeometry":o=new THREE.IcosahedronGeometry(u.radius,u.detail);break;case"TorusGeometry":o=new THREE.TorusGeometry(u.radius,u.tube,u.radialSegments,u.tubularSegments,u.arc);break;case"TorusKnotGeometry":o=new THREE.TorusKnotGeometry(u.radius,u.tube,u.radialSegments,u.tubularSegments,u.p,u.q,u.heightScale);break;case"BufferGeometry":o=r.parse(u.data);break;case"Geometry":o=n.parse(u.data).geometry;break}o.uuid=u.uuid;if(u.name!==undefined)o.name=u.name;t[u.uuid]=o}}return t},parseMaterials:function(e){var t={};if(e!==undefined){var n=new THREE.MaterialLoader;for(var r=0,i=e.length;r<i;r++){var s=e[r];var o=n.parse(s);o.uuid=s.uuid;if(s.name!==undefined)o.name=s.name;t[s.uuid]=o}}return t},parseObject:function(){var e=new THREE.Matrix4;return function(t,n,r){var i;switch(t.type){case"Scene":i=new THREE.Scene;break;case"PerspectiveCamera":i=new THREE.PerspectiveCamera(t.fov,t.aspect,t.near,t.far);break;case"OrthographicCamera":i=new THREE.OrthographicCamera(t.left,t.right,t.top,t.bottom,t.near,t.far);break;case"AmbientLight":i=new THREE.AmbientLight(t.color);break;case"DirectionalLight":i=new THREE.DirectionalLight(t.color,t.intensity);break;case"PointLight":i=new THREE.PointLight(t.color,t.intensity,t.distance);break;case"SpotLight":i=new THREE.SpotLight(t.color,t.intensity,t.distance,t.angle,t.exponent);break;case"HemisphereLight":i=new THREE.HemisphereLight(t.color,t.groundColor,t.intensity);break;case"Mesh":var s=n[t.geometry];var o=r[t.material];if(s===undefined){console.warn("THREE.ObjectLoader: Undefined geometry",t.geometry)}if(o===undefined){console.warn("THREE.ObjectLoader: Undefined material",t.material)}i=new THREE.Mesh(s,o);break;case"Line":var s=n[t.geometry];var o=r[t.material];if(s===undefined){console.warn("THREE.ObjectLoader: Undefined geometry",t.geometry)}if(o===undefined){console.warn("THREE.ObjectLoader: Undefined material",t.material)}i=new THREE.Line(s,o);break;case"Sprite":var o=r[t.material];if(o===undefined){console.warn("THREE.ObjectLoader: Undefined material",t.material)}i=new THREE.Sprite(o);break;case"Group":i=new THREE.Group;break;default:i=new THREE.Object3D}i.uuid=t.uuid;if(t.name!==undefined)i.name=t.name;if(t.matrix!==undefined){e.fromArray(t.matrix);e.decompose(i.position,i.quaternion,i.scale)}else{if(t.position!==undefined)i.position.fromArray(t.position);if(t.rotation!==undefined)i.rotation.fromArray(t.rotation);if(t.scale!==undefined)i.scale.fromArray(t.scale)}if(t.visible!==undefined)i.visible=t.visible;if(t.userData!==undefined)i.userData=t.userData;if(t.children!==undefined){for(var u in t.children){i.add(this.parseObject(t.children[u],n,r))}}return i}}()};THREE.TextureLoader=function(e){this.manager=e!==undefined?e:THREE.DefaultLoadingManager};THREE.TextureLoader.prototype={constructor:THREE.TextureLoader,load:function(e,t,n,r){var i=this;var s=new THREE.ImageLoader(i.manager);s.setCrossOrigin(this.crossOrigin);s.load(e,function(e){var n=new THREE.Texture(e);n.needsUpdate=true;if(t!==undefined){t(n)}},n,r)},setCrossOrigin:function(e){this.crossOrigin=e}};THREE.CompressedTextureLoader=function(){this._parser=null};THREE.CompressedTextureLoader.prototype={constructor:THREE.CompressedTextureLoader,load:function(e,t,n){var r=this;var i=[];var s=new THREE.CompressedTexture;s.image=i;var o=new THREE.XHRLoader;o.setResponseType("arraybuffer");if(e instanceof Array){var u=0;var a=function(n){o.load(e[n],function(e){var o=r._parser(e,true);i[n]={width:o.width,height:o.height,format:o.format,mipmaps:o.mipmaps};u+=1;if(u===6){if(o.mipmapCount==1)s.minFilter=THREE.LinearFilter;s.format=o.format;s.needsUpdate=true;if(t)t(s)}})};for(var f=0,l=e.length;f<l;++f){a(f)}}else{o.load(e,function(e){var n=r._parser(e,true);if(n.isCubemap){var o=n.mipmaps.length/n.mipmapCount;for(var u=0;u<o;u++){i[u]={mipmaps:[]};for(var a=0;a<n.mipmapCount;a++){i[u].mipmaps.push(n.mipmaps[u*n.mipmapCount+a]);i[u].format=n.format;i[u].width=n.width;i[u].height=n.height}}}else{s.image.width=n.width;s.image.height=n.height;s.mipmaps=n.mipmaps}if(n.mipmapCount===1){s.minFilter=THREE.LinearFilter}s.format=n.format;s.needsUpdate=true;if(t)t(s)})}return s}};THREE.Material=function(){Object.defineProperty(this,"id",{value:THREE.MaterialIdCount++});this.uuid=THREE.Math.generateUUID();this.name="";this.type="Material";this.side=THREE.FrontSide;this.opacity=1;this.transparent=false;this.blending=THREE.NormalBlending;this.blendSrc=THREE.SrcAlphaFactor;this.blendDst=THREE.OneMinusSrcAlphaFactor;this.blendEquation=THREE.AddEquation;this.depthTest=true;this.depthWrite=true;this.polygonOffset=false;this.polygonOffsetFactor=0;this.polygonOffsetUnits=0;this.alphaTest=0;this.overdraw=0;this.visible=true;this.needsUpdate=true};THREE.Material.prototype={constructor:THREE.Material,setValues:function(e){if(e===undefined)return;for(var t in e){var n=e[t];if(n===undefined){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}if(t in this){var r=this[t];if(r instanceof THREE.Color){r.set(n)}else if(r instanceof THREE.Vector3&&n instanceof THREE.Vector3){r.copy(n)}else if(t=="overdraw"){this[t]=Number(n)}else{this[t]=n}}}},toJSON:function(){var e={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type};if(this.name!=="")e.name=this.name;if(this instanceof THREE.MeshBasicMaterial){e.color=this.color.getHex();if(this.vertexColors!==THREE.NoColors)e.vertexColors=this.vertexColors;if(this.blending!==THREE.NormalBlending)e.blending=this.blending;if(this.side!==THREE.FrontSide)e.side=this.side}else if(this instanceof THREE.MeshLambertMaterial){e.color=this.color.getHex();e.ambient=this.ambient.getHex();e.emissive=this.emissive.getHex();if(this.vertexColors!==THREE.NoColors)e.vertexColors=this.vertexColors;if(this.blending!==THREE.NormalBlending)e.blending=this.blending;if(this.side!==THREE.FrontSide)e.side=this.side}else if(this instanceof THREE.MeshPhongMaterial){e.color=this.color.getHex();e.ambient=this.ambient.getHex();e.emissive=this.emissive.getHex();e.specular=this.specular.getHex();e.shininess=this.shininess;if(this.vertexColors!==THREE.NoColors)e.vertexColors=this.vertexColors;if(this.blending!==THREE.NormalBlending)e.blending=this.blending;if(this.side!==THREE.FrontSide)e.side=this.side}else if(this instanceof THREE.MeshNormalMaterial){if(this.shading!==THREE.FlatShading)e.shading=this.shading;if(this.blending!==THREE.NormalBlending)e.blending=this.blending;if(this.side!==THREE.FrontSide)e.side=this.side}else if(this instanceof THREE.MeshDepthMaterial){if(this.blending!==THREE.NormalBlending)e.blending=this.blending;if(this.side!==THREE.FrontSide)e.side=this.side}else if(this instanceof THREE.ShaderMaterial){e.uniforms=this.uniforms;e.vertexShader=this.vertexShader;e.fragmentShader=this.fragmentShader}else if(this instanceof THREE.SpriteMaterial){e.color=this.color.getHex()}if(this.opacity<1)e.opacity=this.opacity;if(this.transparent!==false)e.transparent=this.transparent;if(this.wireframe!==false)e.wireframe=this.wireframe;return e},clone:function(e){if(e===undefined)e=new THREE.Material;e.name=this.name;e.side=this.side;e.opacity=this.opacity;e.transparent=this.transparent;e.blending=this.blending;e.blendSrc=this.blendSrc;e.blendDst=this.blendDst;e.blendEquation=this.blendEquation;e.depthTest=this.depthTest;e.depthWrite=this.depthWrite;e.polygonOffset=this.polygonOffset;e.polygonOffsetFactor=this.polygonOffsetFactor;e.polygonOffsetUnits=this.polygonOffsetUnits;e.alphaTest=this.alphaTest;e.overdraw=this.overdraw;e.visible=this.visible;return e},dispose:function(){this.dispatchEvent({type:"dispose"})}};THREE.EventDispatcher.prototype.apply(THREE.Material.prototype);THREE.MaterialIdCount=0;THREE.LineBasicMaterial=function(e){THREE.Material.call(this);this.type="LineBasicMaterial";this.color=new THREE.Color(16777215);this.linewidth=1;this.linecap="round";this.linejoin="round";this.vertexColors=THREE.NoColors;this.fog=true;this.setValues(e)};THREE.LineBasicMaterial.prototype=Object.create(THREE.Material.prototype);THREE.LineBasicMaterial.prototype.clone=function(){var e=new THREE.LineBasicMaterial;THREE.Material.prototype.clone.call(this,e);e.color.copy(this.color);e.linewidth=this.linewidth;e.linecap=this.linecap;e.linejoin=this.linejoin;e.vertexColors=this.vertexColors;e.fog=this.fog;return e};THREE.LineDashedMaterial=function(e){THREE.Material.call(this);this.type="LineDashedMaterial";this.color=new THREE.Color(16777215);this.linewidth=1;this.scale=1;this.dashSize=3;this.gapSize=1;this.vertexColors=false;this.fog=true;this.setValues(e)};THREE.LineDashedMaterial.prototype=Object.create(THREE.Material.prototype);THREE.LineDashedMaterial.prototype.clone=function(){var e=new THREE.LineDashedMaterial;THREE.Material.prototype.clone.call(this,e);e.color.copy(this.color);e.linewidth=this.linewidth;e.scale=this.scale;e.dashSize=this.dashSize;e.gapSize=this.gapSize;e.vertexColors=this.vertexColors;e.fog=this.fog;return e};THREE.MeshBasicMaterial=function(e){THREE.Material.call(this);this.type="MeshBasicMaterial";this.color=new THREE.Color(16777215);this.map=null;this.lightMap=null;this.specularMap=null;this.alphaMap=null;this.envMap=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.fog=true;this.shading=THREE.SmoothShading;this.wireframe=false;this.wireframeLinewidth=1;this.wireframeLinecap="round";this.wireframeLinejoin="round";this.vertexColors=THREE.NoColors;this.skinning=false;this.morphTargets=false;this.setValues(e)};THREE.MeshBasicMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshBasicMaterial.prototype.clone=function(){var e=new THREE.MeshBasicMaterial;THREE.Material.prototype.clone.call(this,e);e.color.copy(this.color);e.map=this.map;e.lightMap=this.lightMap;e.specularMap=this.specularMap;e.alphaMap=this.alphaMap;e.envMap=this.envMap;e.combine=this.combine;e.reflectivity=this.reflectivity;e.refractionRatio=this.refractionRatio;e.fog=this.fog;e.shading=this.shading;e.wireframe=this.wireframe;e.wireframeLinewidth=this.wireframeLinewidth;e.wireframeLinecap=this.wireframeLinecap;e.wireframeLinejoin=this.wireframeLinejoin;e.vertexColors=this.vertexColors;e.skinning=this.skinning;e.morphTargets=this.morphTargets;return e};THREE.MeshLambertMaterial=function(e){THREE.Material.call(this);this.type="MeshLambertMaterial";this.color=new THREE.Color(16777215);this.ambient=new THREE.Color(16777215);this.emissive=new THREE.Color(0);this.wrapAround=false;this.wrapRGB=new THREE.Vector3(1,1,1);this.map=null;this.lightMap=null;this.specularMap=null;this.alphaMap=null;this.envMap=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.fog=true;this.shading=THREE.SmoothShading;this.wireframe=false;this.wireframeLinewidth=1;this.wireframeLinecap="round";this.wireframeLinejoin="round";this.vertexColors=THREE.NoColors;this.skinning=false;this.morphTargets=false;this.morphNormals=false;this.setValues(e)};THREE.MeshLambertMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshLambertMaterial.prototype.clone=function(){var e=new THREE.MeshLambertMaterial;THREE.Material.prototype.clone.call(this,e);e.color.copy(this.color);e.ambient.copy(this.ambient);e.emissive.copy(this.emissive);e.wrapAround=this.wrapAround;e.wrapRGB.copy(this.wrapRGB);e.map=this.map;e.lightMap=this.lightMap;e.specularMap=this.specularMap;e.alphaMap=this.alphaMap;e.envMap=this.envMap;e.combine=this.combine;e.reflectivity=this.reflectivity;e.refractionRatio=this.refractionRatio;e.fog=this.fog;e.shading=this.shading;e.wireframe=this.wireframe;e.wireframeLinewidth=this.wireframeLinewidth;e.wireframeLinecap=this.wireframeLinecap;e.wireframeLinejoin=this.wireframeLinejoin;e.vertexColors=this.vertexColors;e.skinning=this.skinning;e.morphTargets=this.morphTargets;e.morphNormals=this.morphNormals;return e};THREE.MeshPhongMaterial=function(e){THREE.Material.call(this);this.type="MeshPhongMaterial";this.color=new THREE.Color(16777215);this.ambient=new THREE.Color(16777215);this.emissive=new THREE.Color(0);this.specular=new THREE.Color(1118481);this.shininess=30;this.metal=false;this.wrapAround=false;this.wrapRGB=new THREE.Vector3(1,1,1);this.map=null;this.lightMap=null;this.bumpMap=null;this.bumpScale=1;this.normalMap=null;this.normalScale=new THREE.Vector2(1,1);this.specularMap=null;this.alphaMap=null;this.envMap=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.fog=true;this.shading=THREE.SmoothShading;this.wireframe=false;this.wireframeLinewidth=1;this.wireframeLinecap="round";this.wireframeLinejoin="round";this.vertexColors=THREE.NoColors;this.skinning=false;this.morphTargets=false;this.morphNormals=false;this.setValues(e)};THREE.MeshPhongMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshPhongMaterial.prototype.clone=function(){var e=new THREE.MeshPhongMaterial;THREE.Material.prototype.clone.call(this,e);e.color.copy(this.color);e.ambient.copy(this.ambient);e.emissive.copy(this.emissive);e.specular.copy(this.specular);e.shininess=this.shininess;e.metal=this.metal;e.wrapAround=this.wrapAround;e.wrapRGB.copy(this.wrapRGB);e.map=this.map;e.lightMap=this.lightMap;e.bumpMap=this.bumpMap;e.bumpScale=this.bumpScale;e.normalMap=this.normalMap;e.normalScale.copy(this.normalScale);e.specularMap=this.specularMap;e.alphaMap=this.alphaMap;e.envMap=this.envMap;e.combine=this.combine;e.reflectivity=this.reflectivity;e.refractionRatio=this.refractionRatio;e.fog=this.fog;e.shading=this.shading;e.wireframe=this.wireframe;e.wireframeLinewidth=this.wireframeLinewidth;e.wireframeLinecap=this.wireframeLinecap;e.wireframeLinejoin=this.wireframeLinejoin;e.vertexColors=this.vertexColors;e.skinning=this.skinning;e.morphTargets=this.morphTargets;e.morphNormals=this.morphNormals;return e};THREE.MeshDepthMaterial=function(e){THREE.Material.call(this);this.type="MeshDepthMaterial";this.morphTargets=false;this.wireframe=false;this.wireframeLinewidth=1;this.setValues(e)};THREE.MeshDepthMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshDepthMaterial.prototype.clone=function(){var e=new THREE.MeshDepthMaterial;THREE.Material.prototype.clone.call(this,e);e.wireframe=this.wireframe;e.wireframeLinewidth=this.wireframeLinewidth;return e};THREE.MeshNormalMaterial=function(e){THREE.Material.call(this,e);this.type="MeshNormalMaterial";this.shading=THREE.FlatShading;this.wireframe=false;this.wireframeLinewidth=1;this.morphTargets=false;this.setValues(e)};THREE.MeshNormalMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshNormalMaterial.prototype.clone=function(){var e=new THREE.MeshNormalMaterial;THREE.Material.prototype.clone.call(this,e);e.shading=this.shading;e.wireframe=this.wireframe;e.wireframeLinewidth=this.wireframeLinewidth;return e};THREE.MeshFaceMaterial=function(e){this.uuid=THREE.Math.generateUUID();this.type="MeshFaceMaterial";this.materials=e instanceof Array?e:[]};THREE.MeshFaceMaterial.prototype={constructor:THREE.MeshFaceMaterial,toJSON:function(){var e={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type,materials:[]};for(var t=0,n=this.materials.length;t<n;t++){e.materials.push(this.materials[t].toJSON())}return e},clone:function(){var e=new THREE.MeshFaceMaterial;for(var t=0;t<this.materials.length;t++){e.materials.push(this.materials[t].clone())}return e}};THREE.PointCloudMaterial=function(e){THREE.Material.call(this);this.type="PointCloudMaterial";this.color=new THREE.Color(16777215);this.map=null;this.size=1;this.sizeAttenuation=true;this.vertexColors=THREE.NoColors;this.fog=true;this.setValues(e)};THREE.PointCloudMaterial.prototype=Object.create(THREE.Material.prototype);THREE.PointCloudMaterial.prototype.clone=function(){var e=new THREE.PointCloudMaterial;THREE.Material.prototype.clone.call(this,e);e.color.copy(this.color);e.map=this.map;e.size=this.size;e.sizeAttenuation=this.sizeAttenuation;e.vertexColors=this.vertexColors;e.fog=this.fog;return e};THREE.ParticleBasicMaterial=function(e){console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointCloudMaterial.");return new THREE.PointCloudMaterial(e)};THREE.ParticleSystemMaterial=function(e){console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointCloudMaterial.");return new THREE.PointCloudMaterial(e)};THREE.ShaderMaterial=function(e){THREE.Material.call(this);this.type="ShaderMaterial";this.defines={};this.uniforms={};this.attributes=null;this.vertexShader="void main() {\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}";this.fragmentShader="void main() {\n	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";this.shading=THREE.SmoothShading;this.linewidth=1;this.wireframe=false;this.wireframeLinewidth=1;this.fog=false;this.lights=false;this.vertexColors=THREE.NoColors;this.skinning=false;this.morphTargets=false;this.morphNormals=false;this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]};this.index0AttributeName=undefined;this.setValues(e)};THREE.ShaderMaterial.prototype=Object.create(THREE.Material.prototype);THREE.ShaderMaterial.prototype.clone=function(){var e=new THREE.ShaderMaterial;THREE.Material.prototype.clone.call(this,e);e.fragmentShader=this.fragmentShader;e.vertexShader=this.vertexShader;e.uniforms=THREE.UniformsUtils.clone(this.uniforms);e.attributes=this.attributes;e.defines=this.defines;e.shading=this.shading;e.wireframe=this.wireframe;e.wireframeLinewidth=this.wireframeLinewidth;e.fog=this.fog;e.lights=this.lights;e.vertexColors=this.vertexColors;e.skinning=this.skinning;e.morphTargets=this.morphTargets;e.morphNormals=this.morphNormals;return e};THREE.RawShaderMaterial=function(e){THREE.ShaderMaterial.call(this,e);this.type="RawShaderMaterial"};THREE.RawShaderMaterial.prototype=Object.create(THREE.ShaderMaterial.prototype);THREE.RawShaderMaterial.prototype.clone=function(){var e=new THREE.RawShaderMaterial;THREE.ShaderMaterial.prototype.clone.call(this,e);return e};THREE.SpriteMaterial=function(e){THREE.Material.call(this);this.type="SpriteMaterial";this.color=new THREE.Color(16777215);this.map=null;this.rotation=0;this.fog=false;this.setValues(e)};THREE.SpriteMaterial.prototype=Object.create(THREE.Material.prototype);THREE.SpriteMaterial.prototype.clone=function(){var e=new THREE.SpriteMaterial;THREE.Material.prototype.clone.call(this,e);e.color.copy(this.color);e.map=this.map;e.rotation=this.rotation;e.fog=this.fog;return e};THREE.Texture=function(e,t,n,r,i,s,o,u,a){Object.defineProperty(this,"id",{value:THREE.TextureIdCount++});this.uuid=THREE.Math.generateUUID();this.name="";this.image=e!==undefined?e:THREE.Texture.DEFAULT_IMAGE;this.mipmaps=[];this.mapping=t!==undefined?t:THREE.Texture.DEFAULT_MAPPING;this.wrapS=n!==undefined?n:THREE.ClampToEdgeWrapping;this.wrapT=r!==undefined?r:THREE.ClampToEdgeWrapping;this.magFilter=i!==undefined?i:THREE.LinearFilter;this.minFilter=s!==undefined?s:THREE.LinearMipMapLinearFilter;this.anisotropy=a!==undefined?a:1;this.format=o!==undefined?o:THREE.RGBAFormat;this.type=u!==undefined?u:THREE.UnsignedByteType;this.offset=new THREE.Vector2(0,0);this.repeat=new THREE.Vector2(1,1);this.generateMipmaps=true;this.premultiplyAlpha=false;this.flipY=true;this.unpackAlignment=4;this._needsUpdate=false;this.onUpdate=null};THREE.Texture.DEFAULT_IMAGE=undefined;THREE.Texture.DEFAULT_MAPPING=new THREE.UVMapping;THREE.Texture.prototype={constructor:THREE.Texture,get needsUpdate(){return this._needsUpdate},set needsUpdate(e){if(e===true)this.update();this._needsUpdate=e},clone:function(e){if(e===undefined)e=new THREE.Texture;e.image=this.image;e.mipmaps=this.mipmaps.slice(0);e.mapping=this.mapping;e.wrapS=this.wrapS;e.wrapT=this.wrapT;e.magFilter=this.magFilter;e.minFilter=this.minFilter;e.anisotropy=this.anisotropy;e.format=this.format;e.type=this.type;e.offset.copy(this.offset);e.repeat.copy(this.repeat);e.generateMipmaps=this.generateMipmaps;e.premultiplyAlpha=this.premultiplyAlpha;e.flipY=this.flipY;e.unpackAlignment=this.unpackAlignment;return e},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}};THREE.EventDispatcher.prototype.apply(THREE.Texture.prototype);THREE.TextureIdCount=0;THREE.CubeTexture=function(e,t,n,r,i,s,o,u,a){THREE.Texture.call(this,e,t,n,r,i,s,o,u,a);this.images=e};THREE.CubeTexture.prototype=Object.create(THREE.Texture.prototype);THREE.CubeTexture.clone=function(e){if(e===undefined)e=new THREE.CubeTexture;THREE.Texture.prototype.clone.call(this,e);e.images=this.images;return e};THREE.CompressedTexture=function(e,t,n,r,i,s,o,u,a,f,l){THREE.Texture.call(this,null,s,o,u,a,f,r,i,l);this.image={width:t,height:n};this.mipmaps=e;this.flipY=false;this.generateMipmaps=false};THREE.CompressedTexture.prototype=Object.create(THREE.Texture.prototype);THREE.CompressedTexture.prototype.clone=function(){var e=new THREE.CompressedTexture;THREE.Texture.prototype.clone.call(this,e);return e};THREE.DataTexture=function(e,t,n,r,i,s,o,u,a,f,l){THREE.Texture.call(this,null,s,o,u,a,f,r,i,l);this.image={data:e,width:t,height:n}};THREE.DataTexture.prototype=Object.create(THREE.Texture.prototype);THREE.DataTexture.prototype.clone=function(){var e=new THREE.DataTexture;THREE.Texture.prototype.clone.call(this,e);return e};THREE.VideoTexture=function(e,t,n,r,i,s,o,u,a){THREE.Texture.call(this,e,t,n,r,i,s,o,u,a);this.generateMipmaps=false;var f=this;var l=function(){requestAnimationFrame(l);if(e.readyState===e.HAVE_ENOUGH_DATA){f.needsUpdate=true}};l()};THREE.VideoTexture.prototype=Object.create(THREE.Texture.prototype);THREE.Group=function(){THREE.Object3D.call(this);this.type="Group"};THREE.Group.prototype=Object.create(THREE.Object3D.prototype);THREE.PointCloud=function(e,t){THREE.Object3D.call(this);this.type="PointCloud";this.geometry=e!==undefined?e:new THREE.Geometry;this.material=t!==undefined?t:new THREE.PointCloudMaterial({color:Math.random()*16777215});this.sortParticles=false};THREE.PointCloud.prototype=Object.create(THREE.Object3D.prototype);THREE.PointCloud.prototype.raycast=function(){var e=new THREE.Matrix4;var t=new THREE.Ray;return function(n,r){var i=this;var s=i.geometry;var o=n.params.PointCloud.threshold;e.getInverse(this.matrixWorld);t.copy(n.ray).applyMatrix4(e);if(s.boundingBox!==null){if(t.isIntersectionBox(s.boundingBox)===false){return}}var u=o/((this.scale.x+this.scale.y+this.scale.z)/3);var a=new THREE.Vector3;var f=function(e,s){var o=t.distanceToPoint(e);if(o<u){var a=t.closestPointToPoint(e);a.applyMatrix4(i.matrixWorld);var f=n.ray.origin.distanceTo(a);r.push({distance:f,distanceToRay:o,point:a.clone(),index:s,face:null,object:i})}};if(s instanceof THREE.BufferGeometry){var l=s.attributes;var c=l.position.array;if(l.index!==undefined){var h=l.index.array;var p=s.offsets;if(p.length===0){var d={start:0,count:h.length,index:0};p=[d]}for(var v=0,m=p.length;v<m;++v){var g=p[v].start;var y=p[v].count;var b=p[v].index;for(var w=g,E=g+y;w<E;w++){var S=b+h[w];a.fromArray(c,S*3);f(a,S)}}}else{var x=c.length/3;for(var w=0;w<x;w++){a.set(c[3*w],c[3*w+1],c[3*w+2]);f(a,w)}}}else{var T=this.geometry.vertices;for(var w=0;w<T.length;w++){f(T[w],w)}}}}();THREE.PointCloud.prototype.clone=function(e){if(e===undefined)e=new THREE.PointCloud(this.geometry,this.material);e.sortParticles=this.sortParticles;THREE.Object3D.prototype.clone.call(this,e);return e};THREE.ParticleSystem=function(e,t){console.warn("THREE.ParticleSystem has been renamed to THREE.PointCloud.");return new THREE.PointCloud(e,t)};THREE.Line=function(e,t,n){THREE.Object3D.call(this);this.type="Line";this.geometry=e!==undefined?e:new THREE.Geometry;this.material=t!==undefined?t:new THREE.LineBasicMaterial({color:Math.random()*16777215});this.mode=n!==undefined?n:THREE.LineStrip};THREE.LineStrip=0;THREE.LinePieces=1;THREE.Line.prototype=Object.create(THREE.Object3D.prototype);THREE.Line.prototype.raycast=function(){var e=new THREE.Matrix4;var t=new THREE.Ray;var n=new THREE.Sphere;return function(r,i){var s=r.linePrecision;var o=s*s;var u=this.geometry;if(u.boundingSphere===null)u.computeBoundingSphere();n.copy(u.boundingSphere);n.applyMatrix4(this.matrixWorld);if(r.ray.isIntersectionSphere(n)===false){return}e.getInverse(this.matrixWorld);t.copy(r.ray).applyMatrix4(e);if(u instanceof THREE.Geometry){var a=u.vertices;var f=a.length;var l=new THREE.Vector3;var c=new THREE.Vector3;var h=this.mode===THREE.LineStrip?1:2;for(var p=0;p<f-1;p=p+h){var d=t.distanceSqToSegment(a[p],a[p+1],c,l);if(d>o)continue;var v=t.origin.distanceTo(c);if(v<r.near||v>r.far)continue;i.push({distance:v,point:l.clone().applyMatrix4(this.matrixWorld),face:null,faceIndex:null,object:this})}}}}();THREE.Line.prototype.clone=function(e){if(e===undefined)e=new THREE.Line(this.geometry,this.material,this.mode);THREE.Object3D.prototype.clone.call(this,e);return e};THREE.Mesh=function(e,t){THREE.Object3D.call(this);this.type="Mesh";this.geometry=e!==undefined?e:new THREE.Geometry;this.material=t!==undefined?t:new THREE.MeshBasicMaterial({color:Math.random()*16777215});this.updateMorphTargets()};THREE.Mesh.prototype=Object.create(THREE.Object3D.prototype);THREE.Mesh.prototype.updateMorphTargets=function(){if(this.geometry.morphTargets!==undefined&&this.geometry.morphTargets.length>0){this.morphTargetBase=-1;this.morphTargetForcedOrder=[];this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var e=0,t=this.geometry.morphTargets.length;e<t;e++){this.morphTargetInfluences.push(0);this.morphTargetDictionary[this.geometry.morphTargets[e].name]=e}}};THREE.Mesh.prototype.getMorphTargetIndexByName=function(e){if(this.morphTargetDictionary[e]!==undefined){return this.morphTargetDictionary[e]}console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+e+" does not exist. Returning 0.");return 0};THREE.Mesh.prototype.raycast=function(){var e=new THREE.Matrix4;var t=new THREE.Ray;var n=new THREE.Sphere;var r=new THREE.Vector3;var i=new THREE.Vector3;var s=new THREE.Vector3;return function(o,u){var a=this.geometry;if(a.boundingSphere===null)a.computeBoundingSphere();n.copy(a.boundingSphere);n.applyMatrix4(this.matrixWorld);if(o.ray.isIntersectionSphere(n)===false){return}e.getInverse(this.matrixWorld);t.copy(o.ray).applyMatrix4(e);if(a.boundingBox!==null){if(t.isIntersectionBox(a.boundingBox)===false){return}}if(a instanceof THREE.BufferGeometry){var f=this.material;if(f===undefined)return;var l=a.attributes;var c,h,p;var d=o.precision;if(l.index!==undefined){var v=l.index.array;var m=l.position.array;var g=a.offsets;if(g.length===0){g=[{start:0,count:v.length,index:0}]}for(var y=0,b=g.length;y<b;++y){var w=g[y].start;var E=g[y].count;var S=g[y].index;for(var x=w,T=w+E;x<T;x+=3){c=S+v[x];h=S+v[x+1];p=S+v[x+2];r.fromArray(m,c*3);i.fromArray(m,h*3);s.fromArray(m,p*3);if(f.side===THREE.BackSide){var N=t.intersectTriangle(s,i,r,true)}else{var N=t.intersectTriangle(r,i,s,f.side!==THREE.DoubleSide)}if(N===null)continue;N.applyMatrix4(this.matrixWorld);var C=o.ray.origin.distanceTo(N);if(C<d||C<o.near||C>o.far)continue;u.push({distance:C,point:N,face:new THREE.Face3(c,h,p,THREE.Triangle.normal(r,i,s)),faceIndex:null,object:this})}}}else{var m=l.position.array;for(var x=0,k=0,T=m.length;x<T;x+=3,k+=9){c=x;h=x+1;p=x+2;r.fromArray(m,k);i.fromArray(m,k+3);s.fromArray(m,k+6);if(f.side===THREE.BackSide){var N=t.intersectTriangle(s,i,r,true)}else{var N=t.intersectTriangle(r,i,s,f.side!==THREE.DoubleSide)}if(N===null)continue;N.applyMatrix4(this.matrixWorld);var C=o.ray.origin.distanceTo(N);if(C<d||C<o.near||C>o.far)continue;u.push({distance:C,point:N,face:new THREE.Face3(c,h,p,THREE.Triangle.normal(r,i,s)),faceIndex:null,object:this})}}}else if(a instanceof THREE.Geometry){var L=this.material instanceof THREE.MeshFaceMaterial;var A=L===true?this.material.materials:null;var c,h,p,O;var d=o.precision;var M=a.vertices;for(var _=0,D=a.faces.length;_<D;_++){var P=a.faces[_];var f=L===true?A[P.materialIndex]:this.material;if(f===undefined)continue;c=M[P.a];h=M[P.b];p=M[P.c];if(f.morphTargets===true){var H=a.morphTargets;var B=this.morphTargetInfluences;r.set(0,0,0);i.set(0,0,0);s.set(0,0,0);for(var j=0,F=H.length;j<F;j++){var I=B[j];if(I===0)continue;var q=H[j].vertices;r.x+=(q[P.a].x-c.x)*I;r.y+=(q[P.a].y-c.y)*I;r.z+=(q[P.a].z-c.z)*I;i.x+=(q[P.b].x-h.x)*I;i.y+=(q[P.b].y-h.y)*I;i.z+=(q[P.b].z-h.z)*I;s.x+=(q[P.c].x-p.x)*I;s.y+=(q[P.c].y-p.y)*I;s.z+=(q[P.c].z-p.z)*I}r.add(c);i.add(h);s.add(p);c=r;h=i;p=s}if(f.side===THREE.BackSide){var N=t.intersectTriangle(p,h,c,true)}else{var N=t.intersectTriangle(c,h,p,f.side!==THREE.DoubleSide)}if(N===null)continue;N.applyMatrix4(this.matrixWorld);var C=o.ray.origin.distanceTo(N);if(C<d||C<o.near||C>o.far)continue;u.push({distance:C,point:N,face:P,faceIndex:_,object:this})}}}}();THREE.Mesh.prototype.clone=function(e,t){if(e===undefined)e=new THREE.Mesh(this.geometry,this.material);THREE.Object3D.prototype.clone.call(this,e,t);return e};THREE.Bone=function(e){THREE.Object3D.call(this);this.skin=e};THREE.Bone.prototype=Object.create(THREE.Object3D.prototype);THREE.Skeleton=function(e,t,n){this.useVertexTexture=n!==undefined?n:true;this.identityMatrix=new THREE.Matrix4;e=e||[];this.bones=e.slice(0);if(this.useVertexTexture){var r;if(this.bones.length>256)r=64;else if(this.bones.length>64)r=32;else if(this.bones.length>16)r=16;else r=8;this.boneTextureWidth=r;this.boneTextureHeight=r;this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4);this.boneTexture=new THREE.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,THREE.RGBAFormat,THREE.FloatType);this.boneTexture.minFilter=THREE.NearestFilter;this.boneTexture.magFilter=THREE.NearestFilter;this.boneTexture.generateMipmaps=false;this.boneTexture.flipY=false}else{this.boneMatrices=new Float32Array(16*this.bones.length)}if(t===undefined){this.calculateInverses()}else{if(this.bones.length===t.length){this.boneInverses=t.slice(0)}else{console.warn("THREE.Skeleton bonInverses is the wrong length.");this.boneInverses=[];for(var i=0,s=this.bones.length;i<s;i++){this.boneInverses.push(new THREE.Matrix4)}}}};THREE.Skeleton.prototype.calculateInverses=function(){this.boneInverses=[];for(var e=0,t=this.bones.length;e<t;e++){var n=new THREE.Matrix4;if(this.bones[e]){n.getInverse(this.bones[e].matrixWorld)}this.boneInverses.push(n)}};THREE.Skeleton.prototype.pose=function(){var e;for(var t=0,n=this.bones.length;t<n;t++){e=this.bones[t];if(e){e.matrixWorld.getInverse(this.boneInverses[t])}}for(var t=0,n=this.bones.length;t<n;t++){e=this.bones[t];if(e){if(e.parent){e.matrix.getInverse(e.parent.matrixWorld);e.matrix.multiply(e.matrixWorld)}else{e.matrix.copy(e.matrixWorld)}e.matrix.decompose(e.position,e.quaternion,e.scale)}}};THREE.Skeleton.prototype.update=function(){var e=new THREE.Matrix4;return function(){for(var t=0,n=this.bones.length;t<n;t++){var r=this.bones[t]?this.bones[t].matrixWorld:this.identityMatrix;e.multiplyMatrices(r,this.boneInverses[t]);e.flattenToArrayOffset(this.boneMatrices,t*16)}if(this.useVertexTexture){this.boneTexture.needsUpdate=true}}}();THREE.SkinnedMesh=function(e,t,n){THREE.Mesh.call(this,e,t);this.type="SkinnedMesh";this.bindMode="attached";this.bindMatrix=new THREE.Matrix4;this.bindMatrixInverse=new THREE.Matrix4;var r=[];if(this.geometry&&this.geometry.bones!==undefined){var i,s,o,u,a;for(var f=0,l=this.geometry.bones.length;f<l;++f){s=this.geometry.bones[f];o=s.pos;u=s.rotq;a=s.scl;i=new THREE.Bone(this);r.push(i);i.name=s.name;i.position.set(o[0],o[1],o[2]);i.quaternion.set(u[0],u[1],u[2],u[3]);if(a!==undefined){i.scale.set(a[0],a[1],a[2])}else{i.scale.set(1,1,1)}}for(var f=0,l=this.geometry.bones.length;f<l;++f){s=this.geometry.bones[f];if(s.parent!==-1){r[s.parent].add(r[f])}else{this.add(r[f])}}}this.normalizeSkinWeights();this.updateMatrixWorld(true);this.bind(new THREE.Skeleton(r,undefined,n))};THREE.SkinnedMesh.prototype=Object.create(THREE.Mesh.prototype);THREE.SkinnedMesh.prototype.bind=function(e,t){this.skeleton=e;if(t===undefined){this.updateMatrixWorld(true);t=this.matrixWorld}this.bindMatrix.copy(t);this.bindMatrixInverse.getInverse(t)};THREE.SkinnedMesh.prototype.pose=function(){this.skeleton.pose()};THREE.SkinnedMesh.prototype.normalizeSkinWeights=function(){if(this.geometry instanceof THREE.Geometry){for(var e=0;e<this.geometry.skinIndices.length;e++){var t=this.geometry.skinWeights[e];var n=1/t.lengthManhattan();if(n!==Infinity){t.multiplyScalar(n)}else{t.set(1)}}}else{}};THREE.SkinnedMesh.prototype.updateMatrixWorld=function(e){THREE.Mesh.prototype.updateMatrixWorld.call(this,true);if(this.bindMode==="attached"){this.bindMatrixInverse.getInverse(this.matrixWorld)}else if(this.bindMode==="detached"){this.bindMatrixInverse.getInverse(this.bindMatrix)}else{console.warn("THREE.SkinnedMesh unreckognized bindMode: "+this.bindMode)}};THREE.SkinnedMesh.prototype.clone=function(e){if(e===undefined){e=new THREE.SkinnedMesh(this.geometry,this.material,this.useVertexTexture)}THREE.Mesh.prototype.clone.call(this,e);return e};THREE.MorphAnimMesh=function(e,t){THREE.Mesh.call(this,e,t);this.type="MorphAnimMesh";this.duration=1e3;this.mirroredLoop=false;this.time=0;this.lastKeyframe=0;this.currentKeyframe=0;this.direction=1;this.directionBackwards=false;this.setFrameRange(0,this.geometry.morphTargets.length-1)};THREE.MorphAnimMesh.prototype=Object.create(THREE.Mesh.prototype);THREE.MorphAnimMesh.prototype.setFrameRange=function(e,t){this.startKeyframe=e;this.endKeyframe=t;this.length=this.endKeyframe-this.startKeyframe+1};THREE.MorphAnimMesh.prototype.setDirectionForward=function(){this.direction=1;this.directionBackwards=false};THREE.MorphAnimMesh.prototype.setDirectionBackward=function(){this.direction=-1;this.directionBackwards=true};THREE.MorphAnimMesh.prototype.parseAnimations=function(){var e=this.geometry;if(!e.animations)e.animations={};var t,n=e.animations;var r=/([a-z]+)_?(\d+)/;for(var i=0,s=e.morphTargets.length;i<s;i++){var o=e.morphTargets[i];var u=o.name.match(r);if(u&&u.length>1){var a=u[1];var f=u[2];if(!n[a])n[a]={start:Infinity,end:-Infinity};var l=n[a];if(i<l.start)l.start=i;if(i>l.end)l.end=i;if(!t)t=a}}e.firstAnimation=t};THREE.MorphAnimMesh.prototype.setAnimationLabel=function(e,t,n){if(!this.geometry.animations)this.geometry.animations={};this.geometry.animations[e]={start:t,end:n}};THREE.MorphAnimMesh.prototype.playAnimation=function(e,t){var n=this.geometry.animations[e];if(n){this.setFrameRange(n.start,n.end);this.duration=1e3*((n.end-n.start)/t);this.time=0}else{console.warn("animation["+e+"] undefined")}};THREE.MorphAnimMesh.prototype.updateAnimation=function(e){var t=this.duration/this.length;this.time+=this.direction*e;if(this.mirroredLoop){if(this.time>this.duration||this.time<0){this.direction*=-1;if(this.time>this.duration){this.time=this.duration;this.directionBackwards=true}if(this.time<0){this.time=0;this.directionBackwards=false}}}else{this.time=this.time%this.duration;if(this.time<0)this.time+=this.duration}var n=this.startKeyframe+THREE.Math.clamp(Math.floor(this.time/t),0,this.length-1);if(n!==this.currentKeyframe){this.morphTargetInfluences[this.lastKeyframe]=0;this.morphTargetInfluences[this.currentKeyframe]=1;this.morphTargetInfluences[n]=0;this.lastKeyframe=this.currentKeyframe;this.currentKeyframe=n}var r=this.time%t/t;if(this.directionBackwards){r=1-r}this.morphTargetInfluences[this.currentKeyframe]=r;this.morphTargetInfluences[this.lastKeyframe]=1-r};THREE.MorphAnimMesh.prototype.interpolateTargets=function(e,t,n){var r=this.morphTargetInfluences;for(var i=0,s=r.length;i<s;i++){r[i]=0}if(e>-1)r[e]=1-n;if(t>-1)r[t]=n};THREE.MorphAnimMesh.prototype.clone=function(e){if(e===undefined)e=new THREE.MorphAnimMesh(this.geometry,this.material);e.duration=this.duration;e.mirroredLoop=this.mirroredLoop;e.time=this.time;e.lastKeyframe=this.lastKeyframe;e.currentKeyframe=this.currentKeyframe;e.direction=this.direction;e.directionBackwards=this.directionBackwards;THREE.Mesh.prototype.clone.call(this,e);return e};THREE.LOD=function(){THREE.Object3D.call(this);this.objects=[]};THREE.LOD.prototype=Object.create(THREE.Object3D.prototype);THREE.LOD.prototype.addLevel=function(e,t){if(t===undefined)t=0;t=Math.abs(t);for(var n=0;n<this.objects.length;n++){if(t<this.objects[n].distance){break}}this.objects.splice(n,0,{distance:t,object:e});this.add(e)};THREE.LOD.prototype.getObjectForDistance=function(e){for(var t=1,n=this.objects.length;t<n;t++){if(e<this.objects[t].distance){break}}return this.objects[t-1].object};THREE.LOD.prototype.raycast=function(){var e=new THREE.Vector3;return function(t,n){e.setFromMatrixPosition(this.matrixWorld);var r=t.ray.origin.distanceTo(e);this.getObjectForDistance(r).raycast(t,n)}}();THREE.LOD.prototype.update=function(){var e=new THREE.Vector3;var t=new THREE.Vector3;return function(n){if(this.objects.length>1){e.setFromMatrixPosition(n.matrixWorld);t.setFromMatrixPosition(this.matrixWorld);var r=e.distanceTo(t);this.objects[0].object.visible=true;for(var i=1,s=this.objects.length;i<s;i++){if(r>=this.objects[i].distance){this.objects[i-1].object.visible=false;this.objects[i].object.visible=true}else{break}}for(;i<s;i++){this.objects[i].object.visible=false}}}}();THREE.LOD.prototype.clone=function(e){if(e===undefined)e=new THREE.LOD;THREE.Object3D.prototype.clone.call(this,e);for(var t=0,n=this.objects.length;t<n;t++){var r=this.objects[t].object.clone();r.visible=t===0;e.addLevel(r,this.objects[t].distance)}return e};THREE.Sprite=function(){var e=new Uint16Array([0,1,2,0,2,3]);var t=new Float32Array([-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0]);var n=new Float32Array([0,0,1,0,1,1,0,1]);var r=new THREE.BufferGeometry;r.addAttribute("index",new THREE.BufferAttribute(e,1));r.addAttribute("position",new THREE.BufferAttribute(t,3));r.addAttribute("uv",new THREE.BufferAttribute(n,2));return function(e){THREE.Object3D.call(this);this.type="Sprite";this.geometry=r;this.material=e!==undefined?e:new THREE.SpriteMaterial}}();THREE.Sprite.prototype=Object.create(THREE.Object3D.prototype);THREE.Sprite.prototype.raycast=function(){var e=new THREE.Vector3;return function(t,n){e.setFromMatrixPosition(this.matrixWorld);var r=t.ray.distanceToPoint(e);if(r>this.scale.x){return}n.push({distance:r,point:this.position,face:null,object:this})}}();THREE.Sprite.prototype.clone=function(e){if(e===undefined)e=new THREE.Sprite(this.material);THREE.Object3D.prototype.clone.call(this,e);return e};THREE.Particle=THREE.Sprite;THREE.LensFlare=function(e,t,n,r,i){THREE.Object3D.call(this);this.lensFlares=[];this.positionScreen=new THREE.Vector3;this.customUpdateCallback=undefined;if(e!==undefined){this.add(e,t,n,r,i)}};THREE.LensFlare.prototype=Object.create(THREE.Object3D.prototype);THREE.LensFlare.prototype.add=function(e,t,n,r,i,s){if(t===undefined)t=-1;if(n===undefined)n=0;if(s===undefined)s=1;if(i===undefined)i=new THREE.Color(16777215);if(r===undefined)r=THREE.NormalBlending;n=Math.min(n,Math.max(0,n));this.lensFlares.push({texture:e,size:t,distance:n,x:0,y:0,z:0,scale:1,rotation:1,opacity:s,color:i,blending:r})};THREE.LensFlare.prototype.updateLensFlares=function(){var e,t=this.lensFlares.length;var n;var r=-this.positionScreen.x*2;var i=-this.positionScreen.y*2;for(e=0;e<t;e++){n=this.lensFlares[e];n.x=this.positionScreen.x+r*n.distance;n.y=this.positionScreen.y+i*n.distance;n.wantedRotation=n.x*Math.PI*.25;n.rotation+=(n.wantedRotation-n.rotation)*.25}};THREE.Scene=function(){THREE.Object3D.call(this);this.type="Scene";this.fog=null;this.overrideMaterial=null;this.autoUpdate=true};THREE.Scene.prototype=Object.create(THREE.Object3D.prototype);THREE.Scene.prototype.clone=function(e){if(e===undefined)e=new THREE.Scene;THREE.Object3D.prototype.clone.call(this,e);if(this.fog!==null)e.fog=this.fog.clone();if(this.overrideMaterial!==null)e.overrideMaterial=this.overrideMaterial.clone();e.autoUpdate=this.autoUpdate;e.matrixAutoUpdate=this.matrixAutoUpdate;return e};THREE.Fog=function(e,t,n){this.name="";this.color=new THREE.Color(e);this.near=t!==undefined?t:1;this.far=n!==undefined?n:1e3};THREE.Fog.prototype.clone=function(){return new THREE.Fog(this.color.getHex(),this.near,this.far)};THREE.FogExp2=function(e,t){this.name="";this.color=new THREE.Color(e);this.density=t!==undefined?t:25e-5};THREE.FogExp2.prototype.clone=function(){return new THREE.FogExp2(this.color.getHex(),this.density)};THREE.ShaderChunk={};THREE.ShaderChunk["alphatest_fragment"]="#ifdef ALPHATEST\n\n	if ( gl_FragColor.a < ALPHATEST ) discard;\n\n#endif\n";THREE.ShaderChunk["lights_lambert_vertex"]="vLightFront = vec3( 0.0 );\n\n#ifdef DOUBLE_SIDED\n\n	vLightBack = vec3( 0.0 );\n\n#endif\n\ntransformedNormal = normalize( transformedNormal );\n\n#if MAX_DIR_LIGHTS > 0\n\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n	vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\n	vec3 dirVector = normalize( lDirection.xyz );\n\n	float dotProduct = dot( transformedNormal, dirVector );\n	vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n	#ifdef DOUBLE_SIDED\n\n		vec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n		#ifdef WRAP_AROUND\n\n			vec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n		#endif\n\n	#endif\n\n	#ifdef WRAP_AROUND\n\n		vec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n		directionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );\n\n		#ifdef DOUBLE_SIDED\n\n			directionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );\n\n		#endif\n\n	#endif\n\n	vLightFront += directionalLightColor[ i ] * directionalLightWeighting;\n\n	#ifdef DOUBLE_SIDED\n\n		vLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;\n\n	#endif\n\n}\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n	for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n		vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n		vec3 lVector = lPosition.xyz - mvPosition.xyz;\n\n		float lDistance = 1.0;\n		if ( pointLightDistance[ i ] > 0.0 )\n			lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\n\n		lVector = normalize( lVector );\n		float dotProduct = dot( transformedNormal, lVector );\n\n		vec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n		#ifdef DOUBLE_SIDED\n\n			vec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n			#ifdef WRAP_AROUND\n\n				vec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n			#endif\n\n		#endif\n\n		#ifdef WRAP_AROUND\n\n			vec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n			pointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );\n\n			#ifdef DOUBLE_SIDED\n\n				pointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );\n\n			#endif\n\n		#endif\n\n		vLightFront += pointLightColor[ i ] * pointLightWeighting * lDistance;\n\n		#ifdef DOUBLE_SIDED\n\n			vLightBack += pointLightColor[ i ] * pointLightWeightingBack * lDistance;\n\n		#endif\n\n	}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n		vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n		vec3 lVector = lPosition.xyz - mvPosition.xyz;\n\n		float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );\n\n		if ( spotEffect > spotLightAngleCos[ i ] ) {\n\n			spotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );\n\n			float lDistance = 1.0;\n			if ( spotLightDistance[ i ] > 0.0 )\n				lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\n\n			lVector = normalize( lVector );\n\n			float dotProduct = dot( transformedNormal, lVector );\n			vec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n			#ifdef DOUBLE_SIDED\n\n				vec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n				#ifdef WRAP_AROUND\n\n					vec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n				#endif\n\n			#endif\n\n			#ifdef WRAP_AROUND\n\n				vec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n				spotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );\n\n				#ifdef DOUBLE_SIDED\n\n					spotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );\n\n				#endif\n\n			#endif\n\n			vLightFront += spotLightColor[ i ] * spotLightWeighting * lDistance * spotEffect;\n\n			#ifdef DOUBLE_SIDED\n\n				vLightBack += spotLightColor[ i ] * spotLightWeightingBack * lDistance * spotEffect;\n\n			#endif\n\n		}\n\n	}\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n		vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );\n		vec3 lVector = normalize( lDirection.xyz );\n\n		float dotProduct = dot( transformedNormal, lVector );\n\n		float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n		float hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;\n\n		vLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n		#ifdef DOUBLE_SIDED\n\n			vLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );\n\n		#endif\n\n	}\n\n#endif\n\nvLightFront = vLightFront * diffuse + ambient * ambientLightColor + emissive;\n\n#ifdef DOUBLE_SIDED\n\n	vLightBack = vLightBack * diffuse + ambient * ambientLightColor + emissive;\n\n#endif";THREE.ShaderChunk["map_particle_pars_fragment"]="#ifdef USE_MAP\n\n	uniform sampler2D map;\n\n#endif";THREE.ShaderChunk["default_vertex"]="vec4 mvPosition;\n\n#ifdef USE_SKINNING\n\n	mvPosition = modelViewMatrix * skinned;\n\n#endif\n\n#if !defined( USE_SKINNING ) && defined( USE_MORPHTARGETS )\n\n	mvPosition = modelViewMatrix * vec4( morphed, 1.0 );\n\n#endif\n\n#if !defined( USE_SKINNING ) && ! defined( USE_MORPHTARGETS )\n\n	mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\n#endif\n\ngl_Position = projectionMatrix * mvPosition;";THREE.ShaderChunk["map_pars_fragment"]="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n	varying vec2 vUv;\n\n#endif\n\n#ifdef USE_MAP\n\n	uniform sampler2D map;\n\n#endif";THREE.ShaderChunk["skinnormal_vertex"]="#ifdef USE_SKINNING\n\n	mat4 skinMatrix = mat4( 0.0 );\n	skinMatrix += skinWeight.x * boneMatX;\n	skinMatrix += skinWeight.y * boneMatY;\n	skinMatrix += skinWeight.z * boneMatZ;\n	skinMatrix += skinWeight.w * boneMatW;\n	skinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\n	#ifdef USE_MORPHNORMALS\n\n	vec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );\n\n	#else\n\n	vec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );\n\n	#endif\n\n#endif\n";THREE.ShaderChunk["logdepthbuf_pars_vertex"]="#ifdef USE_LOGDEPTHBUF\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		varying float vFragDepth;\n\n	#endif\n\n	uniform float logDepthBufFC;\n\n#endif";THREE.ShaderChunk["lightmap_pars_vertex"]="#ifdef USE_LIGHTMAP\n\n	varying vec2 vUv2;\n\n#endif";THREE.ShaderChunk["lights_phong_fragment"]="vec3 normal = normalize( vNormal );\nvec3 viewPosition = normalize( vViewPosition );\n\n#ifdef DOUBLE_SIDED\n\n	normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n\n#endif\n\n#ifdef USE_NORMALMAP\n\n	normal = perturbNormal2Arb( -vViewPosition, normal );\n\n#elif defined( USE_BUMPMAP )\n\n	normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n	vec3 pointDiffuse = vec3( 0.0 );\n	vec3 pointSpecular = vec3( 0.0 );\n\n	for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n		vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n		vec3 lVector = lPosition.xyz + vViewPosition.xyz;\n\n		float lDistance = 1.0;\n		if ( pointLightDistance[ i ] > 0.0 )\n			lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\n\n		lVector = normalize( lVector );\n\n				// diffuse\n\n		float dotProduct = dot( normal, lVector );\n\n		#ifdef WRAP_AROUND\n\n			float pointDiffuseWeightFull = max( dotProduct, 0.0 );\n			float pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n			vec3 pointDiffuseWeight = mix( vec3( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n\n		#else\n\n			float pointDiffuseWeight = max( dotProduct, 0.0 );\n\n		#endif\n\n		pointDiffuse += diffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;\n\n				// specular\n\n		vec3 pointHalfVector = normalize( lVector + viewPosition );\n		float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\n		float pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );\n\n		float specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n		vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, pointHalfVector ), 0.0 ), 5.0 );\n		pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;\n\n	}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	vec3 spotDiffuse = vec3( 0.0 );\n	vec3 spotSpecular = vec3( 0.0 );\n\n	for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n		vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n		vec3 lVector = lPosition.xyz + vViewPosition.xyz;\n\n		float lDistance = 1.0;\n		if ( spotLightDistance[ i ] > 0.0 )\n			lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\n\n		lVector = normalize( lVector );\n\n		float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\n\n		if ( spotEffect > spotLightAngleCos[ i ] ) {\n\n			spotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );\n\n					// diffuse\n\n			float dotProduct = dot( normal, lVector );\n\n			#ifdef WRAP_AROUND\n\n				float spotDiffuseWeightFull = max( dotProduct, 0.0 );\n				float spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n				vec3 spotDiffuseWeight = mix( vec3( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\n\n			#else\n\n				float spotDiffuseWeight = max( dotProduct, 0.0 );\n\n			#endif\n\n			spotDiffuse += diffuse * spotLightColor[ i ] * spotDiffuseWeight * lDistance * spotEffect;\n\n					// specular\n\n			vec3 spotHalfVector = normalize( lVector + viewPosition );\n			float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\n			float spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );\n\n			float specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n			vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, spotHalfVector ), 0.0 ), 5.0 );\n			spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;\n\n		}\n\n	}\n\n#endif\n\n#if MAX_DIR_LIGHTS > 0\n\n	vec3 dirDiffuse = vec3( 0.0 );\n	vec3 dirSpecular = vec3( 0.0 );\n\n	for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n		vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\n		vec3 dirVector = normalize( lDirection.xyz );\n\n				// diffuse\n\n		float dotProduct = dot( normal, dirVector );\n\n		#ifdef WRAP_AROUND\n\n			float dirDiffuseWeightFull = max( dotProduct, 0.0 );\n			float dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n			vec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );\n\n		#else\n\n			float dirDiffuseWeight = max( dotProduct, 0.0 );\n\n		#endif\n\n		dirDiffuse += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;\n\n		// specular\n\n		vec3 dirHalfVector = normalize( dirVector + viewPosition );\n		float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\n		float dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );\n\n		/*\n		// fresnel term from skin shader\n		const float F0 = 0.128;\n\n		float base = 1.0 - dot( viewPosition, dirHalfVector );\n		float exponential = pow( base, 5.0 );\n\n		float fresnel = exponential + F0 * ( 1.0 - exponential );\n		*/\n\n		/*\n		// fresnel term from fresnel shader\n		const float mFresnelBias = 0.08;\n		const float mFresnelScale = 0.3;\n		const float mFresnelPower = 5.0;\n\n		float fresnel = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( -viewPosition ), normal ), mFresnelPower );\n		*/\n\n		float specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n		// 		dirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization * fresnel;\n\n		vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( dirVector, dirHalfVector ), 0.0 ), 5.0 );\n		dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n\n\n	}\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	vec3 hemiDiffuse = vec3( 0.0 );\n	vec3 hemiSpecular = vec3( 0.0 );\n\n	for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n		vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );\n		vec3 lVector = normalize( lDirection.xyz );\n\n		// diffuse\n\n		float dotProduct = dot( normal, lVector );\n		float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n\n		vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n		hemiDiffuse += diffuse * hemiColor;\n\n		// specular (sky light)\n\n		vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );\n		float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;\n		float hemiSpecularWeightSky = specularStrength * max( pow( max( hemiDotNormalHalfSky, 0.0 ), shininess ), 0.0 );\n\n		// specular (ground light)\n\n		vec3 lVectorGround = -lVector;\n\n		vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );\n		float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;\n		float hemiSpecularWeightGround = specularStrength * max( pow( max( hemiDotNormalHalfGround, 0.0 ), shininess ), 0.0 );\n\n		float dotProductGround = dot( normal, lVectorGround );\n\n		float specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n		vec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, hemiHalfVectorSky ), 0.0 ), 5.0 );\n		vec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 0.0 ), 5.0 );\n		hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );\n\n	}\n\n#endif\n\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\n\n#if MAX_DIR_LIGHTS > 0\n\n	totalDiffuse += dirDiffuse;\n	totalSpecular += dirSpecular;\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	totalDiffuse += hemiDiffuse;\n	totalSpecular += hemiSpecular;\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n	totalDiffuse += pointDiffuse;\n	totalSpecular += pointSpecular;\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	totalDiffuse += spotDiffuse;\n	totalSpecular += spotSpecular;\n\n#endif\n\n#ifdef METAL\n\n	gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient + totalSpecular );\n\n#else\n\n	gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient ) + totalSpecular;\n\n#endif";THREE.ShaderChunk["fog_pars_fragment"]="#ifdef USE_FOG\n\n	uniform vec3 fogColor;\n\n	#ifdef FOG_EXP2\n\n		uniform float fogDensity;\n\n	#else\n\n		uniform float fogNear;\n		uniform float fogFar;\n	#endif\n\n#endif";THREE.ShaderChunk["morphnormal_vertex"]="#ifdef USE_MORPHNORMALS\n\n	vec3 morphedNormal = vec3( 0.0 );\n\n	morphedNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n	morphedNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n	morphedNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n	morphedNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n\n	morphedNormal += normal;\n\n#endif";THREE.ShaderChunk["envmap_pars_fragment"]="#ifdef USE_ENVMAP\n\n	uniform float reflectivity;\n	uniform samplerCube envMap;\n	uniform float flipEnvMap;\n	uniform int combine;\n\n	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n		uniform bool useRefract;\n		uniform float refractionRatio;\n\n	#else\n\n		varying vec3 vReflect;\n\n	#endif\n\n#endif";THREE.ShaderChunk["logdepthbuf_fragment"]="#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\n	gl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n\n#endif";THREE.ShaderChunk["normalmap_pars_fragment"]="#ifdef USE_NORMALMAP\n\n	uniform sampler2D normalMap;\n	uniform vec2 normalScale;\n\n			// Per-Pixel Tangent Space Normal Mapping\n			// http://hacksoflife.blogspot.ch/2009/11/per-pixel-tangent-space-normal-mapping.html\n\n	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\n		vec3 q0 = dFdx( eye_pos.xyz );\n		vec3 q1 = dFdy( eye_pos.xyz );\n		vec2 st0 = dFdx( vUv.st );\n		vec2 st1 = dFdy( vUv.st );\n\n		vec3 S = normalize( q0 * st1.t - q1 * st0.t );\n		vec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n		vec3 N = normalize( surf_norm );\n\n		vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n		mapN.xy = normalScale * mapN.xy;\n		mat3 tsn = mat3( S, T, N );\n		return normalize( tsn * mapN );\n\n	}\n\n#endif\n";THREE.ShaderChunk["lights_phong_pars_vertex"]="#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n	varying vec3 vWorldPosition;\n\n#endif\n";THREE.ShaderChunk["lightmap_pars_fragment"]="#ifdef USE_LIGHTMAP\n\n	varying vec2 vUv2;\n	uniform sampler2D lightMap;\n\n#endif";THREE.ShaderChunk["shadowmap_vertex"]="#ifdef USE_SHADOWMAP\n\n	for( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n		vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;\n\n	}\n\n#endif";THREE.ShaderChunk["lights_phong_vertex"]="#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n	vWorldPosition = worldPosition.xyz;\n\n#endif";THREE.ShaderChunk["map_fragment"]="#ifdef USE_MAP\n\n	vec4 texelColor = texture2D( map, vUv );\n\n	#ifdef GAMMA_INPUT\n\n		texelColor.xyz *= texelColor.xyz;\n\n	#endif\n\n	gl_FragColor = gl_FragColor * texelColor;\n\n#endif";THREE.ShaderChunk["lightmap_vertex"]="#ifdef USE_LIGHTMAP\n\n	vUv2 = uv2;\n\n#endif";THREE.ShaderChunk["map_particle_fragment"]="#ifdef USE_MAP\n\n	gl_FragColor = gl_FragColor * texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) );\n\n#endif";THREE.ShaderChunk["color_pars_fragment"]="#ifdef USE_COLOR\n\n	varying vec3 vColor;\n\n#endif\n";THREE.ShaderChunk["color_vertex"]="#ifdef USE_COLOR\n\n	#ifdef GAMMA_INPUT\n\n		vColor = color * color;\n\n	#else\n\n		vColor = color;\n\n	#endif\n\n#endif";THREE.ShaderChunk["skinning_vertex"]="#ifdef USE_SKINNING\n\n	#ifdef USE_MORPHTARGETS\n\n	vec4 skinVertex = bindMatrix * vec4( morphed, 1.0 );\n\n	#else\n\n	vec4 skinVertex = bindMatrix * vec4( position, 1.0 );\n\n	#endif\n\n	vec4 skinned = vec4( 0.0 );\n	skinned += boneMatX * skinVertex * skinWeight.x;\n	skinned += boneMatY * skinVertex * skinWeight.y;\n	skinned += boneMatZ * skinVertex * skinWeight.z;\n	skinned += boneMatW * skinVertex * skinWeight.w;\n	skinned  = bindMatrixInverse * skinned;\n\n#endif\n";THREE.ShaderChunk["envmap_pars_vertex"]="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\n\n	varying vec3 vReflect;\n\n	uniform float refractionRatio;\n	uniform bool useRefract;\n\n#endif\n";THREE.ShaderChunk["linear_to_gamma_fragment"]="#ifdef GAMMA_OUTPUT\n\n	gl_FragColor.xyz = sqrt( gl_FragColor.xyz );\n\n#endif";THREE.ShaderChunk["color_pars_vertex"]="#ifdef USE_COLOR\n\n	varying vec3 vColor;\n\n#endif";THREE.ShaderChunk["lights_lambert_pars_vertex"]="uniform vec3 ambient;\nuniform vec3 diffuse;\nuniform vec3 emissive;\n\nuniform vec3 ambientLightColor;\n\n#if MAX_DIR_LIGHTS > 0\n\n	uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n	uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n	uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n	uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n	uniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n\n#endif\n\n#ifdef WRAP_AROUND\n\n	uniform vec3 wrapRGB;\n\n#endif\n";THREE.ShaderChunk["map_pars_vertex"]="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n	varying vec2 vUv;\n	uniform vec4 offsetRepeat;\n\n#endif\n";THREE.ShaderChunk["envmap_fragment"]="#ifdef USE_ENVMAP\n\n	vec3 reflectVec;\n\n	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n		vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\n		// http://en.wikibooks.org/wiki/GLSL_Programming/Applying_Matrix_Transformations\n		// Transforming Normal Vectors with the Inverse Transformation\n\n		vec3 worldNormal = normalize( vec3( vec4( normal, 0.0 ) * viewMatrix ) );\n\n		if ( useRefract ) {\n\n			reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\n		} else { \n\n			reflectVec = reflect( cameraToVertex, worldNormal );\n\n		}\n\n	#else\n\n		reflectVec = vReflect;\n\n	#endif\n\n	#ifdef DOUBLE_SIDED\n\n		float flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n		vec4 cubeColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\n	#else\n\n		vec4 cubeColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\n	#endif\n\n	#ifdef GAMMA_INPUT\n\n		cubeColor.xyz *= cubeColor.xyz;\n\n	#endif\n\n	if ( combine == 1 ) {\n\n		gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularStrength * reflectivity );\n\n	} else if ( combine == 2 ) {\n\n		gl_FragColor.xyz += cubeColor.xyz * specularStrength * reflectivity;\n\n	} else {\n\n		gl_FragColor.xyz = mix( gl_FragColor.xyz, gl_FragColor.xyz * cubeColor.xyz, specularStrength * reflectivity );\n\n	}\n\n#endif";THREE.ShaderChunk["specularmap_pars_fragment"]="#ifdef USE_SPECULARMAP\n\n	uniform sampler2D specularMap;\n\n#endif";THREE.ShaderChunk["logdepthbuf_vertex"]="#ifdef USE_LOGDEPTHBUF\n\n	gl_Position.z = log2(max(1e-6, gl_Position.w + 1.0)) * logDepthBufFC;\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		vFragDepth = 1.0 + gl_Position.w;\n\n#else\n\n		gl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\n	#endif\n\n#endif";THREE.ShaderChunk["morphtarget_pars_vertex"]="#ifdef USE_MORPHTARGETS\n\n	#ifndef USE_MORPHNORMALS\n\n	uniform float morphTargetInfluences[ 8 ];\n\n	#else\n\n	uniform float morphTargetInfluences[ 4 ];\n\n	#endif\n\n#endif";THREE.ShaderChunk["specularmap_fragment"]="float specularStrength;\n\n#ifdef USE_SPECULARMAP\n\n	vec4 texelSpecular = texture2D( specularMap, vUv );\n	specularStrength = texelSpecular.r;\n\n#else\n\n	specularStrength = 1.0;\n\n#endif";THREE.ShaderChunk["fog_fragment"]="#ifdef USE_FOG\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		float depth = gl_FragDepthEXT / gl_FragCoord.w;\n\n	#else\n\n		float depth = gl_FragCoord.z / gl_FragCoord.w;\n\n	#endif\n\n	#ifdef FOG_EXP2\n\n		const float LOG2 = 1.442695;\n		float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\n		fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n\n	#else\n\n		float fogFactor = smoothstep( fogNear, fogFar, depth );\n\n	#endif\n	\n	gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n\n#endif";THREE.ShaderChunk["bumpmap_pars_fragment"]="#ifdef USE_BUMPMAP\n\n	uniform sampler2D bumpMap;\n	uniform float bumpScale;\n\n			// Derivative maps - bump mapping unparametrized surfaces by Morten Mikkelsen\n			//	http://mmikkelsen3d.blogspot.sk/2011/07/derivative-maps.html\n\n			// Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\n\n	vec2 dHdxy_fwd() {\n\n		vec2 dSTdx = dFdx( vUv );\n		vec2 dSTdy = dFdy( vUv );\n\n		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\n		return vec2( dBx, dBy );\n\n	}\n\n	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\n		vec3 vSigmaX = dFdx( surf_pos );\n		vec3 vSigmaY = dFdy( surf_pos );\n		vec3 vN = surf_norm;		// normalized\n\n		vec3 R1 = cross( vSigmaY, vN );\n		vec3 R2 = cross( vN, vSigmaX );\n\n		float fDet = dot( vSigmaX, R1 );\n\n		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n		return normalize( abs( fDet ) * surf_norm - vGrad );\n\n	}\n\n#endif";THREE.ShaderChunk["defaultnormal_vertex"]="vec3 objectNormal;\n\n#ifdef USE_SKINNING\n\n	objectNormal = skinnedNormal.xyz;\n\n#endif\n\n#if !defined( USE_SKINNING ) && defined( USE_MORPHNORMALS )\n\n	objectNormal = morphedNormal;\n\n#endif\n\n#if !defined( USE_SKINNING ) && ! defined( USE_MORPHNORMALS )\n\n	objectNormal = normal;\n\n#endif\n\n#ifdef FLIP_SIDED\n\n	objectNormal = -objectNormal;\n\n#endif\n\nvec3 transformedNormal = normalMatrix * objectNormal;";THREE.ShaderChunk["lights_phong_pars_fragment"]="uniform vec3 ambientLightColor;\n\n#if MAX_DIR_LIGHTS > 0\n\n	uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n	uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n	uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n\n	uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n	uniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n\n	uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n	varying vec3 vWorldPosition;\n\n#endif\n\n#ifdef WRAP_AROUND\n\n	uniform vec3 wrapRGB;\n\n#endif\n\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;";THREE.ShaderChunk["skinbase_vertex"]="#ifdef USE_SKINNING\n\n	mat4 boneMatX = getBoneMatrix( skinIndex.x );\n	mat4 boneMatY = getBoneMatrix( skinIndex.y );\n	mat4 boneMatZ = getBoneMatrix( skinIndex.z );\n	mat4 boneMatW = getBoneMatrix( skinIndex.w );\n\n#endif";THREE.ShaderChunk["map_vertex"]="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n	vUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n\n#endif";THREE.ShaderChunk["lightmap_fragment"]="#ifdef USE_LIGHTMAP\n\n	gl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );\n\n#endif";THREE.ShaderChunk["shadowmap_pars_vertex"]="#ifdef USE_SHADOWMAP\n\n	varying vec4 vShadowCoord[ MAX_SHADOWS ];\n	uniform mat4 shadowMatrix[ MAX_SHADOWS ];\n\n#endif";THREE.ShaderChunk["color_fragment"]="#ifdef USE_COLOR\n\n	gl_FragColor = gl_FragColor * vec4( vColor, 1.0 );\n\n#endif";THREE.ShaderChunk["morphtarget_vertex"]="#ifdef USE_MORPHTARGETS\n\n	vec3 morphed = vec3( 0.0 );\n	morphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n	morphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n	morphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n	morphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\n	#ifndef USE_MORPHNORMALS\n\n	morphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n	morphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n	morphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n	morphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\n	#endif\n\n	morphed += position;\n\n#endif";THREE.ShaderChunk["envmap_vertex"]="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\n\n	vec3 worldNormal = mat3( modelMatrix[ 0 ].xyz, modelMatrix[ 1 ].xyz, modelMatrix[ 2 ].xyz ) * objectNormal;\n	worldNormal = normalize( worldNormal );\n\n	vec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\n	if ( useRefract ) {\n\n		vReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\n	} else {\n\n		vReflect = reflect( cameraToVertex, worldNormal );\n\n	}\n\n#endif";THREE.ShaderChunk["shadowmap_fragment"]="#ifdef USE_SHADOWMAP\n\n	#ifdef SHADOWMAP_DEBUG\n\n		vec3 frustumColors[3];\n		frustumColors[0] = vec3( 1.0, 0.5, 0.0 );\n		frustumColors[1] = vec3( 0.0, 1.0, 0.8 );\n		frustumColors[2] = vec3( 0.0, 0.5, 1.0 );\n\n	#endif\n\n	#ifdef SHADOWMAP_CASCADE\n\n		int inFrustumCount = 0;\n\n	#endif\n\n	float fDepth;\n	vec3 shadowColor = vec3( 1.0 );\n\n	for( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n		vec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\n\n				// if ( something && something ) breaks ATI OpenGL shader compiler\n				// if ( all( something, something ) ) using this instead\n\n		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n		bool inFrustum = all( inFrustumVec );\n\n				// don't shadow pixels outside of light frustum\n				// use just first frustum (for cascades)\n				// don't shadow pixels behind far plane of light frustum\n\n		#ifdef SHADOWMAP_CASCADE\n\n			inFrustumCount += int( inFrustum );\n			bvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );\n\n		#else\n\n			bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\n		#endif\n\n		bool frustumTest = all( frustumTestVec );\n\n		if ( frustumTest ) {\n\n			shadowCoord.z += shadowBias[ i ];\n\n			#if defined( SHADOWMAP_TYPE_PCF )\n\n						// Percentage-close filtering\n						// (9 pixel kernel)\n						// http://fabiensanglard.net/shadowmappingPCF/\n\n				float shadow = 0.0;\n\n		/*\n						// nested loops breaks shader compiler / validator on some ATI cards when using OpenGL\n						// must enroll loop manually\n\n				for ( float y = -1.25; y <= 1.25; y += 1.25 )\n					for ( float x = -1.25; x <= 1.25; x += 1.25 ) {\n\n						vec4 rgbaDepth = texture2D( shadowMap[ i ], vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy );\n\n								// doesn't seem to produce any noticeable visual difference compared to simple texture2D lookup\n								//vec4 rgbaDepth = texture2DProj( shadowMap[ i ], vec4( vShadowCoord[ i ].w * ( vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy ), 0.05, vShadowCoord[ i ].w ) );\n\n						float fDepth = unpackDepth( rgbaDepth );\n\n						if ( fDepth < shadowCoord.z )\n							shadow += 1.0;\n\n				}\n\n				shadow /= 9.0;\n\n		*/\n\n				const float shadowDelta = 1.0 / 9.0;\n\n				float xPixelOffset = 1.0 / shadowMapSize[ i ].x;\n				float yPixelOffset = 1.0 / shadowMapSize[ i ].y;\n\n				float dx0 = -1.25 * xPixelOffset;\n				float dy0 = -1.25 * yPixelOffset;\n				float dx1 = 1.25 * xPixelOffset;\n				float dy1 = 1.25 * yPixelOffset;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n\n			#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\n						// Percentage-close filtering\n						// (9 pixel kernel)\n						// http://fabiensanglard.net/shadowmappingPCF/\n\n				float shadow = 0.0;\n\n				float xPixelOffset = 1.0 / shadowMapSize[ i ].x;\n				float yPixelOffset = 1.0 / shadowMapSize[ i ].y;\n\n				float dx0 = -1.0 * xPixelOffset;\n				float dy0 = -1.0 * yPixelOffset;\n				float dx1 = 1.0 * xPixelOffset;\n				float dy1 = 1.0 * yPixelOffset;\n\n				mat3 shadowKernel;\n				mat3 depthKernel;\n\n				depthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n				depthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n				depthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n				depthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n				depthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n				depthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n				depthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n				depthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n				depthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n\n				vec3 shadowZ = vec3( shadowCoord.z );\n				shadowKernel[0] = vec3(lessThan(depthKernel[0], shadowZ ));\n				shadowKernel[0] *= vec3(0.25);\n\n				shadowKernel[1] = vec3(lessThan(depthKernel[1], shadowZ ));\n				shadowKernel[1] *= vec3(0.25);\n\n				shadowKernel[2] = vec3(lessThan(depthKernel[2], shadowZ ));\n				shadowKernel[2] *= vec3(0.25);\n\n				vec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );\n\n				shadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );\n				shadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );\n\n				vec4 shadowValues;\n				shadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );\n				shadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );\n				shadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );\n				shadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );\n\n				shadow = dot( shadowValues, vec4( 1.0 ) );\n\n				shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n\n			#else\n\n				vec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\n				float fDepth = unpackDepth( rgbaDepth );\n\n				if ( fDepth < shadowCoord.z )\n\n		// spot with multiple shadows is darker\n\n					shadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );\n\n		// spot with multiple shadows has the same color as single shadow spot\n\n		// 					shadowColor = min( shadowColor, vec3( shadowDarkness[ i ] ) );\n\n			#endif\n\n		}\n\n\n		#ifdef SHADOWMAP_DEBUG\n\n			#ifdef SHADOWMAP_CASCADE\n\n				if ( inFrustum && inFrustumCount == 1 ) gl_FragColor.xyz *= frustumColors[ i ];\n\n			#else\n\n				if ( inFrustum ) gl_FragColor.xyz *= frustumColors[ i ];\n\n			#endif\n\n		#endif\n\n	}\n\n	#ifdef GAMMA_OUTPUT\n\n		shadowColor *= shadowColor;\n\n	#endif\n\n	gl_FragColor.xyz = gl_FragColor.xyz * shadowColor;\n\n#endif\n";THREE.ShaderChunk["worldpos_vertex"]="#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n\n	#ifdef USE_SKINNING\n\n		vec4 worldPosition = modelMatrix * skinned;\n\n	#endif\n\n	#if defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )\n\n		vec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );\n\n	#endif\n\n	#if ! defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )\n\n		vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n\n	#endif\n\n#endif";THREE.ShaderChunk["shadowmap_pars_fragment"]="#ifdef USE_SHADOWMAP\n\n	uniform sampler2D shadowMap[ MAX_SHADOWS ];\n	uniform vec2 shadowMapSize[ MAX_SHADOWS ];\n\n	uniform float shadowDarkness[ MAX_SHADOWS ];\n	uniform float shadowBias[ MAX_SHADOWS ];\n\n	varying vec4 vShadowCoord[ MAX_SHADOWS ];\n\n	float unpackDepth( const in vec4 rgba_depth ) {\n\n		const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\n		float depth = dot( rgba_depth, bit_shift );\n		return depth;\n\n	}\n\n#endif";THREE.ShaderChunk["skinning_pars_vertex"]="#ifdef USE_SKINNING\n\n	uniform mat4 bindMatrix;\n	uniform mat4 bindMatrixInverse;\n\n	#ifdef BONE_TEXTURE\n\n		uniform sampler2D boneTexture;\n		uniform int boneTextureWidth;\n		uniform int boneTextureHeight;\n\n		mat4 getBoneMatrix( const in float i ) {\n\n			float j = i * 4.0;\n			float x = mod( j, float( boneTextureWidth ) );\n			float y = floor( j / float( boneTextureWidth ) );\n\n			float dx = 1.0 / float( boneTextureWidth );\n			float dy = 1.0 / float( boneTextureHeight );\n\n			y = dy * ( y + 0.5 );\n\n			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\n			mat4 bone = mat4( v1, v2, v3, v4 );\n\n			return bone;\n\n		}\n\n	#else\n\n		uniform mat4 boneGlobalMatrices[ MAX_BONES ];\n\n		mat4 getBoneMatrix( const in float i ) {\n\n			mat4 bone = boneGlobalMatrices[ int(i) ];\n			return bone;\n\n		}\n\n	#endif\n\n#endif\n";THREE.ShaderChunk["logdepthbuf_pars_fragment"]="#ifdef USE_LOGDEPTHBUF\n\n	uniform float logDepthBufFC;\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		#extension GL_EXT_frag_depth : enable\n		varying float vFragDepth;\n\n	#endif\n\n#endif";THREE.ShaderChunk["alphamap_fragment"]="#ifdef USE_ALPHAMAP\n\n	gl_FragColor.a *= texture2D( alphaMap, vUv ).g;\n\n#endif\n";THREE.ShaderChunk["alphamap_pars_fragment"]="#ifdef USE_ALPHAMAP\n\n	uniform sampler2D alphaMap;\n\n#endif\n";THREE.UniformsUtils={merge:function(e){var t={};for(var n=0;n<e.length;n++){var r=this.clone(e[n]);for(var i in r){t[i]=r[i]}}return t},clone:function(e){var t={};for(var n in e){t[n]={};for(var r in e[n]){var i=e[n][r];if(i instanceof THREE.Color||i instanceof THREE.Vector2||i instanceof THREE.Vector3||i instanceof THREE.Vector4||i instanceof THREE.Matrix4||i instanceof THREE.Texture){t[n][r]=i.clone()}else if(i instanceof Array){t[n][r]=i.slice()}else{t[n][r]=i}}}return t}};THREE.UniformsLib={common:{diffuse:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new THREE.Vector4(0,0,1,1)},lightMap:{type:"t",value:null},specularMap:{type:"t",value:null},alphaMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},combine:{type:"i",value:0},morphTargetInfluences:{type:"f",value:0}},bump:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new THREE.Vector2(1,1)}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}};THREE.ShaderLib={basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib["common"],THREE.UniformsLib["fog"],THREE.UniformsLib["shadowmap"]]),vertexShader:[THREE.ShaderChunk["map_pars_vertex"],THREE.ShaderChunk["lightmap_pars_vertex"],THREE.ShaderChunk["envmap_pars_vertex"],THREE.ShaderChunk["color_pars_vertex"],THREE.ShaderChunk["morphtarget_pars_vertex"],THREE.ShaderChunk["skinning_pars_vertex"],THREE.ShaderChunk["shadowmap_pars_vertex"],THREE.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",THREE.ShaderChunk["map_vertex"],THREE.ShaderChunk["lightmap_vertex"],THREE.ShaderChunk["color_vertex"],THREE.ShaderChunk["skinbase_vertex"],"	#ifdef USE_ENVMAP",THREE.ShaderChunk["morphnormal_vertex"],THREE.ShaderChunk["skinnormal_vertex"],THREE.ShaderChunk["defaultnormal_vertex"],"	#endif",THREE.ShaderChunk["morphtarget_vertex"],THREE.ShaderChunk["skinning_vertex"],THREE.ShaderChunk["default_vertex"],THREE.ShaderChunk["logdepthbuf_vertex"],THREE.ShaderChunk["worldpos_vertex"],THREE.ShaderChunk["envmap_vertex"],THREE.ShaderChunk["shadowmap_vertex"],"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;",THREE.ShaderChunk["color_pars_fragment"],THREE.ShaderChunk["map_pars_fragment"],THREE.ShaderChunk["alphamap_pars_fragment"],THREE.ShaderChunk["lightmap_pars_fragment"],THREE.ShaderChunk["envmap_pars_fragment"],THREE.ShaderChunk["fog_pars_fragment"],THREE.ShaderChunk["shadowmap_pars_fragment"],THREE.ShaderChunk["specularmap_pars_fragment"],THREE.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","	gl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk["logdepthbuf_fragment"],THREE.ShaderChunk["map_fragment"],THREE.ShaderChunk["alphamap_fragment"],THREE.ShaderChunk["alphatest_fragment"],THREE.ShaderChunk["specularmap_fragment"],THREE.ShaderChunk["lightmap_fragment"],THREE.ShaderChunk["color_fragment"],THREE.ShaderChunk["envmap_fragment"],THREE.ShaderChunk["shadowmap_fragment"],THREE.ShaderChunk["linear_to_gamma_fragment"],THREE.ShaderChunk["fog_fragment"],"}"].join("\n")},lambert:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib["common"],THREE.UniformsLib["fog"],THREE.UniformsLib["lights"],THREE.UniformsLib["shadowmap"],{ambient:{type:"c",value:new THREE.Color(16777215)},emissive:{type:"c",value:new THREE.Color(0)},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),vertexShader:["#define LAMBERT","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","#endif",THREE.ShaderChunk["map_pars_vertex"],THREE.ShaderChunk["lightmap_pars_vertex"],THREE.ShaderChunk["envmap_pars_vertex"],THREE.ShaderChunk["lights_lambert_pars_vertex"],THREE.ShaderChunk["color_pars_vertex"],THREE.ShaderChunk["morphtarget_pars_vertex"],THREE.ShaderChunk["skinning_pars_vertex"],THREE.ShaderChunk["shadowmap_pars_vertex"],THREE.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",THREE.ShaderChunk["map_vertex"],THREE.ShaderChunk["lightmap_vertex"],THREE.ShaderChunk["color_vertex"],THREE.ShaderChunk["morphnormal_vertex"],THREE.ShaderChunk["skinbase_vertex"],THREE.ShaderChunk["skinnormal_vertex"],THREE.ShaderChunk["defaultnormal_vertex"],THREE.ShaderChunk["morphtarget_vertex"],THREE.ShaderChunk["skinning_vertex"],THREE.ShaderChunk["default_vertex"],THREE.ShaderChunk["logdepthbuf_vertex"],THREE.ShaderChunk["worldpos_vertex"],THREE.ShaderChunk["envmap_vertex"],THREE.ShaderChunk["lights_lambert_vertex"],THREE.ShaderChunk["shadowmap_vertex"],"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","#endif",THREE.ShaderChunk["color_pars_fragment"],THREE.ShaderChunk["map_pars_fragment"],THREE.ShaderChunk["alphamap_pars_fragment"],THREE.ShaderChunk["lightmap_pars_fragment"],THREE.ShaderChunk["envmap_pars_fragment"],THREE.ShaderChunk["fog_pars_fragment"],THREE.ShaderChunk["shadowmap_pars_fragment"],THREE.ShaderChunk["specularmap_pars_fragment"],THREE.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","	gl_FragColor = vec4( vec3( 1.0 ), opacity );",THREE.ShaderChunk["logdepthbuf_fragment"],THREE.ShaderChunk["map_fragment"],THREE.ShaderChunk["alphamap_fragment"],THREE.ShaderChunk["alphatest_fragment"],THREE.ShaderChunk["specularmap_fragment"],"	#ifdef DOUBLE_SIDED","		if ( gl_FrontFacing )","			gl_FragColor.xyz *= vLightFront;","		else","			gl_FragColor.xyz *= vLightBack;","	#else","		gl_FragColor.xyz *= vLightFront;","	#endif",THREE.ShaderChunk["lightmap_fragment"],THREE.ShaderChunk["color_fragment"],THREE.ShaderChunk["envmap_fragment"],THREE.ShaderChunk["shadowmap_fragment"],THREE.ShaderChunk["linear_to_gamma_fragment"],THREE.ShaderChunk["fog_fragment"],"}"].join("\n")},phong:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib["common"],THREE.UniformsLib["bump"],THREE.UniformsLib["normalmap"],THREE.UniformsLib["fog"],THREE.UniformsLib["lights"],THREE.UniformsLib["shadowmap"],{ambient:{type:"c",value:new THREE.Color(16777215)},emissive:{type:"c",value:new THREE.Color(0)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),vertexShader:["#define PHONG","varying vec3 vViewPosition;","varying vec3 vNormal;",THREE.ShaderChunk["map_pars_vertex"],THREE.ShaderChunk["lightmap_pars_vertex"],THREE.ShaderChunk["envmap_pars_vertex"],THREE.ShaderChunk["lights_phong_pars_vertex"],THREE.ShaderChunk["color_pars_vertex"],THREE.ShaderChunk["morphtarget_pars_vertex"],THREE.ShaderChunk["skinning_pars_vertex"],THREE.ShaderChunk["shadowmap_pars_vertex"],THREE.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",THREE.ShaderChunk["map_vertex"],THREE.ShaderChunk["lightmap_vertex"],THREE.ShaderChunk["color_vertex"],THREE.ShaderChunk["morphnormal_vertex"],THREE.ShaderChunk["skinbase_vertex"],THREE.ShaderChunk["skinnormal_vertex"],THREE.ShaderChunk["defaultnormal_vertex"],"	vNormal = normalize( transformedNormal );",THREE.ShaderChunk["morphtarget_vertex"],THREE.ShaderChunk["skinning_vertex"],THREE.ShaderChunk["default_vertex"],THREE.ShaderChunk["logdepthbuf_vertex"],"	vViewPosition = -mvPosition.xyz;",THREE.ShaderChunk["worldpos_vertex"],THREE.ShaderChunk["envmap_vertex"],THREE.ShaderChunk["lights_phong_vertex"],THREE.ShaderChunk["shadowmap_vertex"],"}"].join("\n"),fragmentShader:["#define PHONG","uniform vec3 diffuse;","uniform float opacity;","uniform vec3 ambient;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;",THREE.ShaderChunk["color_pars_fragment"],THREE.ShaderChunk["map_pars_fragment"],THREE.ShaderChunk["alphamap_pars_fragment"],THREE.ShaderChunk["lightmap_pars_fragment"],THREE.ShaderChunk["envmap_pars_fragment"],THREE.ShaderChunk["fog_pars_fragment"],THREE.ShaderChunk["lights_phong_pars_fragment"],THREE.ShaderChunk["shadowmap_pars_fragment"],THREE.ShaderChunk["bumpmap_pars_fragment"],THREE.ShaderChunk["normalmap_pars_fragment"],THREE.ShaderChunk["specularmap_pars_fragment"],THREE.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","	gl_FragColor = vec4( vec3( 1.0 ), opacity );",THREE.ShaderChunk["logdepthbuf_fragment"],THREE.ShaderChunk["map_fragment"],THREE.ShaderChunk["alphamap_fragment"],THREE.ShaderChunk["alphatest_fragment"],THREE.ShaderChunk["specularmap_fragment"],THREE.ShaderChunk["lights_phong_fragment"],THREE.ShaderChunk["lightmap_fragment"],THREE.ShaderChunk["color_fragment"],THREE.ShaderChunk["envmap_fragment"],THREE.ShaderChunk["shadowmap_fragment"],THREE.ShaderChunk["linear_to_gamma_fragment"],THREE.ShaderChunk["fog_fragment"],"}"].join("\n")},particle_basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib["particle"],THREE.UniformsLib["shadowmap"]]),vertexShader:["uniform float size;","uniform float scale;",THREE.ShaderChunk["color_pars_vertex"],THREE.ShaderChunk["shadowmap_pars_vertex"],THREE.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",THREE.ShaderChunk["color_vertex"],"	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","	#ifdef USE_SIZEATTENUATION","		gl_PointSize = size * ( scale / length( mvPosition.xyz ) );","	#else","		gl_PointSize = size;","	#endif","	gl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk["logdepthbuf_vertex"],THREE.ShaderChunk["worldpos_vertex"],THREE.ShaderChunk["shadowmap_vertex"],"}"].join("\n"),fragmentShader:["uniform vec3 psColor;","uniform float opacity;",THREE.ShaderChunk["color_pars_fragment"],THREE.ShaderChunk["map_particle_pars_fragment"],THREE.ShaderChunk["fog_pars_fragment"],THREE.ShaderChunk["shadowmap_pars_fragment"],THREE.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","	gl_FragColor = vec4( psColor, opacity );",THREE.ShaderChunk["logdepthbuf_fragment"],THREE.ShaderChunk["map_particle_fragment"],THREE.ShaderChunk["alphatest_fragment"],THREE.ShaderChunk["color_fragment"],THREE.ShaderChunk["shadowmap_fragment"],THREE.ShaderChunk["fog_fragment"],"}"].join("\n")},dashed:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib["common"],THREE.UniformsLib["fog"],{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:["uniform float scale;","attribute float lineDistance;","varying float vLineDistance;",THREE.ShaderChunk["color_pars_vertex"],THREE.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",THREE.ShaderChunk["color_vertex"],"	vLineDistance = scale * lineDistance;","	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","	gl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk["logdepthbuf_vertex"],"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform float dashSize;","uniform float totalSize;","varying float vLineDistance;",THREE.ShaderChunk["color_pars_fragment"],THREE.ShaderChunk["fog_pars_fragment"],THREE.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","	if ( mod( vLineDistance, totalSize ) > dashSize ) {","		discard;","	}","	gl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk["logdepthbuf_fragment"],THREE.ShaderChunk["color_fragment"],THREE.ShaderChunk["fog_fragment"],"}"].join("\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:[THREE.ShaderChunk["morphtarget_pars_vertex"],THREE.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",THREE.ShaderChunk["morphtarget_vertex"],THREE.ShaderChunk["default_vertex"],THREE.ShaderChunk["logdepthbuf_vertex"],"}"].join("\n"),fragmentShader:["uniform float mNear;","uniform float mFar;","uniform float opacity;",THREE.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {",THREE.ShaderChunk["logdepthbuf_fragment"],"	#ifdef USE_LOGDEPTHBUF_EXT","		float depth = gl_FragDepthEXT / gl_FragCoord.w;","	#else","		float depth = gl_FragCoord.z / gl_FragCoord.w;","	#endif","	float color = 1.0 - smoothstep( mNear, mFar, depth );","	gl_FragColor = vec4( vec3( color ), opacity );","}"].join("\n")},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;",THREE.ShaderChunk["morphtarget_pars_vertex"],THREE.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {","	vNormal = normalize( normalMatrix * normal );",THREE.ShaderChunk["morphtarget_vertex"],THREE.ShaderChunk["default_vertex"],THREE.ShaderChunk["logdepthbuf_vertex"],"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vNormal;",THREE.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","	gl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );",THREE.ShaderChunk["logdepthbuf_fragment"],"}"].join("\n")},normalmap:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib["fog"],THREE.UniformsLib["lights"],THREE.UniformsLib["shadowmap"],{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},enableDisplacement:{type:"i",value:0},tDisplacement:{type:"t",value:null},tDiffuse:{type:"t",value:null},tCube:{type:"t",value:null},tNormal:{type:"t",value:null},tSpecular:{type:"t",value:null},tAO:{type:"t",value:null},uNormalScale:{type:"v2",value:new THREE.Vector2(1,1)},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},diffuse:{type:"c",value:new THREE.Color(16777215)},specular:{type:"c",value:new THREE.Color(1118481)},ambient:{type:"c",value:new THREE.Color(16777215)},shininess:{type:"f",value:30},opacity:{type:"f",value:1},useRefract:{type:"i",value:0},refractionRatio:{type:"f",value:.98},reflectivity:{type:"f",value:.5},uOffset:{type:"v2",value:new THREE.Vector2(0,0)},uRepeat:{type:"v2",value:new THREE.Vector2(1,1)},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),fragmentShader:["uniform vec3 ambient;","uniform vec3 diffuse;","uniform vec3 specular;","uniform float shininess;","uniform float opacity;","uniform bool enableDiffuse;","uniform bool enableSpecular;","uniform bool enableAO;","uniform bool enableReflection;","uniform sampler2D tDiffuse;","uniform sampler2D tNormal;","uniform sampler2D tSpecular;","uniform sampler2D tAO;","uniform samplerCube tCube;","uniform vec2 uNormalScale;","uniform bool useRefract;","uniform float refractionRatio;","uniform float reflectivity;","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","	uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","	uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","	uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","	uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","	uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","	uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","	uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","	uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","	uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","	uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","	uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","	uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","	uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","	uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","#endif","#ifdef WRAP_AROUND","	uniform vec3 wrapRGB;","#endif","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",THREE.ShaderChunk["shadowmap_pars_fragment"],THREE.ShaderChunk["fog_pars_fragment"],THREE.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {",THREE.ShaderChunk["logdepthbuf_fragment"],"	gl_FragColor = vec4( vec3( 1.0 ), opacity );","	vec3 specularTex = vec3( 1.0 );","	vec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;","	normalTex.xy *= uNormalScale;","	normalTex = normalize( normalTex );","	if( enableDiffuse ) {","		#ifdef GAMMA_INPUT","			vec4 texelColor = texture2D( tDiffuse, vUv );","			texelColor.xyz *= texelColor.xyz;","			gl_FragColor = gl_FragColor * texelColor;","		#else","			gl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );","		#endif","	}","	if( enableAO ) {","		#ifdef GAMMA_INPUT","			vec4 aoColor = texture2D( tAO, vUv );","			aoColor.xyz *= aoColor.xyz;","			gl_FragColor.xyz = gl_FragColor.xyz * aoColor.xyz;","		#else","			gl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;","		#endif","	}",THREE.ShaderChunk["alphatest_fragment"],"	if( enableSpecular )","		specularTex = texture2D( tSpecular, vUv ).xyz;","	mat3 tsb = mat3( normalize( vTangent ), normalize( vBinormal ), normalize( vNormal ) );","	vec3 finalNormal = tsb * normalTex;","	#ifdef FLIP_SIDED","		finalNormal = -finalNormal;","	#endif","	vec3 normal = normalize( finalNormal );","	vec3 viewPosition = normalize( vViewPosition );","	#if MAX_POINT_LIGHTS > 0","		vec3 pointDiffuse = vec3( 0.0 );","		vec3 pointSpecular = vec3( 0.0 );","		for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","			vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","			vec3 pointVector = lPosition.xyz + vViewPosition.xyz;","			float pointDistance = 1.0;","			if ( pointLightDistance[ i ] > 0.0 )","				pointDistance = 1.0 - min( ( length( pointVector ) / pointLightDistance[ i ] ), 1.0 );","			pointVector = normalize( pointVector );","			#ifdef WRAP_AROUND","				float pointDiffuseWeightFull = max( dot( normal, pointVector ), 0.0 );","				float pointDiffuseWeightHalf = max( 0.5 * dot( normal, pointVector ) + 0.5, 0.0 );","				vec3 pointDiffuseWeight = mix( vec3( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );","			#else","				float pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );","			#endif","			pointDiffuse += pointDistance * pointLightColor[ i ] * diffuse * pointDiffuseWeight;","			vec3 pointHalfVector = normalize( pointVector + viewPosition );","			float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","			float pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, shininess ), 0.0 );","			float specularNormalization = ( shininess + 2.0 ) / 8.0;","			vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( pointVector, pointHalfVector ), 0.0 ), 5.0 );","			pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance * specularNormalization;","		}","	#endif","	#if MAX_SPOT_LIGHTS > 0","		vec3 spotDiffuse = vec3( 0.0 );","		vec3 spotSpecular = vec3( 0.0 );","		for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","			vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","			vec3 spotVector = lPosition.xyz + vViewPosition.xyz;","			float spotDistance = 1.0;","			if ( spotLightDistance[ i ] > 0.0 )","				spotDistance = 1.0 - min( ( length( spotVector ) / spotLightDistance[ i ] ), 1.0 );","			spotVector = normalize( spotVector );","			float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","			if ( spotEffect > spotLightAngleCos[ i ] ) {","				spotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );","				#ifdef WRAP_AROUND","					float spotDiffuseWeightFull = max( dot( normal, spotVector ), 0.0 );","					float spotDiffuseWeightHalf = max( 0.5 * dot( normal, spotVector ) + 0.5, 0.0 );","					vec3 spotDiffuseWeight = mix( vec3( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );","				#else","					float spotDiffuseWeight = max( dot( normal, spotVector ), 0.0 );","				#endif","				spotDiffuse += spotDistance * spotLightColor[ i ] * diffuse * spotDiffuseWeight * spotEffect;","				vec3 spotHalfVector = normalize( spotVector + viewPosition );","				float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );","				float spotSpecularWeight = specularTex.r * max( pow( spotDotNormalHalf, shininess ), 0.0 );","				float specularNormalization = ( shininess + 2.0 ) / 8.0;","				vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( spotVector, spotHalfVector ), 0.0 ), 5.0 );","				spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * spotDistance * specularNormalization * spotEffect;","			}","		}","	#endif","	#if MAX_DIR_LIGHTS > 0","		vec3 dirDiffuse = vec3( 0.0 );","		vec3 dirSpecular = vec3( 0.0 );","		for( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {","			vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","			vec3 dirVector = normalize( lDirection.xyz );","			#ifdef WRAP_AROUND","				float directionalLightWeightingFull = max( dot( normal, dirVector ), 0.0 );","				float directionalLightWeightingHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );","				vec3 dirDiffuseWeight = mix( vec3( directionalLightWeightingFull ), vec3( directionalLightWeightingHalf ), wrapRGB );","			#else","				float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );","			#endif","			dirDiffuse += directionalLightColor[ i ] * diffuse * dirDiffuseWeight;","			vec3 dirHalfVector = normalize( dirVector + viewPosition );","			float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","			float dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, shininess ), 0.0 );","			float specularNormalization = ( shininess + 2.0 ) / 8.0;","			vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( dirVector, dirHalfVector ), 0.0 ), 5.0 );","			dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;","		}","	#endif","	#if MAX_HEMI_LIGHTS > 0","		vec3 hemiDiffuse = vec3( 0.0 );","		vec3 hemiSpecular = vec3( 0.0 );","		for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","			vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","			vec3 lVector = normalize( lDirection.xyz );","			float dotProduct = dot( normal, lVector );","			float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","			vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","			hemiDiffuse += diffuse * hemiColor;","			vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","			float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","			float hemiSpecularWeightSky = specularTex.r * max( pow( max( hemiDotNormalHalfSky, 0.0 ), shininess ), 0.0 );","			vec3 lVectorGround = -lVector;","			vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","			float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","			float hemiSpecularWeightGround = specularTex.r * max( pow( max( hemiDotNormalHalfGround, 0.0 ), shininess ), 0.0 );","			float dotProductGround = dot( normal, lVectorGround );","			float specularNormalization = ( shininess + 2.0 ) / 8.0;","			vec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, hemiHalfVectorSky ), 0.0 ), 5.0 );","			vec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 0.0 ), 5.0 );","			hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );","		}","	#endif","	vec3 totalDiffuse = vec3( 0.0 );","	vec3 totalSpecular = vec3( 0.0 );","	#if MAX_DIR_LIGHTS > 0","		totalDiffuse += dirDiffuse;","		totalSpecular += dirSpecular;","	#endif","	#if MAX_HEMI_LIGHTS > 0","		totalDiffuse += hemiDiffuse;","		totalSpecular += hemiSpecular;","	#endif","	#if MAX_POINT_LIGHTS > 0","		totalDiffuse += pointDiffuse;","		totalSpecular += pointSpecular;","	#endif","	#if MAX_SPOT_LIGHTS > 0","		totalDiffuse += spotDiffuse;","		totalSpecular += spotSpecular;","	#endif","	#ifdef METAL","		gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * ambient + totalSpecular );","	#else","		gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * ambient ) + totalSpecular;","	#endif","	if ( enableReflection ) {","		vec3 vReflect;","		vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );","		if ( useRefract ) {","			vReflect = refract( cameraToVertex, normal, refractionRatio );","		} else {","			vReflect = reflect( cameraToVertex, normal );","		}","		vec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );","		#ifdef GAMMA_INPUT","			cubeColor.xyz *= cubeColor.xyz;","		#endif","		gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularTex.r * reflectivity );","	}",THREE.ShaderChunk["shadowmap_fragment"],THREE.ShaderChunk["linear_to_gamma_fragment"],THREE.ShaderChunk["fog_fragment"],"}"].join("\n"),vertexShader:["attribute vec4 tangent;","uniform vec2 uOffset;","uniform vec2 uRepeat;","uniform bool enableDisplacement;","#ifdef VERTEX_TEXTURES","	uniform sampler2D tDisplacement;","	uniform float uDisplacementScale;","	uniform float uDisplacementBias;","#endif","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",THREE.ShaderChunk["skinning_pars_vertex"],THREE.ShaderChunk["shadowmap_pars_vertex"],THREE.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",THREE.ShaderChunk["skinbase_vertex"],THREE.ShaderChunk["skinnormal_vertex"],"	#ifdef USE_SKINNING","		vNormal = normalize( normalMatrix * skinnedNormal.xyz );","		vec4 skinnedTangent = skinMatrix * vec4( tangent.xyz, 0.0 );","		vTangent = normalize( normalMatrix * skinnedTangent.xyz );","	#else","		vNormal = normalize( normalMatrix * normal );","		vTangent = normalize( normalMatrix * tangent.xyz );","	#endif","	vBinormal = normalize( cross( vNormal, vTangent ) * tangent.w );","	vUv = uv * uRepeat + uOffset;","	vec3 displacedPosition;","	#ifdef VERTEX_TEXTURES","		if ( enableDisplacement ) {","			vec3 dv = texture2D( tDisplacement, uv ).xyz;","			float df = uDisplacementScale * dv.x + uDisplacementBias;","			displacedPosition = position + normalize( normal ) * df;","		} else {","			#ifdef USE_SKINNING","				vec4 skinVertex = bindMatrix * vec4( position, 1.0 );","				vec4 skinned = vec4( 0.0 );","				skinned += boneMatX * skinVertex * skinWeight.x;","				skinned += boneMatY * skinVertex * skinWeight.y;","				skinned += boneMatZ * skinVertex * skinWeight.z;","				skinned += boneMatW * skinVertex * skinWeight.w;","				skinned  = bindMatrixInverse * skinned;","				displacedPosition = skinned.xyz;","			#else","				displacedPosition = position;","			#endif","		}","	#else","		#ifdef USE_SKINNING","			vec4 skinVertex = bindMatrix * vec4( position, 1.0 );","			vec4 skinned = vec4( 0.0 );","			skinned += boneMatX * skinVertex * skinWeight.x;","			skinned += boneMatY * skinVertex * skinWeight.y;","			skinned += boneMatZ * skinVertex * skinWeight.z;","			skinned += boneMatW * skinVertex * skinWeight.w;","			skinned  = bindMatrixInverse * skinned;","			displacedPosition = skinned.xyz;","		#else","			displacedPosition = position;","		#endif","	#endif","	vec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );","	vec4 worldPosition = modelMatrix * vec4( displacedPosition, 1.0 );","	gl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk["logdepthbuf_vertex"],"	vWorldPosition = worldPosition.xyz;","	vViewPosition = -mvPosition.xyz;","	#ifdef USE_SHADOWMAP","		for( int i = 0; i < MAX_SHADOWS; i ++ ) {","			vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;","		}","	#endif","}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;",THREE.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {","	vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","	vWorldPosition = worldPosition.xyz;","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk["logdepthbuf_vertex"],"}"].join("\n"),fragmentShader:["uniform samplerCube tCube;","uniform float tFlip;","varying vec3 vWorldPosition;",THREE.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","	gl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );",THREE.ShaderChunk["logdepthbuf_fragment"],"}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[THREE.ShaderChunk["morphtarget_pars_vertex"],THREE.ShaderChunk["skinning_pars_vertex"],THREE.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",THREE.ShaderChunk["skinbase_vertex"],THREE.ShaderChunk["morphtarget_vertex"],THREE.ShaderChunk["skinning_vertex"],THREE.ShaderChunk["default_vertex"],THREE.ShaderChunk["logdepthbuf_vertex"],"}"].join("\n"),fragmentShader:[THREE.ShaderChunk["logdepthbuf_pars_fragment"],"vec4 pack_depth( const in float depth ) {","	const vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );","	const vec4 bit_mask = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );","	vec4 res = mod( depth * bit_shift * vec4( 255 ), vec4( 256 ) ) / vec4( 255 );","	res -= res.xxyz * bit_mask;","	return res;","}","void main() {",THREE.ShaderChunk["logdepthbuf_fragment"],"	#ifdef USE_LOGDEPTHBUF_EXT","		gl_FragData[ 0 ] = pack_depth( gl_FragDepthEXT );","	#else","		gl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );","	#endif","}"].join("\n")}};THREE.WebGLRenderer=function(e){function st(){tt.clearColor(0,0,0,1);tt.clearDepth(1);tt.clearStencil(0);tt.enable(tt.DEPTH_TEST);tt.depthFunc(tt.LEQUAL);tt.frontFace(tt.CCW);tt.cullFace(tt.BACK);tt.enable(tt.CULL_FACE);tt.enable(tt.BLEND);tt.blendEquation(tt.FUNC_ADD);tt.blendFunc(tt.SRC_ALPHA,tt.ONE_MINUS_SRC_ALPHA);tt.viewport(q,R,U,z);tt.clearColor(c.r,c.g,c.b,h)}function Tt(e){e.__webglVertexBuffer=tt.createBuffer();e.__webglColorBuffer=tt.createBuffer();w.info.memory.geometries++}function Nt(e){e.__webglVertexBuffer=tt.createBuffer();e.__webglColorBuffer=tt.createBuffer();e.__webglLineDistanceBuffer=tt.createBuffer();w.info.memory.geometries++}function Ct(e){e.__webglVertexBuffer=tt.createBuffer();e.__webglNormalBuffer=tt.createBuffer();e.__webglTangentBuffer=tt.createBuffer();e.__webglColorBuffer=tt.createBuffer();e.__webglUVBuffer=tt.createBuffer();e.__webglUV2Buffer=tt.createBuffer();e.__webglSkinIndicesBuffer=tt.createBuffer();e.__webglSkinWeightsBuffer=tt.createBuffer();e.__webglFaceBuffer=tt.createBuffer();e.__webglLineBuffer=tt.createBuffer();var t,n;if(e.numMorphTargets){e.__webglMorphTargetsBuffers=[];for(t=0,n=e.numMorphTargets;t<n;t++){e.__webglMorphTargetsBuffers.push(tt.createBuffer())}}if(e.numMorphNormals){e.__webglMorphNormalsBuffers=[];for(t=0,n=e.numMorphNormals;t<n;t++){e.__webglMorphNormalsBuffers.push(tt.createBuffer())}}w.info.memory.geometries++}function jt(e){var t=e.geometry;var n=e.material;var r=t.vertices.length;if(n.attributes){if(t.__webglCustomAttributesList===undefined){t.__webglCustomAttributesList=[]}for(var i in n.attributes){var s=n.attributes[i];if(!s.__webglInitialized||s.createUniqueBuffers){s.__webglInitialized=true;var o=1;if(s.type==="v2")o=2;else if(s.type==="v3")o=3;else if(s.type==="v4")o=4;else if(s.type==="c")o=3;s.size=o;s.array=new Float32Array(r*o);s.buffer=tt.createBuffer();s.buffer.belongsToAttribute=i;s.needsUpdate=true}t.__webglCustomAttributesList.push(s)}}}function Ft(e,t){var n=e.vertices.length;e.__vertexArray=new Float32Array(n*3);e.__colorArray=new Float32Array(n*3);e.__sortArray=[];e.__webglParticleCount=n;jt(t)}function It(e,t){var n=e.vertices.length;e.__vertexArray=new Float32Array(n*3);e.__colorArray=new Float32Array(n*3);e.__lineDistanceArray=new Float32Array(n*1);e.__webglLineCount=n;jt(t)}function qt(e,t){var n=t.geometry,r=e.faces3,i=r.length*3,s=r.length*1,o=r.length*3,u=Rt(t,e);e.__vertexArray=new Float32Array(i*3);e.__normalArray=new Float32Array(i*3);e.__colorArray=new Float32Array(i*3);e.__uvArray=new Float32Array(i*2);if(n.faceVertexUvs.length>1){e.__uv2Array=new Float32Array(i*2)}if(n.hasTangents){e.__tangentArray=new Float32Array(i*4)}if(t.geometry.skinWeights.length&&t.geometry.skinIndices.length){e.__skinIndexArray=new Float32Array(i*4);e.__skinWeightArray=new Float32Array(i*4)}var a=it.get("OES_element_index_uint")!==null&&s>21845?Uint32Array:Uint16Array;e.__typeArray=a;e.__faceArray=new a(s*3);e.__lineArray=new a(o*2);var f,l;if(e.numMorphTargets){e.__morphTargetsArrays=[];for(f=0,l=e.numMorphTargets;f<l;f++){e.__morphTargetsArrays.push(new Float32Array(i*3))}}if(e.numMorphNormals){e.__morphNormalsArrays=[];for(f=0,l=e.numMorphNormals;f<l;f++){e.__morphNormalsArrays.push(new Float32Array(i*3))}}e.__webglFaceCount=s*3;e.__webglLineCount=o*2;if(u.attributes){if(e.__webglCustomAttributesList===undefined){e.__webglCustomAttributesList=[]}for(var c in u.attributes){var h=u.attributes[c];var p={};for(var d in h){p[d]=h[d]}if(!p.__webglInitialized||p.createUniqueBuffers){p.__webglInitialized=true;var v=1;if(p.type==="v2")v=2;else if(p.type==="v3")v=3;else if(p.type==="v4")v=4;else if(p.type==="c")v=3;p.size=v;p.array=new Float32Array(i*v);p.buffer=tt.createBuffer();p.buffer.belongsToAttribute=c;h.needsUpdate=true;p.__original=h}e.__webglCustomAttributesList.push(p)}}e.__inittedArrays=true}function Rt(e,t){return e.material instanceof THREE.MeshFaceMaterial?e.material.materials[t.materialIndex]:e.material}function Ut(e){return e&&e.shading!==undefined&&e.shading===THREE.SmoothShading}function zt(e,t,n){var r,i,s,o,u,a,f=e.vertices,l=f.length,c=e.colors,h=c.length,p=e.__vertexArray,d=e.__colorArray,v=e.__sortArray,m=e.verticesNeedUpdate,g=e.elementsNeedUpdate,y=e.colorsNeedUpdate,b=e.__webglCustomAttributesList,w,E,S,x,T,N,C;if(n.sortParticles){Q.copy(K);Q.multiply(n.matrixWorld);for(r=0;r<l;r++){s=f[r];G.copy(s);G.applyProjection(Q);v[r]=[G.z,r]}v.sort(en);for(r=0;r<l;r++){s=f[v[r][1]];o=r*3;p[o]=s.x;p[o+1]=s.y;p[o+2]=s.z}for(i=0;i<h;i++){o=i*3;a=c[v[i][1]];d[o]=a.r;d[o+1]=a.g;d[o+2]=a.b}if(b){for(w=0,E=b.length;w<E;w++){C=b[w];if(!(C.boundTo===undefined||C.boundTo==="vertices"))continue;o=0;T=C.value.length;if(C.size===1){for(x=0;x<T;x++){u=v[x][1];C.array[x]=C.value[u]}}else if(C.size===2){for(x=0;x<T;x++){u=v[x][1];N=C.value[u];C.array[o]=N.x;C.array[o+1]=N.y;o+=2}}else if(C.size===3){if(C.type==="c"){for(x=0;x<T;x++){u=v[x][1];N=C.value[u];C.array[o]=N.r;C.array[o+1]=N.g;C.array[o+2]=N.b;o+=3}}else{for(x=0;x<T;x++){u=v[x][1];N=C.value[u];C.array[o]=N.x;C.array[o+1]=N.y;C.array[o+2]=N.z;o+=3}}}else if(C.size===4){for(x=0;x<T;x++){u=v[x][1];N=C.value[u];C.array[o]=N.x;C.array[o+1]=N.y;C.array[o+2]=N.z;C.array[o+3]=N.w;o+=4}}}}}else{if(m){for(r=0;r<l;r++){s=f[r];o=r*3;p[o]=s.x;p[o+1]=s.y;p[o+2]=s.z}}if(y){for(i=0;i<h;i++){a=c[i];o=i*3;d[o]=a.r;d[o+1]=a.g;d[o+2]=a.b}}if(b){for(w=0,E=b.length;w<E;w++){C=b[w];if(C.needsUpdate&&(C.boundTo===undefined||C.boundTo==="vertices")){T=C.value.length;o=0;if(C.size===1){for(x=0;x<T;x++){C.array[x]=C.value[x]}}else if(C.size===2){for(x=0;x<T;x++){N=C.value[x];C.array[o]=N.x;C.array[o+1]=N.y;o+=2}}else if(C.size===3){if(C.type==="c"){for(x=0;x<T;x++){N=C.value[x];C.array[o]=N.r;C.array[o+1]=N.g;C.array[o+2]=N.b;o+=3}}else{for(x=0;x<T;x++){N=C.value[x];C.array[o]=N.x;C.array[o+1]=N.y;C.array[o+2]=N.z;o+=3}}}else if(C.size===4){for(x=0;x<T;x++){N=C.value[x];C.array[o]=N.x;C.array[o+1]=N.y;C.array[o+2]=N.z;C.array[o+3]=N.w;o+=4}}}}}}if(m||n.sortParticles){tt.bindBuffer(tt.ARRAY_BUFFER,e.__webglVertexBuffer);tt.bufferData(tt.ARRAY_BUFFER,p,t)}if(y||n.sortParticles){tt.bindBuffer(tt.ARRAY_BUFFER,e.__webglColorBuffer);tt.bufferData(tt.ARRAY_BUFFER,d,t)}if(b){for(w=0,E=b.length;w<E;w++){C=b[w];if(C.needsUpdate||n.sortParticles){tt.bindBuffer(tt.ARRAY_BUFFER,C.buffer);tt.bufferData(tt.ARRAY_BUFFER,C.array,t)}}}}function Wt(e,t){var n,r,i,s,o,u,a=e.vertices,f=e.colors,l=e.lineDistances,c=a.length,h=f.length,p=l.length,d=e.__vertexArray,v=e.__colorArray,m=e.__lineDistanceArray,g=e.verticesNeedUpdate,y=e.colorsNeedUpdate,b=e.lineDistancesNeedUpdate,w=e.__webglCustomAttributesList,E,S,x,T,N,C,k;if(g){for(n=0;n<c;n++){s=a[n];o=n*3;d[o]=s.x;d[o+1]=s.y;d[o+2]=s.z}tt.bindBuffer(tt.ARRAY_BUFFER,e.__webglVertexBuffer);tt.bufferData(tt.ARRAY_BUFFER,d,t)}if(y){for(r=0;r<h;r++){u=f[r];o=r*3;v[o]=u.r;v[o+1]=u.g;v[o+2]=u.b}tt.bindBuffer(tt.ARRAY_BUFFER,e.__webglColorBuffer);tt.bufferData(tt.ARRAY_BUFFER,v,t)}if(b){for(i=0;i<p;i++){m[i]=l[i]}tt.bindBuffer(tt.ARRAY_BUFFER,e.__webglLineDistanceBuffer);tt.bufferData(tt.ARRAY_BUFFER,m,t)}if(w){for(E=0,S=w.length;E<S;E++){k=w[E];if(k.needsUpdate&&(k.boundTo===undefined||k.boundTo==="vertices")){o=0;N=k.value.length;if(k.size===1){for(T=0;T<N;T++){k.array[T]=k.value[T]}}else if(k.size===2){for(T=0;T<N;T++){C=k.value[T];k.array[o]=C.x;k.array[o+1]=C.y;o+=2}}else if(k.size===3){if(k.type==="c"){for(T=0;T<N;T++){C=k.value[T];k.array[o]=C.r;k.array[o+1]=C.g;k.array[o+2]=C.b;o+=3}}else{for(T=0;T<N;T++){C=k.value[T];k.array[o]=C.x;k.array[o+1]=C.y;k.array[o+2]=C.z;o+=3}}}else if(k.size===4){for(T=0;T<N;T++){C=k.value[T];k.array[o]=C.x;k.array[o+1]=C.y;k.array[o+2]=C.z;k.array[o+3]=C.w;o+=4}}tt.bindBuffer(tt.ARRAY_BUFFER,k.buffer);tt.bufferData(tt.ARRAY_BUFFER,k.array,t)}}}}function Xt(e,t,n,r,i){if(!e.__inittedArrays){return}var s=Ut(i);var o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U,z,W,X,V,$,J,K,Q,G,Y,Z,et,nt,rt,it,st,ot,ut,at,ft,lt=0,ct=0,ht=0,pt=0,dt=0,vt=0,mt=0,gt=0,yt=0,bt=0,wt=0,Et=0,St=0,xt,Tt=e.__vertexArray,Nt=e.__uvArray,Ct=e.__uv2Array,kt=e.__normalArray,Lt=e.__tangentArray,At=e.__colorArray,Ot=e.__skinIndexArray,Mt=e.__skinWeightArray,_t=e.__morphTargetsArrays,Dt=e.__morphNormalsArrays,Pt=e.__webglCustomAttributesList,Ht,Bt=e.__faceArray,jt=e.__lineArray,Ft=t.geometry,It=Ft.verticesNeedUpdate,qt=Ft.elementsNeedUpdate,Rt=Ft.uvsNeedUpdate,zt=Ft.normalsNeedUpdate,Wt=Ft.tangentsNeedUpdate,Xt=Ft.colorsNeedUpdate,Vt=Ft.morphTargetsNeedUpdate,$t=Ft.vertices,Jt=e.faces3,Kt=Ft.faces,Qt=Ft.faceVertexUvs[0],Gt=Ft.faceVertexUvs[1],Yt=Ft.colors,Zt=Ft.skinIndices,en=Ft.skinWeights,tn=Ft.morphTargets,nn=Ft.morphNormals;if(It){for(o=0,u=Jt.length;o<u;o++){f=Kt[Jt[o]];y=$t[f.a];b=$t[f.b];w=$t[f.c];Tt[ct]=y.x;Tt[ct+1]=y.y;Tt[ct+2]=y.z;Tt[ct+3]=b.x;Tt[ct+4]=b.y;Tt[ct+5]=b.z;Tt[ct+6]=w.x;Tt[ct+7]=w.y;Tt[ct+8]=w.z;ct+=9}tt.bindBuffer(tt.ARRAY_BUFFER,e.__webglVertexBuffer);tt.bufferData(tt.ARRAY_BUFFER,Tt,n)}if(Vt){for(rt=0,it=tn.length;rt<it;rt++){wt=0;for(o=0,u=Jt.length;o<u;o++){ut=Jt[o];f=Kt[ut];y=tn[rt].vertices[f.a];b=tn[rt].vertices[f.b];w=tn[rt].vertices[f.c];st=_t[rt];st[wt]=y.x;st[wt+1]=y.y;st[wt+2]=y.z;st[wt+3]=b.x;st[wt+4]=b.y;st[wt+5]=b.z;st[wt+6]=w.x;st[wt+7]=w.y;st[wt+8]=w.z;if(i.morphNormals){if(s){at=nn[rt].vertexNormals[ut];C=at.a;k=at.b;L=at.c}else{C=nn[rt].faceNormals[ut];k=C;L=C}ot=Dt[rt];ot[wt]=C.x;ot[wt+1]=C.y;ot[wt+2]=C.z;ot[wt+3]=k.x;ot[wt+4]=k.y;ot[wt+5]=k.z;ot[wt+6]=L.x;ot[wt+7]=L.y;ot[wt+8]=L.z}wt+=9}tt.bindBuffer(tt.ARRAY_BUFFER,e.__webglMorphTargetsBuffers[rt]);tt.bufferData(tt.ARRAY_BUFFER,_t[rt],n);if(i.morphNormals){tt.bindBuffer(tt.ARRAY_BUFFER,e.__webglMorphNormalsBuffers[rt]);tt.bufferData(tt.ARRAY_BUFFER,Dt[rt],n)}}}if(en.length){for(o=0,u=Jt.length;o<u;o++){f=Kt[Jt[o]];D=en[f.a];P=en[f.b];H=en[f.c];Mt[bt]=D.x;Mt[bt+1]=D.y;Mt[bt+2]=D.z;Mt[bt+3]=D.w;Mt[bt+4]=P.x;Mt[bt+5]=P.y;Mt[bt+6]=P.z;Mt[bt+7]=P.w;Mt[bt+8]=H.x;Mt[bt+9]=H.y;Mt[bt+10]=H.z;Mt[bt+11]=H.w;j=Zt[f.a];F=Zt[f.b];I=Zt[f.c];Ot[bt]=j.x;Ot[bt+1]=j.y;Ot[bt+2]=j.z;Ot[bt+3]=j.w;Ot[bt+4]=F.x;Ot[bt+5]=F.y;Ot[bt+6]=F.z;Ot[bt+7]=F.w;Ot[bt+8]=I.x;Ot[bt+9]=I.y;Ot[bt+10]=I.z;Ot[bt+11]=I.w;bt+=12}if(bt>0){tt.bindBuffer(tt.ARRAY_BUFFER,e.__webglSkinIndicesBuffer);tt.bufferData(tt.ARRAY_BUFFER,Ot,n);tt.bindBuffer(tt.ARRAY_BUFFER,e.__webglSkinWeightsBuffer);tt.bufferData(tt.ARRAY_BUFFER,Mt,n)}}if(Xt){for(o=0,u=Jt.length;o<u;o++){f=Kt[Jt[o]];p=f.vertexColors;d=f.color;if(p.length===3&&i.vertexColors===THREE.VertexColors){O=p[0];M=p[1];_=p[2]}else{O=d;M=d;_=d}At[yt]=O.r;At[yt+1]=O.g;At[yt+2]=O.b;At[yt+3]=M.r;At[yt+4]=M.g;At[yt+5]=M.b;At[yt+6]=_.r;At[yt+7]=_.g;At[yt+8]=_.b;yt+=9}if(yt>0){tt.bindBuffer(tt.ARRAY_BUFFER,e.__webglColorBuffer);tt.bufferData(tt.ARRAY_BUFFER,At,n)}}if(Wt&&Ft.hasTangents){for(o=0,u=Jt.length;o<u;o++){f=Kt[Jt[o]];v=f.vertexTangents;S=v[0];x=v[1];T=v[2];Lt[mt]=S.x;Lt[mt+1]=S.y;Lt[mt+2]=S.z;Lt[mt+3]=S.w;Lt[mt+4]=x.x;Lt[mt+5]=x.y;Lt[mt+6]=x.z;Lt[mt+7]=x.w;Lt[mt+8]=T.x;Lt[mt+9]=T.y;Lt[mt+10]=T.z;Lt[mt+11]=T.w;mt+=12}tt.bindBuffer(tt.ARRAY_BUFFER,e.__webglTangentBuffer);tt.bufferData(tt.ARRAY_BUFFER,Lt,n)}if(zt){for(o=0,u=Jt.length;o<u;o++){f=Kt[Jt[o]];l=f.vertexNormals;c=f.normal;if(l.length===3&&s){for(G=0;G<3;G++){Z=l[G];kt[vt]=Z.x;kt[vt+1]=Z.y;kt[vt+2]=Z.z;vt+=3}}else{for(G=0;G<3;G++){kt[vt]=c.x;kt[vt+1]=c.y;kt[vt+2]=c.z;vt+=3}}}tt.bindBuffer(tt.ARRAY_BUFFER,e.__webglNormalBuffer);tt.bufferData(tt.ARRAY_BUFFER,kt,n)}if(Rt&&Qt){for(o=0,u=Jt.length;o<u;o++){a=Jt[o];m=Qt[a];if(m===undefined)continue;for(G=0;G<3;G++){et=m[G];Nt[ht]=et.x;Nt[ht+1]=et.y;ht+=2}}if(ht>0){tt.bindBuffer(tt.ARRAY_BUFFER,e.__webglUVBuffer);tt.bufferData(tt.ARRAY_BUFFER,Nt,n)}}if(Rt&&Gt){for(o=0,u=Jt.length;o<u;o++){a=Jt[o];g=Gt[a];if(g===undefined)continue;for(G=0;G<3;G++){nt=g[G];Ct[pt]=nt.x;Ct[pt+1]=nt.y;pt+=2}}if(pt>0){tt.bindBuffer(tt.ARRAY_BUFFER,e.__webglUV2Buffer);tt.bufferData(tt.ARRAY_BUFFER,Ct,n)}}if(qt){for(o=0,u=Jt.length;o<u;o++){Bt[dt]=lt;Bt[dt+1]=lt+1;Bt[dt+2]=lt+2;dt+=3;jt[gt]=lt;jt[gt+1]=lt+1;jt[gt+2]=lt;jt[gt+3]=lt+2;jt[gt+4]=lt+1;jt[gt+5]=lt+2;gt+=6;lt+=3}tt.bindBuffer(tt.ELEMENT_ARRAY_BUFFER,e.__webglFaceBuffer);tt.bufferData(tt.ELEMENT_ARRAY_BUFFER,Bt,n);tt.bindBuffer(tt.ELEMENT_ARRAY_BUFFER,e.__webglLineBuffer);tt.bufferData(tt.ELEMENT_ARRAY_BUFFER,jt,n)}if(Pt){for(G=0,Y=Pt.length;G<Y;G++){Ht=Pt[G];if(!Ht.__original.needsUpdate)continue;Et=0;St=0;if(Ht.size===1){if(Ht.boundTo===undefined||Ht.boundTo==="vertices"){for(o=0,u=Jt.length;o<u;o++){f=Kt[Jt[o]];Ht.array[Et]=Ht.value[f.a];Ht.array[Et+1]=Ht.value[f.b];Ht.array[Et+2]=Ht.value[f.c];Et+=3}}else if(Ht.boundTo==="faces"){for(o=0,u=Jt.length;o<u;o++){xt=Ht.value[Jt[o]];Ht.array[Et]=xt;Ht.array[Et+1]=xt;Ht.array[Et+2]=xt;Et+=3}}}else if(Ht.size===2){if(Ht.boundTo===undefined||Ht.boundTo==="vertices"){for(o=0,u=Jt.length;o<u;o++){f=Kt[Jt[o]];y=Ht.value[f.a];b=Ht.value[f.b];w=Ht.value[f.c];Ht.array[Et]=y.x;Ht.array[Et+1]=y.y;Ht.array[Et+2]=b.x;Ht.array[Et+3]=b.y;Ht.array[Et+4]=w.x;Ht.array[Et+5]=w.y;Et+=6}}else if(Ht.boundTo==="faces"){for(o=0,u=Jt.length;o<u;o++){xt=Ht.value[Jt[o]];y=xt;b=xt;w=xt;Ht.array[Et]=y.x;Ht.array[Et+1]=y.y;Ht.array[Et+2]=b.x;Ht.array[Et+3]=b.y;Ht.array[Et+4]=w.x;Ht.array[Et+5]=w.y;Et+=6}}}else if(Ht.size===3){var rn;if(Ht.type==="c"){rn=["r","g","b"]}else{rn=["x","y","z"]}if(Ht.boundTo===undefined||Ht.boundTo==="vertices"){for(o=0,u=Jt.length;o<u;o++){f=Kt[Jt[o]];y=Ht.value[f.a];b=Ht.value[f.b];w=Ht.value[f.c];Ht.array[Et]=y[rn[0]];Ht.array[Et+1]=y[rn[1]];Ht.array[Et+2]=y[rn[2]];Ht.array[Et+3]=b[rn[0]];Ht.array[Et+4]=b[rn[1]];Ht.array[Et+5]=b[rn[2]];Ht.array[Et+6]=w[rn[0]];Ht.array[Et+7]=w[rn[1]];Ht.array[Et+8]=w[rn[2]];Et+=9}}else if(Ht.boundTo==="faces"){for(o=0,u=Jt.length;o<u;o++){xt=Ht.value[Jt[o]];y=xt;b=xt;w=xt;Ht.array[Et]=y[rn[0]];Ht.array[Et+1]=y[rn[1]];Ht.array[Et+2]=y[rn[2]];Ht.array[Et+3]=b[rn[0]];Ht.array[Et+4]=b[rn[1]];Ht.array[Et+5]=b[rn[2]];Ht.array[Et+6]=w[rn[0]];Ht.array[Et+7]=w[rn[1]];Ht.array[Et+8]=w[rn[2]];Et+=9}}else if(Ht.boundTo==="faceVertices"){for(o=0,u=Jt.length;o<u;o++){xt=Ht.value[Jt[o]];y=xt[0];b=xt[1];w=xt[2];Ht.array[Et]=y[rn[0]];Ht.array[Et+1]=y[rn[1]];Ht.array[Et+2]=y[rn[2]];Ht.array[Et+3]=b[rn[0]];Ht.array[Et+4]=b[rn[1]];Ht.array[Et+5]=b[rn[2]];Ht.array[Et+6]=w[rn[0]];Ht.array[Et+7]=w[rn[1]];Ht.array[Et+8]=w[rn[2]];Et+=9}}}else if(Ht.size===4){if(Ht.boundTo===undefined||Ht.boundTo==="vertices"){for(o=0,u=Jt.length;o<u;o++){f=Kt[Jt[o]];y=Ht.value[f.a];b=Ht.value[f.b];w=Ht.value[f.c];Ht.array[Et]=y.x;Ht.array[Et+1]=y.y;Ht.array[Et+2]=y.z;Ht.array[Et+3]=y.w;Ht.array[Et+4]=b.x;Ht.array[Et+5]=b.y;Ht.array[Et+6]=b.z;Ht.array[Et+7]=b.w;Ht.array[Et+8]=w.x;Ht.array[Et+9]=w.y;Ht.array[Et+10]=w.z;Ht.array[Et+11]=w.w;Et+=12}}else if(Ht.boundTo==="faces"){for(o=0,u=Jt.length;o<u;o++){xt=Ht.value[Jt[o]];y=xt;b=xt;w=xt;Ht.array[Et]=y.x;Ht.array[Et+1]=y.y;Ht.array[Et+2]=y.z;Ht.array[Et+3]=y.w;Ht.array[Et+4]=b.x;Ht.array[Et+5]=b.y;Ht.array[Et+6]=b.z;Ht.array[Et+7]=b.w;Ht.array[Et+8]=w.x;Ht.array[Et+9]=w.y;Ht.array[Et+10]=w.z;Ht.array[Et+11]=w.w;Et+=12}}else if(Ht.boundTo==="faceVertices"){for(o=0,u=Jt.length;o<u;o++){xt=Ht.value[Jt[o]];y=xt[0];b=xt[1];w=xt[2];Ht.array[Et]=y.x;Ht.array[Et+1]=y.y;Ht.array[Et+2]=y.z;Ht.array[Et+3]=y.w;Ht.array[Et+4]=b.x;Ht.array[Et+5]=b.y;Ht.array[Et+6]=b.z;Ht.array[Et+7]=b.w;Ht.array[Et+8]=w.x;Ht.array[Et+9]=w.y;Ht.array[Et+10]=w.z;Ht.array[Et+11]=w.w;Et+=12}}}tt.bindBuffer(tt.ARRAY_BUFFER,Ht.buffer);tt.bufferData(tt.ARRAY_BUFFER,Ht.array,n)}}if(r){delete e.__inittedArrays;delete e.__colorArray;delete e.__normalArray;delete e.__tangentArray;delete e.__uvArray;delete e.__uv2Array;delete e.__faceArray;delete e.__vertexArray;delete e.__lineArray;delete e.__skinIndexArray;delete e.__skinWeightArray}}function Vt(e){var t=e.attributes;var n=e.attributesKeys;for(var r=0,i=n.length;r<i;r++){var s=n[r];var o=t[s];if(o.buffer===undefined){o.buffer=tt.createBuffer();o.needsUpdate=true}if(o.needsUpdate===true){var u=s==="index"?tt.ELEMENT_ARRAY_BUFFER:tt.ARRAY_BUFFER;tt.bindBuffer(u,o.buffer);tt.bufferData(u,o.array,tt.STATIC_DRAW);o.needsUpdate=false}}}function $t(e,t,n,r){var i=n.attributes;var s=t.attributes;var o=t.attributesKeys;for(var u=0,a=o.length;u<a;u++){var f=o[u];var l=s[f];if(l>=0){var c=i[f];if(c!==undefined){var h=c.itemSize;tt.bindBuffer(tt.ARRAY_BUFFER,c.buffer);Kt(l);tt.vertexAttribPointer(l,h,tt.FLOAT,false,0,r*h*4)}else if(e.defaultAttributeValues!==undefined){if(e.defaultAttributeValues[f].length===2){tt.vertexAttrib2fv(l,e.defaultAttributeValues[f])}else if(e.defaultAttributeValues[f].length===3){tt.vertexAttrib3fv(l,e.defaultAttributeValues[f])}}}}Qt()}function Jt(){for(var e=0,t=V.length;e<t;e++){V[e]=0}}function Kt(e){V[e]=1;if($[e]===0){tt.enableVertexAttribArray(e);$[e]=1}}function Qt(){for(var e=0,t=$.length;e<t;e++){if($[e]!==V[e]){tt.disableVertexAttribArray(e);$[e]=0}}}function Gt(e,t,n){var r=e.program.attributes;if(n.morphTargetBase!==-1&&r.position>=0){tt.bindBuffer(tt.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[n.morphTargetBase]);Kt(r.position);tt.vertexAttribPointer(r.position,3,tt.FLOAT,false,0,0)}else if(r.position>=0){tt.bindBuffer(tt.ARRAY_BUFFER,t.__webglVertexBuffer);Kt(r.position);tt.vertexAttribPointer(r.position,3,tt.FLOAT,false,0,0)}if(n.morphTargetForcedOrder.length){var i=0;var s=n.morphTargetForcedOrder;var o=n.morphTargetInfluences;while(i<e.numSupportedMorphTargets&&i<s.length){if(r["morphTarget"+i]>=0){tt.bindBuffer(tt.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[s[i]]);Kt(r["morphTarget"+i]);tt.vertexAttribPointer(r["morphTarget"+i],3,tt.FLOAT,false,0,0)}if(r["morphNormal"+i]>=0&&e.morphNormals){tt.bindBuffer(tt.ARRAY_BUFFER,t.__webglMorphNormalsBuffers[s[i]]);Kt(r["morphNormal"+i]);tt.vertexAttribPointer(r["morphNormal"+i],3,tt.FLOAT,false,0,0)}n.__webglMorphTargetInfluences[i]=o[s[i]];i++}}else{var u,a=[];var o=n.morphTargetInfluences;var f,l=o.length;for(f=0;f<l;f++){u=o[f];if(u>0){a.push([u,f])}}if(a.length>e.numSupportedMorphTargets){a.sort(en);a.length=e.numSupportedMorphTargets}else if(a.length>e.numSupportedMorphNormals){a.sort(en)}else if(a.length===0){a.push([0,0])}var c,i=0;while(i<e.numSupportedMorphTargets){if(a[i]){c=a[i][1];if(r["morphTarget"+i]>=0){tt.bindBuffer(tt.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[c]);Kt(r["morphTarget"+i]);tt.vertexAttribPointer(r["morphTarget"+i],3,tt.FLOAT,false,0,0)}if(r["morphNormal"+i]>=0&&e.morphNormals){tt.bindBuffer(tt.ARRAY_BUFFER,t.__webglMorphNormalsBuffers[c]);Kt(r["morphNormal"+i]);tt.vertexAttribPointer(r["morphNormal"+i],3,tt.FLOAT,false,0,0)}n.__webglMorphTargetInfluences[i]=o[c]}else{n.__webglMorphTargetInfluences[i]=0}i++}}if(e.program.uniforms.morphTargetInfluences!==null){tt.uniform1fv(e.program.uniforms.morphTargetInfluences,n.__webglMorphTargetInfluences)}}function Yt(e,t){if(e.material.id!==t.material.id){return t.material.id-e.material.id}else if(e.z!==t.z){return t.z-e.z}else{return e.id-t.id}}function Zt(e,t){if(e.z!==t.z){return e.z-t.z}else{return e.id-t.id}}function en(e,t){return t[0]-e[0]}function tn(e,t){if(t.visible===false)return;if(t instanceof THREE.Scene||t instanceof THREE.Group){}else{un(t,e);if(t instanceof THREE.Light){p.push(t)}else if(t instanceof THREE.Sprite){y.push(t)}else if(t instanceof THREE.LensFlare){b.push(t)}else{var n=d[t.id];if(n&&(t.frustumCulled===false||J.intersectsObject(t)===true)){dn(t,e);for(var r=0,i=n.length;r<i;r++){var s=n[r];on(s);s.render=true;if(w.sortObjects===true){if(t.renderDepth!==null){s.z=t.renderDepth}else{G.setFromMatrixPosition(t.matrixWorld);G.applyProjection(K);s.z=G.z}}}}}}for(var r=0,i=t.children.length;r<i;r++){tn(e,t.children[r])}}function nn(e,t,n,r,i,s){var o;for(var u=e.length-1;u!==-1;u--){var a=e[u];var f=a.object;var l=a.buffer;Pn(f,t);if(s){o=s}else{o=a.material;if(!o)continue;if(i)w.setBlending(o.blending,o.blendEquation,o.blendSrc,o.blendDst);w.setDepthTest(o.depthTest);w.setDepthWrite(o.depthWrite);In(o.polygonOffset,o.polygonOffsetFactor,o.polygonOffsetUnits)}w.setMaterialFaces(o);if(l instanceof THREE.BufferGeometry){w.renderBufferDirect(t,n,r,o,l,f)}else{w.renderBuffer(t,n,r,o,l,f)}}}function rn(e,t,n,r,i,s,o){var u;for(var a=0,f=e.length;a<f;a++){var l=e[a];var c=l.object;if(c.visible){if(o){u=o}else{u=l[t];if(!u)continue;if(s)w.setBlending(u.blending,u.blendEquation,u.blendSrc,u.blendDst);w.setDepthTest(u.depthTest);w.setDepthWrite(u.depthWrite);In(u.polygonOffset,u.polygonOffsetFactor,u.polygonOffsetUnits)}w.renderImmediateObject(n,r,i,u,c)}}}function sn(e){var t=e.object,n=t.material;if(n.transparent){e.transparent=n;e.opaque=null}else{e.opaque=n;e.transparent=null}}function on(e){var t=e.object;var n=e.buffer;var r=t.geometry;var i=t.material;if(i instanceof THREE.MeshFaceMaterial){var s=r instanceof THREE.BufferGeometry?0:n.materialIndex;i=i.materials[s];e.material=i;if(i.transparent){g.push(e)}else{m.push(e)}}else if(i){e.material=i;if(i.transparent){g.push(e)}else{m.push(e)}}}function un(e,t){if(e.__webglInit===undefined){e.__webglInit=true;e._modelViewMatrix=new THREE.Matrix4;e._normalMatrix=new THREE.Matrix3;e.addEventListener("removed",kt)}var n=e.geometry;if(n===undefined){}else if(n.__webglInit===undefined){n.__webglInit=true;n.addEventListener("dispose",Lt);if(n instanceof THREE.BufferGeometry){}else if(e instanceof THREE.Mesh){cn(t,e,n)}else if(e instanceof THREE.Line){if(n.__webglVertexBuffer===undefined){Nt(n);It(n,e);n.verticesNeedUpdate=true;n.colorsNeedUpdate=true;n.lineDistancesNeedUpdate=true}}else if(e instanceof THREE.PointCloud){if(n.__webglVertexBuffer===undefined){Tt(n);Ft(n,e);n.verticesNeedUpdate=true;n.colorsNeedUpdate=true}}}if(e.__webglActive===undefined){e.__webglActive=true;if(e instanceof THREE.Mesh){if(n instanceof THREE.BufferGeometry){hn(d,n,e)}else if(n instanceof THREE.Geometry){var r=an[n.id];for(var i=0,s=r.length;i<s;i++){hn(d,r[i],e)}}}else if(e instanceof THREE.Line||e instanceof THREE.PointCloud){hn(d,n,e)}else if(e instanceof THREE.ImmediateRenderObject||e.immediateRenderCallback){pn(v,e)}}}function ln(e,t){var n=it.get("OES_element_index_uint")?4294967296:65535;var r,i={};var s=e.morphTargets.length;var o=e.morphNormals.length;var u;var a={};var f=[];for(var l=0,c=e.faces.length;l<c;l++){var h=e.faces[l];var p=t?h.materialIndex:0;if(!(p in i)){i[p]={hash:p,counter:0}}r=i[p].hash+"_"+i[p].counter;if(!(r in a)){u={id:fn++,faces3:[],materialIndex:p,vertices:0,numMorphTargets:s,numMorphNormals:o};a[r]=u;f.push(u)}if(a[r].vertices+3>n){i[p].counter+=1;r=i[p].hash+"_"+i[p].counter;if(!(r in a)){u={id:fn++,faces3:[],materialIndex:p,vertices:0,numMorphTargets:s,numMorphNormals:o};a[r]=u;f.push(u)}}a[r].faces3.push(l);a[r].vertices+=3}return f}function cn(e,t,n){var r=t.material,i=false;if(an[n.id]===undefined||n.groupsNeedUpdate===true){delete d[t.id];an[n.id]=ln(n,r instanceof THREE.MeshFaceMaterial);n.groupsNeedUpdate=false}var s=an[n.id];for(var o=0,u=s.length;o<u;o++){var a=s[o];if(a.__webglVertexBuffer===undefined){Ct(a);qt(a,t);n.verticesNeedUpdate=true;n.morphTargetsNeedUpdate=true;n.elementsNeedUpdate=true;n.uvsNeedUpdate=true;n.normalsNeedUpdate=true;n.tangentsNeedUpdate=true;n.colorsNeedUpdate=true;i=true}else{i=false}if(i||t.__webglActive===undefined){hn(d,a,t)}}t.__webglActive=true}function hn(e,t,n){var r=n.id;e[r]=e[r]||[];e[r].push({id:r,buffer:t,object:n,material:null,z:0})}function pn(e,t){e.push({id:null,object:t,opaque:null,transparent:null,z:0})}function dn(e,t){var n=e.geometry,r,i;if(n instanceof THREE.BufferGeometry){Vt(n)}else if(e instanceof THREE.Mesh){if(n.groupsNeedUpdate===true){cn(t,e,n)}var s=an[n.id];for(var o=0,u=s.length;o<u;o++){var a=s[o];i=Rt(e,a);if(n.groupsNeedUpdate===true){qt(a,e)}r=i.attributes&&vn(i);if(n.verticesNeedUpdate||n.morphTargetsNeedUpdate||n.elementsNeedUpdate||n.uvsNeedUpdate||n.normalsNeedUpdate||n.colorsNeedUpdate||n.tangentsNeedUpdate||r){Xt(a,e,tt.DYNAMIC_DRAW,!n.dynamic,i)}}n.verticesNeedUpdate=false;n.morphTargetsNeedUpdate=false;n.elementsNeedUpdate=false;n.uvsNeedUpdate=false;n.normalsNeedUpdate=false;n.colorsNeedUpdate=false;n.tangentsNeedUpdate=false;i.attributes&&mn(i)}else if(e instanceof THREE.Line){i=Rt(e,n);r=i.attributes&&vn(i);if(n.verticesNeedUpdate||n.colorsNeedUpdate||n.lineDistancesNeedUpdate||r){Wt(n,tt.DYNAMIC_DRAW)}n.verticesNeedUpdate=false;n.colorsNeedUpdate=false;n.lineDistancesNeedUpdate=false;i.attributes&&mn(i)}else if(e instanceof THREE.PointCloud){i=Rt(e,n);r=i.attributes&&vn(i);if(n.verticesNeedUpdate||n.colorsNeedUpdate||e.sortParticles||r){zt(n,tt.DYNAMIC_DRAW,e)}n.verticesNeedUpdate=false;n.colorsNeedUpdate=false;i.attributes&&mn(i)}}function vn(e){for(var t in e.attributes){if(e.attributes[t].needsUpdate)return true}return false}function mn(e){for(var t in e.attributes){e.attributes[t].needsUpdate=false}}function gn(e){if(e instanceof THREE.Mesh||e instanceof THREE.PointCloud||e instanceof THREE.Line){delete d[e.id]}else if(e instanceof THREE.ImmediateRenderObject||e.immediateRenderCallback){yn(v,e)}delete e.__webglInit;delete e._modelViewMatrix;delete e._normalMatrix;delete e.__webglActive}function yn(e,t){for(var n=e.length-1;n>=0;n--){if(e[n].object===t){e.splice(n,1)}}}function bn(e,t,n,i){e.addEventListener("dispose",Mt);var s;if(e instanceof THREE.MeshDepthMaterial){s="depth"}else if(e instanceof THREE.MeshNormalMaterial){s="normal"}else if(e instanceof THREE.MeshBasicMaterial){s="basic"}else if(e instanceof THREE.MeshLambertMaterial){s="lambert"}else if(e instanceof THREE.MeshPhongMaterial){s="phong"}else if(e instanceof THREE.LineBasicMaterial){s="basic"}else if(e instanceof THREE.LineDashedMaterial){s="dashed"}else if(e instanceof THREE.PointCloudMaterial){s="particle_basic"}if(s){var o=THREE.ShaderLib[s];e.__webglShader={uniforms:THREE.UniformsUtils.clone(o.uniforms),vertexShader:o.vertexShader,fragmentShader:o.fragmentShader}}else{e.__webglShader={uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader}}var u=Qn(t);var a=Gn(t);var f=Kn(i);var c={precision:r,supportsVertexTextures:lt,map:!!e.map,envMap:!!e.envMap,lightMap:!!e.lightMap,bumpMap:!!e.bumpMap,normalMap:!!e.normalMap,specularMap:!!e.specularMap,alphaMap:!!e.alphaMap,vertexColors:e.vertexColors,fog:n,useFog:e.fog,fogExp:n instanceof THREE.FogExp2,sizeAttenuation:e.sizeAttenuation,logarithmicDepthBuffer:l,skinning:e.skinning,maxBones:f,useVertexTexture:ct&&i&&i.skeleton&&i.skeleton.useVertexTexture,morphTargets:e.morphTargets,morphNormals:e.morphNormals,maxMorphTargets:w.maxMorphTargets,maxMorphNormals:w.maxMorphNormals,maxDirLights:u.directional,maxPointLights:u.point,maxSpotLights:u.spot,maxHemiLights:u.hemi,maxShadows:a,shadowMapEnabled:w.shadowMapEnabled&&i.receiveShadow&&a>0,shadowMapType:w.shadowMapType,shadowMapDebug:w.shadowMapDebug,shadowMapCascade:w.shadowMapCascade,alphaTest:e.alphaTest,metal:e.metal,wrapAround:e.wrapAround,doubleSided:e.side===THREE.DoubleSide,flipSided:e.side===THREE.BackSide};var h=[];if(s){h.push(s)}else{h.push(e.fragmentShader);h.push(e.vertexShader)}if(e.defines!==undefined){for(var p in e.defines){h.push(p);h.push(e.defines[p])}}for(var p in c){h.push(p);h.push(c[p])}var d=h.join();var v;for(var m=0,g=E.length;m<g;m++){var y=E[m];if(y.code===d){v=y;v.usedTimes++;break}}if(v===undefined){v=new THREE.WebGLProgram(w,d,e,c);E.push(v);w.info.memory.programs=E.length}e.program=v;var b=v.attributes;if(e.morphTargets){e.numSupportedMorphTargets=0;var S,x="morphTarget";for(var T=0;T<w.maxMorphTargets;T++){S=x+T;if(b[S]>=0){e.numSupportedMorphTargets++}}}if(e.morphNormals){e.numSupportedMorphNormals=0;var S,x="morphNormal";for(T=0;T<w.maxMorphNormals;T++){S=x+T;if(b[S]>=0){e.numSupportedMorphNormals++}}}e.uniformsList=[];for(var N in e.__webglShader.uniforms){var C=e.program.uniforms[N];if(C){e.uniformsList.push([e.__webglShader.uniforms[N],C])}}}function wn(e,t,n,r,i){k=0;if(r.needsUpdate){if(r.program)Bt(r);bn(r,t,n,i);r.needsUpdate=false}if(r.morphTargets){if(!i.__webglMorphTargetInfluences){i.__webglMorphTargetInfluences=new Float32Array(w.maxMorphTargets)}}var s=false;var o=false;var u=false;var a=r.program,f=a.uniforms,c=r.__webglShader.uniforms;if(a.id!==S){tt.useProgram(a.program);S=a.id;s=true;o=true;u=true}if(r.id!==T){if(T===-1)u=true;T=r.id;o=true}if(s||e!==C){tt.uniformMatrix4fv(f.projectionMatrix,false,e.projectionMatrix.elements);if(l){tt.uniform1f(f.logDepthBufFC,2/(Math.log(e.far+1)/Math.LN2))}if(e!==C)C=e;if(r instanceof THREE.ShaderMaterial||r instanceof THREE.MeshPhongMaterial||r.envMap){if(f.cameraPosition!==null){G.setFromMatrixPosition(e.matrixWorld);tt.uniform3f(f.cameraPosition,G.x,G.y,G.z)}}if(r instanceof THREE.MeshPhongMaterial||r instanceof THREE.MeshLambertMaterial||r instanceof THREE.ShaderMaterial||r.skinning){if(f.viewMatrix!==null){tt.uniformMatrix4fv(f.viewMatrix,false,e.matrixWorldInverse.elements)}}}if(r.skinning){if(i.bindMatrix&&f.bindMatrix!==null){tt.uniformMatrix4fv(f.bindMatrix,false,i.bindMatrix.elements)}if(i.bindMatrixInverse&&f.bindMatrixInverse!==null){tt.uniformMatrix4fv(f.bindMatrixInverse,false,i.bindMatrixInverse.elements)}if(ct&&i.skeleton&&i.skeleton.useVertexTexture){if(f.boneTexture!==null){var h=_n();tt.uniform1i(f.boneTexture,h);w.setTexture(i.skeleton.boneTexture,h)}if(f.boneTextureWidth!==null){tt.uniform1i(f.boneTextureWidth,i.skeleton.boneTextureWidth)}if(f.boneTextureHeight!==null){tt.uniform1i(f.boneTextureHeight,i.skeleton.boneTextureHeight)}}else if(i.skeleton&&i.skeleton.boneMatrices){if(f.boneGlobalMatrices!==null){tt.uniformMatrix4fv(f.boneGlobalMatrices,false,i.skeleton.boneMatrices)}}}if(o){if(n&&r.fog){Nn(c,n)}if(r instanceof THREE.MeshPhongMaterial||r instanceof THREE.MeshLambertMaterial||r.lights){if(Z){u=true;jn(t);Z=false}if(u){Ln(c,et);An(c,true)}else{An(c,false)}}if(r instanceof THREE.MeshBasicMaterial||r instanceof THREE.MeshLambertMaterial||r instanceof THREE.MeshPhongMaterial){En(c,r)}if(r instanceof THREE.LineBasicMaterial){Sn(c,r)}else if(r instanceof THREE.LineDashedMaterial){Sn(c,r);xn(c,r)}else if(r instanceof THREE.PointCloudMaterial){Tn(c,r)}else if(r instanceof THREE.MeshPhongMaterial){Cn(c,r)}else if(r instanceof THREE.MeshLambertMaterial){kn(c,r)}else if(r instanceof THREE.MeshDepthMaterial){c.mNear.value=e.near;c.mFar.value=e.far;c.opacity.value=r.opacity}else if(r instanceof THREE.MeshNormalMaterial){c.opacity.value=r.opacity}if(i.receiveShadow&&!r._shadowPass){On(c,t)}Dn(r.uniformsList)}Mn(f,i);if(f.modelMatrix!==null){tt.uniformMatrix4fv(f.modelMatrix,false,i.matrixWorld.elements)}return a}function En(e,t){e.opacity.value=t.opacity;if(w.gammaInput){e.diffuse.value.copyGammaToLinear(t.color)}else{e.diffuse.value=t.color}e.map.value=t.map;e.lightMap.value=t.lightMap;e.specularMap.value=t.specularMap;e.alphaMap.value=t.alphaMap;if(t.bumpMap){e.bumpMap.value=t.bumpMap;e.bumpScale.value=t.bumpScale}if(t.normalMap){e.normalMap.value=t.normalMap;e.normalScale.value.copy(t.normalScale)}var n;if(t.map){n=t.map}else if(t.specularMap){n=t.specularMap}else if(t.normalMap){n=t.normalMap}else if(t.bumpMap){n=t.bumpMap}else if(t.alphaMap){n=t.alphaMap}if(n!==undefined){var r=n.offset;var i=n.repeat;e.offsetRepeat.value.set(r.x,r.y,i.x,i.y)}e.envMap.value=t.envMap;e.flipEnvMap.value=t.envMap instanceof THREE.WebGLRenderTargetCube?1:-1;if(w.gammaInput){e.reflectivity.value=t.reflectivity}else{e.reflectivity.value=t.reflectivity}e.refractionRatio.value=t.refractionRatio;e.combine.value=t.combine;e.useRefract.value=t.envMap&&t.envMap.mapping instanceof THREE.CubeRefractionMapping}function Sn(e,t){e.diffuse.value=t.color;e.opacity.value=t.opacity}function xn(e,t){e.dashSize.value=t.dashSize;e.totalSize.value=t.dashSize+t.gapSize;e.scale.value=t.scale}function Tn(e,n){e.psColor.value=n.color;e.opacity.value=n.opacity;e.size.value=n.size;e.scale.value=t.height/2;e.map.value=n.map}function Nn(e,t){e.fogColor.value=t.color;if(t instanceof THREE.Fog){e.fogNear.value=t.near;e.fogFar.value=t.far}else if(t instanceof THREE.FogExp2){e.fogDensity.value=t.density}}function Cn(e,t){e.shininess.value=t.shininess;if(w.gammaInput){e.ambient.value.copyGammaToLinear(t.ambient);e.emissive.value.copyGammaToLinear(t.emissive);e.specular.value.copyGammaToLinear(t.specular)}else{e.ambient.value=t.ambient;e.emissive.value=t.emissive;e.specular.value=t.specular}if(t.wrapAround){e.wrapRGB.value.copy(t.wrapRGB)}}function kn(e,t){if(w.gammaInput){e.ambient.value.copyGammaToLinear(t.ambient);e.emissive.value.copyGammaToLinear(t.emissive)}else{e.ambient.value=t.ambient;e.emissive.value=t.emissive}if(t.wrapAround){e.wrapRGB.value.copy(t.wrapRGB)}}function Ln(e,t){e.ambientLightColor.value=t.ambient;e.directionalLightColor.value=t.directional.colors;e.directionalLightDirection.value=t.directional.positions;e.pointLightColor.value=t.point.colors;e.pointLightPosition.value=t.point.positions;e.pointLightDistance.value=t.point.distances;e.spotLightColor.value=t.spot.colors;e.spotLightPosition.value=t.spot.positions;e.spotLightDistance.value=t.spot.distances;e.spotLightDirection.value=t.spot.directions;e.spotLightAngleCos.value=t.spot.anglesCos;e.spotLightExponent.value=t.spot.exponents;e.hemisphereLightSkyColor.value=t.hemi.skyColors;e.hemisphereLightGroundColor.value=t.hemi.groundColors;e.hemisphereLightDirection.value=t.hemi.positions}function An(e,t){e.ambientLightColor.needsUpdate=t;e.directionalLightColor.needsUpdate=t;e.directionalLightDirection.needsUpdate=t;e.pointLightColor.needsUpdate=t;e.pointLightPosition.needsUpdate=t;e.pointLightDistance.needsUpdate=t;e.spotLightColor.needsUpdate=t;e.spotLightPosition.needsUpdate=t;e.spotLightDistance.needsUpdate=t;e.spotLightDirection.needsUpdate=t;e.spotLightAngleCos.needsUpdate=t;e.spotLightExponent.needsUpdate=t;e.hemisphereLightSkyColor.needsUpdate=t;e.hemisphereLightGroundColor.needsUpdate=t;e.hemisphereLightDirection.needsUpdate=t}function On(e,t){if(e.shadowMatrix){var n=0;for(var r=0,i=t.length;r<i;r++){var s=t[r];if(!s.castShadow)continue;if(s instanceof THREE.SpotLight||s instanceof THREE.DirectionalLight&&!s.shadowCascade){e.shadowMap.value[n]=s.shadowMap;e.shadowMapSize.value[n]=s.shadowMapSize;e.shadowMatrix.value[n]=s.shadowMatrix;e.shadowDarkness.value[n]=s.shadowDarkness;e.shadowBias.value[n]=s.shadowBias;n++}}}}function Mn(e,t){tt.uniformMatrix4fv(e.modelViewMatrix,false,t._modelViewMatrix.elements);if(e.normalMatrix){tt.uniformMatrix3fv(e.normalMatrix,false,t._normalMatrix.elements)}}function _n(){var e=k;if(e>=ot){console.warn("WebGLRenderer: trying to use "+e+" texture units while this GPU supports only "+ot)}k+=1;return e}function Dn(e){var t,n,r;for(var i=0,s=e.length;i<s;i++){var o=e[i][0];if(o.needsUpdate===false)continue;var u=o.type;var a=o.value;var f=e[i][1];switch(u){case"1i":tt.uniform1i(f,a);break;case"1f":tt.uniform1f(f,a);break;case"2f":tt.uniform2f(f,a[0],a[1]);break;case"3f":tt.uniform3f(f,a[0],a[1],a[2]);break;case"4f":tt.uniform4f(f,a[0],a[1],a[2],a[3]);break;case"1iv":tt.uniform1iv(f,a);break;case"3iv":tt.uniform3iv(f,a);break;case"1fv":tt.uniform1fv(f,a);break;case"2fv":tt.uniform2fv(f,a);break;case"3fv":tt.uniform3fv(f,a);break;case"4fv":tt.uniform4fv(f,a);break;case"Matrix3fv":tt.uniformMatrix3fv(f,false,a);break;case"Matrix4fv":tt.uniformMatrix4fv(f,false,a);break;case"i":tt.uniform1i(f,a);break;case"f":tt.uniform1f(f,a);break;case"v2":tt.uniform2f(f,a.x,a.y);break;case"v3":tt.uniform3f(f,a.x,a.y,a.z);break;case"v4":tt.uniform4f(f,a.x,a.y,a.z,a.w);break;case"c":tt.uniform3f(f,a.r,a.g,a.b);break;case"iv1":tt.uniform1iv(f,a);break;case"iv":tt.uniform3iv(f,a);break;case"fv1":tt.uniform1fv(f,a);break;case"fv":tt.uniform3fv(f,a);break;case"v2v":if(o._array===undefined){o._array=new Float32Array(2*a.length)}for(var l=0,c=a.length;l<c;l++){r=l*2;o._array[r]=a[l].x;o._array[r+1]=a[l].y}tt.uniform2fv(f,o._array);break;case"v3v":if(o._array===undefined){o._array=new Float32Array(3*a.length)}for(var l=0,c=a.length;l<c;l++){r=l*3;o._array[r]=a[l].x;o._array[r+1]=a[l].y;o._array[r+2]=a[l].z}tt.uniform3fv(f,o._array);break;case"v4v":if(o._array===undefined){o._array=new Float32Array(4*a.length)}for(var l=0,c=a.length;l<c;l++){r=l*4;o._array[r]=a[l].x;o._array[r+1]=a[l].y;o._array[r+2]=a[l].z;o._array[r+3]=a[l].w}tt.uniform4fv(f,o._array);break;case"m3":tt.uniformMatrix3fv(f,false,a.elements);break;case"m3v":if(o._array===undefined){o._array=new Float32Array(9*a.length)}for(var l=0,c=a.length;l<c;l++){a[l].flattenToArrayOffset(o._array,l*9)}tt.uniformMatrix3fv(f,false,o._array);break;case"m4":tt.uniformMatrix4fv(f,false,a.elements);break;case"m4v":if(o._array===undefined){o._array=new Float32Array(16*a.length)}for(var l=0,c=a.length;l<c;l++){a[l].flattenToArrayOffset(o._array,l*16)}tt.uniformMatrix4fv(f,false,o._array);break;case"t":t=a;n=_n();tt.uniform1i(f,n);if(!t)continue;if(t instanceof THREE.CubeTexture||t.image instanceof Array&&t.image.length===6){Un(t,n)}else if(t instanceof THREE.WebGLRenderTargetCube){zn(t,n)}else{w.setTexture(t,n)}break;case"tv":if(o._array===undefined){o._array=[]}for(var l=0,c=o.value.length;l<c;l++){o._array[l]=_n()}tt.uniform1iv(f,o._array);for(var l=0,c=o.value.length;l<c;l++){t=o.value[l];n=o._array[l];if(!t)continue;w.setTexture(t,n)}break;default:console.warn("THREE.WebGLRenderer: Unknown uniform type: "+u)}}}function Pn(e,t){e._modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld);e._normalMatrix.getNormalMatrix(e._modelViewMatrix)}function Hn(e,t,n,r){e[t]=n.r*n.r*r;e[t+1]=n.g*n.g*r;e[t+2]=n.b*n.b*r}function Bn(e,t,n,r){e[t]=n.r*r;e[t+1]=n.g*r;e[t+2]=n.b*r}function jn(e){var t,n,r,i,s=0,o=0,u=0,a,f,l,c,h,p,d,v=et,m=v.directional.colors,g=v.directional.positions,y=v.point.colors,b=v.point.positions,E=v.point.distances,S=v.spot.colors,x=v.spot.positions,T=v.spot.distances,N=v.spot.directions,C=v.spot.anglesCos,k=v.spot.exponents,L=v.hemi.skyColors,A=v.hemi.groundColors,O=v.hemi.positions,M=0,_=0,D=0,P=0,H=0,B=0,j=0,F=0,I=0,q=0,R=0,U=0;for(t=0,n=e.length;t<n;t++){r=e[t];if(r.onlyShadow)continue;a=r.color;c=r.intensity;d=r.distance;if(r instanceof THREE.AmbientLight){if(!r.visible)continue;if(w.gammaInput){s+=a.r*a.r;o+=a.g*a.g;u+=a.b*a.b}else{s+=a.r;o+=a.g;u+=a.b}}else if(r instanceof THREE.DirectionalLight){H+=1;if(!r.visible)continue;Y.setFromMatrixPosition(r.matrixWorld);G.setFromMatrixPosition(r.target.matrixWorld);Y.sub(G);Y.normalize();I=M*3;g[I]=Y.x;g[I+1]=Y.y;g[I+2]=Y.z;if(w.gammaInput){Hn(m,I,a,c*c)}else{Bn(m,I,a,c)}M+=1}else if(r instanceof THREE.PointLight){B+=1;if(!r.visible)continue;q=_*3;if(w.gammaInput){Hn(y,q,a,c*c)}else{Bn(y,q,a,c)}G.setFromMatrixPosition(r.matrixWorld);b[q]=G.x;b[q+1]=G.y;b[q+2]=G.z;E[_]=d;_+=1}else if(r instanceof THREE.SpotLight){j+=1;if(!r.visible)continue;R=D*3;if(w.gammaInput){Hn(S,R,a,c*c)}else{Bn(S,R,a,c)}Y.setFromMatrixPosition(r.matrixWorld);x[R]=Y.x;x[R+1]=Y.y;x[R+2]=Y.z;T[D]=d;G.setFromMatrixPosition(r.target.matrixWorld);Y.sub(G);Y.normalize();N[R]=Y.x;N[R+1]=Y.y;N[R+2]=Y.z;C[D]=Math.cos(r.angle);k[D]=r.exponent;D+=1}else if(r instanceof THREE.HemisphereLight){F+=1;if(!r.visible)continue;Y.setFromMatrixPosition(r.matrixWorld);Y.normalize();U=P*3;O[U]=Y.x;O[U+1]=Y.y;O[U+2]=Y.z;f=r.color;l=r.groundColor;if(w.gammaInput){h=c*c;Hn(L,U,f,h);Hn(A,U,l,h)}else{Bn(L,U,f,c);Bn(A,U,l,c)}P+=1}}for(t=M*3,n=Math.max(m.length,H*3);t<n;t++)m[t]=0;for(t=_*3,n=Math.max(y.length,B*3);t<n;t++)y[t]=0;for(t=D*3,n=Math.max(S.length,j*3);t<n;t++)S[t]=0;for(t=P*3,n=Math.max(L.length,F*3);t<n;t++)L[t]=0;for(t=P*3,n=Math.max(A.length,F*3);t<n;t++)A[t]=0;v.directional.length=M;v.point.length=_;v.spot.length=D;v.hemi.length=P;v.ambient[0]=s;v.ambient[1]=o;v.ambient[2]=u}function Fn(e){if(e!==I){tt.lineWidth(e);I=e}}function In(e,t,n){if(B!==e){if(e){tt.enable(tt.POLYGON_OFFSET_FILL)}else{tt.disable(tt.POLYGON_OFFSET_FILL)}B=e}if(e&&(j!==t||F!==n)){tt.polygonOffset(t,n);j=t;F=n}}function qn(e,t,n){var r;if(n){tt.texParameteri(e,tt.TEXTURE_WRAP_S,Jn(t.wrapS));tt.texParameteri(e,tt.TEXTURE_WRAP_T,Jn(t.wrapT));tt.texParameteri(e,tt.TEXTURE_MAG_FILTER,Jn(t.magFilter));tt.texParameteri(e,tt.TEXTURE_MIN_FILTER,Jn(t.minFilter))}else{tt.texParameteri(e,tt.TEXTURE_WRAP_S,tt.CLAMP_TO_EDGE);tt.texParameteri(e,tt.TEXTURE_WRAP_T,tt.CLAMP_TO_EDGE);tt.texParameteri(e,tt.TEXTURE_MAG_FILTER,$n(t.magFilter));tt.texParameteri(e,tt.TEXTURE_MIN_FILTER,$n(t.minFilter))}r=it.get("EXT_texture_filter_anisotropic");if(r&&t.type!==THREE.FloatType){if(t.anisotropy>1||t.__oldAnisotropy){tt.texParameterf(e,r.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,w.getMaxAnisotropy()));t.__oldAnisotropy=t.anisotropy}}}function Rn(e,t){if(e.width>t||e.height>t){var n=t/Math.max(e.width,e.height);var r=document.createElement("canvas");r.width=Math.floor(e.width*n);r.height=Math.floor(e.height*n);var i=r.getContext("2d");i.drawImage(e,0,0,e.width,e.height,0,0,r.width,r.height);console.log("THREE.WebGLRenderer:",e,"is too big ("+e.width+"x"+e.height+"). Resized to "+r.width+"x"+r.height+".");return r}return e}function Un(e,t){if(e.image.length===6){if(e.needsUpdate){if(!e.image.__webglTextureCube){e.addEventListener("dispose",At);e.image.__webglTextureCube=tt.createTexture();w.info.memory.textures++}tt.activeTexture(tt.TEXTURE0+t);tt.bindTexture(tt.TEXTURE_CUBE_MAP,e.image.__webglTextureCube);tt.pixelStorei(tt.UNPACK_FLIP_Y_WEBGL,e.flipY);var n=e instanceof THREE.CompressedTexture;var r=e.image[0]instanceof THREE.DataTexture;var i=[];for(var s=0;s<6;s++){if(w.autoScaleCubemaps&&!n&&!r){i[s]=Rn(e.image[s],ft)}else{i[s]=r?e.image[s].image:e.image[s]}}var o=i[0],u=THREE.Math.isPowerOfTwo(o.width)&&THREE.Math.isPowerOfTwo(o.height),a=Jn(e.format),f=Jn(e.type);qn(tt.TEXTURE_CUBE_MAP,e,u);for(var s=0;s<6;s++){if(!n){if(r){tt.texImage2D(tt.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,a,i[s].width,i[s].height,0,a,f,i[s].data)}else{tt.texImage2D(tt.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,a,a,f,i[s])}}else{var l,c=i[s].mipmaps;for(var h=0,p=c.length;h<p;h++){l=c[h];if(e.format!==THREE.RGBAFormat&&e.format!==THREE.RGBFormat){if(yt().indexOf(a)>-1){tt.compressedTexImage2D(tt.TEXTURE_CUBE_MAP_POSITIVE_X+s,h,a,l.width,l.height,0,l.data)}else{console.warn("Attempt to load unsupported compressed texture format")}}else{tt.texImage2D(tt.TEXTURE_CUBE_MAP_POSITIVE_X+s,h,a,l.width,l.height,0,a,f,l.data)}}}}if(e.generateMipmaps&&u){tt.generateMipmap(tt.TEXTURE_CUBE_MAP)}e.needsUpdate=false;if(e.onUpdate)e.onUpdate()}else{tt.activeTexture(tt.TEXTURE0+t);tt.bindTexture(tt.TEXTURE_CUBE_MAP,e.image.__webglTextureCube)}}}function zn(e,t){tt.activeTexture(tt.TEXTURE0+t);tt.bindTexture(tt.TEXTURE_CUBE_MAP,e.__webglTexture)}function Wn(e,t,n){tt.bindFramebuffer(tt.FRAMEBUFFER,e);tt.framebufferTexture2D(tt.FRAMEBUFFER,tt.COLOR_ATTACHMENT0,n,t.__webglTexture,0)}function Xn(e,t){tt.bindRenderbuffer(tt.RENDERBUFFER,e);if(t.depthBuffer&&!t.stencilBuffer){tt.renderbufferStorage(tt.RENDERBUFFER,tt.DEPTH_COMPONENT16,t.width,t.height);tt.framebufferRenderbuffer(tt.FRAMEBUFFER,tt.DEPTH_ATTACHMENT,tt.RENDERBUFFER,e)}else if(t.depthBuffer&&t.stencilBuffer){tt.renderbufferStorage(tt.RENDERBUFFER,tt.DEPTH_STENCIL,t.width,t.height);tt.framebufferRenderbuffer(tt.FRAMEBUFFER,tt.DEPTH_STENCIL_ATTACHMENT,tt.RENDERBUFFER,e)}else{tt.renderbufferStorage(tt.RENDERBUFFER,tt.RGBA4,t.width,t.height)}}function Vn(e){if(e instanceof THREE.WebGLRenderTargetCube){tt.bindTexture(tt.TEXTURE_CUBE_MAP,e.__webglTexture);tt.generateMipmap(tt.TEXTURE_CUBE_MAP);tt.bindTexture(tt.TEXTURE_CUBE_MAP,null)}else{tt.bindTexture(tt.TEXTURE_2D,e.__webglTexture);tt.generateMipmap(tt.TEXTURE_2D);tt.bindTexture(tt.TEXTURE_2D,null)}}function $n(e){if(e===THREE.NearestFilter||e===THREE.NearestMipMapNearestFilter||e===THREE.NearestMipMapLinearFilter){return tt.NEAREST}return tt.LINEAR}function Jn(e){var t;if(e===THREE.RepeatWrapping)return tt.REPEAT;if(e===THREE.ClampToEdgeWrapping)return tt.CLAMP_TO_EDGE;if(e===THREE.MirroredRepeatWrapping)return tt.MIRRORED_REPEAT;if(e===THREE.NearestFilter)return tt.NEAREST;if(e===THREE.NearestMipMapNearestFilter)return tt.NEAREST_MIPMAP_NEAREST;if(e===THREE.NearestMipMapLinearFilter)return tt.NEAREST_MIPMAP_LINEAR;if(e===THREE.LinearFilter)return tt.LINEAR;if(e===THREE.LinearMipMapNearestFilter)return tt.LINEAR_MIPMAP_NEAREST;if(e===THREE.LinearMipMapLinearFilter)return tt.LINEAR_MIPMAP_LINEAR;if(e===THREE.UnsignedByteType)return tt.UNSIGNED_BYTE;if(e===THREE.UnsignedShort4444Type)return tt.UNSIGNED_SHORT_4_4_4_4;if(e===THREE.UnsignedShort5551Type)return tt.UNSIGNED_SHORT_5_5_5_1;if(e===THREE.UnsignedShort565Type)return tt.UNSIGNED_SHORT_5_6_5;if(e===THREE.ByteType)return tt.BYTE;if(e===THREE.ShortType)return tt.SHORT;if(e===THREE.UnsignedShortType)return tt.UNSIGNED_SHORT;if(e===THREE.IntType)return tt.INT;if(e===THREE.UnsignedIntType)return tt.UNSIGNED_INT;if(e===THREE.FloatType)return tt.FLOAT;if(e===THREE.AlphaFormat)return tt.ALPHA;if(e===THREE.RGBFormat)return tt.RGB;if(e===THREE.RGBAFormat)return tt.RGBA;if(e===THREE.LuminanceFormat)return tt.LUMINANCE;if(e===THREE.LuminanceAlphaFormat)return tt.LUMINANCE_ALPHA;if(e===THREE.AddEquation)return tt.FUNC_ADD;if(e===THREE.SubtractEquation)return tt.FUNC_SUBTRACT;if(e===THREE.ReverseSubtractEquation)return tt.FUNC_REVERSE_SUBTRACT;if(e===THREE.ZeroFactor)return tt.ZERO;if(e===THREE.OneFactor)return tt.ONE;if(e===THREE.SrcColorFactor)return tt.SRC_COLOR;if(e===THREE.OneMinusSrcColorFactor)return tt.ONE_MINUS_SRC_COLOR;if(e===THREE.SrcAlphaFactor)return tt.SRC_ALPHA;if(e===THREE.OneMinusSrcAlphaFactor)return tt.ONE_MINUS_SRC_ALPHA;if(e===THREE.DstAlphaFactor)return tt.DST_ALPHA;if(e===THREE.OneMinusDstAlphaFactor)return tt.ONE_MINUS_DST_ALPHA;if(e===THREE.DstColorFactor)return tt.DST_COLOR;if(e===THREE.OneMinusDstColorFactor)return tt.ONE_MINUS_DST_COLOR;if(e===THREE.SrcAlphaSaturateFactor)return tt.SRC_ALPHA_SATURATE;t=it.get("WEBGL_compressed_texture_s3tc");if(t!==null){if(e===THREE.RGB_S3TC_DXT1_Format)return t.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===THREE.RGBA_S3TC_DXT1_Format)return t.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===THREE.RGBA_S3TC_DXT3_Format)return t.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===THREE.RGBA_S3TC_DXT5_Format)return t.COMPRESSED_RGBA_S3TC_DXT5_EXT}t=it.get("WEBGL_compressed_texture_pvrtc");if(t!==null){if(e===THREE.RGB_PVRTC_4BPPV1_Format)return t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===THREE.RGB_PVRTC_2BPPV1_Format)return t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===THREE.RGBA_PVRTC_4BPPV1_Format)return t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===THREE.RGBA_PVRTC_2BPPV1_Format)return t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}t=it.get("EXT_blend_minmax");if(t!==null){if(e===THREE.MinEquation)return t.MIN_EXT;if(e===THREE.MaxEquation)return t.MAX_EXT}return 0}function Kn(e){if(ct&&e&&e.skeleton&&e.skeleton.useVertexTexture){return 1024}else{var t=tt.getParameter(tt.MAX_VERTEX_UNIFORM_VECTORS);var n=Math.floor((t-20)/4);var r=n;if(e!==undefined&&e instanceof THREE.SkinnedMesh){r=Math.min(e.skeleton.bones.length,r);if(r<e.skeleton.bones.length){console.warn("WebGLRenderer: too many bones - "+e.skeleton.bones.length+", this GPU supports just "+r+" (try OpenGL instead of ANGLE)")}}return r}}function Qn(e){var t=0;var n=0;var r=0;var i=0;for(var s=0,o=e.length;s<o;s++){var u=e[s];if(u.onlyShadow||u.visible===false)continue;if(u instanceof THREE.DirectionalLight)t++;if(u instanceof THREE.PointLight)n++;if(u instanceof THREE.SpotLight)r++;if(u instanceof THREE.HemisphereLight)i++}return{directional:t,point:n,spot:r,hemi:i}}function Gn(e){var t=0;for(var n=0,r=e.length;n<r;n++){var i=e[n];if(!i.castShadow)continue;if(i instanceof THREE.SpotLight)t++;if(i instanceof THREE.DirectionalLight&&!i.shadowCascade)t++}return t}console.log("THREE.WebGLRenderer",THREE.REVISION);e=e||{};var t=e.canvas!==undefined?e.canvas:document.createElement("canvas"),n=e.context!==undefined?e.context:null,r=e.precision!==undefined?e.precision:"highp",i=e.alpha!==undefined?e.alpha:false,s=e.depth!==undefined?e.depth:true,o=e.stencil!==undefined?e.stencil:true,u=e.antialias!==undefined?e.antialias:false,a=e.premultipliedAlpha!==undefined?e.premultipliedAlpha:true,f=e.preserveDrawingBuffer!==undefined?e.preserveDrawingBuffer:false,l=e.logarithmicDepthBuffer!==undefined?e.logarithmicDepthBuffer:false,c=new THREE.Color(0),h=0;var p=[];var d={};var v=[];var m=[];var g=[];var y=[];var b=[];this.domElement=t;this.context=null;this.devicePixelRatio=e.devicePixelRatio!==undefined?e.devicePixelRatio:self.devicePixelRatio!==undefined?self.devicePixelRatio:1;this.autoClear=true;this.autoClearColor=true;this.autoClearDepth=true;this.autoClearStencil=true;this.sortObjects=true;this.gammaInput=false;this.gammaOutput=false;this.shadowMapEnabled=false;this.shadowMapType=THREE.PCFShadowMap;this.shadowMapCullFace=THREE.CullFaceFront;this.shadowMapDebug=false;this.shadowMapCascade=false;this.maxMorphTargets=8;this.maxMorphNormals=4;this.autoScaleCubemaps=true;this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var w=this,E=[],S=null,x=null,T=-1,N=-1,C=null,k=0,L=-1,A=-1,O=-1,M=-1,_=-1,D=-1,P=-1,H=-1,B=null,j=null,F=null,I=null,q=0,R=0,U=t.width,z=t.height,W=0,X=0,V=new Uint8Array(16),$=new Uint8Array(16),J=new THREE.Frustum,K=new THREE.Matrix4,Q=new THREE.Matrix4,G=new THREE.Vector3,Y=new THREE.Vector3,Z=true,et={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}};var tt;try{var nt={alpha:i,depth:s,stencil:o,antialias:u,premultipliedAlpha:a,preserveDrawingBuffer:f};tt=n||t.getContext("webgl",nt)||t.getContext("experimental-webgl",nt);if(tt===null){if(t.getContext("webgl")!==null){throw"Error creating WebGL context with your selected attributes."}else{throw"Error creating WebGL context."}}}catch(rt){console.error(rt)}if(tt.getShaderPrecisionFormat===undefined){tt.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}}}var it=new THREE.WebGLExtensions(tt);it.get("OES_texture_float");it.get("OES_texture_float_linear");it.get("OES_standard_derivatives");if(l){it.get("EXT_frag_depth")}st();this.context=tt;var ot=tt.getParameter(tt.MAX_TEXTURE_IMAGE_UNITS);var ut=tt.getParameter(tt.MAX_VERTEX_TEXTURE_IMAGE_UNITS);var at=tt.getParameter(tt.MAX_TEXTURE_SIZE);var ft=tt.getParameter(tt.MAX_CUBE_MAP_TEXTURE_SIZE);var lt=ut>0;var ct=lt&&it.get("OES_texture_float");var ht=tt.getShaderPrecisionFormat(tt.VERTEX_SHADER,tt.HIGH_FLOAT);var pt=tt.getShaderPrecisionFormat(tt.VERTEX_SHADER,tt.MEDIUM_FLOAT);var dt=tt.getShaderPrecisionFormat(tt.VERTEX_SHADER,tt.LOW_FLOAT);var vt=tt.getShaderPrecisionFormat(tt.FRAGMENT_SHADER,tt.HIGH_FLOAT);var mt=tt.getShaderPrecisionFormat(tt.FRAGMENT_SHADER,tt.MEDIUM_FLOAT);var gt=tt.getShaderPrecisionFormat(tt.FRAGMENT_SHADER,tt.LOW_FLOAT);var yt=function(){var e;return function(){if(e!==undefined){return e}e=[];if(it.get("WEBGL_compressed_texture_pvrtc")||it.get("WEBGL_compressed_texture_s3tc")){var t=tt.getParameter(tt.COMPRESSED_TEXTURE_FORMATS);for(var n=0;n<t.length;n++){e.push(t[n])}}return e}}();var bt=ht.precision>0&&vt.precision>0;var wt=pt.precision>0&&mt.precision>0;if(r==="highp"&&!bt){if(wt){r="mediump";console.warn("THREE.WebGLRenderer: highp not supported, using mediump.")}else{r="lowp";console.warn("THREE.WebGLRenderer: highp and mediump not supported, using lowp.")}}if(r==="mediump"&&!wt){r="lowp";console.warn("THREE.WebGLRenderer: mediump not supported, using lowp.")}var Et=new THREE.ShadowMapPlugin(this,p,d,v);var St=new THREE.SpritePlugin(this,y);var xt=new THREE.LensFlarePlugin(this,b);this.getContext=function(){return tt};this.supportsVertexTextures=function(){return lt};this.supportsFloatTextures=function(){return it.get("OES_texture_float")};this.supportsStandardDerivatives=function(){return it.get("OES_standard_derivatives")};this.supportsCompressedTextureS3TC=function(){return it.get("WEBGL_compressed_texture_s3tc")};this.supportsCompressedTexturePVRTC=function(){return it.get("WEBGL_compressed_texture_pvrtc")};this.supportsBlendMinMax=function(){return it.get("EXT_blend_minmax")};this.getMaxAnisotropy=function(){var e;return function(){if(e!==undefined){return e}var t=it.get("EXT_texture_filter_anisotropic");e=t!==null?tt.getParameter(t.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0;return e}}();this.getPrecision=function(){return r};this.setSize=function(e,n,r){t.width=e*this.devicePixelRatio;t.height=n*this.devicePixelRatio;if(r!==false){t.style.width=e+"px";t.style.height=n+"px"}this.setViewport(0,0,e,n)};this.setViewport=function(e,t,n,r){q=e*this.devicePixelRatio;R=t*this.devicePixelRatio;U=n*this.devicePixelRatio;z=r*this.devicePixelRatio;tt.viewport(q,R,U,z)};this.setScissor=function(e,t,n,r){tt.scissor(e*this.devicePixelRatio,t*this.devicePixelRatio,n*this.devicePixelRatio,r*this.devicePixelRatio)};this.enableScissorTest=function(e){e?tt.enable(tt.SCISSOR_TEST):tt.disable(tt.SCISSOR_TEST)};this.setClearColor=function(e,t){c.set(e);h=t!==undefined?t:1;tt.clearColor(c.r,c.g,c.b,h)};this.setClearColorHex=function(e,t){console.warn("THREE.WebGLRenderer: .setClearColorHex() is being removed. Use .setClearColor() instead.");this.setClearColor(e,t)};this.getClearColor=function(){return c};this.getClearAlpha=function(){return h};this.clear=function(e,t,n){var r=0;if(e===undefined||e)r|=tt.COLOR_BUFFER_BIT;if(t===undefined||t)r|=tt.DEPTH_BUFFER_BIT;if(n===undefined||n)r|=tt.STENCIL_BUFFER_BIT;tt.clear(r)};this.clearColor=function(){tt.clear(tt.COLOR_BUFFER_BIT)};this.clearDepth=function(){tt.clear(tt.DEPTH_BUFFER_BIT)};this.clearStencil=function(){tt.clear(tt.STENCIL_BUFFER_BIT)};this.clearTarget=function(e,t,n,r){this.setRenderTarget(e);this.clear(t,n,r)};this.resetGLState=function(){S=null;C=null;O=-1;P=-1;H=-1;L=-1;A=-1;N=-1;T=-1;Z=true};var kt=function(e){var t=e.target;t.traverse(function(e){e.removeEventListener("remove",kt);gn(e)})};var Lt=function(e){var t=e.target;t.removeEventListener("dispose",Lt);Dt(t)};var At=function(e){var t=e.target;t.removeEventListener("dispose",At);Pt(t);w.info.memory.textures--};var Ot=function(e){var t=e.target;t.removeEventListener("dispose",Ot);Ht(t);w.info.memory.textures--};var Mt=function(e){var t=e.target;t.removeEventListener("dispose",Mt);Bt(t)};var _t=function(e){var t=["__webglVertexBuffer","__webglNormalBuffer","__webglTangentBuffer","__webglColorBuffer","__webglUVBuffer","__webglUV2Buffer","__webglSkinIndicesBuffer","__webglSkinWeightsBuffer","__webglFaceBuffer","__webglLineBuffer","__webglLineDistanceBuffer"];for(var n=0,r=t.length;n<r;n++){var i=t[n];if(e[i]!==undefined){tt.deleteBuffer(e[i]);delete e[i]}}if(e.__webglCustomAttributesList!==undefined){for(var i in e.__webglCustomAttributesList){tt.deleteBuffer(e.__webglCustomAttributesList[i].buffer)}delete e.__webglCustomAttributesList}w.info.memory.geometries--};var Dt=function(e){delete e.__webglInit;if(e instanceof THREE.BufferGeometry){for(var t in e.attributes){var n=e.attributes[t];if(n.buffer!==undefined){tt.deleteBuffer(n.buffer);delete n.buffer}}w.info.memory.geometries--}else{var r=an[e.id];if(r!==undefined){for(var i=0,s=r.length;i<s;i++){var o=r[i];if(o.numMorphTargets!==undefined){for(var u=0,a=o.numMorphTargets;u<a;u++){tt.deleteBuffer(o.__webglMorphTargetsBuffers[u])}delete o.__webglMorphTargetsBuffers}if(o.numMorphNormals!==undefined){for(var u=0,a=o.numMorphNormals;u<a;u++){tt.deleteBuffer(o.__webglMorphNormalsBuffers[u])}delete o.__webglMorphNormalsBuffers}_t(o)}delete an[e.id]}else{_t(e)}}N=-1};var Pt=function(e){if(e.image&&e.image.__webglTextureCube){tt.deleteTexture(e.image.__webglTextureCube);delete e.image.__webglTextureCube}else{if(e.__webglInit===undefined)return;tt.deleteTexture(e.__webglTexture);delete e.__webglTexture;delete e.__webglInit}};var Ht=function(e){if(!e||e.__webglTexture===undefined)return;tt.deleteTexture(e.__webglTexture);delete e.__webglTexture;if(e instanceof THREE.WebGLRenderTargetCube){for(var t=0;t<6;t++){tt.deleteFramebuffer(e.__webglFramebuffer[t]);tt.deleteRenderbuffer(e.__webglRenderbuffer[t])}}else{tt.deleteFramebuffer(e.__webglFramebuffer);tt.deleteRenderbuffer(e.__webglRenderbuffer)}delete e.__webglFramebuffer;delete e.__webglRenderbuffer};var Bt=function(e){var t=e.program.program;if(t===undefined)return;e.program=undefined;var n,r,i;var s=false;for(n=0,r=E.length;n<r;n++){i=E[n];if(i.program===t){i.usedTimes--;if(i.usedTimes===0){s=true}break}}if(s===true){var o=[];for(n=0,r=E.length;n<r;n++){i=E[n];if(i.program!==t){o.push(i)}}E=o;tt.deleteProgram(t);w.info.memory.programs--}};this.renderBufferImmediate=function(e,t,n){Jt();if(e.hasPositions&&!e.__webglVertexBuffer)e.__webglVertexBuffer=tt.createBuffer();if(e.hasNormals&&!e.__webglNormalBuffer)e.__webglNormalBuffer=tt.createBuffer();if(e.hasUvs&&!e.__webglUvBuffer)e.__webglUvBuffer=tt.createBuffer();if(e.hasColors&&!e.__webglColorBuffer)e.__webglColorBuffer=tt.createBuffer();if(e.hasPositions){tt.bindBuffer(tt.ARRAY_BUFFER,e.__webglVertexBuffer);tt.bufferData(tt.ARRAY_BUFFER,e.positionArray,tt.DYNAMIC_DRAW);Kt(t.attributes.position);tt.vertexAttribPointer(t.attributes.position,3,tt.FLOAT,false,0,0)}if(e.hasNormals){tt.bindBuffer(tt.ARRAY_BUFFER,e.__webglNormalBuffer);if(n.shading===THREE.FlatShading){var r,i,s,o,u,a,f,l,c,h,p,d,v,m,g=e.count*3;for(m=0;m<g;m+=9){v=e.normalArray;o=v[m];f=v[m+1];h=v[m+2];u=v[m+3];l=v[m+4];p=v[m+5];a=v[m+6];c=v[m+7];d=v[m+8];r=(o+u+a)/3;i=(f+l+c)/3;s=(h+p+d)/3;v[m]=r;v[m+1]=i;v[m+2]=s;v[m+3]=r;v[m+4]=i;v[m+5]=s;v[m+6]=r;v[m+7]=i;v[m+8]=s}}tt.bufferData(tt.ARRAY_BUFFER,e.normalArray,tt.DYNAMIC_DRAW);Kt(t.attributes.normal);tt.vertexAttribPointer(t.attributes.normal,3,tt.FLOAT,false,0,0)}if(e.hasUvs&&n.map){tt.bindBuffer(tt.ARRAY_BUFFER,e.__webglUvBuffer);tt.bufferData(tt.ARRAY_BUFFER,e.uvArray,tt.DYNAMIC_DRAW);Kt(t.attributes.uv);tt.vertexAttribPointer(t.attributes.uv,2,tt.FLOAT,false,0,0)}if(e.hasColors&&n.vertexColors!==THREE.NoColors){tt.bindBuffer(tt.ARRAY_BUFFER,e.__webglColorBuffer);tt.bufferData(tt.ARRAY_BUFFER,e.colorArray,tt.DYNAMIC_DRAW);Kt(t.attributes.color);tt.vertexAttribPointer(t.attributes.color,3,tt.FLOAT,false,0,0)}Qt();tt.drawArrays(tt.TRIANGLES,0,e.count);e.count=0};this.renderBufferDirect=function(e,t,n,r,i,s){if(r.visible===false)return;var o=wn(e,t,n,r,s);var u=false,a=r.wireframe?1:0,f=i.id*16777215+o.id*2+a;if(f!==N){N=f;u=true}if(u){Jt()}if(s instanceof THREE.Mesh){var l=r.wireframe===true?tt.LINES:tt.TRIANGLES;var c=i.attributes.index;if(c){var h,p;if(c.array instanceof Uint32Array&&it.get("OES_element_index_uint")){h=tt.UNSIGNED_INT;p=4}else{h=tt.UNSIGNED_SHORT;p=2}var d=i.offsets;if(d.length===0){if(u){$t(r,o,i,0);tt.bindBuffer(tt.ELEMENT_ARRAY_BUFFER,c.buffer)}tt.drawElements(l,c.array.length,h,0);w.info.render.calls++;w.info.render.vertices+=c.array.length;w.info.render.faces+=c.array.length/3}else{u=true;for(var v=0,m=d.length;v<m;v++){var g=d[v].index;if(u){$t(r,o,i,g);tt.bindBuffer(tt.ELEMENT_ARRAY_BUFFER,c.buffer)}tt.drawElements(l,d[v].count,h,d[v].start*p);w.info.render.calls++;w.info.render.vertices+=d[v].count;w.info.render.faces+=d[v].count/3}}}else{if(u){$t(r,o,i,0)}var y=i.attributes["position"];tt.drawArrays(l,0,y.array.length/3);w.info.render.calls++;w.info.render.vertices+=y.array.length/3;w.info.render.faces+=y.array.length/9}}else if(s instanceof THREE.PointCloud){if(u){$t(r,o,i,0)}var y=i.attributes.position;tt.drawArrays(tt.POINTS,0,y.array.length/3);w.info.render.calls++;w.info.render.points+=y.array.length/3}else if(s instanceof THREE.Line){var l=s.mode===THREE.LineStrip?tt.LINE_STRIP:tt.LINES;Fn(r.linewidth);var c=i.attributes.index;if(c){var h,p;if(c.array instanceof Uint32Array){h=tt.UNSIGNED_INT;p=4}else{h=tt.UNSIGNED_SHORT;p=2}var d=i.offsets;if(d.length===0){if(u){$t(r,o,i,0);tt.bindBuffer(tt.ELEMENT_ARRAY_BUFFER,c.buffer)}tt.drawElements(l,c.array.length,h,0);w.info.render.calls++;w.info.render.vertices+=c.array.length}else{if(d.length>1)u=true;for(var v=0,m=d.length;v<m;v++){var g=d[v].index;if(u){$t(r,o,i,g);tt.bindBuffer(tt.ELEMENT_ARRAY_BUFFER,c.buffer)}tt.drawElements(l,d[v].count,h,d[v].start*p);w.info.render.calls++;w.info.render.vertices+=d[v].count}}}else{if(u){$t(r,o,i,0)}var y=i.attributes.position;tt.drawArrays(l,0,y.array.length/3);w.info.render.calls++;w.info.render.points+=y.array.length/3}}};this.renderBuffer=function(e,t,n,r,i,s){if(r.visible===false)return;var o=wn(e,t,n,r,s);var u=o.attributes;var a=false,f=r.wireframe?1:0,l=i.id*16777215+o.id*2+f;if(l!==N){N=l;a=true}if(a){Jt()}if(!r.morphTargets&&u.position>=0){if(a){tt.bindBuffer(tt.ARRAY_BUFFER,i.__webglVertexBuffer);Kt(u.position);tt.vertexAttribPointer(u.position,3,tt.FLOAT,false,0,0)}}else{if(s.morphTargetBase){Gt(r,i,s)}}if(a){if(i.__webglCustomAttributesList){for(var c=0,h=i.__webglCustomAttributesList.length;c<h;c++){var p=i.__webglCustomAttributesList[c];if(u[p.buffer.belongsToAttribute]>=0){tt.bindBuffer(tt.ARRAY_BUFFER,p.buffer);Kt(u[p.buffer.belongsToAttribute]);tt.vertexAttribPointer(u[p.buffer.belongsToAttribute],p.size,tt.FLOAT,false,0,0)}}}if(u.color>=0){if(s.geometry.colors.length>0||s.geometry.faces.length>0){tt.bindBuffer(tt.ARRAY_BUFFER,i.__webglColorBuffer);Kt(u.color);tt.vertexAttribPointer(u.color,3,tt.FLOAT,false,0,0)}else if(r.defaultAttributeValues!==undefined){tt.vertexAttrib3fv(u.color,r.defaultAttributeValues.color)}}if(u.normal>=0){tt.bindBuffer(tt.ARRAY_BUFFER,i.__webglNormalBuffer);Kt(u.normal);tt.vertexAttribPointer(u.normal,3,tt.FLOAT,false,0,0)}if(u.tangent>=0){tt.bindBuffer(tt.ARRAY_BUFFER,i.__webglTangentBuffer);Kt(u.tangent);tt.vertexAttribPointer(u.tangent,4,tt.FLOAT,false,0,0)}if(u.uv>=0){if(s.geometry.faceVertexUvs[0]){tt.bindBuffer(tt.ARRAY_BUFFER,i.__webglUVBuffer);Kt(u.uv);tt.vertexAttribPointer(u.uv,2,tt.FLOAT,false,0,0)}else if(r.defaultAttributeValues!==undefined){tt.vertexAttrib2fv(u.uv,r.defaultAttributeValues.uv)}}if(u.uv2>=0){if(s.geometry.faceVertexUvs[1]){tt.bindBuffer(tt.ARRAY_BUFFER,i.__webglUV2Buffer);Kt(u.uv2);tt.vertexAttribPointer(u.uv2,2,tt.FLOAT,false,0,0)}else if(r.defaultAttributeValues!==undefined){tt.vertexAttrib2fv(u.uv2,r.defaultAttributeValues.uv2)}}if(r.skinning&&u.skinIndex>=0&&u.skinWeight>=0){tt.bindBuffer(tt.ARRAY_BUFFER,i.__webglSkinIndicesBuffer);Kt(u.skinIndex);tt.vertexAttribPointer(u.skinIndex,4,tt.FLOAT,false,0,0);tt.bindBuffer(tt.ARRAY_BUFFER,i.__webglSkinWeightsBuffer);Kt(u.skinWeight);tt.vertexAttribPointer(u.skinWeight,4,tt.FLOAT,false,0,0)}if(u.lineDistance>=0){tt.bindBuffer(tt.ARRAY_BUFFER,i.__webglLineDistanceBuffer);Kt(u.lineDistance);tt.vertexAttribPointer(u.lineDistance,1,tt.FLOAT,false,0,0)}}Qt();if(s instanceof THREE.Mesh){var d=i.__typeArray===Uint32Array?tt.UNSIGNED_INT:tt.UNSIGNED_SHORT;if(r.wireframe){Fn(r.wireframeLinewidth);if(a)tt.bindBuffer(tt.ELEMENT_ARRAY_BUFFER,i.__webglLineBuffer);tt.drawElements(tt.LINES,i.__webglLineCount,d,0)}else{if(a)tt.bindBuffer(tt.ELEMENT_ARRAY_BUFFER,i.__webglFaceBuffer);tt.drawElements(tt.TRIANGLES,i.__webglFaceCount,d,0)}w.info.render.calls++;w.info.render.vertices+=i.__webglFaceCount;w.info.render.faces+=i.__webglFaceCount/3}else if(s instanceof THREE.Line){var v=s.mode===THREE.LineStrip?tt.LINE_STRIP:tt.LINES;Fn(r.linewidth);tt.drawArrays(v,0,i.__webglLineCount);w.info.render.calls++}else if(s instanceof THREE.PointCloud){tt.drawArrays(tt.POINTS,0,i.__webglParticleCount);w.info.render.calls++;w.info.render.points+=i.__webglParticleCount}};this.render=function(e,t,n,r){if(t instanceof THREE.Camera===false){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}var i=e.fog;N=-1;T=-1;C=null;Z=true;if(e.autoUpdate===true)e.updateMatrixWorld();if(t.parent===undefined)t.updateMatrixWorld();e.traverse(function(e){if(e instanceof THREE.SkinnedMesh){e.skeleton.update()}});t.matrixWorldInverse.getInverse(t.matrixWorld);K.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse);J.setFromMatrix(K);p.length=0;m.length=0;g.length=0;y.length=0;b.length=0;tn(e,e);if(w.sortObjects===true){m.sort(Yt);g.sort(Zt)}Et.render(e,t);w.info.render.calls=0;w.info.render.vertices=0;w.info.render.faces=0;w.info.render.points=0;this.setRenderTarget(n);if(this.autoClear||r){this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil)}for(var s=0,o=v.length;s<o;s++){var u=v[s];var a=u.object;if(a.visible){Pn(a,t);sn(u)}}if(e.overrideMaterial){var f=e.overrideMaterial;this.setBlending(f.blending,f.blendEquation,f.blendSrc,f.blendDst);this.setDepthTest(f.depthTest);this.setDepthWrite(f.depthWrite);In(f.polygonOffset,f.polygonOffsetFactor,f.polygonOffsetUnits);nn(m,t,p,i,true,f);nn(g,t,p,i,true,f);rn(v,"",t,p,i,false,f)}else{var f=null;this.setBlending(THREE.NoBlending);nn(m,t,p,i,false,f);rn(v,"opaque",t,p,i,false,f);nn(g,t,p,i,true,f);rn(v,"transparent",t,p,i,true,f)}St.render(e,t);xt.render(e,t,W,X);if(n&&n.generateMipmaps&&n.minFilter!==THREE.NearestFilter&&n.minFilter!==THREE.LinearFilter){Vn(n)}this.setDepthTest(true);this.setDepthWrite(true)};this.renderImmediateObject=function(e,t,n,r,i){var s=wn(e,t,n,r,i);N=-1;w.setMaterialFaces(r);if(i.immediateRenderCallback){i.immediateRenderCallback(s,tt,J)}else{i.render(function(e){w.renderBufferImmediate(e,s,r)})}};var an={};var fn=0;this.setFaceCulling=function(e,t){if(e===THREE.CullFaceNone){tt.disable(tt.CULL_FACE)}else{if(t===THREE.FrontFaceDirectionCW){tt.frontFace(tt.CW)}else{tt.frontFace(tt.CCW)}if(e===THREE.CullFaceBack){tt.cullFace(tt.BACK)}else if(e===THREE.CullFaceFront){tt.cullFace(tt.FRONT)}else{tt.cullFace(tt.FRONT_AND_BACK)}tt.enable(tt.CULL_FACE)}};this.setMaterialFaces=function(e){var t=e.side===THREE.DoubleSide;var n=e.side===THREE.BackSide;if(L!==t){if(t){tt.disable(tt.CULL_FACE)}else{tt.enable(tt.CULL_FACE)}L=t}if(A!==n){if(n){tt.frontFace(tt.CW)}else{tt.frontFace(tt.CCW)}A=n}};this.setDepthTest=function(e){if(P!==e){if(e){tt.enable(tt.DEPTH_TEST)}else{tt.disable(tt.DEPTH_TEST)}P=e}};this.setDepthWrite=function(e){if(H!==e){tt.depthMask(e);H=e}};this.setBlending=function(e,t,n,r){if(e!==O){if(e===THREE.NoBlending){tt.disable(tt.BLEND)}else if(e===THREE.AdditiveBlending){tt.enable(tt.BLEND);tt.blendEquation(tt.FUNC_ADD);tt.blendFunc(tt.SRC_ALPHA,tt.ONE)}else if(e===THREE.SubtractiveBlending){tt.enable(tt.BLEND);tt.blendEquation(tt.FUNC_ADD);tt.blendFunc(tt.ZERO,tt.ONE_MINUS_SRC_COLOR)}else if(e===THREE.MultiplyBlending){tt.enable(tt.BLEND);tt.blendEquation(tt.FUNC_ADD);tt.blendFunc(tt.ZERO,tt.SRC_COLOR)}else if(e===THREE.CustomBlending){tt.enable(tt.BLEND)}else{tt.enable(tt.BLEND);tt.blendEquationSeparate(tt.FUNC_ADD,tt.FUNC_ADD);tt.blendFuncSeparate(tt.SRC_ALPHA,tt.ONE_MINUS_SRC_ALPHA,tt.ONE,tt.ONE_MINUS_SRC_ALPHA)}O=e}if(e===THREE.CustomBlending){if(t!==M){tt.blendEquation(Jn(t));M=t}if(n!==_||r!==D){tt.blendFunc(Jn(n),Jn(r));_=n;D=r}}else{M=null;_=null;D=null}};this.uploadTexture=function(e){if(e.__webglInit===undefined){e.__webglInit=true;e.addEventListener("dispose",At);e.__webglTexture=tt.createTexture();w.info.memory.textures++}tt.bindTexture(tt.TEXTURE_2D,e.__webglTexture);tt.pixelStorei(tt.UNPACK_FLIP_Y_WEBGL,e.flipY);tt.pixelStorei(tt.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha);tt.pixelStorei(tt.UNPACK_ALIGNMENT,e.unpackAlignment);e.image=Rn(e.image,at);var t=e.image,n=THREE.Math.isPowerOfTwo(t.width)&&THREE.Math.isPowerOfTwo(t.height),r=Jn(e.format),i=Jn(e.type);qn(tt.TEXTURE_2D,e,n);var s,o=e.mipmaps;if(e instanceof THREE.DataTexture){if(o.length>0&&n){for(var u=0,a=o.length;u<a;u++){s=o[u];tt.texImage2D(tt.TEXTURE_2D,u,r,s.width,s.height,0,r,i,s.data)}e.generateMipmaps=false}else{tt.texImage2D(tt.TEXTURE_2D,0,r,t.width,t.height,0,r,i,t.data)}}else if(e instanceof THREE.CompressedTexture){for(var u=0,a=o.length;u<a;u++){s=o[u];if(e.format!==THREE.RGBAFormat&&e.format!==THREE.RGBFormat){if(yt().indexOf(r)>-1){tt.compressedTexImage2D(tt.TEXTURE_2D,u,r,s.width,s.height,0,s.data)}else{console.warn("Attempt to load unsupported compressed texture format")}}else{tt.texImage2D(tt.TEXTURE_2D,u,r,s.width,s.height,0,r,i,s.data)}}}else{if(o.length>0&&n){for(var u=0,a=o.length;u<a;u++){s=o[u];tt.texImage2D(tt.TEXTURE_2D,u,r,r,i,s)}e.generateMipmaps=false}else{tt.texImage2D(tt.TEXTURE_2D,0,r,r,i,e.image)}}if(e.generateMipmaps&&n)tt.generateMipmap(tt.TEXTURE_2D);e.needsUpdate=false;if(e.onUpdate)e.onUpdate()};this.setTexture=function(e,t){tt.activeTexture(tt.TEXTURE0+t);if(e.needsUpdate){w.uploadTexture(e)}else{tt.bindTexture(tt.TEXTURE_2D,e.__webglTexture)}};this.setRenderTarget=function(e){var t=e instanceof THREE.WebGLRenderTargetCube;if(e&&e.__webglFramebuffer===undefined){if(e.depthBuffer===undefined)e.depthBuffer=true;if(e.stencilBuffer===undefined)e.stencilBuffer=true;e.addEventListener("dispose",Ot);e.__webglTexture=tt.createTexture();w.info.memory.textures++;var n=THREE.Math.isPowerOfTwo(e.width)&&THREE.Math.isPowerOfTwo(e.height),r=Jn(e.format),i=Jn(e.type);if(t){e.__webglFramebuffer=[];e.__webglRenderbuffer=[];tt.bindTexture(tt.TEXTURE_CUBE_MAP,e.__webglTexture);qn(tt.TEXTURE_CUBE_MAP,e,n);for(var s=0;s<6;s++){e.__webglFramebuffer[s]=tt.createFramebuffer();e.__webglRenderbuffer[s]=tt.createRenderbuffer();tt.texImage2D(tt.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,r,e.width,e.height,0,r,i,null);Wn(e.__webglFramebuffer[s],e,tt.TEXTURE_CUBE_MAP_POSITIVE_X+s);Xn(e.__webglRenderbuffer[s],e)}if(n)tt.generateMipmap(tt.TEXTURE_CUBE_MAP)}else{e.__webglFramebuffer=tt.createFramebuffer();if(e.shareDepthFrom){e.__webglRenderbuffer=e.shareDepthFrom.__webglRenderbuffer}else{e.__webglRenderbuffer=tt.createRenderbuffer()}tt.bindTexture(tt.TEXTURE_2D,e.__webglTexture);qn(tt.TEXTURE_2D,e,n);tt.texImage2D(tt.TEXTURE_2D,0,r,e.width,e.height,0,r,i,null);Wn(e.__webglFramebuffer,e,tt.TEXTURE_2D);if(e.shareDepthFrom){if(e.depthBuffer&&!e.stencilBuffer){tt.framebufferRenderbuffer(tt.FRAMEBUFFER,tt.DEPTH_ATTACHMENT,tt.RENDERBUFFER,e.__webglRenderbuffer)}else if(e.depthBuffer&&e.stencilBuffer){tt.framebufferRenderbuffer(tt.FRAMEBUFFER,tt.DEPTH_STENCIL_ATTACHMENT,tt.RENDERBUFFER,e.__webglRenderbuffer)}}else{Xn(e.__webglRenderbuffer,e)}if(n)tt.generateMipmap(tt.TEXTURE_2D)}if(t){tt.bindTexture(tt.TEXTURE_CUBE_MAP,null)}else{tt.bindTexture(tt.TEXTURE_2D,null)}tt.bindRenderbuffer(tt.RENDERBUFFER,null);tt.bindFramebuffer(tt.FRAMEBUFFER,null)}var o,u,a,f,l;if(e){if(t){o=e.__webglFramebuffer[e.activeCubeFace]}else{o=e.__webglFramebuffer}u=e.width;a=e.height;f=0;l=0}else{o=null;u=U;a=z;f=q;l=R}if(o!==x){tt.bindFramebuffer(tt.FRAMEBUFFER,o);tt.viewport(f,l,u,a);x=o}W=u;X=a};this.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")};this.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")};this.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")};this.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")}};THREE.WebGLRenderTarget=function(e,t,n){this.width=e;this.height=t;n=n||{};this.wrapS=n.wrapS!==undefined?n.wrapS:THREE.ClampToEdgeWrapping;this.wrapT=n.wrapT!==undefined?n.wrapT:THREE.ClampToEdgeWrapping;this.magFilter=n.magFilter!==undefined?n.magFilter:THREE.LinearFilter;this.minFilter=n.minFilter!==undefined?n.minFilter:THREE.LinearMipMapLinearFilter;this.anisotropy=n.anisotropy!==undefined?n.anisotropy:1;this.offset=new THREE.Vector2(0,0);this.repeat=new THREE.Vector2(1,1);this.format=n.format!==undefined?n.format:THREE.RGBAFormat;this.type=n.type!==undefined?n.type:THREE.UnsignedByteType;this.depthBuffer=n.depthBuffer!==undefined?n.depthBuffer:true;this.stencilBuffer=n.stencilBuffer!==undefined?n.stencilBuffer:true;this.generateMipmaps=true;this.shareDepthFrom=null};THREE.WebGLRenderTarget.prototype={constructor:THREE.WebGLRenderTarget,setSize:function(e,t){this.width=e;this.height=t},clone:function(){var e=new THREE.WebGLRenderTarget(this.width,this.height);e.wrapS=this.wrapS;e.wrapT=this.wrapT;e.magFilter=this.magFilter;e.minFilter=this.minFilter;e.anisotropy=this.anisotropy;e.offset.copy(this.offset);e.repeat.copy(this.repeat);e.format=this.format;e.type=this.type;e.depthBuffer=this.depthBuffer;e.stencilBuffer=this.stencilBuffer;e.generateMipmaps=this.generateMipmaps;e.shareDepthFrom=this.shareDepthFrom;return e},dispose:function(){this.dispatchEvent({type:"dispose"})}};THREE.EventDispatcher.prototype.apply(THREE.WebGLRenderTarget.prototype);THREE.WebGLRenderTargetCube=function(e,t,n){THREE.WebGLRenderTarget.call(this,e,t,n);this.activeCubeFace=0};THREE.WebGLRenderTargetCube.prototype=Object.create(THREE.WebGLRenderTarget.prototype);THREE.WebGLExtensions=function(e){var t={};this.get=function(n){if(t[n]!==undefined){return t[n]}var r;switch(n){case"OES_texture_float":r=e.getExtension("OES_texture_float");break;case"OES_texture_float_linear":r=e.getExtension("OES_texture_float_linear");break;case"OES_standard_derivatives":r=e.getExtension("OES_standard_derivatives");break;case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;case"OES_element_index_uint":r=e.getExtension("OES_element_index_uint");break;case"EXT_blend_minmax":r=e.getExtension("EXT_blend_minmax");break;case"EXT_frag_depth":r=e.getExtension("EXT_frag_depth");break}if(r===null){console.log("THREE.WebGLRenderer: "+n+" extension not supported.")}t[n]=r;return r}};THREE.WebGLProgram=function(){var e=0;var t=function(e){var t,n,r=[];for(var i in e){t=e[i];if(t===false)continue;n="#define "+i+" "+t;r.push(n)}return r.join("\n")};var n=function(e,t,n){var r={};for(var i=0,s=n.length;i<s;i++){var o=n[i];r[o]=e.getUniformLocation(t,o)}return r};var r=function(e,t,n){var r={};for(var i=0,s=n.length;i<s;i++){var o=n[i];r[o]=e.getAttribLocation(t,o)}return r};return function(i,s,o,u){var a=i;var f=a.context;var l=o.defines;var c=o.__webglShader.uniforms;var h=o.attributes;var p=o.__webglShader.vertexShader;var d=o.__webglShader.fragmentShader;var v=o.index0AttributeName;if(v===undefined&&u.morphTargets===true){v="position"}var m="SHADOWMAP_TYPE_BASIC";if(u.shadowMapType===THREE.PCFShadowMap){m="SHADOWMAP_TYPE_PCF"}else if(u.shadowMapType===THREE.PCFSoftShadowMap){m="SHADOWMAP_TYPE_PCF_SOFT"}var g=t(l);var y=f.createProgram();var b,w;if(o instanceof THREE.RawShaderMaterial){b="";w=""}else{b=["precision "+u.precision+" float;","precision "+u.precision+" int;",g,u.supportsVertexTextures?"#define VERTEX_TEXTURES":"",a.gammaInput?"#define GAMMA_INPUT":"",a.gammaOutput?"#define GAMMA_OUTPUT":"","#define MAX_DIR_LIGHTS "+u.maxDirLights,"#define MAX_POINT_LIGHTS "+u.maxPointLights,"#define MAX_SPOT_LIGHTS "+u.maxSpotLights,"#define MAX_HEMI_LIGHTS "+u.maxHemiLights,"#define MAX_SHADOWS "+u.maxShadows,"#define MAX_BONES "+u.maxBones,u.map?"#define USE_MAP":"",u.envMap?"#define USE_ENVMAP":"",u.lightMap?"#define USE_LIGHTMAP":"",u.bumpMap?"#define USE_BUMPMAP":"",u.normalMap?"#define USE_NORMALMAP":"",u.specularMap?"#define USE_SPECULARMAP":"",u.alphaMap?"#define USE_ALPHAMAP":"",u.vertexColors?"#define USE_COLOR":"",u.skinning?"#define USE_SKINNING":"",u.useVertexTexture?"#define BONE_TEXTURE":"",u.morphTargets?"#define USE_MORPHTARGETS":"",u.morphNormals?"#define USE_MORPHNORMALS":"",u.wrapAround?"#define WRAP_AROUND":"",u.doubleSided?"#define DOUBLE_SIDED":"",u.flipSided?"#define FLIP_SIDED":"",u.shadowMapEnabled?"#define USE_SHADOWMAP":"",u.shadowMapEnabled?"#define "+m:"",u.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",u.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",u.sizeAttenuation?"#define USE_SIZEATTENUATION":"",u.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","attribute vec2 uv2;","#ifdef USE_COLOR","	attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",""].join("\n");w=["precision "+u.precision+" float;","precision "+u.precision+" int;",u.bumpMap||u.normalMap?"#extension GL_OES_standard_derivatives : enable":"",g,"#define MAX_DIR_LIGHTS "+u.maxDirLights,"#define MAX_POINT_LIGHTS "+u.maxPointLights,"#define MAX_SPOT_LIGHTS "+u.maxSpotLights,"#define MAX_HEMI_LIGHTS "+u.maxHemiLights,"#define MAX_SHADOWS "+u.maxShadows,u.alphaTest?"#define ALPHATEST "+u.alphaTest:"",a.gammaInput?"#define GAMMA_INPUT":"",a.gammaOutput?"#define GAMMA_OUTPUT":"",u.useFog&&u.fog?"#define USE_FOG":"",u.useFog&&u.fogExp?"#define FOG_EXP2":"",u.map?"#define USE_MAP":"",u.envMap?"#define USE_ENVMAP":"",u.lightMap?"#define USE_LIGHTMAP":"",u.bumpMap?"#define USE_BUMPMAP":"",u.normalMap?"#define USE_NORMALMAP":"",u.specularMap?"#define USE_SPECULARMAP":"",u.alphaMap?"#define USE_ALPHAMAP":"",u.vertexColors?"#define USE_COLOR":"",u.metal?"#define METAL":"",u.wrapAround?"#define WRAP_AROUND":"",u.doubleSided?"#define DOUBLE_SIDED":"",u.flipSided?"#define FLIP_SIDED":"",u.shadowMapEnabled?"#define USE_SHADOWMAP":"",u.shadowMapEnabled?"#define "+m:"",u.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",u.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",u.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",""].join("\n")}var E=new THREE.WebGLShader(f,f.VERTEX_SHADER,b+p);var S=new THREE.WebGLShader(f,f.FRAGMENT_SHADER,w+d);f.attachShader(y,E);f.attachShader(y,S);if(v!==undefined){f.bindAttribLocation(y,0,v)}f.linkProgram(y);if(f.getProgramParameter(y,f.LINK_STATUS)===false){console.error("THREE.WebGLProgram: Could not initialise shader.");console.error("gl.VALIDATE_STATUS",f.getProgramParameter(y,f.VALIDATE_STATUS));console.error("gl.getError()",f.getError())}if(f.getProgramInfoLog(y)!==""){console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",f.getProgramInfoLog(y))}f.deleteShader(E);f.deleteShader(S);var x=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","modelMatrix","cameraPosition","morphTargetInfluences","bindMatrix","bindMatrixInverse"];if(u.useVertexTexture){x.push("boneTexture");x.push("boneTextureWidth");x.push("boneTextureHeight")}else{x.push("boneGlobalMatrices")}if(u.logarithmicDepthBuffer){x.push("logDepthBufFC")}for(var T in c){x.push(T)}this.uniforms=n(f,y,x);x=["position","normal","uv","uv2","tangent","color","skinIndex","skinWeight","lineDistance"];for(var N=0;N<u.maxMorphTargets;N++){x.push("morphTarget"+N)}for(var N=0;N<u.maxMorphNormals;N++){x.push("morphNormal"+N)}for(var C in h){x.push(C)}this.attributes=r(f,y,x);this.attributesKeys=Object.keys(this.attributes);this.id=e++;this.code=s;this.usedTimes=1;this.program=y;this.vertexShader=E;this.fragmentShader=S;return this}}();THREE.WebGLShader=function(){var e=function(e){var t=e.split("\n");for(var n=0;n<t.length;n++){t[n]=n+1+": "+t[n]}return t.join("\n")};return function(t,n,r){var i=t.createShader(n);t.shaderSource(i,r);t.compileShader(i);if(t.getShaderParameter(i,t.COMPILE_STATUS)===false){console.error("THREE.WebGLShader: Shader couldn't compile.")}if(t.getShaderInfoLog(i)!==""){console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",t.getShaderInfoLog(i));console.warn(e(r))}return i}}();THREE.LensFlarePlugin=function(e,t){function h(t){var r=n.createProgram();var i=n.createShader(n.FRAGMENT_SHADER);var s=n.createShader(n.VERTEX_SHADER);var o="precision "+e.getPrecision()+" float;\n";n.shaderSource(i,o+t.fragmentShader);n.shaderSource(s,o+t.vertexShader);n.compileShader(i);n.compileShader(s);n.attachShader(r,i);n.attachShader(r,s);n.linkProgram(r);return r}var n=e.context;var r,i;var s,o,u;var a;var f,l;var c=function(){var e=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]);var t=new Uint16Array([0,1,2,0,2,3]);r=n.createBuffer();i=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,r);n.bufferData(n.ARRAY_BUFFER,e,n.STATIC_DRAW);n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,i);n.bufferData(n.ELEMENT_ARRAY_BUFFER,t,n.STATIC_DRAW);f=n.createTexture();l=n.createTexture();n.bindTexture(n.TEXTURE_2D,f);n.texImage2D(n.TEXTURE_2D,0,n.RGB,16,16,0,n.RGB,n.UNSIGNED_BYTE,null);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST);n.bindTexture(n.TEXTURE_2D,l);n.texImage2D(n.TEXTURE_2D,0,n.RGBA,16,16,0,n.RGBA,n.UNSIGNED_BYTE,null);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST);a=n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;var c;if(a){c={vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility =        visibility.r / 9.0;","vVisibility *= 1.0 - visibility.g / 9.0;","vVisibility *=       visibility.b / 9.0;","vVisibility *= 1.0 - visibility.a / 9.0;","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * vVisibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")}}else{c={vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision mediump float;","uniform lowp int renderType;","uniform sampler2D map;","uniform sampler2D occlusionMap;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","float visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;","visibility = ( 1.0 - visibility / 4.0 );","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * visibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")}}s=h(c);o={vertex:n.getAttribLocation(s,"position"),uv:n.getAttribLocation(s,"uv")};u={renderType:n.getUniformLocation(s,"renderType"),map:n.getUniformLocation(s,"map"),occlusionMap:n.getUniformLocation(s,"occlusionMap"),opacity:n.getUniformLocation(s,"opacity"),color:n.getUniformLocation(s,"color"),scale:n.getUniformLocation(s,"scale"),rotation:n.getUniformLocation(s,"rotation"),screenPosition:n.getUniformLocation(s,"screenPosition")}};this.render=function(h,p,d,v){if(t.length===0)return;var m=new THREE.Vector3;var g=v/d,y=d*.5,b=v*.5;var w=16/v,E=new THREE.Vector2(w*g,w);var S=new THREE.Vector3(1,1,0),x=new THREE.Vector2(1,1);if(s===undefined){c()}n.useProgram(s);n.enableVertexAttribArray(o.vertex);n.enableVertexAttribArray(o.uv);n.uniform1i(u.occlusionMap,0);n.uniform1i(u.map,1);n.bindBuffer(n.ARRAY_BUFFER,r);n.vertexAttribPointer(o.vertex,2,n.FLOAT,false,2*8,0);n.vertexAttribPointer(o.uv,2,n.FLOAT,false,2*8,8);n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,i);n.disable(n.CULL_FACE);n.depthMask(false);for(var T=0,N=t.length;T<N;T++){w=16/v;E.set(w*g,w);var C=t[T];m.set(C.matrixWorld.elements[12],C.matrixWorld.elements[13],C.matrixWorld.elements[14]);m.applyMatrix4(p.matrixWorldInverse);m.applyProjection(p.projectionMatrix);S.copy(m);x.x=S.x*y+y;x.y=S.y*b+b;if(a||x.x>0&&x.x<d&&x.y>0&&x.y<v){n.activeTexture(n.TEXTURE1);n.bindTexture(n.TEXTURE_2D,f);n.copyTexImage2D(n.TEXTURE_2D,0,n.RGB,x.x-8,x.y-8,16,16,0);n.uniform1i(u.renderType,0);n.uniform2f(u.scale,E.x,E.y);n.uniform3f(u.screenPosition,S.x,S.y,S.z);n.disable(n.BLEND);n.enable(n.DEPTH_TEST);n.drawElements(n.TRIANGLES,6,n.UNSIGNED_SHORT,0);n.activeTexture(n.TEXTURE0);n.bindTexture(n.TEXTURE_2D,l);n.copyTexImage2D(n.TEXTURE_2D,0,n.RGBA,x.x-8,x.y-8,16,16,0);n.uniform1i(u.renderType,1);n.disable(n.DEPTH_TEST);n.activeTexture(n.TEXTURE1);n.bindTexture(n.TEXTURE_2D,f);n.drawElements(n.TRIANGLES,6,n.UNSIGNED_SHORT,0);C.positionScreen.copy(S);if(C.customUpdateCallback){C.customUpdateCallback(C)}else{C.updateLensFlares()}n.uniform1i(u.renderType,2);n.enable(n.BLEND);for(var k=0,L=C.lensFlares.length;k<L;k++){var A=C.lensFlares[k];if(A.opacity>.001&&A.scale>.001){S.x=A.x;S.y=A.y;S.z=A.z;w=A.size*A.scale/v;E.x=w*g;E.y=w;n.uniform3f(u.screenPosition,S.x,S.y,S.z);n.uniform2f(u.scale,E.x,E.y);n.uniform1f(u.rotation,A.rotation);n.uniform1f(u.opacity,A.opacity);n.uniform3f(u.color,A.color.r,A.color.g,A.color.b);e.setBlending(A.blending,A.blendEquation,A.blendSrc,A.blendDst);e.setTexture(A.texture,1);n.drawElements(n.TRIANGLES,6,n.UNSIGNED_SHORT,0)}}}}n.enable(n.CULL_FACE);n.enable(n.DEPTH_TEST);n.depthMask(true);e.resetGLState()}};THREE.ShadowMapPlugin=function(e,t,n,r){function g(e,t,r){if(t.visible){var i=n[t.id];if(i&&t.castShadow&&(t.frustumCulled===false||f.intersectsObject(t)===true)){for(var s=0,o=i.length;s<o;s++){var u=i[s];t._modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,t.matrixWorld);d.push(u)}}for(var s=0,o=t.children.length;s<o;s++){g(e,t.children[s],r)}}}function y(e,t){var n=new THREE.DirectionalLight;n.isVirtual=true;n.onlyShadow=true;n.castShadow=true;n.shadowCameraNear=e.shadowCameraNear;n.shadowCameraFar=e.shadowCameraFar;n.shadowCameraLeft=e.shadowCameraLeft;n.shadowCameraRight=e.shadowCameraRight;n.shadowCameraBottom=e.shadowCameraBottom;n.shadowCameraTop=e.shadowCameraTop;n.shadowCameraVisible=e.shadowCameraVisible;n.shadowDarkness=e.shadowDarkness;n.shadowBias=e.shadowCascadeBias[t];n.shadowMapWidth=e.shadowCascadeWidth[t];n.shadowMapHeight=e.shadowCascadeHeight[t];n.pointsWorld=[];n.pointsFrustum=[];var r=n.pointsWorld,i=n.pointsFrustum;for(var s=0;s<8;s++){r[s]=new THREE.Vector3;i[s]=new THREE.Vector3}var o=e.shadowCascadeNearZ[t];var u=e.shadowCascadeFarZ[t];i[0].set(-1,-1,o);i[1].set(1,-1,o);i[2].set(-1,1,o);i[3].set(1,1,o);i[4].set(-1,-1,u);i[5].set(1,-1,u);i[6].set(-1,1,u);i[7].set(1,1,u);return n}function b(e,t){var n=e.shadowCascadeArray[t];n.position.copy(e.position);n.target.position.copy(e.target.position);n.lookAt(n.target);n.shadowCameraVisible=e.shadowCameraVisible;n.shadowDarkness=e.shadowDarkness;n.shadowBias=e.shadowCascadeBias[t];var r=e.shadowCascadeNearZ[t];var i=e.shadowCascadeFarZ[t];var s=n.pointsFrustum;s[0].z=r;s[1].z=r;s[2].z=r;s[3].z=r;s[4].z=i;s[5].z=i;s[6].z=i;s[7].z=i}function w(e,t){var n=t.shadowCamera,r=t.pointsFrustum,i=t.pointsWorld;c.set(Infinity,Infinity,Infinity);h.set(-Infinity,-Infinity,-Infinity);for(var s=0;s<8;s++){var o=i[s];o.copy(r[s]);o.unproject(e);o.applyMatrix4(n.matrixWorldInverse);if(o.x<c.x)c.x=o.x;if(o.x>h.x)h.x=o.x;if(o.y<c.y)c.y=o.y;if(o.y>h.y)h.y=o.y;if(o.z<c.z)c.z=o.z;if(o.z>h.z)h.z=o.z}n.left=c.x;n.right=h.x;n.top=h.y;n.bottom=c.y;n.updateProjectionMatrix()}function E(e){return e.material instanceof THREE.MeshFaceMaterial?e.material.materials[0]:e.material}var i=e.context;var s,o,u,a,f=new THREE.Frustum,l=new THREE.Matrix4,c=new THREE.Vector3,h=new THREE.Vector3,p=new THREE.Vector3,d=[];var v=THREE.ShaderLib["depthRGBA"];var m=THREE.UniformsUtils.clone(v.uniforms);s=new THREE.ShaderMaterial({uniforms:m,vertexShader:v.vertexShader,fragmentShader:v.fragmentShader});o=new THREE.ShaderMaterial({uniforms:m,vertexShader:v.vertexShader,fragmentShader:v.fragmentShader,morphTargets:true});u=new THREE.ShaderMaterial({uniforms:m,vertexShader:v.vertexShader,fragmentShader:v.fragmentShader,skinning:true});a=new THREE.ShaderMaterial({uniforms:m,vertexShader:v.vertexShader,fragmentShader:v.fragmentShader,morphTargets:true,skinning:true});s._shadowPass=true;o._shadowPass=true;u._shadowPass=true;a._shadowPass=true;this.render=function(n,c){if(e.shadowMapEnabled===false)return;var h,v,m,S,x,T,N,C,k,L,A,O,M,_,D=[],P=0,H=null;i.clearColor(1,1,1,1);i.disable(i.BLEND);i.enable(i.CULL_FACE);i.frontFace(i.CCW);if(e.shadowMapCullFace===THREE.CullFaceFront){i.cullFace(i.FRONT)}else{i.cullFace(i.BACK)}e.setDepthTest(true);for(h=0,v=t.length;h<v;h++){_=t[h];if(!_.castShadow)continue;if(_ instanceof THREE.DirectionalLight&&_.shadowCascade){for(x=0;x<_.shadowCascadeCount;x++){var B;if(!_.shadowCascadeArray[x]){B=y(_,x);B.originalCamera=c;var j=new THREE.Gyroscope;j.position.copy(_.shadowCascadeOffset);j.add(B);j.add(B.target);c.add(j);_.shadowCascadeArray[x]=B;console.log("Created virtualLight",B)}else{B=_.shadowCascadeArray[x]}b(_,x);D[P]=B;P++}}else{D[P]=_;P++}}for(h=0,v=D.length;h<v;h++){_=D[h];if(!_.shadowMap){var F=THREE.LinearFilter;if(e.shadowMapType===THREE.PCFSoftShadowMap){F=THREE.NearestFilter}var I={minFilter:F,magFilter:F,format:THREE.RGBAFormat};_.shadowMap=new THREE.WebGLRenderTarget(_.shadowMapWidth,_.shadowMapHeight,I);_.shadowMapSize=new THREE.Vector2(_.shadowMapWidth,_.shadowMapHeight);_.shadowMatrix=new THREE.Matrix4}if(!_.shadowCamera){if(_ instanceof THREE.SpotLight){_.shadowCamera=new THREE.PerspectiveCamera(_.shadowCameraFov,_.shadowMapWidth/_.shadowMapHeight,_.shadowCameraNear,_.shadowCameraFar)}else if(_ instanceof THREE.DirectionalLight){_.shadowCamera=new THREE.OrthographicCamera(_.shadowCameraLeft,_.shadowCameraRight,_.shadowCameraTop,_.shadowCameraBottom,_.shadowCameraNear,_.shadowCameraFar)}else{console.error("Unsupported light type for shadow");continue}n.add(_.shadowCamera);if(n.autoUpdate===true)n.updateMatrixWorld()}if(_.shadowCameraVisible&&!_.cameraHelper){_.cameraHelper=new THREE.CameraHelper(_.shadowCamera);n.add(_.cameraHelper)}if(_.isVirtual&&B.originalCamera==c){w(c,_)}T=_.shadowMap;N=_.shadowMatrix;C=_.shadowCamera;C.position.setFromMatrixPosition(_.matrixWorld);p.setFromMatrixPosition(_.target.matrixWorld);C.lookAt(p);C.updateMatrixWorld();C.matrixWorldInverse.getInverse(C.matrixWorld);if(_.cameraHelper)_.cameraHelper.visible=_.shadowCameraVisible;if(_.shadowCameraVisible)_.cameraHelper.update();N.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1);N.multiply(C.projectionMatrix);N.multiply(C.matrixWorldInverse);l.multiplyMatrices(C.projectionMatrix,C.matrixWorldInverse);f.setFromMatrix(l);e.setRenderTarget(T);e.clear();d.length=0;g(n,n,C);var q,R,U;for(m=0,S=d.length;m<S;m++){O=d[m];M=O.object;L=O.buffer;q=E(M);R=M.geometry.morphTargets!==undefined&&M.geometry.morphTargets.length>0&&q.morphTargets;U=M instanceof THREE.SkinnedMesh&&q.skinning;if(M.customDepthMaterial){A=M.customDepthMaterial}else if(U){A=R?a:u}else if(R){A=o}else{A=s}e.setMaterialFaces(q);if(L instanceof THREE.BufferGeometry){e.renderBufferDirect(C,t,H,A,L,M)}else{e.renderBuffer(C,t,H,A,L,M)}}for(m=0,S=r.length;m<S;m++){O=r[m];M=O.object;if(M.visible&&M.castShadow){M._modelViewMatrix.multiplyMatrices(C.matrixWorldInverse,M.matrixWorld);e.renderImmediateObject(C,t,H,s,M)}}}var z=e.getClearColor(),W=e.getClearAlpha();i.clearColor(z.r,z.g,z.b,W);i.enable(i.BLEND);if(e.shadowMapCullFace===THREE.CullFaceFront){i.cullFace(i.BACK)}e.resetGLState()};};THREE.SpritePlugin=function(e,t){function l(){var t=n.createProgram();var r=n.createShader(n.VERTEX_SHADER);var i=n.createShader(n.FRAGMENT_SHADER);n.shaderSource(r,["precision "+e.getPrecision()+" float;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position * scale;","vec2 rotatedPosition;","rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","vec4 finalPosition;","finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition;","finalPosition = projectionMatrix * finalPosition;","gl_Position = finalPosition;","}"].join("\n"));n.shaderSource(i,["precision "+e.getPrecision()+" float;","uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n"));n.compileShader(r);n.compileShader(i);n.attachShader(t,r);n.attachShader(t,i);n.linkProgram(t);return t}function c(e,t){if(e.z!==t.z){return t.z-e.z}else{return t.id-e.id}}var n=e.context;var r,i;var s,o,u;var a;var f=function(){var e=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]);var t=new Uint16Array([0,1,2,0,2,3]);r=n.createBuffer();i=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,r);n.bufferData(n.ARRAY_BUFFER,e,n.STATIC_DRAW);n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,i);n.bufferData(n.ELEMENT_ARRAY_BUFFER,t,n.STATIC_DRAW);s=l();o={position:n.getAttribLocation(s,"position"),uv:n.getAttribLocation(s,"uv")};u={uvOffset:n.getUniformLocation(s,"uvOffset"),uvScale:n.getUniformLocation(s,"uvScale"),rotation:n.getUniformLocation(s,"rotation"),scale:n.getUniformLocation(s,"scale"),color:n.getUniformLocation(s,"color"),map:n.getUniformLocation(s,"map"),opacity:n.getUniformLocation(s,"opacity"),modelViewMatrix:n.getUniformLocation(s,"modelViewMatrix"),projectionMatrix:n.getUniformLocation(s,"projectionMatrix"),fogType:n.getUniformLocation(s,"fogType"),fogDensity:n.getUniformLocation(s,"fogDensity"),fogNear:n.getUniformLocation(s,"fogNear"),fogFar:n.getUniformLocation(s,"fogFar"),fogColor:n.getUniformLocation(s,"fogColor"),alphaTest:n.getUniformLocation(s,"alphaTest")};var f=document.createElement("canvas");f.width=8;f.height=8;var c=f.getContext("2d");c.fillStyle="white";c.fillRect(0,0,8,8);a=new THREE.Texture(f);a.needsUpdate=true};this.render=function(l,h){if(t.length===0)return;if(s===undefined){f()}n.useProgram(s);n.enableVertexAttribArray(o.position);n.enableVertexAttribArray(o.uv);n.disable(n.CULL_FACE);n.enable(n.BLEND);n.bindBuffer(n.ARRAY_BUFFER,r);n.vertexAttribPointer(o.position,2,n.FLOAT,false,2*8,0);n.vertexAttribPointer(o.uv,2,n.FLOAT,false,2*8,8);n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,i);n.uniformMatrix4fv(u.projectionMatrix,false,h.projectionMatrix.elements);n.activeTexture(n.TEXTURE0);n.uniform1i(u.map,0);var p=0;var d=0;var v=l.fog;if(v){n.uniform3f(u.fogColor,v.color.r,v.color.g,v.color.b);if(v instanceof THREE.Fog){n.uniform1f(u.fogNear,v.near);n.uniform1f(u.fogFar,v.far);n.uniform1i(u.fogType,1);p=1;d=1}else if(v instanceof THREE.FogExp2){n.uniform1f(u.fogDensity,v.density);n.uniform1i(u.fogType,2);p=2;d=2}}else{n.uniform1i(u.fogType,0);p=0;d=0}for(var m=0,g=t.length;m<g;m++){var y=t[m];y._modelViewMatrix.multiplyMatrices(h.matrixWorldInverse,y.matrixWorld);if(y.renderDepth===null){y.z=-y._modelViewMatrix.elements[14]}else{y.z=y.renderDepth}}t.sort(c);var b=[];for(var m=0,g=t.length;m<g;m++){var y=t[m];var w=y.material;n.uniform1f(u.alphaTest,w.alphaTest);n.uniformMatrix4fv(u.modelViewMatrix,false,y._modelViewMatrix.elements);b[0]=y.scale.x;b[1]=y.scale.y;var E=0;if(l.fog&&w.fog){E=d}if(p!==E){n.uniform1i(u.fogType,E);p=E}if(w.map!==null){n.uniform2f(u.uvOffset,w.map.offset.x,w.map.offset.y);n.uniform2f(u.uvScale,w.map.repeat.x,w.map.repeat.y)}else{n.uniform2f(u.uvOffset,0,0);n.uniform2f(u.uvScale,1,1)}n.uniform1f(u.opacity,w.opacity);n.uniform3f(u.color,w.color.r,w.color.g,w.color.b);n.uniform1f(u.rotation,w.rotation);n.uniform2fv(u.scale,b);e.setBlending(w.blending,w.blendEquation,w.blendSrc,w.blendDst);e.setDepthTest(w.depthTest);e.setDepthWrite(w.depthWrite);if(w.map&&w.map.image&&w.map.image.width){e.setTexture(w.map,0)}else{e.setTexture(a,0)}n.drawElements(n.TRIANGLES,6,n.UNSIGNED_SHORT,0)}n.enable(n.CULL_FACE);e.resetGLState()};};THREE.GeometryUtils={merge:function(e,t,n){console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.");var r;if(t instanceof THREE.Mesh){t.matrixAutoUpdate&&t.updateMatrix();r=t.matrix;t=t.geometry}e.merge(t,r,n)},center:function(e){console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead.");return e.center()}};THREE.ImageUtils={crossOrigin:undefined,loadTexture:function(e,t,n,r){var i=new THREE.ImageLoader;i.crossOrigin=this.crossOrigin;var s=new THREE.Texture(undefined,t);i.load(e,function(e){s.image=e;s.needsUpdate=true;if(n)n(s)},undefined,function(e){if(r)r(e)});s.sourceFile=e;return s},loadTextureCube:function(e,t,n,r){var i=[];var s=new THREE.ImageLoader;s.crossOrigin=this.crossOrigin;var o=new THREE.CubeTexture(i,t);o.flipY=false;var u=0;var a=function(t){s.load(e[t],function(e){o.images[t]=e;u+=1;if(u===6){o.needsUpdate=true;if(n)n(o)}})};for(var f=0,l=e.length;f<l;++f){a(f)}return o},loadCompressedTexture:function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},loadCompressedTextureCube:function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")},getNormalMap:function(e,t){var n=function(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]};var r=function(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2]]};var i=function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return[e[0]/t,e[1]/t,e[2]/t]};t=t|1;var s=e.width;var o=e.height;var u=document.createElement("canvas");u.width=s;u.height=o;var a=u.getContext("2d");a.drawImage(e,0,0);var f=a.getImageData(0,0,s,o).data;var l=a.createImageData(s,o);var c=l.data;for(var h=0;h<s;h++){for(var p=0;p<o;p++){var d=p-1<0?0:p-1;var v=p+1>o-1?o-1:p+1;var m=h-1<0?0:h-1;var g=h+1>s-1?s-1:h+1;var y=[];var b=[0,0,f[(p*s+h)*4]/255*t];y.push([-1,0,f[(p*s+m)*4]/255*t]);y.push([-1,-1,f[(d*s+m)*4]/255*t]);y.push([0,-1,f[(d*s+h)*4]/255*t]);y.push([1,-1,f[(d*s+g)*4]/255*t]);y.push([1,0,f[(p*s+g)*4]/255*t]);y.push([1,1,f[(v*s+g)*4]/255*t]);y.push([0,1,f[(v*s+h)*4]/255*t]);y.push([-1,1,f[(v*s+m)*4]/255*t]);var w=[];var E=y.length;for(var S=0;S<E;S++){var x=y[S];var T=y[(S+1)%E];x=r(x,b);T=r(T,b);w.push(i(n(x,T)))}var N=[0,0,0];for(var S=0;S<w.length;S++){N[0]+=w[S][0];N[1]+=w[S][1];N[2]+=w[S][2]}N[0]/=w.length;N[1]/=w.length;N[2]/=w.length;var C=(p*s+h)*4;c[C]=(N[0]+1)/2*255|0;c[C+1]=(N[1]+1)/2*255|0;c[C+2]=N[2]*255|0;c[C+3]=255}}a.putImageData(l,0,0);return u},generateDataTexture:function(e,t,n){var r=e*t;var i=new Uint8Array(3*r);var s=Math.floor(n.r*255);var o=Math.floor(n.g*255);var u=Math.floor(n.b*255);for(var a=0;a<r;a++){i[a*3]=s;i[a*3+1]=o;i[a*3+2]=u}var f=new THREE.DataTexture(i,e,t,THREE.RGBFormat);f.needsUpdate=true;return f}};THREE.SceneUtils={createMultiMaterialObject:function(e,t){var n=new THREE.Object3D;for(var r=0,i=t.length;r<i;r++){n.add(new THREE.Mesh(e,t[r]))}return n},detach:function(e,t,n){e.applyMatrix(t.matrixWorld);t.remove(e);n.add(e)},attach:function(e,t,n){var r=new THREE.Matrix4;r.getInverse(n.matrixWorld);e.applyMatrix(r);t.remove(e);n.add(e)}};THREE.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){try{return this.faces[this.face][this.weight][this.style]}catch(e){throw"The font "+this.face+" with "+this.weight+" weight and "+this.style+" style is missing."}},loadFace:function(e){var t=e.familyName.toLowerCase();var n=this;n.faces[t]=n.faces[t]||{};n.faces[t][e.cssFontWeight]=n.faces[t][e.cssFontWeight]||{};n.faces[t][e.cssFontWeight][e.cssFontStyle]=e;var r=n.faces[t][e.cssFontWeight][e.cssFontStyle]=e;return e},drawText:function(e){var t=[],n=[];var r,i,s=this.getFace(),o=this.size/s.resolution,u=0,a=String(e).split(""),f=a.length;var l=[];for(r=0;r<f;r++){var c=new THREE.Path;var h=this.extractGlyphPoints(a[r],s,o,u,c);u+=h.offset;l.push(h.path)}var p=u/2;return{paths:l,offset:p}},extractGlyphPoints:function(e,t,n,r,i){var s=[];var o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N=t.glyphs[e]||t.glyphs["?"];if(!N)return;if(N.o){f=N._cachedOutline||(N._cachedOutline=N.o.split(" "));c=f.length;h=n;p=n;for(o=0;o<c;){l=f[o++];switch(l){case"m":d=f[o++]*h+r;v=f[o++]*p;i.moveTo(d,v);break;case"l":d=f[o++]*h+r;v=f[o++]*p;i.lineTo(d,v);break;case"q":m=f[o++]*h+r;g=f[o++]*p;w=f[o++]*h+r;E=f[o++]*p;i.quadraticCurveTo(w,E,m,g);T=s[s.length-1];if(T){y=T.x;b=T.y;for(u=1,a=this.divisions;u<=a;u++){var C=u/a;var k=THREE.Shape.Utils.b2(C,y,w,m);var L=THREE.Shape.Utils.b2(C,b,E,g)}}break;case"b":m=f[o++]*h+r;g=f[o++]*p;w=f[o++]*h+r;E=f[o++]*p;S=f[o++]*h+r;x=f[o++]*p;i.bezierCurveTo(w,E,S,x,m,g);T=s[s.length-1];if(T){y=T.x;b=T.y;for(u=1,a=this.divisions;u<=a;u++){var C=u/a;var k=THREE.Shape.Utils.b3(C,y,w,S,m);var L=THREE.Shape.Utils.b3(C,b,E,x,g)}}break}}}return{offset:N.ha*n,path:i}}};THREE.FontUtils.generateShapes=function(e,t){t=t||{};var n=t.size!==undefined?t.size:100;var r=t.curveSegments!==undefined?t.curveSegments:4;var i=t.font!==undefined?t.font:"helvetiker";var s=t.weight!==undefined?t.weight:"normal";var o=t.style!==undefined?t.style:"normal";THREE.FontUtils.size=n;THREE.FontUtils.divisions=r;THREE.FontUtils.face=i;THREE.FontUtils.weight=s;THREE.FontUtils.style=o;var u=THREE.FontUtils.drawText(e);var a=u.paths;var f=[];for(var l=0,c=a.length;l<c;l++){Array.prototype.push.apply(f,a[l].toShapes())}return f};(function(e){var t=1e-10;var n=function(e,t){var n=e.length;if(n<3)return null;var s=[],o=[],u=[];var a,f,l;if(r(e)>0){for(f=0;f<n;f++)o[f]=f}else{for(f=0;f<n;f++)o[f]=n-1-f}var c=n;var h=2*c;for(f=c-1;c>2;){if(h--<=0){console.log("Warning, unable to triangulate polygon!");if(t)return u;return s}a=f;if(c<=a)a=0;f=a+1;if(c<=f)f=0;l=f+1;if(c<=l)l=0;if(i(e,a,f,l,c,o)){var p,d,v,m,g;p=o[a];d=o[f];v=o[l];s.push([e[p],e[d],e[v]]);u.push([o[a],o[f],o[l]]);for(m=f,g=f+1;g<c;m++,g++){o[m]=o[g]}c--;h=2*c}}if(t)return u;return s};var r=function(e){var t=e.length;var n=0;for(var r=t-1,i=0;i<t;r=i++){n+=e[r].x*e[i].y-e[i].x*e[r].y}return n*.5};var i=function(e,n,r,i,s,o){var u;var a,f,l,c;var h,p,d,v;a=e[o[n]].x;f=e[o[n]].y;l=e[o[r]].x;c=e[o[r]].y;h=e[o[i]].x;p=e[o[i]].y;if(t>(l-a)*(p-f)-(c-f)*(h-a))return false;var m,g,y,b,w,E;var S,x,T,N,C,k;var L,A,O;m=h-l;g=p-c;y=a-h;b=f-p;w=l-a;E=c-f;for(u=0;u<s;u++){d=e[o[u]].x;v=e[o[u]].y;if(d===a&&v===f||d===l&&v===c||d===h&&v===p)continue;S=d-a;x=v-f;T=d-l;N=v-c;C=d-h;k=v-p;O=m*N-g*T;L=w*x-E*S;A=y*k-b*C;if(O>=-t&&A>=-t&&L>=-t)return false}return true};e.Triangulate=n;e.Triangulate.area=r;return e})(THREE.FontUtils);self._typeface_js={faces:THREE.FontUtils.faces,loadFace:THREE.FontUtils.loadFace};THREE.typeface_js=self._typeface_js;THREE.Audio=function(e){THREE.Object3D.call(this);this.type="Audio";this.context=e.context;this.source=this.context.createBufferSource();this.gain=this.context.createGain();this.gain.connect(this.context.destination);this.panner=this.context.createPanner();this.panner.connect(this.gain)};THREE.Audio.prototype=Object.create(THREE.Object3D.prototype);THREE.Audio.prototype.load=function(e){var t=this;var n=new XMLHttpRequest;n.open("GET",e,true);n.responseType="arraybuffer";n.onload=function(e){t.context.decodeAudioData(this.response,function(e){t.source.buffer=e;t.source.connect(t.panner);t.source.start(0)})};n.send();return this};THREE.Audio.prototype.setLoop=function(e){this.source.loop=e};THREE.Audio.prototype.setRefDistance=function(e){this.panner.refDistance=e};THREE.Audio.prototype.setRolloffFactor=function(e){this.panner.rolloffFactor=e};THREE.Audio.prototype.updateMatrixWorld=function(){var e=new THREE.Vector3;return function(t){THREE.Object3D.prototype.updateMatrixWorld.call(this,t);e.setFromMatrixPosition(this.matrixWorld);this.panner.setPosition(e.x,e.y,e.z)}}();THREE.AudioListener=function(){THREE.Object3D.call(this);this.type="AudioListener";this.context=new(window.AudioContext||window.webkitAudioContext)};THREE.AudioListener.prototype=Object.create(THREE.Object3D.prototype);THREE.AudioListener.prototype.updateMatrixWorld=function(){var e=new THREE.Vector3;var t=new THREE.Quaternion;var n=new THREE.Vector3;var r=new THREE.Vector3;var i=new THREE.Vector3;var s=new THREE.Vector3;return function(o){THREE.Object3D.prototype.updateMatrixWorld.call(this,o);var u=this.context.listener;this.matrixWorld.decompose(e,t,n);r.set(0,0,-1).applyQuaternion(t);i.subVectors(e,s);u.setPosition(e.x,e.y,e.z);u.setOrientation(r.x,r.y,r.z,this.up.x,this.up.y,this.up.z);u.setVelocity(i.x,i.y,i.z);s.copy(e)}}();THREE.Curve=function(){};THREE.Curve.prototype.getPoint=function(e){console.log("Warning, getPoint() not implemented!");return null};THREE.Curve.prototype.getPointAt=function(e){var t=this.getUtoTmapping(e);return this.getPoint(t)};THREE.Curve.prototype.getPoints=function(e){if(!e)e=5;var t,n=[];for(t=0;t<=e;t++){n.push(this.getPoint(t/e))}return n};THREE.Curve.prototype.getSpacedPoints=function(e){if(!e)e=5;var t,n=[];for(t=0;t<=e;t++){n.push(this.getPointAt(t/e))}return n};THREE.Curve.prototype.getLength=function(){var e=this.getLengths();return e[e.length-1]};THREE.Curve.prototype.getLengths=function(e){if(!e)e=this.__arcLengthDivisions?this.__arcLengthDivisions:200;if(this.cacheArcLengths&&this.cacheArcLengths.length==e+1&&!this.needsUpdate){return this.cacheArcLengths}this.needsUpdate=false;var t=[];var n,r=this.getPoint(0);var i,s=0;t.push(0);for(i=1;i<=e;i++){n=this.getPoint(i/e);s+=n.distanceTo(r);t.push(s);r=n}this.cacheArcLengths=t;return t};THREE.Curve.prototype.updateArcLengths=function(){this.needsUpdate=true;this.getLengths()};THREE.Curve.prototype.getUtoTmapping=function(e,t){var n=this.getLengths();var r=0,i=n.length;var s;if(t){s=t}else{s=e*n[i-1]}var o=0,u=i-1,a;while(o<=u){r=Math.floor(o+(u-o)/2);a=n[r]-s;if(a<0){o=r+1;continue}else if(a>0){u=r-1;continue}else{u=r;break}}r=u;if(n[r]==s){var f=r/(i-1);return f}var l=n[r];var c=n[r+1];var h=c-l;var p=(s-l)/h;var f=(r+p)/(i-1);return f};THREE.Curve.prototype.getTangent=function(e){var t=1e-4;var n=e-t;var r=e+t;if(n<0)n=0;if(r>1)r=1;var i=this.getPoint(n);var s=this.getPoint(r);var o=s.clone().sub(i);return o.normalize()};THREE.Curve.prototype.getTangentAt=function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)};THREE.Curve.Utils={tangentQuadraticBezier:function(e,t,n,r){return 2*(1-e)*(n-t)+2*e*(r-n)},tangentCubicBezier:function(e,t,n,r,i){return-3*t*(1-e)*(1-e)+3*n*(1-e)*(1-e)-6*e*n*(1-e)+6*e*r*(1-e)-3*e*e*r+3*e*e*i},tangentSpline:function(e,t,n,r,i){var s=6*e*e-6*e;var o=3*e*e-4*e+1;var u=-6*e*e+6*e;var a=3*e*e-2*e;return s+o+u+a},interpolate:function(e,t,n,r,i){var s=(n-e)*.5;var o=(r-t)*.5;var u=i*i;var a=i*u;return(2*t-2*n+s+o)*a+(-3*t+3*n-2*s-o)*u+s*i+t}};THREE.Curve.create=function(e,t){e.prototype=Object.create(THREE.Curve.prototype);e.prototype.getPoint=t;return e};THREE.CurvePath=function(){this.curves=[];this.bends=[];this.autoClose=false};THREE.CurvePath.prototype=Object.create(THREE.Curve.prototype);THREE.CurvePath.prototype.add=function(e){this.curves.push(e)};THREE.CurvePath.prototype.checkConnection=function(){};THREE.CurvePath.prototype.closePath=function(){var e=this.curves[0].getPoint(0);var t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){this.curves.push(new THREE.LineCurve(t,e))}};THREE.CurvePath.prototype.getPoint=function(e){var t=e*this.getLength();var n=this.getCurveLengths();var r=0,i,s;while(r<n.length){if(n[r]>=t){i=n[r]-t;s=this.curves[r];var o=1-i/s.getLength();return s.getPointAt(o);break}r++}return null};THREE.CurvePath.prototype.getLength=function(){var e=this.getCurveLengths();return e[e.length-1]};THREE.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length){return this.cacheLengths}var e=[],t=0;var n,r=this.curves.length;for(n=0;n<r;n++){t+=this.curves[n].getLength();e.push(t)}this.cacheLengths=e;return e};THREE.CurvePath.prototype.getBoundingBox=function(){var e=this.getPoints();var t,n,r;var i,s,o;t=n=Number.NEGATIVE_INFINITY;i=s=Number.POSITIVE_INFINITY;var u,a,f,l;var c=e[0]instanceof THREE.Vector3;l=c?new THREE.Vector3:new THREE.Vector2;for(a=0,f=e.length;a<f;a++){u=e[a];if(u.x>t)t=u.x;else if(u.x<i)i=u.x;if(u.y>n)n=u.y;else if(u.y<s)s=u.y;if(c){if(u.z>r)r=u.z;else if(u.z<o)o=u.z}l.add(u)}var h={minX:i,minY:s,maxX:t,maxY:n};if(c){h.maxZ=r;h.minZ=o}return h};THREE.CurvePath.prototype.createPointsGeometry=function(e){var t=this.getPoints(e,true);return this.createGeometry(t)};THREE.CurvePath.prototype.createSpacedPointsGeometry=function(e){var t=this.getSpacedPoints(e,true);return this.createGeometry(t)};THREE.CurvePath.prototype.createGeometry=function(e){var t=new THREE.Geometry;for(var n=0;n<e.length;n++){t.vertices.push(new THREE.Vector3(e[n].x,e[n].y,e[n].z||0))}return t};THREE.CurvePath.prototype.addWrapPath=function(e){this.bends.push(e)};THREE.CurvePath.prototype.getTransformedPoints=function(e,t){var n=this.getPoints(e);var r,i;if(!t){t=this.bends}for(r=0,i=t.length;r<i;r++){n=this.getWrapPoints(n,t[r])}return n};THREE.CurvePath.prototype.getTransformedSpacedPoints=function(e,t){var n=this.getSpacedPoints(e);var r,i;if(!t){t=this.bends}for(r=0,i=t.length;r<i;r++){n=this.getWrapPoints(n,t[r])}return n};THREE.CurvePath.prototype.getWrapPoints=function(e,t){var n=this.getBoundingBox();var r,i,s,o,u,a;for(r=0,i=e.length;r<i;r++){s=e[r];o=s.x;u=s.y;a=o/n.maxX;a=t.getUtoTmapping(a,o);var f=t.getPoint(a);var l=t.getTangent(a);l.set(-l.y,l.x).multiplyScalar(u);s.x=f.x+l.x;s.y=f.y+l.y}return e};THREE.Gyroscope=function(){THREE.Object3D.call(this)};THREE.Gyroscope.prototype=Object.create(THREE.Object3D.prototype);THREE.Gyroscope.prototype.updateMatrixWorld=function(){var e=new THREE.Vector3;var t=new THREE.Quaternion;var n=new THREE.Vector3;var r=new THREE.Vector3;var i=new THREE.Quaternion;var s=new THREE.Vector3;return function(o){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||o){if(this.parent){this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix);this.matrixWorld.decompose(r,i,s);this.matrix.decompose(e,t,n);this.matrixWorld.compose(r,t,s)}else{this.matrixWorld.copy(this.matrix)}this.matrixWorldNeedsUpdate=false;o=true}for(var u=0,a=this.children.length;u<a;u++){this.children[u].updateMatrixWorld(o)}}}();THREE.Path=function(e){THREE.CurvePath.call(this);this.actions=[];if(e){this.fromPoints(e)}};THREE.Path.prototype=Object.create(THREE.CurvePath.prototype);THREE.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"};THREE.Path.prototype.fromPoints=function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,n=e.length;t<n;t++){this.lineTo(e[t].x,e[t].y)}};THREE.Path.prototype.moveTo=function(e,t){var n=Array.prototype.slice.call(arguments);this.actions.push({action:THREE.PathActions.MOVE_TO,args:n})};THREE.Path.prototype.lineTo=function(e,t){var n=Array.prototype.slice.call(arguments);var r=this.actions[this.actions.length-1].args;var i=r[r.length-2];var s=r[r.length-1];var o=new THREE.LineCurve(new THREE.Vector2(i,s),new THREE.Vector2(e,t));this.curves.push(o);this.actions.push({action:THREE.PathActions.LINE_TO,args:n})};THREE.Path.prototype.quadraticCurveTo=function(e,t,n,r){var i=Array.prototype.slice.call(arguments);var s=this.actions[this.actions.length-1].args;var o=s[s.length-2];var u=s[s.length-1];var a=new THREE.QuadraticBezierCurve(new THREE.Vector2(o,u),new THREE.Vector2(e,t),new THREE.Vector2(n,r));this.curves.push(a);this.actions.push({action:THREE.PathActions.QUADRATIC_CURVE_TO,args:i})};THREE.Path.prototype.bezierCurveTo=function(e,t,n,r,i,s){var o=Array.prototype.slice.call(arguments);var u=this.actions[this.actions.length-1].args;var a=u[u.length-2];var f=u[u.length-1];var l=new THREE.CubicBezierCurve(new THREE.Vector2(a,f),new THREE.Vector2(e,t),new THREE.Vector2(n,r),new THREE.Vector2(i,s));this.curves.push(l);this.actions.push({action:THREE.PathActions.BEZIER_CURVE_TO,args:o})};THREE.Path.prototype.splineThru=function(e){var t=Array.prototype.slice.call(arguments);var n=this.actions[this.actions.length-1].args;var r=n[n.length-2];var i=n[n.length-1];var s=[new THREE.Vector2(r,i)];Array.prototype.push.apply(s,e);var o=new THREE.SplineCurve(s);this.curves.push(o);this.actions.push({action:THREE.PathActions.CSPLINE_THRU,args:t})};THREE.Path.prototype.arc=function(e,t,n,r,i,s){var o=this.actions[this.actions.length-1].args;var u=o[o.length-2];var a=o[o.length-1];this.absarc(e+u,t+a,n,r,i,s)};THREE.Path.prototype.absarc=function(e,t,n,r,i,s){this.absellipse(e,t,n,n,r,i,s)};THREE.Path.prototype.ellipse=function(e,t,n,r,i,s,o){var u=this.actions[this.actions.length-1].args;var a=u[u.length-2];var f=u[u.length-1];this.absellipse(e+a,t+f,n,r,i,s,o)};THREE.Path.prototype.absellipse=function(e,t,n,r,i,s,o){var u=Array.prototype.slice.call(arguments);var a=new THREE.EllipseCurve(e,t,n,r,i,s,o);this.curves.push(a);var f=a.getPoint(1);u.push(f.x);u.push(f.y);this.actions.push({action:THREE.PathActions.ELLIPSE,args:u})};THREE.Path.prototype.getSpacedPoints=function(e,t){if(!e)e=40;var n=[];for(var r=0;r<e;r++){n.push(this.getPoint(r/e))}return n};THREE.Path.prototype.getPoints=function(e,t){if(this.useSpacedPoints){console.log("tata");return this.getSpacedPoints(e,t)}e=e||12;var n=[];var r,i,s,o,u;var a,f,l,c,h,p,d,v,m,g,y,b,w;for(r=0,i=this.actions.length;r<i;r++){s=this.actions[r];o=s.action;u=s.args;switch(o){case THREE.PathActions.MOVE_TO:n.push(new THREE.Vector2(u[0],u[1]));break;case THREE.PathActions.LINE_TO:n.push(new THREE.Vector2(u[0],u[1]));break;case THREE.PathActions.QUADRATIC_CURVE_TO:a=u[2];f=u[3];h=u[0];p=u[1];if(n.length>0){m=n[n.length-1];d=m.x;v=m.y}else{m=this.actions[r-1].args;d=m[m.length-2];v=m[m.length-1]}for(g=1;g<=e;g++){y=g/e;b=THREE.Shape.Utils.b2(y,d,h,a);w=THREE.Shape.Utils.b2(y,v,p,f);n.push(new THREE.Vector2(b,w))}break;case THREE.PathActions.BEZIER_CURVE_TO:a=u[4];f=u[5];h=u[0];p=u[1];l=u[2];c=u[3];if(n.length>0){m=n[n.length-1];d=m.x;v=m.y}else{m=this.actions[r-1].args;d=m[m.length-2];v=m[m.length-1]}for(g=1;g<=e;g++){y=g/e;b=THREE.Shape.Utils.b3(y,d,h,l,a);w=THREE.Shape.Utils.b3(y,v,p,c,f);n.push(new THREE.Vector2(b,w))}break;case THREE.PathActions.CSPLINE_THRU:m=this.actions[r-1].args;var E=new THREE.Vector2(m[m.length-2],m[m.length-1]);var S=[E];var x=e*u[0].length;S=S.concat(u[0]);var T=new THREE.SplineCurve(S);for(g=1;g<=x;g++){n.push(T.getPointAt(g/x))}break;case THREE.PathActions.ARC:var N=u[0],C=u[1],k=u[2],L=u[3],A=u[4],O=!!u[5];var M=A-L;var _;var D=e*2;for(g=1;g<=D;g++){y=g/D;if(!O){y=1-y}_=L+y*M;b=N+k*Math.cos(_);w=C+k*Math.sin(_);n.push(new THREE.Vector2(b,w))}break;case THREE.PathActions.ELLIPSE:var N=u[0],C=u[1],P=u[2],H=u[3],L=u[4],A=u[5],O=!!u[6];var M=A-L;var _;var D=e*2;for(g=1;g<=D;g++){y=g/D;if(!O){y=1-y}_=L+y*M;b=N+P*Math.cos(_);w=C+H*Math.sin(_);n.push(new THREE.Vector2(b,w))}break}}var B=n[n.length-1];var j=1e-10;if(Math.abs(B.x-n[0].x)<j&&Math.abs(B.y-n[0].y)<j)n.splice(n.length-1,1);if(t){n.push(n[0])}return n};THREE.Path.prototype.toShapes=function(e,t){function n(e){var t,n,r,i,s;var o=[],u=new THREE.Path;for(t=0,n=e.length;t<n;t++){r=e[t];s=r.args;i=r.action;if(i==THREE.PathActions.MOVE_TO){if(u.actions.length!=0){o.push(u);u=new THREE.Path}}u[i].apply(u,s)}if(u.actions.length!=0){o.push(u)}return o}function r(e){var t=[];for(var n=0,r=e.length;n<r;n++){var i=e[n];var s=new THREE.Shape;s.actions=i.actions;s.curves=i.curves;t.push(s)}return t}function i(e,t){var n=1e-10;var r=t.length;var i=false;for(var s=r-1,o=0;o<r;s=o++){var u=t[s];var a=t[o];var f=a.x-u.x;var l=a.y-u.y;if(Math.abs(l)>n){if(l<0){u=t[o];f=-f;a=t[s];l=-l}if(e.y<u.y||e.y>a.y)continue;if(e.y==u.y){if(e.x==u.x)return true}else{var c=l*(e.x-u.x)-f*(e.y-u.y);if(c==0)return true;if(c<0)continue;i=!i}}else{if(e.y!=u.y)continue;if(a.x<=e.x&&e.x<=u.x||u.x<=e.x&&e.x<=a.x)return true}}return i}var s=n(this.actions);if(s.length==0)return[];if(t===true)return r(s);var o,u,a,f=[];if(s.length==1){u=s[0];a=new THREE.Shape;a.actions=u.actions;a.curves=u.curves;f.push(a);return f}var l=!THREE.Shape.Utils.isClockWise(s[0].getPoints());l=e?!l:l;var c=[];var h=[];var p=[];var d=0;var v;h[d]=undefined;p[d]=[];var m,g;for(m=0,g=s.length;m<g;m++){u=s[m];v=u.getPoints();o=THREE.Shape.Utils.isClockWise(v);o=e?!o:o;if(o){if(!l&&h[d])d++;h[d]={s:new THREE.Shape,p:v};h[d].s.actions=u.actions;h[d].s.curves=u.curves;if(l)d++;p[d]=[]}else{p[d].push({h:u,p:v[0]})}}if(!h[0])return r(s);if(h.length>1){var y=false;var b=[];for(var w=0,E=h.length;w<E;w++){c[w]=[]}for(var w=0,E=h.length;w<E;w++){var S=h[w];var x=p[w];for(var T=0;T<x.length;T++){var N=x[T];var C=true;for(var k=0;k<h.length;k++){if(i(N.p,h[k].p)){if(w!=k)b.push({froms:w,tos:k,hole:T});if(C){C=false;c[k].push(N)}else{y=true}}}if(C){c[w].push(N)}}}if(b.length>0){if(!y)p=c}}var L,A,O;for(m=0,g=h.length;m<g;m++){a=h[m].s;f.push(a);L=p[m];for(A=0,O=L.length;A<O;A++){a.holes.push(L[A].h)}}return f};THREE.Shape=function(){THREE.Path.apply(this,arguments);this.holes=[]};THREE.Shape.prototype=Object.create(THREE.Path.prototype);THREE.Shape.prototype.extrude=function(e){var t=new THREE.ExtrudeGeometry(this,e);return t};THREE.Shape.prototype.makeGeometry=function(e){var t=new THREE.ShapeGeometry(this,e);return t};THREE.Shape.prototype.getPointsHoles=function(e){var t,n=this.holes.length,r=[];for(t=0;t<n;t++){r[t]=this.holes[t].getTransformedPoints(e,this.bends)}return r};THREE.Shape.prototype.getSpacedPointsHoles=function(e){var t,n=this.holes.length,r=[];for(t=0;t<n;t++){r[t]=this.holes[t].getTransformedSpacedPoints(e,this.bends)}return r};THREE.Shape.prototype.extractAllPoints=function(e){return{shape:this.getTransformedPoints(e),holes:this.getPointsHoles(e)}};THREE.Shape.prototype.extractPoints=function(e){if(this.useSpacedPoints){return this.extractAllSpacedPoints(e)}return this.extractAllPoints(e)};THREE.Shape.prototype.extractAllSpacedPoints=function(e){return{shape:this.getTransformedSpacedPoints(e),holes:this.getSpacedPointsHoles(e)}};THREE.Shape.Utils={triangulateShape:function(e,t){function n(e,t,n){if(e.x!=t.x){if(e.x<t.x){return e.x<=n.x&&n.x<=t.x}else{return t.x<=n.x&&n.x<=e.x}}else{if(e.y<t.y){return e.y<=n.y&&n.y<=t.y}else{return t.y<=n.y&&n.y<=e.y}}}function r(e,t,r,i,s){var o=1e-10;var u=t.x-e.x,a=t.y-e.y;var f=i.x-r.x,l=i.y-r.y;var c=e.x-r.x;var h=e.y-r.y;var p=a*f-u*l;var d=a*c-u*h;if(Math.abs(p)>o){var v;if(p>0){if(d<0||d>p)return[];v=l*c-f*h;if(v<0||v>p)return[]}else{if(d>0||d<p)return[];v=l*c-f*h;if(v>0||v<p)return[]}if(v==0){if(s&&(d==0||d==p))return[];return[e]}if(v==p){if(s&&(d==0||d==p))return[];return[t]}if(d==0)return[r];if(d==p)return[i];var m=v/p;return[{x:e.x+m*u,y:e.y+m*a}]}else{if(d!=0||l*c!=f*h)return[];var g=u==0&&a==0;var y=f==0&&l==0;if(g&&y){if(e.x!=r.x||e.y!=r.y)return[];return[e]}if(g){if(!n(r,i,e))return[];return[e]}if(y){if(!n(e,t,r))return[];return[r]}var b,w,E,S;var x,T,N,C;if(u!=0){if(e.x<t.x){b=e;E=e.x;w=t;S=t.x}else{b=t;E=t.x;w=e;S=e.x}if(r.x<i.x){x=r;N=r.x;T=i;C=i.x}else{x=i;N=i.x;T=r;C=r.x}}else{if(e.y<t.y){b=e;E=e.y;w=t;S=t.y}else{b=t;E=t.y;w=e;S=e.y}if(r.y<i.y){x=r;N=r.y;T=i;C=i.y}else{x=i;N=i.y;T=r;C=r.y}}if(E<=N){if(S<N)return[];if(S==N){if(s)return[];return[x]}if(S<=C)return[x,w];return[x,T]}else{if(E>C)return[];if(E==C){if(s)return[];return[b]}if(S<=C)return[b,w];return[b,T]}}}function i(e,t,n,r){var i=1e-10;var s=t.x-e.x,o=t.y-e.y;var u=n.x-e.x,a=n.y-e.y;var f=r.x-e.x,l=r.y-e.y;var c=s*a-o*u;var h=s*l-o*f;if(Math.abs(c)>i){var p=f*a-l*u;if(c>0){return h>=0&&p>=0}else{return h>=0||p>=0}}else{return h>0}}function s(e,t){function o(e,t){var r=n.length-1;var o=e-1;if(o<0)o=r;var u=e+1;if(u>r)u=0;var a=i(n[e],n[o],n[u],s[t]);if(!a){return false}var f=s.length-1;var l=t-1;if(l<0)l=f;var c=t+1;if(c>f)c=0;a=i(s[t],s[l],s[c],n[e]);if(!a){return false}return true}function u(e,t){var i,s,o;for(i=0;i<n.length;i++){s=i+1;s%=n.length;o=r(e,t,n[i],n[s],true);if(o.length>0)return true}return false}function f(e,n){var i,s,o,u,f;for(i=0;i<a.length;i++){s=t[a[i]];for(o=0;o<s.length;o++){u=o+1;u%=s.length;f=r(e,n,s[o],s[u],true);if(f.length>0)return true}}return false}var n=e.concat();var s;var a=[];var l,c,h,p,d,v,m=[],g,y,b,w;for(var E=0,S=t.length;E<S;E++){a.push(E)}var x=0;var T=a.length*2;while(a.length>0){T--;if(T<0){console.log("Infinite Loop! Holes left:"+a.length+", Probably Hole outside Shape!");break}for(c=x;c<n.length;c++){h=n[c];l=-1;for(var E=0;E<a.length;E++){d=a[E];v=h.x+":"+h.y+":"+d;if(m[v]!==undefined)continue;s=t[d];for(var N=0;N<s.length;N++){p=s[N];if(!o(c,N))continue;if(u(h,p))continue;if(f(h,p))continue;l=N;a.splice(E,1);g=n.slice(0,c+1);y=n.slice(c);b=s.slice(l);w=s.slice(0,l+1);n=g.concat(b).concat(w).concat(y);x=c;break}if(l>=0)break;m[v]=true}if(l>=0)break}}return n}var o,u,a,f,l,c,h={};var p=e.concat();for(var d=0,v=t.length;d<v;d++){Array.prototype.push.apply(p,t[d])}for(o=0,u=p.length;o<u;o++){l=p[o].x+":"+p[o].y;if(h[l]!==undefined){console.log("Duplicate point",l)}h[l]=o}var m=s(e,t);var g=THREE.FontUtils.Triangulate(m,false);return g;for(o=0,u=g.length;o<u;o++){f=g[o];for(a=0;a<3;a++){l=f[a].x+":"+f[a].y;c=h[l];if(c!==undefined){f[a]=c}}}return g.concat()},isClockWise:function(e){return THREE.FontUtils.Triangulate.area(e)<0},b2p0:function(e,t){var n=1-e;return n*n*t},b2p1:function(e,t){return 2*(1-e)*e*t},b2p2:function(e,t){return e*e*t},b2:function(e,t,n,r){return this.b2p0(e,t)+this.b2p1(e,n)+this.b2p2(e,r)},b3p0:function(e,t){var n=1-e;return n*n*n*t},b3p1:function(e,t){var n=1-e;return 3*n*n*e*t},b3p2:function(e,t){var n=1-e;return 3*n*e*e*t},b3p3:function(e,t){return e*e*e*t},b3:function(e,t,n,r,i){return this.b3p0(e,t)+this.b3p1(e,n)+this.b3p2(e,r)+this.b3p3(e,i)}};THREE.LineCurve=function(e,t){this.v1=e;this.v2=t};THREE.LineCurve.prototype=Object.create(THREE.Curve.prototype);THREE.LineCurve.prototype.getPoint=function(e){var t=this.v2.clone().sub(this.v1);t.multiplyScalar(e).add(this.v1);return t};THREE.LineCurve.prototype.getPointAt=function(e){return this.getPoint(e)};THREE.LineCurve.prototype.getTangent=function(e){var t=this.v2.clone().sub(this.v1);return t.normalize()};THREE.QuadraticBezierCurve=function(e,t,n){this.v0=e;this.v1=t;this.v2=n};THREE.QuadraticBezierCurve.prototype=Object.create(THREE.Curve.prototype);THREE.QuadraticBezierCurve.prototype.getPoint=function(e){var t=new THREE.Vector2;t.x=THREE.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x);t.y=THREE.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y);return t};THREE.QuadraticBezierCurve.prototype.getTangent=function(e){var t=new THREE.Vector2;t.x=THREE.Curve.Utils.tangentQuadraticBezier(e,this.v0.x,this.v1.x,this.v2.x);t.y=THREE.Curve.Utils.tangentQuadraticBezier(e,this.v0.y,this.v1.y,this.v2.y);return t.normalize()};THREE.CubicBezierCurve=function(e,t,n,r){this.v0=e;this.v1=t;this.v2=n;this.v3=r};THREE.CubicBezierCurve.prototype=Object.create(THREE.Curve.prototype);THREE.CubicBezierCurve.prototype.getPoint=function(e){var t,n;t=THREE.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x);n=THREE.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y);return new THREE.Vector2(t,n)};THREE.CubicBezierCurve.prototype.getTangent=function(e){var t,n;t=THREE.Curve.Utils.tangentCubicBezier(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x);n=THREE.Curve.Utils.tangentCubicBezier(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y);var r=new THREE.Vector2(t,n);r.normalize();return r};THREE.SplineCurve=function(e){this.points=e==undefined?[]:e};THREE.SplineCurve.prototype=Object.create(THREE.Curve.prototype);THREE.SplineCurve.prototype.getPoint=function(e){var t=this.points;var n=(t.length-1)*e;var r=Math.floor(n);var i=n-r;var s=t[r==0?r:r-1];var o=t[r];var u=t[r>t.length-2?t.length-1:r+1];var a=t[r>t.length-3?t.length-1:r+2];var f=new THREE.Vector2;f.x=THREE.Curve.Utils.interpolate(s.x,o.x,u.x,a.x,i);f.y=THREE.Curve.Utils.interpolate(s.y,o.y,u.y,a.y,i);return f};THREE.EllipseCurve=function(e,t,n,r,i,s,o){this.aX=e;this.aY=t;this.xRadius=n;this.yRadius=r;this.aStartAngle=i;this.aEndAngle=s;this.aClockwise=o};THREE.EllipseCurve.prototype=Object.create(THREE.Curve.prototype);THREE.EllipseCurve.prototype.getPoint=function(e){var t=this.aEndAngle-this.aStartAngle;if(t<0)t+=Math.PI*2;if(t>Math.PI*2)t-=Math.PI*2;var n;if(this.aClockwise===true){n=this.aEndAngle+(1-e)*(Math.PI*2-t)}else{n=this.aStartAngle+e*t}var r=new THREE.Vector2;r.x=this.aX+this.xRadius*Math.cos(n);r.y=this.aY+this.yRadius*Math.sin(n);return r};THREE.ArcCurve=function(e,t,n,r,i,s){THREE.EllipseCurve.call(this,e,t,n,n,r,i,s)};THREE.ArcCurve.prototype=Object.create(THREE.EllipseCurve.prototype);THREE.LineCurve3=THREE.Curve.create(function(e,t){this.v1=e;this.v2=t},function(e){var t=new THREE.Vector3;t.subVectors(this.v2,this.v1);t.multiplyScalar(e);t.add(this.v1);return t});THREE.QuadraticBezierCurve3=THREE.Curve.create(function(e,t,n){this.v0=e;this.v1=t;this.v2=n},function(e){var t=new THREE.Vector3;t.x=THREE.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x);t.y=THREE.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y);t.z=THREE.Shape.Utils.b2(e,this.v0.z,this.v1.z,this.v2.z);return t});THREE.CubicBezierCurve3=THREE.Curve.create(function(e,t,n,r){this.v0=e;this.v1=t;this.v2=n;this.v3=r},function(e){var t=new THREE.Vector3;t.x=THREE.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x);t.y=THREE.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y);t.z=THREE.Shape.Utils.b3(e,this.v0.z,this.v1.z,this.v2.z,this.v3.z);return t});THREE.SplineCurve3=THREE.Curve.create(function(e){this.points=e==undefined?[]:e},function(e){var t=this.points;var n=(t.length-1)*e;var r=Math.floor(n);var i=n-r;var s=t[r==0?r:r-1];var o=t[r];var u=t[r>t.length-2?t.length-1:r+1];var a=t[r>t.length-3?t.length-1:r+2];var f=new THREE.Vector3;f.x=THREE.Curve.Utils.interpolate(s.x,o.x,u.x,a.x,i);f.y=THREE.Curve.Utils.interpolate(s.y,o.y,u.y,a.y,i);f.z=THREE.Curve.Utils.interpolate(s.z,o.z,u.z,a.z,i);return f});THREE.ClosedSplineCurve3=THREE.Curve.create(function(e){this.points=e==undefined?[]:e},function(e){var t=this.points;var n=(t.length-0)*e;var r=Math.floor(n);var i=n-r;r+=r>0?0:(Math.floor(Math.abs(r)/t.length)+1)*t.length;var s=t[(r-1)%t.length];var o=t[r%t.length];var u=t[(r+1)%t.length];var a=t[(r+2)%t.length];var f=new THREE.Vector3;f.x=THREE.Curve.Utils.interpolate(s.x,o.x,u.x,a.x,i);f.y=THREE.Curve.Utils.interpolate(s.y,o.y,u.y,a.y,i);f.z=THREE.Curve.Utils.interpolate(s.z,o.z,u.z,a.z,i);return f});THREE.AnimationHandler={LINEAR:0,CATMULLROM:1,CATMULLROM_FORWARD:2,add:function(){console.warn("THREE.AnimationHandler.add() has been deprecated.")},get:function(){console.warn("THREE.AnimationHandler.get() has been deprecated.")},remove:function(){console.warn("THREE.AnimationHandler.remove() has been deprecated.")},animations:[],init:function(e){if(e.initialized===true)return;for(var t=0;t<e.hierarchy.length;t++){for(var n=0;n<e.hierarchy[t].keys.length;n++){if(e.hierarchy[t].keys[n].time<0){e.hierarchy[t].keys[n].time=0}if(e.hierarchy[t].keys[n].rot!==undefined&&!(e.hierarchy[t].keys[n].rot instanceof THREE.Quaternion)){var r=e.hierarchy[t].keys[n].rot;e.hierarchy[t].keys[n].rot=(new THREE.Quaternion).fromArray(r)}}if(e.hierarchy[t].keys.length&&e.hierarchy[t].keys[0].morphTargets!==undefined){var i={};for(var n=0;n<e.hierarchy[t].keys.length;n++){for(var s=0;s<e.hierarchy[t].keys[n].morphTargets.length;s++){var o=e.hierarchy[t].keys[n].morphTargets[s];i[o]=-1}}e.hierarchy[t].usedMorphTargets=i;for(var n=0;n<e.hierarchy[t].keys.length;n++){var u={};for(var o in i){for(var s=0;s<e.hierarchy[t].keys[n].morphTargets.length;s++){if(e.hierarchy[t].keys[n].morphTargets[s]===o){u[o]=e.hierarchy[t].keys[n].morphTargetsInfluences[s];break}}if(s===e.hierarchy[t].keys[n].morphTargets.length){u[o]=0}}e.hierarchy[t].keys[n].morphTargetsInfluences=u}}for(var n=1;n<e.hierarchy[t].keys.length;n++){if(e.hierarchy[t].keys[n].time===e.hierarchy[t].keys[n-1].time){e.hierarchy[t].keys.splice(n,1);n--}}for(var n=0;n<e.hierarchy[t].keys.length;n++){e.hierarchy[t].keys[n].index=n}}e.initialized=true;return e},parse:function(e){var t=function(e,n){n.push(e);for(var r=0;r<e.children.length;r++)t(e.children[r],n)};var n=[];if(e instanceof THREE.SkinnedMesh){for(var r=0;r<e.skeleton.bones.length;r++){n.push(e.skeleton.bones[r])}}else{t(e,n)}return n},play:function(e){if(this.animations.indexOf(e)===-1){this.animations.push(e)}},stop:function(e){var t=this.animations.indexOf(e);if(t!==-1){this.animations.splice(t,1)}},update:function(e){for(var t=0;t<this.animations.length;t++){this.animations[t].resetBlendWeights()}for(var t=0;t<this.animations.length;t++){this.animations[t].update(e)}}};THREE.Animation=function(e,t){this.root=e;this.data=THREE.AnimationHandler.init(t);this.hierarchy=THREE.AnimationHandler.parse(e);this.currentTime=0;this.timeScale=1;this.isPlaying=false;this.loop=true;this.weight=0;this.interpolationType=THREE.AnimationHandler.LINEAR};THREE.Animation.prototype.keyTypes=["pos","rot","scl"];THREE.Animation.prototype.play=function(e,t){this.currentTime=e!==undefined?e:0;this.weight=t!==undefined?t:1;this.isPlaying=true;this.reset();THREE.AnimationHandler.play(this)};THREE.Animation.prototype.stop=function(){this.isPlaying=false;THREE.AnimationHandler.stop(this)};THREE.Animation.prototype.reset=function(){for(var e=0,t=this.hierarchy.length;e<t;e++){var n=this.hierarchy[e];n.matrixAutoUpdate=true;if(n.animationCache===undefined){n.animationCache={animations:{},blending:{positionWeight:0,quaternionWeight:0,scaleWeight:0}}}if(n.animationCache.animations[this.data.name]===undefined){n.animationCache.animations[this.data.name]={};n.animationCache.animations[this.data.name].prevKey={pos:0,rot:0,scl:0};n.animationCache.animations[this.data.name].nextKey={pos:0,rot:0,scl:0};n.animationCache.animations[this.data.name].originalMatrix=n.matrix}var r=n.animationCache.animations[this.data.name];for(var i=0;i<3;i++){var s=this.keyTypes[i];var o=this.data.hierarchy[e].keys[0];var u=this.getNextKeyWith(s,e,1);while(u.time<this.currentTime&&u.index>o.index){o=u;u=this.getNextKeyWith(s,e,u.index+1)}r.prevKey[s]=o;r.nextKey[s]=u}}};THREE.Animation.prototype.resetBlendWeights=function(){for(var e=0,t=this.hierarchy.length;e<t;e++){var n=this.hierarchy[e];if(n.animationCache!==undefined){n.animationCache.blending.positionWeight=0;n.animationCache.blending.quaternionWeight=0;n.animationCache.blending.scaleWeight=0}}};THREE.Animation.prototype.update=function(){var e=[];var t=new THREE.Vector3;var n=new THREE.Vector3;var r=new THREE.Quaternion;var i=function(e,t){var n=[],r=[],i,o,u,a,f,l,c,h,p;i=(e.length-1)*t;o=Math.floor(i);u=i-o;n[0]=o===0?o:o-1;n[1]=o;n[2]=o>e.length-2?o:o+1;n[3]=o>e.length-3?o:o+2;l=e[n[0]];c=e[n[1]];h=e[n[2]];p=e[n[3]];a=u*u;f=u*a;r[0]=s(l[0],c[0],h[0],p[0],u,a,f);r[1]=s(l[1],c[1],h[1],p[1],u,a,f);r[2]=s(l[2],c[2],h[2],p[2],u,a,f);return r};var s=function(e,t,n,r,i,s,o){var u=(n-e)*.5,a=(r-t)*.5;return(2*(t-n)+u+a)*o+(-3*(t-n)-2*u-a)*s+u*i+t};return function(s){if(this.isPlaying===false)return;this.currentTime+=s*this.timeScale;if(this.weight===0)return;var o=this.data.length;if(this.currentTime>o||this.currentTime<0){if(this.loop){this.currentTime%=o;if(this.currentTime<0)this.currentTime+=o;this.reset()}else{this.stop();return}}for(var u=0,a=this.hierarchy.length;u<a;u++){var f=this.hierarchy[u];var l=f.animationCache.animations[this.data.name];var c=f.animationCache.blending;for(var h=0;h<3;h++){var p=this.keyTypes[h];var d=l.prevKey[p];var v=l.nextKey[p];if(this.timeScale>0&&v.time<=this.currentTime||this.timeScale<0&&d.time>=this.currentTime){d=this.data.hierarchy[u].keys[0];v=this.getNextKeyWith(p,u,1);while(v.time<this.currentTime&&v.index>d.index){d=v;v=this.getNextKeyWith(p,u,v.index+1)}l.prevKey[p]=d;l.nextKey[p]=v}f.matrixAutoUpdate=true;f.matrixWorldNeedsUpdate=true;var m=(this.currentTime-d.time)/(v.time-d.time);var g=d[p];var y=v[p];if(m<0)m=0;if(m>1)m=1;if(p==="pos"){if(this.interpolationType===THREE.AnimationHandler.LINEAR){n.x=g[0]+(y[0]-g[0])*m;n.y=g[1]+(y[1]-g[1])*m;n.z=g[2]+(y[2]-g[2])*m;var b=this.weight/(this.weight+c.positionWeight);f.position.lerp(n,b);c.positionWeight+=this.weight}else if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){e[0]=this.getPrevKeyWith("pos",u,d.index-1)["pos"];e[1]=g;e[2]=y;e[3]=this.getNextKeyWith("pos",u,v.index+1)["pos"];m=m*.33+.33;var w=i(e,m);var b=this.weight/(this.weight+c.positionWeight);c.positionWeight+=this.weight;var E=f.position;E.x=E.x+(w[0]-E.x)*b;E.y=E.y+(w[1]-E.y)*b;E.z=E.z+(w[2]-E.z)*b;if(this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){var S=i(e,m*1.01);t.set(S[0],S[1],S[2]);t.sub(E);t.y=0;t.normalize();var x=Math.atan2(t.x,t.z);f.rotation.set(0,x,0)}}}else if(p==="rot"){THREE.Quaternion.slerp(g,y,r,m);if(c.quaternionWeight===0){f.quaternion.copy(r);c.quaternionWeight=this.weight}else{var b=this.weight/(this.weight+c.quaternionWeight);THREE.Quaternion.slerp(f.quaternion,r,f.quaternion,b);c.quaternionWeight+=this.weight}}else if(p==="scl"){n.x=g[0]+(y[0]-g[0])*m;n.y=g[1]+(y[1]-g[1])*m;n.z=g[2]+(y[2]-g[2])*m;var b=this.weight/(this.weight+c.scaleWeight);f.scale.lerp(n,b);c.scaleWeight+=this.weight}}}return true}}();THREE.Animation.prototype.getNextKeyWith=function(e,t,n){var r=this.data.hierarchy[t].keys;if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){n=n<r.length-1?n:r.length-1}else{n=n%r.length}for(;n<r.length;n++){if(r[n][e]!==undefined){return r[n]}}return this.data.hierarchy[t].keys[0]};THREE.Animation.prototype.getPrevKeyWith=function(e,t,n){var r=this.data.hierarchy[t].keys;if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){n=n>0?n:0}else{n=n>=0?n:n+r.length}for(;n>=0;n--){if(r[n][e]!==undefined){return r[n]}}return this.data.hierarchy[t].keys[r.length-1]};THREE.KeyFrameAnimation=function(e){this.root=e.node;this.data=THREE.AnimationHandler.init(e);this.hierarchy=THREE.AnimationHandler.parse(this.root);this.currentTime=0;this.timeScale=.001;this.isPlaying=false;this.isPaused=true;this.loop=true;for(var t=0,n=this.hierarchy.length;t<n;t++){var r=this.data.hierarchy[t].keys,i=this.data.hierarchy[t].sids,s=this.hierarchy[t];if(r.length&&i){for(var o=0;o<i.length;o++){var u=i[o],a=this.getNextKeyWith(u,t,0);if(a){a.apply(u)}}s.matrixAutoUpdate=false;this.data.hierarchy[t].node.updateMatrix();s.matrixWorldNeedsUpdate=true}}};THREE.KeyFrameAnimation.prototype.play=function(e){this.currentTime=e!==undefined?e:0;if(this.isPlaying===false){this.isPlaying=true;var t,n=this.hierarchy.length,r,i;for(t=0;t<n;t++){r=this.hierarchy[t];i=this.data.hierarchy[t];if(i.animationCache===undefined){i.animationCache={};i.animationCache.prevKey=null;i.animationCache.nextKey=null;i.animationCache.originalMatrix=r.matrix}var s=this.data.hierarchy[t].keys;if(s.length){i.animationCache.prevKey=s[0];i.animationCache.nextKey=s[1];this.startTime=Math.min(s[0].time,this.startTime);this.endTime=Math.max(s[s.length-1].time,this.endTime)}}this.update(0)}this.isPaused=false;THREE.AnimationHandler.play(this)};THREE.KeyFrameAnimation.prototype.stop=function(){this.isPlaying=false;this.isPaused=false;THREE.AnimationHandler.stop(this);for(var e=0;e<this.data.hierarchy.length;e++){var t=this.hierarchy[e];var n=this.data.hierarchy[e];if(n.animationCache!==undefined){var r=n.animationCache.originalMatrix;r.copy(t.matrix);t.matrix=r;delete n.animationCache}}};THREE.KeyFrameAnimation.prototype.update=function(e){if(this.isPlaying===false)return;this.currentTime+=e*this.timeScale;var t=this.data.length;if(this.loop===true&&this.currentTime>t){this.currentTime%=t}this.currentTime=Math.min(this.currentTime,t);for(var n=0,r=this.hierarchy.length;n<r;n++){var i=this.hierarchy[n];var s=this.data.hierarchy[n];var o=s.keys,u=s.animationCache;if(o.length){var a=u.prevKey;var f=u.nextKey;if(f.time<=this.currentTime){while(f.time<this.currentTime&&f.index>a.index){a=f;f=o[a.index+1]}u.prevKey=a;u.nextKey=f}if(f.time>=this.currentTime){a.interpolate(f,this.currentTime)}else{a.interpolate(f,f.time)}this.data.hierarchy[n].node.updateMatrix();i.matrixWorldNeedsUpdate=true}}};THREE.KeyFrameAnimation.prototype.getNextKeyWith=function(e,t,n){var r=this.data.hierarchy[t].keys;n=n%r.length;for(;n<r.length;n++){if(r[n].hasTarget(e)){return r[n]}}return r[0]};THREE.KeyFrameAnimation.prototype.getPrevKeyWith=function(e,t,n){var r=this.data.hierarchy[t].keys;n=n>=0?n:n+r.length;for(;n>=0;n--){if(r[n].hasTarget(e)){return r[n]}}return r[r.length-1]};THREE.MorphAnimation=function(e){this.mesh=e;this.frames=e.morphTargetInfluences.length;this.currentTime=0;this.duration=1e3;this.loop=true;this.isPlaying=false};THREE.MorphAnimation.prototype={play:function(){this.isPlaying=true},pause:function(){this.isPlaying=false},update:function(){var e=0;var t=0;return function(n){if(this.isPlaying===false)return;this.currentTime+=n;if(this.loop===true&&this.currentTime>this.duration){this.currentTime%=this.duration}this.currentTime=Math.min(this.currentTime,this.duration);var r=this.duration/this.frames;var i=Math.floor(this.currentTime/r);if(i!=t){this.mesh.morphTargetInfluences[e]=0;this.mesh.morphTargetInfluences[t]=1;this.mesh.morphTargetInfluences[i]=0;e=t;t=i}this.mesh.morphTargetInfluences[i]=this.currentTime%r/r;this.mesh.morphTargetInfluences[e]=1-this.mesh.morphTargetInfluences[i]}}()};THREE.BoxGeometry=function(e,t,n,r,i,s){function l(e,t,n,r,i,s,u,a){var f,l,c,h=o.widthSegments,p=o.heightSegments,d=i/2,v=s/2,m=o.vertices.length;if(e==="x"&&t==="y"||e==="y"&&t==="x"){f="z"}else if(e==="x"&&t==="z"||e==="z"&&t==="x"){f="y";p=o.depthSegments}else if(e==="z"&&t==="y"||e==="y"&&t==="z"){f="x";h=o.depthSegments}var g=h+1,y=p+1,b=i/h,w=s/p,E=new THREE.Vector3;E[f]=u>0?1:-1;for(c=0;c<y;c++){for(l=0;l<g;l++){var S=new THREE.Vector3;S[e]=(l*b-d)*n;S[t]=(c*w-v)*r;S[f]=u;o.vertices.push(S)}}for(c=0;c<p;c++){for(l=0;l<h;l++){var x=l+g*c;var T=l+g*(c+1);var N=l+1+g*(c+1);var C=l+1+g*c;var k=new THREE.Vector2(l/h,1-c/p);var L=new THREE.Vector2(l/h,1-(c+1)/p);var A=new THREE.Vector2((l+1)/h,1-(c+1)/p);var O=new THREE.Vector2((l+1)/h,1-c/p);var M=new THREE.Face3(x+m,T+m,C+m);M.normal.copy(E);M.vertexNormals.push(E.clone(),E.clone(),E.clone());M.materialIndex=a;o.faces.push(M);o.faceVertexUvs[0].push([k,L,O]);M=new THREE.Face3(T+m,N+m,C+m);M.normal.copy(E);M.vertexNormals.push(E.clone(),E.clone(),E.clone());M.materialIndex=a;o.faces.push(M);o.faceVertexUvs[0].push([L.clone(),A,O.clone()])}}}THREE.Geometry.call(this);this.type="BoxGeometry";this.parameters={width:e,height:t,depth:n,widthSegments:r,heightSegments:i,depthSegments:s};this.widthSegments=r||1;this.heightSegments=i||1;this.depthSegments=s||1;var o=this;var u=e/2;var a=t/2;var f=n/2;l("z","y",-1,-1,n,t,u,0);l("z","y",1,-1,n,t,-u,1);l("x","z",1,1,e,n,a,2);l("x","z",1,-1,e,n,-a,3);l("x","y",1,-1,e,t,f,4);l("x","y",-1,-1,e,t,-f,5);this.mergeVertices()};THREE.BoxGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.CircleGeometry=function(e,t,n,r){THREE.Geometry.call(this);this.type="CircleGeometry";this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:r};e=e||50;t=t!==undefined?Math.max(3,t):8;n=n!==undefined?n:0;r=r!==undefined?r:Math.PI*2;var i,s=[],o=new THREE.Vector3,u=new THREE.Vector2(.5,.5);this.vertices.push(o);s.push(u);for(i=0;i<=t;i++){var a=new THREE.Vector3;var f=n+i/t*r;a.x=e*Math.cos(f);a.y=e*Math.sin(f);this.vertices.push(a);s.push(new THREE.Vector2((a.x/e+1)/2,(a.y/e+1)/2))}var l=new THREE.Vector3(0,0,1);for(i=1;i<=t;i++){this.faces.push(new THREE.Face3(i,i+1,0,[l.clone(),l.clone(),l.clone()]));this.faceVertexUvs[0].push([s[i].clone(),s[i+1].clone(),u.clone()])}this.computeFaceNormals();this.boundingSphere=new THREE.Sphere(new THREE.Vector3,e)};THREE.CircleGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.CubeGeometry=function(e,t,n,r,i,s){console.warn("THREE.CubeGeometry has been renamed to THREE.BoxGeometry.");return new THREE.BoxGeometry(e,t,n,r,i,s)};THREE.CylinderGeometry=function(e,t,n,r,i,s){THREE.Geometry.call(this);this.type="CylinderGeometry";this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:r,heightSegments:i,openEnded:s};e=e!==undefined?e:20;t=t!==undefined?t:20;n=n!==undefined?n:100;r=r||8;i=i||1;s=s!==undefined?s:false;var o=n/2;var u,a,f=[],l=[];for(a=0;a<=i;a++){var c=[];var h=[];var p=a/i;var d=p*(t-e)+e;for(u=0;u<=r;u++){var v=u/r;var m=new THREE.Vector3;m.x=d*Math.sin(v*Math.PI*2);m.y=-p*n+o;m.z=d*Math.cos(v*Math.PI*2);this.vertices.push(m);c.push(this.vertices.length-1);h.push(new THREE.Vector2(v,1-p))}f.push(c);l.push(h)}var g=(t-e)/n;var y,b;for(u=0;u<r;u++){if(e!==0){y=this.vertices[f[0][u]].clone();b=this.vertices[f[0][u+1]].clone()}else{y=this.vertices[f[1][u]].clone();b=this.vertices[f[1][u+1]].clone()}y.setY(Math.sqrt(y.x*y.x+y.z*y.z)*g).normalize();b.setY(Math.sqrt(b.x*b.x+b.z*b.z)*g).normalize();for(a=0;a<i;a++){var w=f[a][u];var E=f[a+1][u];var S=f[a+1][u+1];var x=f[a][u+1];var T=y.clone();var N=y.clone();var C=b.clone();var k=b.clone();var L=l[a][u].clone();var A=l[a+1][u].clone();var O=l[a+1][u+1].clone();var M=l[a][u+1].clone();this.faces.push(new THREE.Face3(w,E,x,[T,N,k]));this.faceVertexUvs[0].push([L,A,M]);this.faces.push(new THREE.Face3(E,S,x,[N.clone(),C,k.clone()]));this.faceVertexUvs[0].push([A.clone(),O,M.clone()])}}if(s===false&&e>0){this.vertices.push(new THREE.Vector3(0,o,0));for(u=0;u<r;u++){var w=f[0][u];var E=f[0][u+1];var S=this.vertices.length-1;var T=new THREE.Vector3(0,1,0);var N=new THREE.Vector3(0,1,0);var C=new THREE.Vector3(0,1,0);var L=l[0][u].clone();var A=l[0][u+1].clone();var O=new THREE.Vector2(A.x,0);this.faces.push(new THREE.Face3(w,E,S,[T,N,C]));this.faceVertexUvs[0].push([L,A,O])}}if(s===false&&t>0){this.vertices.push(new THREE.Vector3(0,-o,0));for(u=0;u<r;u++){var w=f[a][u+1];var E=f[a][u];var S=this.vertices.length-1;var T=new THREE.Vector3(0,-1,0);var N=new THREE.Vector3(0,-1,0);var C=new THREE.Vector3(0,-1,0);var L=l[a][u+1].clone();var A=l[a][u].clone();var O=new THREE.Vector2(A.x,1);this.faces.push(new THREE.Face3(w,E,S,[T,N,C]));this.faceVertexUvs[0].push([L,A,O])}}this.computeFaceNormals()};THREE.CylinderGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ExtrudeGeometry=function(e,t){if(typeof e==="undefined"){e=[];return}THREE.Geometry.call(this);this.type="ExtrudeGeometry";e=e instanceof Array?e:[e];this.addShapeList(e,t);this.computeFaceNormals()};THREE.ExtrudeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ExtrudeGeometry.prototype.addShapeList=function(e,t){var n=e.length;for(var r=0;r<n;r++){var i=e[r];this.addShape(i,t)}};THREE.ExtrudeGeometry.prototype.addShape=function(e,t){function M(e,t,n){if(!t)console.log("die");return t.clone().multiplyScalar(n).add(e)}function z(e,t,n){var r=1e-10;var i,s,o=1;var u=e.x-t.x,a=e.y-t.y;var f=n.x-e.x,l=n.y-e.y;var c=u*u+a*a;var h=u*l-a*f;if(Math.abs(h)>r){var p=Math.sqrt(c);var d=Math.sqrt(f*f+l*l);var v=t.x-a/p;var m=t.y+u/p;var g=n.x-l/d;var y=n.y+f/d;var b=((g-v)*l-(y-m)*f)/(u*l-a*f);i=v+u*b-e.x;s=m+a*b-e.y;var w=i*i+s*s;if(w<=2){return new THREE.Vector2(i,s)}else{o=Math.sqrt(w/2)}}else{var E=false;if(u>r){if(f>r){E=true}}else{if(u<-r){if(f<-r){E=true}}else{if(Math.sign(a)==Math.sign(l)){E=true}}}if(E){i=-a;s=u;o=Math.sqrt(c)}else{i=u;s=a;o=Math.sqrt(c/2)}}return new THREE.Vector2(i/o,s/o)}function nt(){if(o){var e=0;var t=j*e;for(X=0;X<I;X++){F=A[X];ot(F[2]+t,F[1]+t,F[0]+t)}e=a+s*2;t=j*e;for(X=0;X<I;X++){F=A[X];ot(F[0]+t,F[1]+t,F[2]+t)}}else{for(X=0;X<I;X++){F=A[X];ot(F[2],F[1],F[0])}for(X=0;X<I;X++){F=A[X];ot(F[0]+j*a,F[1]+j*a,F[2]+j*a)}}}function rt(){var e=0;it(O,e);e+=O.length;for(w=0,E=k.length;w<E;w++){b=k[w];it(b,e);e+=b.length}}function it(e,t){var n,r;X=e.length;while(--X>=0){n=X;r=X-1;if(r<0)r=e.length-1;var i=0,o=a+s*2;for(i=0;i<o;i++){var u=j*i;var f=j*(i+1);var l=t+n+u,c=t+r+u,h=t+r+f,p=t+n+f;ut(l,c,h,p,e,i,o,n,r)}}}function st(e,t,n){S.vertices.push(new THREE.Vector3(e,t,n))}function ot(e,t,n){e+=T;t+=T;n+=T;S.faces.push(new THREE.Face3(e,t,n,null,null,h));var r=d.generateTopUV(S,e,t,n);S.faceVertexUvs[0].push(r)}function ut(e,t,n,r,i,s,o,u,a){e+=T;t+=T;n+=T;r+=T;S.faces.push(new THREE.Face3(e,t,r,null,null,p));S.faces.push(new THREE.Face3(t,n,r,null,null,p));var f=d.generateSideWallUV(S,e,t,n,r);S.faceVertexUvs[0].push([f[0],f[1],f[3]]);S.faceVertexUvs[0].push([f[1],f[2],f[3]])}var n=t.amount!==undefined?t.amount:100;var r=t.bevelThickness!==undefined?t.bevelThickness:6;var i=t.bevelSize!==undefined?t.bevelSize:r-2;var s=t.bevelSegments!==undefined?t.bevelSegments:3;var o=t.bevelEnabled!==undefined?t.bevelEnabled:true;var u=t.curveSegments!==undefined?t.curveSegments:12;var a=t.steps!==undefined?t.steps:1;var f=t.extrudePath;var l,c=false;var h=t.material;var p=t.extrudeMaterial;var d=t.UVGenerator!==undefined?t.UVGenerator:THREE.ExtrudeGeometry.WorldUVGenerator;var v,m,g,y;if(f){l=f.getSpacedPoints(a);c=true;o=false;v=t.frames!==undefined?t.frames:new THREE.TubeGeometry.FrenetFrames(f,a,false);m=new THREE.Vector3;g=new THREE.Vector3;y=new THREE.Vector3}if(!o){s=0;r=0;i=0}var b,w,E;var S=this;var x=[];var T=this.vertices.length;var N=e.extractPoints(u);var C=N.shape;var k=N.holes;var L=!THREE.Shape.Utils.isClockWise(C);if(L){C=C.reverse();for(w=0,E=k.length;w<E;w++){b=k[w];if(THREE.Shape.Utils.isClockWise(b)){k[w]=b.reverse()}}L=false}var A=THREE.Shape.Utils.triangulateShape(C,k);var O=C;for(w=0,E=k.length;w<E;w++){b=k[w];C=C.concat(b)}var _,D,P,H,B,j=C.length,F,I=A.length,q,R=O.length;var U=180/Math.PI;var W=[];for(var X=0,V=O.length,$=V-1,J=X+1;X<V;X++,$++,J++){if($===V)$=0;if(J===V)J=0;var K=O[X];var Q=O[$];var G=O[J];W[X]=z(O[X],O[$],O[J])}var Y=[],Z,et=W.concat();for(w=0,E=k.length;w<E;w++){b=k[w];Z=[];for(X=0,V=b.length,$=V-1,J=X+1;X<V;X++,$++,J++){if($===V)$=0;if(J===V)J=0;Z[X]=z(b[X],b[$],b[J])}Y.push(Z);et=et.concat(Z)}for(_=0;_<s;_++){P=_/s;H=r*(1-P);D=i*Math.sin(P*Math.PI/2);for(X=0,V=O.length;X<V;X++){B=M(O[X],W[X],D);st(B.x,B.y,-H)}for(w=0,E=k.length;w<E;w++){b=k[w];Z=Y[w];for(X=0,V=b.length;X<V;X++){B=M(b[X],Z[X],D);st(B.x,B.y,-H)}}}D=i;for(X=0;X<j;X++){B=o?M(C[X],et[X],D):C[X];if(!c){st(B.x,B.y,0)}else{g.copy(v.normals[0]).multiplyScalar(B.x);m.copy(v.binormals[0]).multiplyScalar(B.y);y.copy(l[0]).add(g).add(m);st(y.x,y.y,y.z)}}var tt;for(tt=1;tt<=a;tt++){for(X=0;X<j;X++){B=o?M(C[X],et[X],D):C[X];if(!c){st(B.x,B.y,n/a*tt)}else{g.copy(v.normals[tt]).multiplyScalar(B.x);m.copy(v.binormals[tt]).multiplyScalar(B.y);y.copy(l[tt]).add(g).add(m);st(y.x,y.y,y.z)}}}for(_=s-1;_>=0;_--){P=_/s;H=r*(1-P);D=i*Math.sin(P*Math.PI/2);for(X=0,V=O.length;X<V;X++){B=M(O[X],W[X],D);st(B.x,B.y,n+H)}for(w=0,E=k.length;w<E;w++){b=k[w];Z=Y[w];for(X=0,V=b.length;X<V;X++){B=M(b[X],Z[X],D);if(!c){st(B.x,B.y,n+H)}else{st(B.x,B.y+l[a-1].y,l[a-1].x+H)}}}}nt();rt()};THREE.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(e,t,n,r){var i=e.vertices;var s=i[t];var o=i[n];var u=i[r];return[new THREE.Vector2(s.x,s.y),new THREE.Vector2(o.x,o.y),new THREE.Vector2(u.x,u.y)]},generateSideWallUV:function(e,t,n,r,i){var s=e.vertices;var o=s[t];var u=s[n];var a=s[r];var f=s[i];if(Math.abs(o.y-u.y)<.01){return[new THREE.Vector2(o.x,1-o.z),new THREE.Vector2(u.x,1-u.z),new THREE.Vector2(a.x,1-a.z),new THREE.Vector2(f.x,1-f.z)]}else{return[new THREE.Vector2(o.y,1-o.z),new THREE.Vector2(u.y,1-u.z),new THREE.Vector2(a.y,1-a.z),new THREE.Vector2(f.y,1-f.z)]}}};THREE.ShapeGeometry=function(e,t){THREE.Geometry.call(this);this.type="ShapeGeometry";if(e instanceof Array===false)e=[e];this.addShapeList(e,t);this.computeFaceNormals()};THREE.ShapeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ShapeGeometry.prototype.addShapeList=function(e,t){for(var n=0,r=e.length;n<r;n++){this.addShape(e[n],t)}return this};THREE.ShapeGeometry.prototype.addShape=function(e,t){if(t===undefined)t={};var n=t.curveSegments!==undefined?t.curveSegments:12;var r=t.material;var i=t.UVGenerator===undefined?THREE.ExtrudeGeometry.WorldUVGenerator:t.UVGenerator;var s,o,u,a;var f=this.vertices.length;var l=e.extractPoints(n);var c=l.shape;var h=l.holes;var p=!THREE.Shape.Utils.isClockWise(c);if(p){c=c.reverse();for(s=0,o=h.length;s<o;s++){u=h[s];if(THREE.Shape.Utils.isClockWise(u)){h[s]=u.reverse()}}p=false}var d=THREE.Shape.Utils.triangulateShape(c,h);var v=c;for(s=0,o=h.length;s<o;s++){u=h[s];c=c.concat(u)}var m,g=c.length;var y,b=d.length;var w,E=v.length;for(s=0;s<g;s++){m=c[s];this.vertices.push(new THREE.Vector3(m.x,m.y,0))}for(s=0;s<b;s++){y=d[s];var S=y[0]+f;var x=y[1]+f;var T=y[2]+f;this.faces.push(new THREE.Face3(S,x,T,null,null,r));this.faceVertexUvs[0].push(i.generateTopUV(this,S,x,T))}};THREE.LatheGeometry=function(e,t,n,r){THREE.Geometry.call(this);this.type="LatheGeometry";this.parameters={points:e,segments:t,phiStart:n,phiLength:r};t=t||12;n=n||0;r=r||2*Math.PI;var i=1/(e.length-1);var s=1/t;for(var o=0,u=t;o<=u;o++){var a=n+o*s*r;var f=Math.cos(a),l=Math.sin(a);for(var c=0,h=e.length;c<h;c++){var p=e[c];var d=new THREE.Vector3;d.x=f*p.x-l*p.y;d.y=l*p.x+f*p.y;d.z=p.z;this.vertices.push(d)}}var v=e.length;for(var o=0,u=t;o<u;o++){for(var c=0,h=e.length-1;c<h;c++){var m=c+v*o;var g=m;var y=m+v;var f=m+1+v;var b=m+1;var w=o*s;var E=c*i;var S=w+s;var x=E+i;this.faces.push(new THREE.Face3(g,y,b));this.faceVertexUvs[0].push([new THREE.Vector2(w,E),new THREE.Vector2(S,E),new THREE.Vector2(w,x)]);this.faces.push(new THREE.Face3(y,f,b));this.faceVertexUvs[0].push([new THREE.Vector2(S,E),new THREE.Vector2(S,x),new THREE.Vector2(w,x)])}}this.mergeVertices();this.computeFaceNormals();this.computeVertexNormals()};THREE.LatheGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.PlaneGeometry=function(e,t,n,r){console.info("THREE.PlaneGeometry: Consider using THREE.PlaneBufferGeometry for lower memory footprint.");THREE.Geometry.call(this);this.type="PlaneGeometry";this.parameters={width:e,height:t,widthSegments:n,heightSegments:r};this.fromBufferGeometry(new THREE.PlaneBufferGeometry(e,t,n,r))};THREE.PlaneGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.PlaneBufferGeometry=function(e,t,n,r){THREE.BufferGeometry.call(this);this.type="PlaneBufferGeometry";this.parameters={width:e,height:t,widthSegments:n,heightSegments:r};var i=e/2;var s=t/2;var o=n||1;var u=r||1;var a=o+1;var f=u+1;var l=e/o;var c=t/u;var h=new Float32Array(a*f*3);var p=new Float32Array(a*f*3);var d=new Float32Array(a*f*2);var v=0;var m=0;for(var g=0;g<f;g++){var y=g*c-s;for(var b=0;b<a;b++){var w=b*l-i;h[v]=w;h[v+1]=-y;p[v+2]=1;d[m]=b/o;d[m+1]=1-g/u;v+=3;m+=2}}v=0;var E=new(h.length/3>65535?Uint32Array:Uint16Array)(o*u*6);for(var g=0;g<u;g++){for(var b=0;b<o;b++){var S=b+a*g;var x=b+a*(g+1);var T=b+1+a*(g+1);var N=b+1+a*g;E[v]=S;E[v+1]=x;E[v+2]=N;E[v+3]=x;E[v+4]=T;E[v+5]=N;v+=6}}this.addAttribute("index",new THREE.BufferAttribute(E,1));this.addAttribute("position",new THREE.BufferAttribute(h,3));this.addAttribute("normal",new THREE.BufferAttribute(p,3));this.addAttribute("uv",new THREE.BufferAttribute(d,2))};THREE.PlaneBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.RingGeometry=function(e,t,n,r,i,s){THREE.Geometry.call(this);this.type="RingGeometry";this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:r,thetaStart:i,thetaLength:s};e=e||0;t=t||50;i=i!==undefined?i:0;s=s!==undefined?s:Math.PI*2;n=n!==undefined?Math.max(3,n):8;r=r!==undefined?Math.max(1,r):8;var o,u,a=[],f=e,l=(t-e)/r;for(o=0;o<r+1;o++){for(u=0;u<n+1;u++){var c=new THREE.Vector3;var h=i+u/n*s;c.x=f*Math.cos(h);c.y=f*Math.sin(h);this.vertices.push(c);a.push(new THREE.Vector2((c.x/t+1)/2,(c.y/t+1)/2))}f+=l}var p=new THREE.Vector3(0,0,1);for(o=0;o<r;o++){var d=o*(n+1);for(u=0;u<n;u++){var h=u+d;var v=h;var m=h+n+1;var g=h+n+2;this.faces.push(new THREE.Face3(v,m,g,[p.clone(),p.clone(),p.clone()]));this.faceVertexUvs[0].push([a[v].clone(),a[m].clone(),a[g].clone()]);v=h;m=h+n+2;g=h+1;this.faces.push(new THREE.Face3(v,m,g,[p.clone(),p.clone(),p.clone()]));this.faceVertexUvs[0].push([a[v].clone(),a[m].clone(),a[g].clone()])}}this.computeFaceNormals();this.boundingSphere=new THREE.Sphere(new THREE.Vector3,f)};THREE.RingGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.SphereGeometry=function(e,t,n,r,i,s,o){THREE.Geometry.call(this);this.type="SphereGeometry";this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:r,phiLength:i,thetaStart:s,thetaLength:o};e=e||50;t=Math.max(3,Math.floor(t)||8);n=Math.max(2,Math.floor(n)||6);r=r!==undefined?r:0;i=i!==undefined?i:Math.PI*2;s=s!==undefined?s:0;o=o!==undefined?o:Math.PI;var u,a,f=[],l=[];for(a=0;a<=n;a++){var c=[];var h=[];for(u=0;u<=t;u++){var p=u/t;var d=a/n;var v=new THREE.Vector3;v.x=-e*Math.cos(r+p*i)*Math.sin(s+d*o);v.y=e*Math.cos(s+d*o);v.z=e*Math.sin(r+p*i)*Math.sin(s+d*o);this.vertices.push(v);c.push(this.vertices.length-1);h.push(new THREE.Vector2(p,1-d))}f.push(c);l.push(h)}for(a=0;a<n;a++){for(u=0;u<t;u++){var m=f[a][u+1];var g=f[a][u];var y=f[a+1][u];var b=f[a+1][u+1];var w=this.vertices[m].clone().normalize();var E=this.vertices[g].clone().normalize();var S=this.vertices[y].clone().normalize();var x=this.vertices[b].clone().normalize();var T=l[a][u+1].clone();var N=l[a][u].clone();var C=l[a+1][u].clone();var k=l[a+1][u+1].clone();if(Math.abs(this.vertices[m].y)===e){T.x=(T.x+N.x)/2;this.faces.push(new THREE.Face3(m,y,b,[w,S,x]));this.faceVertexUvs[0].push([T,C,k])}else if(Math.abs(this.vertices[y].y)===e){C.x=(C.x+k.x)/2;this.faces.push(new THREE.Face3(m,g,y,[w,E,S]));this.faceVertexUvs[0].push([T,N,C])}else{this.faces.push(new THREE.Face3(m,g,b,[w,E,x]));this.faceVertexUvs[0].push([T,N,k]);this.faces.push(new THREE.Face3(g,y,b,[E.clone(),S,x.clone()]));this.faceVertexUvs[0].push([N.clone(),C,k.clone()])}}}this.computeFaceNormals();this.boundingSphere=new THREE.Sphere(new THREE.Vector3,e)};THREE.SphereGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TextGeometry=function(e,t){t=t||{};var n=THREE.FontUtils.generateShapes(e,t);t.amount=t.height!==undefined?t.height:50;if(t.bevelThickness===undefined)t.bevelThickness=10;if(t.bevelSize===undefined)t.bevelSize=8;if(t.bevelEnabled===undefined)t.bevelEnabled=false;THREE.ExtrudeGeometry.call(this,n,t);this.type="TextGeometry"};THREE.TextGeometry.prototype=Object.create(THREE.ExtrudeGeometry.prototype);THREE.TorusGeometry=function(e,t,n,r,i){THREE.Geometry.call(this);this.type="TorusGeometry";this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:r,arc:i};e=e||100;t=t||40;n=n||8;r=r||6;i=i||Math.PI*2;var s=new THREE.Vector3,o=[],u=[];for(var a=0;a<=n;a++){for(var f=0;f<=r;f++){var l=f/r*i;var c=a/n*Math.PI*2;s.x=e*Math.cos(l);s.y=e*Math.sin(l);var h=new THREE.Vector3;h.x=(e+t*Math.cos(c))*Math.cos(l);h.y=(e+t*Math.cos(c))*Math.sin(l);h.z=t*Math.sin(c);this.vertices.push(h);o.push(new THREE.Vector2(f/r,a/n));u.push(h.clone().sub(s).normalize())}}for(var a=1;a<=n;a++){for(var f=1;f<=r;f++){var p=(r+1)*a+f-1;var d=(r+1)*(a-1)+f-1;var v=(r+1)*(a-1)+f;var m=(r+1)*a+f;var g=new THREE.Face3(p,d,m,[u[p].clone(),u[d].clone(),u[m].clone()]);this.faces.push(g);this.faceVertexUvs[0].push([o[p].clone(),o[d].clone(),o[m].clone()]);g=new THREE.Face3(d,v,m,[u[d].clone(),u[v].clone(),u[m].clone()]);this.faces.push(g);this.faceVertexUvs[0].push([o[d].clone(),o[v].clone(),o[m].clone()])}}this.computeFaceNormals()};THREE.TorusGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TorusKnotGeometry=function(e,t,n,r,i,s,o){function O(e,t,n,r,i){var s=Math.cos(e);var o=Math.sin(e);var u=t/n*e;var a=Math.cos(u);var f=r*(2+a)*.5*s;var l=r*(2+a)*o*.5;var c=i*r*Math.sin(u)*.5;return new THREE.Vector3(f,l,c)}THREE.Geometry.call(this);this.type="TorusKnotGeometry";this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:r,p:i,q:s,heightScale:o};e=e||100;t=t||40;n=n||64;r=r||8;i=i||2;s=s||3;o=o||1;var u=new Array(n);var a=new THREE.Vector3;var f=new THREE.Vector3;var l=new THREE.Vector3;for(var c=0;c<n;++c){u[c]=new Array(r);var h=c/n*2*i*Math.PI;var p=O(h,s,i,e,o);var d=O(h+.01,s,i,e,o);a.subVectors(d,p);f.addVectors(d,p);l.crossVectors(a,f);f.crossVectors(l,a);l.normalize();f.normalize();for(var v=0;v<r;++v){var m=v/r*2*Math.PI;var g=-t*Math.cos(m);var y=t*Math.sin(m);var b=new THREE.Vector3;b.x=p.x+g*f.x+y*l.x;b.y=p.y+g*f.y+y*l.y;b.z=p.z+g*f.z+y*l.z;u[c][v]=this.vertices.push(b)-1}}for(var c=0;c<n;++c){for(var v=0;v<r;++v){var w=(c+1)%n;var E=(v+1)%r;var S=u[c][v];var x=u[w][v];var T=u[w][E];var N=u[c][E];var C=new THREE.Vector2(c/n,v/r);var k=new THREE.Vector2((c+1)/n,v/r);var L=new THREE.Vector2((c+1)/n,(v+1)/r);var A=new THREE.Vector2(c/n,(v+1)/r);this.faces.push(new THREE.Face3(S,x,N));this.faceVertexUvs[0].push([C,k,A]);this.faces.push(new THREE.Face3(x,T,N));this.faceVertexUvs[0].push([k.clone(),L,A.clone()])}}this.computeFaceNormals();this.computeVertexNormals()};THREE.TorusKnotGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TubeGeometry=function(e,t,n,r,i){function I(e,t,n){return o.vertices.push(new THREE.Vector3(e,t,n))-1}THREE.Geometry.call(this);this.type="TubeGeometry";this.parameters={path:e,segments:t,radius:n,radialSegments:r,closed:i};t=t||64;n=n||1;r=r||8;i=i||false;var s=[];var o=this,u,a,f,l=t+1,c,h,p,d,v,m,g,y,b,w,E,S=new THREE.Vector3,x,T,N,C,k,L,A,O,M,_,D,P;var H=new THREE.TubeGeometry.FrenetFrames(e,t,i),B=H.tangents,j=H.normals,F=H.binormals;this.tangents=B;this.normals=j;this.binormals=F;for(x=0;x<l;x++){s[x]=[];g=x/(l-1);E=e.getPointAt(g);u=B[x];a=j[x];f=F[x];for(T=0;T<r;T++){y=T/r*2*Math.PI;b=-n*Math.cos(y);w=n*Math.sin(y);S.copy(E);S.x+=b*a.x+w*f.x;S.y+=b*a.y+w*f.y;S.z+=b*a.z+w*f.z;s[x][T]=I(S.x,S.y,S.z)}}for(x=0;x<t;x++){for(T=0;T<r;T++){N=i?(x+1)%t:x+1;C=(T+1)%r;k=s[x][T];L=s[N][T];A=s[N][C];O=s[x][C];M=new THREE.Vector2(x/t,T/r);_=new THREE.Vector2((x+1)/t,T/r);D=new THREE.Vector2((x+1)/t,(T+1)/r);P=new THREE.Vector2(x/t,(T+1)/r);this.faces.push(new THREE.Face3(k,L,O));this.faceVertexUvs[0].push([M,_,P]);this.faces.push(new THREE.Face3(L,A,O));this.faceVertexUvs[0].push([_.clone(),D,P.clone()])}}this.computeFaceNormals();this.computeVertexNormals()};THREE.TubeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TubeGeometry.FrenetFrames=function(e,t,n){function E(){u[0]=new THREE.Vector3;a[0]=new THREE.Vector3;d=Number.MAX_VALUE;v=Math.abs(o[0].x);m=Math.abs(o[0].y);g=Math.abs(o[0].z);if(v<=d){d=v;i.set(1,0,0)}if(m<=d){d=m;i.set(0,1,0)}if(g<=d){i.set(0,0,1)}f.crossVectors(o[0],i).normalize();u[0].crossVectors(o[0],f);a[0].crossVectors(o[0],u[0])}var r=new THREE.Vector3,i=new THREE.Vector3,s=new THREE.Vector3,o=[],u=[],a=[],f=new THREE.Vector3,l=new THREE.Matrix4,c=t+1,h,p=1e-4,d,v,m,g,y,b,w;this.tangents=o;this.normals=u;this.binormals=a;for(y=0;y<c;y++){b=y/(c-1);o[y]=e.getTangentAt(b);o[y].normalize()}E();for(y=1;y<c;y++){u[y]=u[y-1].clone();a[y]=a[y-1].clone();f.crossVectors(o[y-1],o[y]);if(f.length()>p){f.normalize();h=Math.acos(THREE.Math.clamp(o[y-1].dot(o[y]),-1,1));u[y].applyMatrix4(l.makeRotationAxis(f,h))}a[y].crossVectors(o[y],u[y])}if(n){h=Math.acos(THREE.Math.clamp(u[0].dot(u[c-1]),-1,1));h/=c-1;if(o[0].dot(f.crossVectors(u[0],u[c-1]))>0){h=-h}for(y=1;y<c;y++){u[y].applyMatrix4(l.makeRotationAxis(o[y],h*y));a[y].crossVectors(o[y],u[y])}}};THREE.PolyhedronGeometry=function(e,t,n,r){function E(e){var t=e.normalize().clone();t.index=i.vertices.push(t)-1;var n=T(e)/2/Math.PI+.5;var r=N(e)/Math.PI+.5;t.uv=new THREE.Vector2(n,1-r);return t}function S(e,t,n){var r=new THREE.Face3(e.index,t.index,n.index,[e.clone(),t.clone(),n.clone()]);i.faces.push(r);d.copy(e).add(t).add(n).divideScalar(3);var s=T(d);i.faceVertexUvs[0].push([C(e.uv,e,s),C(t.uv,t,s),C(n.uv,n,s)])}function x(e,t){var n=Math.pow(2,t);var r=Math.pow(4,t);var s=E(i.vertices[e.a]);var o=E(i.vertices[e.b]);var u=E(i.vertices[e.c]);var a=[];for(var f=0;f<=n;f++){a[f]=[];var l=E(s.clone().lerp(u,f/n));var c=E(o.clone().lerp(u,f/n));var h=n-f;for(var p=0;p<=h;p++){if(p==0&&f==n){a[f][p]=l}else{a[f][p]=E(l.clone().lerp(c,p/h))}}}for(var f=0;f<n;f++){for(var p=0;p<2*(n-f)-1;p++){var d=Math.floor(p/2);if(p%2==0){S(a[f][d+1],a[f+1][d],a[f][d])}else{S(a[f][d+1],a[f+1][d+1],a[f+1][d])}}}}function T(e){return Math.atan2(e.z,-e.x)}function N(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}function C(e,t,n){if(n<0&&e.x===1)e=new THREE.Vector2(e.x-1,e.y);if(t.x===0&&t.z===0)e=new THREE.Vector2(n/2/Math.PI+.5,e.y);return e.clone()}THREE.Geometry.call(this);this.type="PolyhedronGeometry";this.parameters={vertices:e,indices:t,radius:n,detail:r};n=n||1;r=r||0;var i=this;for(var s=0,o=e.length;s<o;s+=3){E(new THREE.Vector3(e[s],e[s+1],e[s+2]))}var u=[],a=this.vertices;var f=[];for(var s=0,l=0,o=t.length;s<o;s+=3,l++){var c=a[t[s]];var h=a[t[s+1]];var p=a[t[s+2]];f[l]=new THREE.Face3(c.index,h.index,p.index,[c.clone(),h.clone(),p.clone()])}var d=new THREE.Vector3;for(var s=0,o=f.length;s<o;s++){x(f[s],r)}for(var s=0,o=this.faceVertexUvs[0].length;s<o;s++){var v=this.faceVertexUvs[0][s];var m=v[0].x;var g=v[1].x;var y=v[2].x;var b=Math.max(m,Math.max(g,y));var w=Math.min(m,Math.min(g,y));if(b>.9&&w<.1){if(m<.2)v[0].x+=1;if(g<.2)v[1].x+=1;if(y<.2)v[2].x+=1}}for(var s=0,o=this.vertices.length;s<o;s++){this.vertices[s].multiplyScalar(n)}this.mergeVertices();this.computeFaceNormals();this.boundingSphere=new THREE.Sphere(new THREE.Vector3,n)};THREE.PolyhedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.DodecahedronGeometry=function(e,t){this.parameters={radius:e,detail:t};var n=(1+Math.sqrt(5))/2;var r=1/n;var i=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-n,0,-r,n,0,r,-n,0,r,n,-r,-n,0,-r,n,0,r,-n,0,r,n,0,-n,0,-r,n,0,-r,-n,0,r,n,0,r];var s=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];THREE.PolyhedronGeometry.call(this,i,s,e,t)};THREE.DodecahedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.IcosahedronGeometry=function(e,t){var n=(1+Math.sqrt(5))/2;var r=[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1];var i=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];THREE.PolyhedronGeometry.call(this,r,i,e,t);this.type="IcosahedronGeometry";this.parameters={radius:e,detail:t}};THREE.IcosahedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.OctahedronGeometry=function(e,t){this.parameters={radius:e,detail:t};var n=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1];var r=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];THREE.PolyhedronGeometry.call(this,n,r,e,t);this.type="OctahedronGeometry";this.parameters={radius:e,detail:t}};THREE.OctahedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TetrahedronGeometry=function(e,t){var n=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1];var r=[2,1,0,0,3,2,1,3,0,2,3,1];THREE.PolyhedronGeometry.call(this,n,r,e,t);this.type="TetrahedronGeometry";this.parameters={radius:e,detail:t}};THREE.TetrahedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ParametricGeometry=function(e,t,n){THREE.Geometry.call(this);this.type="ParametricGeometry";this.parameters={func:e,slices:t,stacks:n};var r=this.vertices;var i=this.faces;var s=this.faceVertexUvs[0];var o,u,a,f;var l,c;var h=n+1;var p=t+1;for(o=0;o<=n;o++){c=o/n;for(a=0;a<=t;a++){l=a/t;f=e(l,c);r.push(f)}}var d,v,m,g;var y,b,w,E;for(o=0;o<n;o++){for(a=0;a<t;a++){d=o*p+a;v=o*p+a+1;m=(o+1)*p+a+1;g=(o+1)*p+a;y=new THREE.Vector2(a/t,o/n);b=new THREE.Vector2((a+1)/t,o/n);w=new THREE.Vector2((a+1)/t,(o+1)/n);E=new THREE.Vector2(a/t,(o+1)/n);i.push(new THREE.Face3(d,v,g));s.push([y,b,E]);i.push(new THREE.Face3(v,m,g));s.push([b.clone(),w,E.clone()])}}this.computeFaceNormals();this.computeVertexNormals()};THREE.ParametricGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.AxisHelper=function(e){e=e||1;var t=new Float32Array([0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e]);var n=new Float32Array([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1]);var r=new THREE.BufferGeometry;r.addAttribute("position",new THREE.BufferAttribute(t,3));r.addAttribute("color",new THREE.BufferAttribute(n,3));var i=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});THREE.Line.call(this,r,i,THREE.LinePieces)};THREE.AxisHelper.prototype=Object.create(THREE.Line.prototype);THREE.ArrowHelper=function(){var e=new THREE.Geometry;e.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,1,0));var t=new THREE.CylinderGeometry(0,.5,1,5,1);t.applyMatrix((new THREE.Matrix4).makeTranslation(0,-.5,0));return function(n,r,i,s,o,u){THREE.Object3D.call(this);if(s===undefined)s=16776960;if(i===undefined)i=1;if(o===undefined)o=.2*i;if(u===undefined)u=.2*o;this.position.copy(r);this.line=new THREE.Line(e,new THREE.LineBasicMaterial({color:s}));this.line.matrixAutoUpdate=false;this.add(this.line);this.cone=new THREE.Mesh(t,new THREE.MeshBasicMaterial({color:s}));this.cone.matrixAutoUpdate=false;this.add(this.cone);this.setDirection(n);this.setLength(i,o,u)}}();THREE.ArrowHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.ArrowHelper.prototype.setDirection=function(){var e=new THREE.Vector3;var t;return function(n){if(n.y>.99999){this.quaternion.set(0,0,0,1)}else if(n.y<-.99999){this.quaternion.set(1,0,0,0)}else{e.set(n.z,0,-n.x).normalize();t=Math.acos(n.y);this.quaternion.setFromAxisAngle(e,t)}}}();THREE.ArrowHelper.prototype.setLength=function(e,t,n){if(t===undefined)t=.2*e;if(n===undefined)n=.2*t;this.line.scale.set(1,e,1);this.line.updateMatrix();this.cone.scale.set(n,t,n);this.cone.position.y=e;this.cone.updateMatrix()};THREE.ArrowHelper.prototype.setColor=function(e){this.line.material.color.set(e);this.cone.material.color.set(e)};THREE.BoxHelper=function(e){var t=new THREE.BufferGeometry;t.addAttribute("position",new THREE.BufferAttribute(new Float32Array(72),3));THREE.Line.call(this,t,new THREE.LineBasicMaterial({color:16776960}),THREE.LinePieces);if(e!==undefined){this.update(e)}};THREE.BoxHelper.prototype=Object.create(THREE.Line.prototype);THREE.BoxHelper.prototype.update=function(e){var t=e.geometry;if(t.boundingBox===null){t.computeBoundingBox()}var n=t.boundingBox.min;var r=t.boundingBox.max;var i=this.geometry.attributes.position.array;i[0]=r.x;i[1]=r.y;i[2]=r.z;i[3]=n.x;i[4]=r.y;i[5]=r.z;i[6]=n.x;i[7]=r.y;i[8]=r.z;i[9]=n.x;i[10]=n.y;i[11]=r.z;i[12]=n.x;i[13]=n.y;i[14]=r.z;i[15]=r.x;i[16]=n.y;i[17]=r.z;i[18]=r.x;i[19]=n.y;i[20]=r.z;i[21]=r.x;i[22]=r.y;i[23]=r.z;i[24]=r.x;i[25]=r.y;i[26]=n.z;i[27]=n.x;i[28]=r.y;i[29]=n.z;i[30]=n.x;i[31]=r.y;i[32]=n.z;i[33]=n.x;i[34]=n.y;i[35]=n.z;i[36]=n.x;i[37]=n.y;i[38]=n.z;i[39]=r.x;i[40]=n.y;i[41]=n.z;i[42]=r.x;i[43]=n.y;i[44]=n.z;i[45]=r.x;i[46]=r.y;i[47]=n.z;i[48]=r.x;i[49]=r.y;i[50]=r.z;i[51]=r.x;i[52]=r.y;i[53]=n.z;i[54]=n.x;i[55]=r.y;i[56]=r.z;i[57]=n.x;i[58]=r.y;i[59]=n.z;i[60]=n.x;i[61]=n.y;i[62]=r.z;i[63]=n.x;i[64]=n.y;i[65]=n.z;i[66]=r.x;i[67]=n.y;i[68]=r.z;i[69]=r.x;i[70]=n.y;i[71]=n.z;this.geometry.attributes.position.needsUpdate=true;this.geometry.computeBoundingSphere();this.matrix=e.matrixWorld;this.matrixAutoUpdate=false};THREE.BoundingBoxHelper=function(e,t){var n=t!==undefined?t:8947848;this.object=e;this.box=new THREE.Box3;THREE.Mesh.call(this,new THREE.BoxGeometry(1,1,1),new THREE.MeshBasicMaterial({color:n,wireframe:true}))};THREE.BoundingBoxHelper.prototype=Object.create(THREE.Mesh.prototype);THREE.BoundingBoxHelper.prototype.update=function(){this.box.setFromObject(this.object);this.box.size(this.scale);this.box.center(this.position)};THREE.CameraHelper=function(e){function f(e,t,n){l(e,n);l(t,n)}function l(e,n){t.vertices.push(new THREE.Vector3);t.colors.push(new THREE.Color(n));if(r[e]===undefined){r[e]=[]}r[e].push(t.vertices.length-1)}var t=new THREE.Geometry;var n=new THREE.LineBasicMaterial({color:16777215,vertexColors:THREE.FaceColors});var r={};var i=16755200;var s=16711680;var o=43775;var u=16777215;var a=3355443;f("n1","n2",i);f("n2","n4",i);f("n4","n3",i);f("n3","n1",i);f("f1","f2",i);f("f2","f4",i);f("f4","f3",i);f("f3","f1",i);f("n1","f1",i);f("n2","f2",i);f("n3","f3",i);f("n4","f4",i);f("p","n1",s);f("p","n2",s);f("p","n3",s);f("p","n4",s);f("u1","u2",o);f("u2","u3",o);f("u3","u1",o);f("c","t",u);f("p","c",a);f("cn1","cn2",a);f("cn3","cn4",a);f("cf1","cf2",a);f("cf3","cf4",a);THREE.Line.call(this,t,n,THREE.LinePieces);this.camera=e;this.matrix=e.matrixWorld;this.matrixAutoUpdate=false;this.pointMap=r;this.update()};THREE.CameraHelper.prototype=Object.create(THREE.Line.prototype);THREE.CameraHelper.prototype.update=function(){var e,t;var n=new THREE.Vector3;var r=new THREE.Camera;var i=function(i,s,o,u){n.set(s,o,u).unproject(r);var a=t[i];if(a!==undefined){for(var f=0,l=a.length;f<l;f++){e.vertices[a[f]].copy(n)}}};return function(){e=this.geometry;t=this.pointMap;var n=1,s=1;r.projectionMatrix.copy(this.camera.projectionMatrix);i("c",0,0,-1);i("t",0,0,1);i("n1",-n,-s,-1);i("n2",n,-s,-1);i("n3",-n,s,-1);i("n4",n,s,-1);i("f1",-n,-s,1);i("f2",n,-s,1);i("f3",-n,s,1);i("f4",n,s,1);i("u1",n*.7,s*1.1,-1);i("u2",-n*.7,s*1.1,-1);i("u3",0,s*2,-1);i("cf1",-n,0,1);i("cf2",n,0,1);i("cf3",0,-s,1);i("cf4",0,s,1);i("cn1",-n,0,-1);i("cn2",n,0,-1);i("cn3",0,-s,-1);i("cn4",0,s,-1);e.verticesNeedUpdate=true}}();THREE.DirectionalLightHelper=function(e,t){THREE.Object3D.call(this);this.light=e;this.light.updateMatrixWorld();this.matrix=e.matrixWorld;this.matrixAutoUpdate=false;t=t||1;var n=new THREE.Geometry;n.vertices.push(new THREE.Vector3(-t,t,0),new THREE.Vector3(t,t,0),new THREE.Vector3(t,-t,0),new THREE.Vector3(-t,-t,0),new THREE.Vector3(-t,t,0));var r=new THREE.LineBasicMaterial({fog:false});r.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.lightPlane=new THREE.Line(n,r);this.add(this.lightPlane);n=new THREE.Geometry;n.vertices.push(new THREE.Vector3,new THREE.Vector3);r=new THREE.LineBasicMaterial({fog:false});r.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.targetLine=new THREE.Line(n,r);this.add(this.targetLine);this.update()};THREE.DirectionalLightHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.DirectionalLightHelper.prototype.dispose=function(){this.lightPlane.geometry.dispose();this.lightPlane.material.dispose();this.targetLine.geometry.dispose();this.targetLine.material.dispose()};THREE.DirectionalLightHelper.prototype.update=function(){var e=new THREE.Vector3;var t=new THREE.Vector3;var n=new THREE.Vector3;return function(){e.setFromMatrixPosition(this.light.matrixWorld);t.setFromMatrixPosition(this.light.target.matrixWorld);n.subVectors(t,e);this.lightPlane.lookAt(n);this.lightPlane.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.targetLine.geometry.vertices[1].copy(n);this.targetLine.geometry.verticesNeedUpdate=true;this.targetLine.material.color.copy(this.lightPlane.material.color)}}();THREE.EdgesHelper=function(e,t){var n=t!==undefined?t:16777215;var r=[0,0],i={};var s=function(e,t){return e-t};var o=["a","b","c"];var u=new THREE.BufferGeometry;var a=e.geometry.clone();a.mergeVertices();a.computeFaceNormals();var f=a.vertices;var l=a.faces;var c=0;for(var h=0,p=l.length;h<p;h++){var d=l[h];for(var v=0;v<3;v++){r[0]=d[o[v]];r[1]=d[o[(v+1)%3]];r.sort(s);var m=r.toString();if(i[m]===undefined){i[m]={vert1:r[0],vert2:r[1],face1:h,face2:undefined};c++}else{i[m].face2=h}}}var g=new Float32Array(c*2*3);var y=0;for(var m in i){var b=i[m];if(b.face2===undefined||l[b.face1].normal.dot(l[b.face2].normal)<.9999){var w=f[b.vert1];g[y++]=w.x;g[y++]=w.y;g[y++]=w.z;w=f[b.vert2];g[y++]=w.x;g[y++]=w.y;g[y++]=w.z}}u.addAttribute("position",new THREE.BufferAttribute(g,3));THREE.Line.call(this,u,new THREE.LineBasicMaterial({color:n}),THREE.LinePieces);this.matrix=e.matrixWorld;this.matrixAutoUpdate=false};THREE.EdgesHelper.prototype=Object.create(THREE.Line.prototype);THREE.FaceNormalsHelper=function(e,t,n,r){this.object=e;this.size=t!==undefined?t:1;var i=n!==undefined?n:16776960;var s=r!==undefined?r:1;var o=new THREE.Geometry;var u=this.object.geometry.faces;for(var a=0,f=u.length;a<f;a++){o.vertices.push(new THREE.Vector3,new THREE.Vector3)}THREE.Line.call(this,o,new THREE.LineBasicMaterial({color:i,linewidth:s}),THREE.LinePieces);this.matrixAutoUpdate=false;this.normalMatrix=new THREE.Matrix3;this.update()};THREE.FaceNormalsHelper.prototype=Object.create(THREE.Line.prototype);THREE.FaceNormalsHelper.prototype.update=function(){var e=this.geometry.vertices;var t=this.object;var n=t.geometry.vertices;var r=t.geometry.faces;var i=t.matrixWorld;t.updateMatrixWorld(true);this.normalMatrix.getNormalMatrix(i);for(var s=0,o=0,u=r.length;s<u;s++,o+=2){var a=r[s];e[o].copy(n[a.a]).add(n[a.b]).add(n[a.c]).divideScalar(3).applyMatrix4(i);e[o+1].copy(a.normal).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size).add(e[o])}this.geometry.verticesNeedUpdate=true;return this};THREE.GridHelper=function(e,t){var n=new THREE.Geometry;var r=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});this.color1=new THREE.Color(4473924);this.color2=new THREE.Color(8947848);for(var i=-e;i<=e;i+=t){n.vertices.push(new THREE.Vector3(-e,0,i),new THREE.Vector3(e,0,i),new THREE.Vector3(i,0,-e),new THREE.Vector3(i,0,e));var s=i===0?this.color1:this.color2;n.colors.push(s,s,s,s)}THREE.Line.call(this,n,r,THREE.LinePieces)};THREE.GridHelper.prototype=Object.create(THREE.Line.prototype);THREE.GridHelper.prototype.setColors=function(e,t){this.color1.set(e);this.color2.set(t);this.geometry.colorsNeedUpdate=true};THREE.HemisphereLightHelper=function(e,t,n,r){THREE.Object3D.call(this);this.light=e;this.light.updateMatrixWorld();this.matrix=e.matrixWorld;this.matrixAutoUpdate=false;this.colors=[new THREE.Color,new THREE.Color];var i=new THREE.SphereGeometry(t,4,2);i.applyMatrix((new THREE.Matrix4).makeRotationX(-Math.PI/2));for(var s=0,o=8;s<o;s++){i.faces[s].color=this.colors[s<4?0:1]}var u=new THREE.MeshBasicMaterial({vertexColors:THREE.FaceColors,wireframe:true});this.lightSphere=new THREE.Mesh(i,u);this.add(this.lightSphere);this.update()};THREE.HemisphereLightHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.HemisphereLightHelper.prototype.dispose=function(){this.lightSphere.geometry.dispose();this.lightSphere.material.dispose()};THREE.HemisphereLightHelper.prototype.update=function(){var e=new THREE.Vector3;return function(){this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity);this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity);this.lightSphere.lookAt(e.setFromMatrixPosition(this.light.matrixWorld).negate());this.lightSphere.geometry.colorsNeedUpdate=true}}();THREE.PointLightHelper=function(e,t){this.light=e;this.light.updateMatrixWorld();var n=new THREE.SphereGeometry(t,4,2);var r=new THREE.MeshBasicMaterial({wireframe:true,fog:false});r.color.copy(this.light.color).multiplyScalar(this.light.intensity);THREE.Mesh.call(this,n,r);this.matrix=this.light.matrixWorld;this.matrixAutoUpdate=false};THREE.PointLightHelper.prototype=Object.create(THREE.Mesh.prototype);THREE.PointLightHelper.prototype.dispose=function(){this.geometry.dispose();this.material.dispose()};THREE.PointLightHelper.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)};THREE.SkeletonHelper=function(e){this.bones=this.getBoneList(e);var t=new THREE.Geometry;for(var n=0;n<this.bones.length;n++){var r=this.bones[n];if(r.parent instanceof THREE.Bone){t.vertices.push(new THREE.Vector3);t.vertices.push(new THREE.Vector3);t.colors.push(new THREE.Color(0,0,1));t.colors.push(new THREE.Color(0,1,0))}}var i=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors,depthTest:false,depthWrite:false,transparent:true});THREE.Line.call(this,t,i,THREE.LinePieces);this.root=e;this.matrix=e.matrixWorld;this.matrixAutoUpdate=false;this.update()};THREE.SkeletonHelper.prototype=Object.create(THREE.Line.prototype);THREE.SkeletonHelper.prototype.getBoneList=function(e){var t=[];if(e instanceof THREE.Bone){t.push(e)}for(var n=0;n<e.children.length;n++){t.push.apply(t,this.getBoneList(e.children[n]))}return t};THREE.SkeletonHelper.prototype.update=function(){var e=this.geometry;var t=(new THREE.Matrix4).getInverse(this.root.matrixWorld);var n=new THREE.Matrix4;var r=0;for(var i=0;i<this.bones.length;i++){var s=this.bones[i];if(s.parent instanceof THREE.Bone){n.multiplyMatrices(t,s.matrixWorld);e.vertices[r].setFromMatrixPosition(n);n.multiplyMatrices(t,s.parent.matrixWorld);e.vertices[r+1].setFromMatrixPosition(n);r+=2}}e.verticesNeedUpdate=true;e.computeBoundingSphere()};THREE.SpotLightHelper=function(e){THREE.Object3D.call(this);this.light=e;this.light.updateMatrixWorld();this.matrix=e.matrixWorld;this.matrixAutoUpdate=false;var t=new THREE.CylinderGeometry(0,1,1,8,1,true);t.applyMatrix((new THREE.Matrix4).makeTranslation(0,-.5,0));t.applyMatrix((new THREE.Matrix4).makeRotationX(-Math.PI/2));var n=new THREE.MeshBasicMaterial({wireframe:true,fog:false});this.cone=new THREE.Mesh(t,n);this.add(this.cone);this.update()};THREE.SpotLightHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose();this.cone.material.dispose()};THREE.SpotLightHelper.prototype.update=function(){var e=new THREE.Vector3;var t=new THREE.Vector3;return function(){var n=this.light.distance?this.light.distance:1e4;var r=n*Math.tan(this.light.angle);this.cone.scale.set(r,r,n);e.setFromMatrixPosition(this.light.matrixWorld);t.setFromMatrixPosition(this.light.target.matrixWorld);this.cone.lookAt(t.sub(e));this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}();THREE.VertexNormalsHelper=function(e,t,n,r){this.object=e;this.size=t!==undefined?t:1;var i=n!==undefined?n:16711680;var s=r!==undefined?r:1;var o=new THREE.Geometry;var u=e.geometry.vertices;var a=e.geometry.faces;for(var f=0,l=a.length;f<l;f++){var c=a[f];for(var h=0,p=c.vertexNormals.length;h<p;h++){o.vertices.push(new THREE.Vector3,new THREE.Vector3)}}THREE.Line.call(this,o,new THREE.LineBasicMaterial({color:i,linewidth:s}),THREE.LinePieces);this.matrixAutoUpdate=false;this.normalMatrix=new THREE.Matrix3;this.update()};THREE.VertexNormalsHelper.prototype=Object.create(THREE.Line.prototype);THREE.VertexNormalsHelper.prototype.update=function(e){var t=new THREE.Vector3;return function(e){var n=["a","b","c","d"];this.object.updateMatrixWorld(true);this.normalMatrix.getNormalMatrix(this.object.matrixWorld);var r=this.geometry.vertices;var i=this.object.geometry.vertices;var s=this.object.geometry.faces;var o=this.object.matrixWorld;var u=0;for(var a=0,f=s.length;a<f;a++){var l=s[a];for(var c=0,h=l.vertexNormals.length;c<h;c++){var p=l[n[c]];var d=i[p];var v=l.vertexNormals[c];r[u].copy(d).applyMatrix4(o);t.copy(v).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size);t.add(r[u]);u=u+1;r[u].copy(t);u=u+1}}this.geometry.verticesNeedUpdate=true;return this}}();THREE.VertexTangentsHelper=function(e,t,n,r){this.object=e;this.size=t!==undefined?t:1;var i=n!==undefined?n:255;var s=r!==undefined?r:1;var o=new THREE.Geometry;var u=e.geometry.vertices;var a=e.geometry.faces;for(var f=0,l=a.length;f<l;f++){var c=a[f];for(var h=0,p=c.vertexTangents.length;h<p;h++){o.vertices.push(new THREE.Vector3);o.vertices.push(new THREE.Vector3)}}THREE.Line.call(this,o,new THREE.LineBasicMaterial({color:i,linewidth:s}),THREE.LinePieces);this.matrixAutoUpdate=false;this.update()};THREE.VertexTangentsHelper.prototype=Object.create(THREE.Line.prototype);THREE.VertexTangentsHelper.prototype.update=function(e){var t=new THREE.Vector3;return function(e){var n=["a","b","c","d"];this.object.updateMatrixWorld(true);var r=this.geometry.vertices;var i=this.object.geometry.vertices;var s=this.object.geometry.faces;var o=this.object.matrixWorld;var u=0;for(var a=0,f=s.length;a<f;a++){var l=s[a];for(var c=0,h=l.vertexTangents.length;c<h;c++){var p=l[n[c]];var d=i[p];var v=l.vertexTangents[c];r[u].copy(d).applyMatrix4(o);t.copy(v).transformDirection(o).multiplyScalar(this.size);t.add(r[u]);u=u+1;r[u].copy(t);u=u+1}}this.geometry.verticesNeedUpdate=true;return this}}();THREE.WireframeHelper=function(e,t){var n=t!==undefined?t:16777215;var r=[0,0],i={};var s=function(e,t){return e-t};var o=["a","b","c"];var u=new THREE.BufferGeometry;if(e.geometry instanceof THREE.Geometry){var a=e.geometry.vertices;var f=e.geometry.faces;var l=0;var c=new Uint32Array(6*f.length);for(var h=0,p=f.length;h<p;h++){var d=f[h];for(var v=0;v<3;v++){r[0]=d[o[v]];r[1]=d[o[(v+1)%3]];r.sort(s);var m=r.toString();if(i[m]===undefined){c[2*l]=r[0];c[2*l+1]=r[1];i[m]=true;l++}}}var g=new Float32Array(l*2*3);for(var h=0,p=l;h<p;h++){for(var v=0;v<2;v++){var y=a[c[2*h+v]];var b=6*h+3*v;g[b+0]=y.x;g[b+1]=y.y;g[b+2]=y.z}}u.addAttribute("position",new THREE.BufferAttribute(g,3))}else if(e.geometry instanceof THREE.BufferGeometry){if(e.geometry.attributes.index!==undefined){var a=e.geometry.attributes.position.array;var w=e.geometry.attributes.index.array;var E=e.geometry.drawcalls;var l=0;if(E.length===0){E=[{count:w.length,index:0,start:0}]}var c=new Uint32Array(2*w.length);for(var S=0,x=E.length;S<x;++S){var T=E[S].start;var N=E[S].count;var b=E[S].index;for(var h=T,C=T+N;h<C;h+=3){for(var v=0;v<3;v++){r[0]=b+w[h+v];r[1]=b+w[h+(v+1)%3];r.sort(s);var m=r.toString();if(i[m]===undefined){c[2*l]=r[0];c[2*l+1]=r[1];i[m]=true;l++}}}}var g=new Float32Array(l*2*3);for(var h=0,p=l;h<p;h++){for(var v=0;v<2;v++){var b=6*h+3*v;var k=3*c[2*h+v];g[b+0]=a[k];g[b+1]=a[k+1];g[b+2]=a[k+2]}}u.addAttribute("position",new THREE.BufferAttribute(g,3))}else{var a=e.geometry.attributes.position.array;var l=a.length/3;var L=l/3;var g=new Float32Array(l*2*3);for(var h=0,p=L;h<p;h++){for(var v=0;v<3;v++){var b=18*h+6*v;var A=9*h+3*v;g[b+0]=a[A];g[b+1]=a[A+1];g[b+2]=a[A+2];var k=9*h+3*((v+1)%3);g[b+3]=a[k];g[b+4]=a[k+1];g[b+5]=a[k+2]}}u.addAttribute("position",new THREE.BufferAttribute(g,3))}}THREE.Line.call(this,u,new THREE.LineBasicMaterial({color:n}),THREE.LinePieces);this.matrix=e.matrixWorld;this.matrixAutoUpdate=false};THREE.WireframeHelper.prototype=Object.create(THREE.Line.prototype);THREE.ImmediateRenderObject=function(){THREE.Object3D.call(this);this.render=function(e){}};THREE.ImmediateRenderObject.prototype=Object.create(THREE.Object3D.prototype);THREE.MorphBlendMesh=function(e,t){THREE.Mesh.call(this,e,t);this.animationsMap={};this.animationsList=[];var n=this.geometry.morphTargets.length;var r="__default";var i=0;var s=n-1;var o=n/1;this.createAnimation(r,i,s,o);this.setAnimationWeight(r,1)};THREE.MorphBlendMesh.prototype=Object.create(THREE.Mesh.prototype);THREE.MorphBlendMesh.prototype.createAnimation=function(e,t,n,r){var i={startFrame:t,endFrame:n,length:n-t+1,fps:r,duration:(n-t)/r,lastFrame:0,currentFrame:0,active:false,time:0,direction:1,weight:1,directionBackwards:false,mirroredLoop:false};this.animationsMap[e]=i;this.animationsList.push(i)};THREE.MorphBlendMesh.prototype.autoCreateAnimations=function(e){var t=/([a-z]+)_?(\d+)/;var n,r={};var i=this.geometry;for(var s=0,o=i.morphTargets.length;s<o;s++){var u=i.morphTargets[s];var a=u.name.match(t);if(a&&a.length>1){var f=a[1];var l=a[2];if(!r[f])r[f]={start:Infinity,end:-Infinity};var c=r[f];if(s<c.start)c.start=s;if(s>c.end)c.end=s;if(!n)n=f}}for(var f in r){var c=r[f];this.createAnimation(f,c.start,c.end,e)}this.firstAnimation=n};THREE.MorphBlendMesh.prototype.setAnimationDirectionForward=function(e){var t=this.animationsMap[e];if(t){t.direction=1;t.directionBackwards=false}};THREE.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(e){var t=this.animationsMap[e];if(t){t.direction=-1;t.directionBackwards=true}};THREE.MorphBlendMesh.prototype.setAnimationFPS=function(e,t){var n=this.animationsMap[e];if(n){n.fps=t;n.duration=(n.end-n.start)/n.fps}};THREE.MorphBlendMesh.prototype.setAnimationDuration=function(e,t){var n=this.animationsMap[e];if(n){n.duration=t;n.fps=(n.end-n.start)/n.duration}};THREE.MorphBlendMesh.prototype.setAnimationWeight=function(e,t){var n=this.animationsMap[e];if(n){n.weight=t}};THREE.MorphBlendMesh.prototype.setAnimationTime=function(e,t){var n=this.animationsMap[e];if(n){n.time=t}};THREE.MorphBlendMesh.prototype.getAnimationTime=function(e){var t=0;var n=this.animationsMap[e];if(n){t=n.time}return t};THREE.MorphBlendMesh.prototype.getAnimationDuration=function(e){var t=-1;var n=this.animationsMap[e];if(n){t=n.duration}return t};THREE.MorphBlendMesh.prototype.playAnimation=function(e){var t=this.animationsMap[e];if(t){t.time=0;t.active=true}else{console.warn("animation["+e+"] undefined")}};THREE.MorphBlendMesh.prototype.stopAnimation=function(e){var t=this.animationsMap[e];if(t){t.active=false}};THREE.MorphBlendMesh.prototype.update=function(e){for(var t=0,n=this.animationsList.length;t<n;t++){var r=this.animationsList[t];if(!r.active)continue;var i=r.duration/r.length;r.time+=r.direction*e;if(r.mirroredLoop){if(r.time>r.duration||r.time<0){r.direction*=-1;if(r.time>r.duration){r.time=r.duration;r.directionBackwards=true}if(r.time<0){r.time=0;r.directionBackwards=false}}}else{r.time=r.time%r.duration;if(r.time<0)r.time+=r.duration}var s=r.startFrame+THREE.Math.clamp(Math.floor(r.time/i),0,r.length-1);var o=r.weight;if(s!==r.currentFrame){this.morphTargetInfluences[r.lastFrame]=0;this.morphTargetInfluences[r.currentFrame]=1*o;this.morphTargetInfluences[s]=0;r.lastFrame=r.currentFrame;r.currentFrame=s}var u=r.time%i/i;if(r.directionBackwards)u=1-u;this.morphTargetInfluences[r.currentFrame]=u*o;this.morphTargetInfluences[r.lastFrame]=(1-u)*o}};"use strict";var JSM={mainVersion:0,subVersion:32,Eps:1e-8,Inf:9999999999,RadDeg:57.29577951308232,DegRad:.017453292519943,IsZero:function(e){return Math.abs(e)<JSM.Eps},IsPositive:function(e){return e>JSM.Eps},IsNegative:function(e){return e<-JSM.Eps},IsLower:function(e,t){return t-e>JSM.Eps},IsGreater:function(e,t){return e-t>JSM.Eps},IsEqual:function(e,t){return Math.abs(t-e)<JSM.Eps},IsEqualWithEps:function(e,t,n){return Math.abs(t-e)<n},IsLowerOrEqual:function(e,t){return JSM.IsLower(e,t)||JSM.IsEqual(e,t)},IsGreaterOrEqual:function(e,t){return JSM.IsGreater(e,t)||JSM.IsEqual(e,t)},Minimum:function(e,t){return JSM.IsLower(e,t)?e:t},Maximum:function(e,t){return JSM.IsGreater(e,t)?e:t},ArcSin:function(e){return JSM.IsGreaterOrEqual(e,1)?Math.PI/2:JSM.IsLowerOrEqual(e,-1)?-Math.PI/2:Math.asin(e)},ArcCos:function(e){return JSM.IsGreaterOrEqual(e,1)?0:JSM.IsLowerOrEqual(e,-1)?Math.PI:Math.acos(e)},RandomNumber:function(e,t){return Math.random()*(t-e)+e},RandomInt:function(e,t){return Math.floor(Math.random()*(t-e+1)+e)},SeededRandomInt:function(e,t,n){return Math.floor((9301*n+49297)%233280/233280*(t-e+1)+e)},ValueOrDefault:function(e,t){return void 0===e||null===e?t:e},Assert:function(e,t){if(!e){var n="Assertion failed.";void 0!==t&&null!==t&&(n+=" "+t);alert(n)}},Timer:function(){this.stop=this.start=0}};JSM.Timer.prototype.Start=function(){this.start=(new Date).getTime()};JSM.Timer.prototype.Stop=function(){this.end=(new Date).getTime()};JSM.Timer.prototype.Result=function(){return this.end-this.start};JSM.FPSCounter=function(){this.current=this.frames=this.start=null};JSM.FPSCounter.prototype.Get=function(e){var t=(new Date).getTime();null===this.start&&(this.start=t,this.current=this.frames=0);if(null===e||void 0===e)e=1e3;this.frames+=1;var n=t-this.start;n>=e&&(this.current=1e3*(this.frames/n),this.start=t,this.frames=0);return parseInt(this.current,10)};JSM.BubbleSort=function(e,t){if(!(2>e.length||void 0===t||null===t)){var n,r;for(n=0;n<e.length-1;n++)for(r=0;r<e.length-n-1;r++)if(!t(e[r],e[r+1])){var i=e,s=r+1,o=i[r];i[r]=i[s];i[s]=o}}};JSM.AsyncEnvironment=function(e){this.parameters=e};JSM.AsyncEnvironment.prototype.OnStart=function(e,t){if(void 0!==this.parameters&&void 0!==this.parameters.onStart)this.parameters.onStart(e,t)};JSM.AsyncEnvironment.prototype.OnProcess=function(e,t){if(void 0!==this.parameters&&void 0!==this.parameters.onProcess)this.parameters.onProcess(e,t)};JSM.AsyncEnvironment.prototype.OnFinish=function(e){if(void 0!==this.parameters&&void 0!==this.parameters.onFinish)this.parameters.onFinish(e)};JSM.AsyncRunTask=function(e,t,n,r,i){function s(o){var u=e();t.OnProcess(o,i);u&&o<n-1?setTimeout(function(){s(o+1)},r):setTimeout(function(){t.OnFinish(i)},r)}if(void 0===t||null===t){var o,u;for(o=0;o<n&&!(u=e(),!u);o++);}else t.OnStart(n,i),s(0)};JSM.Coord2D=function(e,t){this.x=e;this.y=t};JSM.Coord2D.prototype.Set=function(e,t){this.x=e;this.y=t};JSM.Coord2D.prototype.ToString=function(){return"("+this.x+", "+this.y+")"};JSM.Coord2D.prototype.Clone=function(){return new JSM.Coord2D(this.x,this.y)};JSM.PolarCoord=function(e,t){this.radius=e;this.angle=t};JSM.PolarCoord.prototype.Set=function(e,t){this.radius=e;this.angle=t};JSM.PolarCoord.prototype.ToString=function(){return"("+this.radius+", "+this.angle+")"};JSM.PolarCoord.prototype.Clone=function(){return new JSM.PolarCoord(this.radius,this.angle)};JSM.Coord=function(e,t,n){this.x=e;this.y=t;this.z=n};JSM.Coord.prototype.Set=function(e,t,n){this.x=e;this.y=t;this.z=n};JSM.Coord.prototype.ToString=function(){return"("+this.x+", "+this.y+", "+this.z+")"};JSM.Coord.prototype.Clone=function(){return new JSM.Coord(this.x,this.y,this.z)};JSM.SphericalCoord=function(e,t,n){this.radius=e;this.theta=t;this.phi=n};JSM.SphericalCoord.prototype.Set=function(e,t,n){this.radius=e;this.theta=t;this.phi=n};JSM.SphericalCoord.prototype.ToString=function(){return"("+this.radius+", "+this.theta+", "+this.phi+")"};JSM.SphericalCoord.prototype.Clone=function(){return new JSM.SphericalCoord(this.radius,this.theta,this.phi)};JSM.Vector2D=JSM.Coord2D;JSM.Vector=JSM.Coord;JSM.MatrixDeterminant2x2=function(e,t,n,r){return e*r-t*n};JSM.MatrixDeterminant3x3=function(e,t,n,r,i,s,o,u,a){var f=JSM.MatrixDeterminant2x2(i,s,u,a);s=JSM.MatrixDeterminant2x2(r,s,o,a);r=JSM.MatrixDeterminant2x2(r,i,o,u);return e*f-t*s+n*r};JSM.MatrixDeterminant4x4=function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){var m=JSM.MatrixDeterminant3x3(s,o,u,f,l,c,p,d,v),g=JSM.MatrixDeterminant3x3(i,o,u,a,l,c,h,d,v);u=JSM.MatrixDeterminant3x3(i,s,u,a,f,c,h,p,v);i=JSM.MatrixDeterminant3x3(i,s,o,a,f,l,h,p,d);return m*e-g*t+u*n-i*r};JSM.CoordFromArray2D=function(e){return new JSM.Coord2D(e[0],e[1])};JSM.CoordFromArray=function(e){return new JSM.Coord(e[0],e[1],e[2])};JSM.CoordIsEqual2D=function(e,t){return JSM.IsEqual(e.x,t.x)&&JSM.IsEqual(e.y,t.y)};JSM.CoordIsEqual2DWithEps=function(e,t,n){return JSM.IsEqualWithEps(e.x,t.x,n)&&JSM.IsEqualWithEps(e.y,t.y,n)};JSM.CoordDistance2D=function(e,t){var n=e.x,r=e.y,i=t.x,s=t.y;return Math.sqrt((i-n)*(i-n)+(s-r)*(s-r))};JSM.MidCoord2D=function(e,t){return new JSM.Coord2D((e.x+t.x)/2,(e.y+t.y)/2)};JSM.PolarToCartesian=function(e,t){var n=new JSM.Coord2D(0,0);n.x=e*Math.cos(t);n.y=e*Math.sin(t);return n};JSM.GetArcLengthFromAngle=function(e,t){return t*e};JSM.GetAngleFromArcLength=function(e,t){return JSM.IsEqual(e,0)?0:t/e};JSM.CoordTurnType2D=function(e,t,n){e=JSM.MatrixDeterminant3x3(e.x,e.y,1,t.x,t.y,1,n.x,n.y,1);return JSM.IsPositive(e)?"CounterClockwise":JSM.IsNegative(e)?"Clockwise":"Collinear"};JSM.CoordIsEqual=function(e,t){return JSM.IsEqual(e.x,t.x)&&JSM.IsEqual(e.y,t.y)&&JSM.IsEqual(e.z,t.z)};JSM.CoordIsEqualWithEps=function(e,t,n){return JSM.IsEqualWithEps(e.x,t.x,n)&&JSM.IsEqualWithEps(e.y,t.y,n)&&JSM.IsEqualWithEps(e.z,t.z,n)};JSM.SphericalCoordIsEqual=function(e,t){return JSM.IsEqual(e.radius,t.radius)&&JSM.IsEqual(e.phi,t.phi)&&JSM.IsEqual(e.theta,t.theta)};JSM.CoordDistance=function(e,t){var n=e.x,r=e.y,i=e.z,s=t.x,o=t.y,u=t.z;return Math.sqrt((s-n)*(s-n)+(o-r)*(o-r)+(u-i)*(u-i))};JSM.CoordSignedDistance=function(e,t,n){var r=JSM.CoordSub(t,e);e=JSM.CoordDistance(e,t);n=JSM.GetVectorsAngle(r,n);JSM.IsPositive(n)&&(e=-e);return e};JSM.MidCoord=function(e,t){return new JSM.Coord((e.x+t.x)/2,(e.y+t.y)/2,(e.z+t.z)/2)};JSM.VectorMultiply=function(e,t){var n=new JSM.Vector(0,0,0);n.x=e.x*t;n.y=e.y*t;n.z=e.z*t;return n};JSM.VectorDot=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z};JSM.VectorCross=function(e,t){var n=new JSM.Vector(0,0,0);n.x=e.y*t.z-e.z*t.y;n.y=e.z*t.x-e.x*t.z;n.z=e.x*t.y-e.y*t.x;return n};JSM.VectorLength=function(e){var t=e.x,n=e.y;e=e.z;return Math.sqrt(t*t+n*n+e*e)};JSM.VectorNormalize=function(e){var t=JSM.VectorLength(e),n=new JSM.Vector(0,0,0);JSM.IsGreater(t,0)&&(n=JSM.VectorMultiply(e,1/t));return n};JSM.VectorSetLength=function(e,t){var n=t/JSM.VectorLength(e);return JSM.VectorMultiply(e,n)};JSM.GetVectorsAngle=function(e,t){var n=JSM.VectorNormalize(e),r=JSM.VectorNormalize(t);if(JSM.CoordIsEqual(n,r))return 0;n=JSM.VectorDot(n,r);return JSM.ArcCos(n)};JSM.GetVectorsFullAngle=function(e,t,n){var r=JSM.GetVectorsAngle(e,t),i=new JSM.Coord(0,0,0);"Clockwise"==JSM.CoordTurnType(e,i,t,n)&&(r=2*Math.PI-r);return r};JSM.VectorsAreCollinear=function(e,t){var n=JSM.GetVectorsAngle(e,t);return JSM.IsEqual(n,0)||JSM.IsEqual(n,Math.PI)};JSM.CoordAdd=function(e,t){return new JSM.Vector(e.x+t.x,e.y+t.y,e.z+t.z)};JSM.CoordSub=function(e,t){return new JSM.Vector(e.x-t.x,e.y-t.y,e.z-t.z)};JSM.CoordOffset=function(e,t,n){t=JSM.VectorNormalize(t);var r=new JSM.Coord(0,0,0);r.x=e.x+t.x*n;r.y=e.y+t.y*n;r.z=e.z+t.z*n;return r};JSM.CoordRotate=function(e,t,n,r){var i=JSM.CoordSub(e,r),s=JSM.VectorNormalize(t);t=s.x;e=s.y;var s=s.z,o=i.x,u=i.y,i=i.z,a=new JSM.Coord(0,0,0);a.x=-t*(-t*o-e*u-s*i)*(1-Math.cos(n))+o*Math.cos(n)+(-s*u+e*i)*Math.sin(n);a.y=-e*(-t*o-e*u-s*i)*(1-Math.cos(n))+u*Math.cos(n)+(s*o-t*i)*Math.sin(n);a.z=-s*(-t*o-e*u-s*i)*(1-Math.cos(n))+i*Math.cos(n)+(-e*o+t*u)*Math.sin(n);return a=JSM.CoordAdd(a,r)};JSM.GetCoord2DFromCoord=function(e,t,n){var r=new JSM.Vector(0,0,1),i=JSM.VectorCross(n,r);n=JSM.GetVectorsAngle(n,r);e=JSM.CoordRotate(e,i,n,t);return new JSM.Coord2D(e.x,e.y)};JSM.CoordTurnType=function(e,t,n,r){var i=new JSM.Coord(0,0,0);e=JSM.GetCoord2DFromCoord(e,i,r);t=JSM.GetCoord2DFromCoord(t,i,r);n=JSM.GetCoord2DFromCoord(n,i,r);n=JSM.CoordTurnType2D(e,t,n);i=new JSM.Vector(0,0,1);r=JSM.GetVectorsAngle(r,i);JSM.IsEqual(r,Math.PI)&&("CounterClockwise"===n?n="Clockwise":"Clockwise"===n&&(n="CounterClockwise"));return n};JSM.CalculateCentroid=function(e){var t=e.length,n=new JSM.Coord(0,0,0);if(1<=t){var r;for(r=0;r<t;r++)n=JSM.CoordAdd(n,e[r]);n=JSM.VectorMultiply(n,1/t)}return n};JSM.CalculateTriangleNormal=function(e,t,n){t=JSM.CoordSub(t,e);e=JSM.CoordSub(n,e);n=new JSM.Vector(0,0,0);n.x=t.y*e.z-t.z*e.y;n.y=t.z*e.x-t.x*e.z;n.z=t.x*e.y-t.y*e.x;return JSM.VectorNormalize(n)};JSM.CalculateNormal=function(e){var t=e.length,n=new JSM.Vector(0,0,0);if(3<=t){var r,i,s;for(r=0;r<t;r++)i=r%t,s=(r+1)%t,i=e[i],s=e[s],n.x+=(i.y-s.y)*(i.z+s.z),n.y+=(i.z-s.z)*(i.x+s.x),n.z+=(i.x-s.x)*(i.y+s.y)}return JSM.VectorNormalize(n)};JSM.SphericalToCartesian=function(e,t,n){var r=new JSM.Coord(0,0,0);r.x=e*Math.sin(t)*Math.cos(n);r.y=e*Math.sin(t)*Math.sin(n);r.z=e*Math.cos(t);return r};JSM.CartesianToSpherical=function(e,t,n){var r=new JSM.SphericalCoord(0,0,0);r.radius=Math.sqrt(e*e+t*t+n*n);if(JSM.IsZero(r.radius))return r;r.theta=Math.acos(n/r.radius);r.phi=Math.atan2(t,e);return r};JSM.SphericalToCartesianWithOrigo=function(e,t){var n=JSM.SphericalToCartesian(e.radius,e.theta,e.phi);return JSM.CoordAdd(n,t)};JSM.CartesianToSphericalWithOrigo=function(e,t){var n=JSM.CoordSub(e,t);return JSM.CartesianToSpherical(n.x,n.y,n.z)};JSM.MoveCoordOnSphere=function(e,t,n,r){e=JSM.CartesianToSphericalWithOrigo(e,t);e.theta+=n;e.phi+=r;return JSM.SphericalToCartesianWithOrigo(e,t)};JSM.CylindricalToCartesian=function(e,t,n){var r=new JSM.Coord(0,0,0);r.x=e*Math.cos(n);r.y=e*Math.sin(n);r.z=t;return r};JSM.GetArcLength=function(e,t,n){return JSM.GetVectorsAngle(e,t)*n};JSM.GetFullArcLength=function(e,t,n,r){return JSM.GetVectorsFullAngle(e,t,r)*n};JSM.MatrixIdentity=function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]};JSM.MatrixClone=function(e){var t=[];t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];t[4]=e[4];t[5]=e[5];t[6]=e[6];t[7]=e[7];t[8]=e[8];t[9]=e[9];t[10]=e[10];t[11]=e[11];t[12]=e[12];t[13]=e[13];t[14]=e[14];t[15]=e[15];return t};JSM.MatrixTranspose=function(e){var t=[];t[0]=e[0];t[1]=e[4];t[2]=e[8];t[3]=e[12];t[4]=e[1];t[5]=e[5];t[6]=e[9];t[7]=e[13];t[8]=e[2];t[9]=e[6];t[10]=e[10];t[11]=e[14];t[12]=e[3];t[13]=e[7];t[14]=e[11];t[15]=e[15];return t};JSM.MatrixVectorMultiply=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=e[1],u=e[2],a=e[3],f=e[5],l=e[6],c=e[7],h=e[9],p=e[10],d=e[11],v=e[13],m=e[14],g=e[15],y=[];y[0]=n*e[0]+r*e[4]+i*e[8]+s*e[12];y[1]=n*o+r*f+i*h+s*v;y[2]=n*u+r*l+i*p+s*m;y[3]=n*a+r*c+i*d+s*g;return y};JSM.MatrixMultiply=function(e,t){var n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],u=e[5],a=e[6],f=e[7],l=e[8],c=e[9],h=e[10],p=e[11],d=e[12],v=e[13],m=e[14],g=e[15],y=t[0],b=t[1],w=t[2],E=t[3],S=t[4],x=t[5],T=t[6],N=t[7],C=t[8],k=t[9],L=t[10],A=t[11],O=t[12],M=t[13],_=t[14],D=t[15],P=[];P[0]=n*y+r*S+i*C+s*O;P[1]=n*b+r*x+i*k+s*M;P[2]=n*w+r*T+i*L+s*_;P[3]=n*E+r*N+i*A+s*D;P[4]=o*y+u*S+a*C+f*O;P[5]=o*b+u*x+a*k+f*M;P[6]=o*w+u*T+a*L+f*_;P[7]=o*E+u*N+a*A+f*D;P[8]=l*y+c*S+h*C+p*O;P[9]=l*b+c*x+h*k+p*M;P[10]=l*w+c*T+h*L+p*_;P[11]=l*E+c*N+h*A+p*D;P[12]=d*y+v*S+m*C+g*O;P[13]=d*b+v*x+m*k+g*M;P[14]=d*w+v*T+m*L+g*_;P[15]=d*E+v*N+m*A+g*D;return P};JSM.MatrixDeterminant=function(e){var t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],o=e[5],u=e[6],a=e[7],f=e[8],l=e[9],c=e[10],h=e[11],p=e[12],d=e[13],v=e[14];e=e[15];return(t*o-n*s)*(c*e-h*v)-(t*u-r*s)*(l*e-h*d)+(t*a-i*s)*(l*v-c*d)+(n*u-r*o)*(f*e-h*p)-(n*a-i*o)*(f*v-c*p)+(r*a-i*u)*(f*d-l*p)};JSM.MatrixInvert=function(e){var t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],o=e[5],u=e[6],a=e[7],f=e[8],l=e[9],c=e[10],h=e[11],p=e[12],d=e[13],v=e[14];e=e[15];var m=t*o-n*s,g=t*u-r*s,y=t*a-i*s,b=n*u-r*o,w=n*a-i*o,E=r*a-i*u,S=f*d-l*p,x=f*v-c*p,T=f*e-h*p,N=l*v-c*d,C=l*e-h*d,k=c*e-h*v,L=m*k-g*C+y*N+b*T-w*x+E*S;if(JSM.IsZero(L))return null;var A=[];A[0]=(o*k-u*C+a*N)/L;A[1]=(r*C-n*k-i*N)/L;A[2]=(d*E-v*w+e*b)/L;A[3]=(c*w-l*E-h*b)/L;A[4]=(u*T-s*k-a*x)/L;A[5]=(t*k-r*T+i*x)/L;A[6]=(v*y-p*E-e*g)/L;A[7]=(f*E-c*y+h*g)/L;A[8]=(s*C-o*T+a*S)/L;A[9]=(n*T-t*C-i*S)/L;A[10]=(p*w-d*y+e*m)/L;A[11]=(l*y-f*w-h*m)/L;A[12]=(o*x-s*N-u*S)/L;A[13]=(t*N-n*x+r*S)/L;A[14]=(d*g-p*b-v*m)/L;A[15]=(f*b-l*g+c*m)/L;return A};JSM.MatrixTranslation=function(e,t,n){var r=[1,0,0,0,0,1,0,0,0,0,1,0];r[12]=e;r[13]=t;r[14]=n;r[15]=1;return r};JSM.MatrixRotation=function(e,t,n){var r=JSM.VectorNormalize(e);e=r.x;var i=r.y,r=r.z,s=e*e,o=i*i,u=r*r,a=Math.sin(t);t=Math.cos(t);var f=[];if(void 0===n||null===n)f[0]=s+(o+u)*t,f[1]=e*i*(1-t)+r*a,f[2]=e*r*(1-t)-i*a,f[3]=0,f[4]=e*i*(1-t)-r*a,f[5]=o+(s+u)*t,f[6]=i*r*(1-t)+e*a,f[7]=0,f[8]=e*r*(1-t)+i*a,f[9]=i*r*(1-t)-e*a,f[10]=u+(s+o)*t,f[11]=0,f[12]=0,f[13]=0,f[14]=0;else{var l=n.x,c=n.y;n=n.z;f[0]=s+(o+u)*t;f[1]=e*i*(1-t)+r*a;f[2]=e*r*(1-t)-i*a;f[3]=0;f[4]=e*i*(1-t)-r*a;f[5]=o+(s+u)*t;f[6]=i*r*(1-t)+e*a;f[7]=0;f[8]=e*r*(1-t)+i*a;f[9]=i*r*(1-t)-e*a;f[10]=u+(s+o)*t;f[11]=0;f[12]=(l*(o+u)-e*(c*i+n*r))*(1-t)+(c*r-n*i)*a;f[13]=(c*(s+u)-i*(l*e+n*r))*(1-t)+(n*e-l*r)*a;f[14]=(n*(s+o)-r*(l*e+c*i))*(1-t)+(l*i-c*e)*a}f[15]=1;return f};JSM.MatrixRotationQuaternion=function(e){var t=e[0],n=e[1],r=e[2],i=e[3],s=t+t,o=n+n,u=r+r;e=t*s;var a=t*o,t=t*u,f=n*o,n=n*u,r=r*u,s=i*s,o=i*o,i=i*u,u=[];u[0]=1-(f+r);u[1]=a+i;u[2]=t-o;u[3]=0;u[4]=a-i;u[5]=1-(e+r);u[6]=n+s;u[7]=0;u[8]=t+o;u[9]=n-s;u[10]=1-(e+f);u[11]=0;u[12]=0;u[13]=0;u[14]=0;u[15]=1;return u};JSM.MatrixRotationX=function(e){var t=Math.sin(e);e=Math.cos(e);var n=[1,0,0,0,0];n[5]=e;n[6]=t;n[7]=0;n[8]=0;n[9]=-t;n[10]=e;n[11]=0;n[12]=0;n[13]=0;n[14]=0;n[15]=1;return n};JSM.MatrixRotationY=function(e){var t=Math.sin(e);e=Math.cos(e);var n=[];n[0]=e;n[1]=0;n[2]=-t;n[3]=0;n[4]=0;n[5]=1;n[6]=0;n[7]=0;n[8]=t;n[9]=0;n[10]=e;n[11]=0;n[12]=0;n[13]=0;n[14]=0;n[15]=1;return n};JSM.MatrixRotationZ=function(e){var t=Math.sin(e);e=Math.cos(e);var n=[];n[0]=e;n[1]=t;n[2]=0;n[3]=0;n[4]=-t;n[5]=e;n[6]=0;n[7]=0;n[8]=0;n[9]=0;n[10]=1;n[11]=0;n[12]=0;n[13]=0;n[14]=0;n[15]=1;return n};JSM.MatrixView=function(e,t,n){if(JSM.CoordIsEqual(e,t))return JSM.MatrixIdentity();var r=[];t=JSM.VectorNormalize(JSM.CoordSub(e,t));n=JSM.VectorNormalize(JSM.VectorCross(n,t));var i=JSM.VectorNormalize(JSM.VectorCross(t,n));r[0]=n.x;r[1]=i.x;r[2]=t.x;r[3]=0;r[4]=n.y;r[5]=i.y;r[6]=t.y;r[7]=0;r[8]=n.z;r[9]=i.z;r[10]=t.z;r[11]=0;r[12]=-JSM.VectorDot(n,e);r[13]=-JSM.VectorDot(i,e);r[14]=-JSM.VectorDot(t,e);r[15]=1;return r};JSM.MatrixPerspective=function(e,t,n,r){var i=[];e=1/Math.tan(e/2);var s=1/(n-r);i[0]=e/t;i[1]=0;i[2]=0;i[3]=0;i[4]=0;i[5]=e;i[6]=0;i[7]=0;i[8]=0;i[9]=0;i[10]=(r+n)*s;i[11]=-1;i[12]=0;i[13]=0;i[14]=2*r*n*s;i[15]=0;return i};JSM.ApplyTransformation=function(e,t){var n=[];n[0]=t.x;n[1]=t.y;n[2]=t.z;n[3]=1;n=JSM.MatrixVectorMultiply(e,n);return new JSM.Coord(n[0],n[1],n[2])};JSM.CoordSystem=function(e,t,n,r){this.origo=e;this.e1=t;this.e2=n;this.e3=r};JSM.CoordSystem.prototype.Set=function(e,t,n,r){this.origo=e;this.e1=t;this.e2=n;this.e3=r};JSM.CoordSystem.prototype.Clone=function(){return new JSM.CoordSystem(this.origo.Clone(),this.e1.Clone(),this.e2.Clone(),this.e3.Clone())};JSM.CoordSystemToDirectionVectors=function(e){return new JSM.CoordSystem(e.origo,JSM.CoordSub(e.e1,e.origo),JSM.CoordSub(e.e2,e.origo),JSM.CoordSub(e.e3,e.origo))};JSM.CoordSystemToAbsoluteCoords=function(e){return new JSM.CoordSystem(e.origo,JSM.CoordAdd(e.e1,e.origo),JSM.CoordAdd(e.e2,e.origo),JSM.CoordAdd(e.e3,e.origo))};JSM.ChangeCoordSystem=function(e,t,n){var r=JSM.VectorNormalize(t.e1),i=JSM.VectorNormalize(t.e2),s=JSM.VectorNormalize(t.e3),o=JSM.VectorNormalize(n.e1),u=JSM.VectorNormalize(n.e2),a=JSM.VectorNormalize(n.e3);e=JSM.CoordSub(e,t.origo);t=new JSM.Coord(0,0,0);t.x=JSM.VectorDot(o,r)*e.x+JSM.VectorDot(o,i)*e.y+JSM.VectorDot(o,s)*e.z;t.y=JSM.VectorDot(u,r)*e.x+JSM.VectorDot(u,i)*e.y+JSM.VectorDot(u,s)*e.z;t.z=JSM.VectorDot(a,r)*e.x+JSM.VectorDot(a,i)*e.y+JSM.VectorDot(a,s)*e.z;return t=JSM.CoordAdd(t,n.origo)};JSM.Sector2D=function(e,t){this.beg=e;this.end=t};JSM.Sector2D.prototype.Set=function(e,t){this.beg=e;this.end=t};JSM.Sector2D.prototype.Clone=function(){return new JSM.Sector2D(this.beg.Clone(),this.end.Clone())};JSM.Sector=function(e,t){this.beg=e;this.end=t};JSM.Sector.prototype.Set=function(e,t){this.beg=e;this.end=t};JSM.Sector.prototype.Clone=function(){return new JSM.Sector(this.beg.Clone(),this.end.Clone())};JSM.CoordSectorPosition2D=function(e,t){var n=e.x,r=e.y,i=t.beg.x,s=t.beg.y,o=t.end.x,u=t.end.y,a=Math.pow(o-i,2)+Math.pow(u-s,2);if(JSM.IsZero(a))return JSM.CoordIsEqual2D(e,t.beg)?"CoordOnSectorEndCoord":"CoordOutsideOfSector";a=((n-i)*(o-i)+(r-s)*(u-s))/a;if(JSM.IsLower(a,0)||JSM.IsGreater(a,1))return"CoordOutsideOfSector";s+=a*(u-s);return!JSM.IsEqual(i+a*(o-i),n)||!JSM.IsEqual(s,r)?"CoordOutsideOfSector":JSM.IsEqual(a,0)||JSM.IsEqual(a,1)?"CoordOnSectorEndCoord":"CoordInsideOfSector"};JSM.SectorSectorPosition2D=function(e,t,n){var r=e.beg.x,i=e.beg.y,s=e.end.x,o=e.end.y,u=t.beg.x,a=t.beg.y,f=t.end.x,l=t.end.y,c=(f-u)*(i-a)-(l-a)*(r-u),h=(s-r)*(i-a)-(o-i)*(r-u);if(JSM.IsZero(c)&&JSM.IsZero(h))return n=JSM.CoordSectorPosition2D(e.beg,t),r=JSM.CoordSectorPosition2D(e.end,t),i=JSM.CoordSectorPosition2D(t.beg,e),e=JSM.CoordSectorPosition2D(t.end,e),"CoordInsideOfSector"===n||"CoordInsideOfSector"===r||"CoordInsideOfSector"===i||"CoordInsideOfSector"===e||"CoordOnSectorEndCoord"===n&&"CoordOnSectorEndCoord"===r&&"CoordOnSectorEndCoord"===i&&"CoordOnSectorEndCoord"===e?"SectorsIntersectsCoincident":"CoordOnSectorEndCoord"===n||"CoordOnSectorEndCoord"===r||"CoordOnSectorEndCoord"===i||"CoordOnSectorEndCoord"===e?"SectorsIntersectsEndPoint":"SectorsDontIntersects";e=(l-a)*(s-r)-(f-u)*(o-i);if(JSM.IsZero(e))return"SectorsDontIntersects";c/=e;h/=e;if(JSM.IsLower(c,0)||JSM.IsGreater(c,1)||JSM.IsLower(h,0)||JSM.IsGreater(h,1))return"SectorsDontIntersects";void 0!==n&&(n.x=r+c*(s-r),n.y=i+c*(o-i));return JSM.IsEqual(c,0)||JSM.IsEqual(c,1)||JSM.IsEqual(h,0)||JSM.IsEqual(h,1)?"SectorsIntersectsEndPoint":"SectorsIntersectsOnePoint"};JSM.GetSectorSegmentation=function(e,t,n){var r=JSM.CoordSub(e.end,e.beg),i=JSM.CoordDistance(e.beg,e.end)/t,s=0,o;for(o=0;o<=t;o++)n.push(JSM.CoordOffset(e.beg,r,s)),s+=i};JSM.Line2D=function(e,t){this.start=e;this.direction=t};JSM.Line2D.prototype.Set=function(e,t){this.start=e;this.direction=t};JSM.Line2D.prototype.Clone=function(){return new JSM.Line2D(this.start.Clone(),this.direction.Clone())};JSM.Line=function(e,t){this.start=e;this.direction=t};JSM.Line.prototype.Set=function(e,t){this.start=e;this.direction=t};JSM.Line.prototype.Clone=function(){return new JSM.Line(this.start.Clone(),this.direction.Clone())};JSM.CoordLinePosition2D=function(e,t){var n=t.start,r=t.direction,n=r.x*(e.y-n.y)-r.y*(e.x-n.x);return JSM.IsPositive(n)?"CoordAtLineLeft":JSM.IsNegative(n)?"CoordAtLineRight":"CoordOnLine"};JSM.CoordLinePosition=function(e,t,n){var r=e.x,i=e.y,s=e.z,o=t.start;t=t.direction;var u=o.x,a=o.y,f=o.z,l=o.x+t.x,c=o.y+t.y,h=o.z+t.z,p=(l-u)*(l-u)+(c-a)*(c-a)+(h-f)*(h-f);if(JSM.IsZero(p))return void 0!==n&&n.Set(o.x,o.y,o.z),JSM.CoordIsEqual(o,e)?"CoordOnLine":"CoordOutsideOfLine";r=JSM.CoordAdd(o,JSM.VectorMultiply(t,((l-u)*(r-u)+(c-a)*(i-a)+(h-f)*(s-f))/p));void 0!==n&&n.Set(r.x,r.y,r.z);e=JSM.CoordDistance(e,r);return JSM.IsZero(e)?"CoordOnLine":"CoordOutsideOfLine"};JSM.ProjectCoordToLine=function(e,t){var n=new JSM.Coord(0,0,0),r=e.x,i=e.y,s=e.z,o=t.start,u=t.direction,a=o.x,f=o.y,l=o.z,c=o.x+u.x,h=o.y+u.y,p=o.z+u.z,d=(c-a)*(c-a)+(h-f)*(h-f)+(p-l)*(p-l);if(JSM.IsZero(d))return n.Set(o.x,o.y,o.z),n;r=JSM.CoordAdd(o,JSM.VectorMultiply(u,((c-a)*(r-a)+(h-f)*(i-f)+(p-l)*(s-l))/d));n.Set(r.x,r.y,r.z);return n};JSM.LineLineClosestPoint=function(e,t,n,r){function i(e,t,n,r,i){return(e[t].x-e[n].x)*(e[r].x-e[i].x)+(e[t].y-e[n].y)*(e[r].y-e[i].y)+(e[t].z-e[n].z)*(e[r].z-e[i].z)}var s=JSM.VectorNormalize(e.direction),o=e.start,s=JSM.CoordAdd(o,s);e=JSM.VectorNormalize(t.direction);t=t.start;var u=JSM.CoordAdd(t,e),a=[o,s,t,u],f=i(a,1,0,1,0),l=i(a,0,2,1,0),u=i(a,0,2,3,2),c=i(a,3,2,1,0),a=i(a,3,2,3,2),f=f*a-c*c;if(JSM.IsEqual(f,0))return!1;l=(u*c-l*a)/f;u=(u+l*c)/a;void 0!==n&&(s=JSM.VectorNormalize(JSM.CoordSub(s,o)),o=JSM.CoordAdd(o,JSM.VectorMultiply(s,l)),n.Set(o.x,o.y,o.z));void 0!==r&&(n=JSM.CoordAdd(t,JSM.VectorMultiply(e,u)),r.Set(n.x,n.y,n.z));return!0};JSM.LineLinePosition=function(e,t,n){var r=new JSM.Coord(0,0,0),i=new JSM.Coord(0,0,0);return!JSM.LineLineClosestPoint(e,t,r,i)?"LinesIntersectsCoincident":JSM.CoordIsEqual(r,i)?(void 0!==n&&n.Set(r.x,r.y,r.z),"LinesIntersectsOnePoint"):"LinesDontIntersects"};JSM.Transformation=function(){this.matrix=JSM.MatrixIdentity()};JSM.Transformation.prototype.GetMatrix=function(){return this.matrix};JSM.Transformation.prototype.SetMatrix=function(e){this.matrix=e};JSM.Transformation.prototype.Append=function(e){this.matrix=JSM.MatrixMultiply(this.matrix,e.matrix)};JSM.Transformation.prototype.Apply=function(e){return JSM.ApplyTransformation(this.matrix,e)};JSM.Transformation.prototype.Clone=function(){var e=new JSM.Transformation;e.matrix=JSM.MatrixClone(this.matrix);return e};JSM.IdentityTransformation=function(){var e=new JSM.Transformation;e.matrix=JSM.MatrixIdentity();return e};JSM.TranslationTransformation=function(e){var t=new JSM.Transformation;t.matrix=JSM.MatrixTranslation(e.x,e.y,e.z);return t};JSM.OffsetTransformation=function(e,t){var n=JSM.VectorNormalize(e),n=JSM.VectorMultiply(n,t);return JSM.TranslationTransformation(n)};JSM.RotationTransformation=function(e,t,n){var r=new JSM.Transformation;r.matrix=JSM.MatrixRotation(e,t,n);return r};JSM.RotationXTransformation=function(e,t){var n=new JSM.Transformation;void 0===t||null===t?n.matrix=JSM.MatrixRotationX(e):(n.Append(JSM.TranslationTransformation(new JSM.Vector(-t.x,-t.y,-t.z))),n.Append(JSM.RotationXTransformation(e)),n.Append(JSM.TranslationTransformation(new JSM.Vector(t.x,t.y,t.z))));return n};JSM.RotationYTransformation=function(e,t){var n=new JSM.Transformation;void 0===t||null===t?n.matrix=JSM.MatrixRotationY(e):(n.Append(JSM.TranslationTransformation(new JSM.Vector(-t.x,-t.y,-t.z))),n.Append(JSM.RotationYTransformation(e)),n.Append(JSM.TranslationTransformation(new JSM.Vector(t.x,t.y,t.z))));return n};JSM.RotationZTransformation=function(e,t){var n=new JSM.Transformation;void 0===t||null===t?n.matrix=JSM.MatrixRotationZ(e):(n.Append(JSM.TranslationTransformation(new JSM.Vector(-t.x,-t.y,-t.z))),n.Append(JSM.RotationZTransformation(e)),n.Append(JSM.TranslationTransformation(new JSM.Vector(t.x,t.y,t.z))));return n};JSM.RotationXYZTransformation=function(e,t,n,r){var i=new JSM.Transformation;i.Append(JSM.RotationXTransformation(e,r));i.Append(JSM.RotationYTransformation(t,r));i.Append(JSM.RotationZTransformation(n,r));return i};JSM.Plane=function(e,t,n,r){this.a=e;this.b=t;this.c=n;this.d=r};JSM.Plane.prototype.Set=function(e,t,n,r){this.a=e;this.b=t;this.c=n;this.d=r};JSM.Plane.prototype.GetNormal=function(){return new JSM.Vector(this.a,this.b,this.c)};JSM.Plane.prototype.Clone=function(){return new JSM.Plane(this.a,this.b,this.c,this.d)};JSM.GetPlaneFromCoordAndDirection=function(e,t){var n=new JSM.Plane,r=JSM.VectorNormalize(t),i=r.x,s=r.y,r=r.z;n.Set(i,s,r,-(i*e.x+s*e.y+r*e.z));return n};JSM.GetPlaneFromThreeCoords=function(e,t,n){var r=new JSM.Plane,i=(t.y-e.y)*(n.z-e.z)-(n.y-e.y)*(t.z-e.z),s=(t.z-e.z)*(n.x-e.x)-(n.z-e.z)*(t.x-e.x);t=(t.x-e.x)*(n.y-e.y)-(n.x-e.x)*(t.y-e.y);r.Set(i,s,t,-(i*e.x+s*e.y+t*e.z));return r};JSM.CoordPlanePosition=function(e,t){var n=t.a*e.x+t.b*e.y+t.c*e.z+t.d;return JSM.IsPositive(n)?"CoordInFrontOfPlane":JSM.IsNegative(n)?"CoordAtBackOfPlane":"CoordOnPlane"};JSM.LinePlanePosition=function(e,t,n){var r=JSM.VectorNormalize(e.direction),i=e.start.x,s=e.start.y,o=e.start.z,u=t.a,a=t.b,f=t.c;t=t.d;var l=u*(i-(e.start.x+r.x))+a*(s-(e.start.y+r.y))+f*(o-(e.start.z+r.z));if(JSM.IsZero(l))return"LineParallelToPlane";void 0!==n&&(e=JSM.CoordAdd(e.start,JSM.VectorMultiply(r,(u*i+a*s+f*o+t)/l)),n.Set(e.x,e.y,e.z));return"LineIntersectsPlane"};JSM.LinePlaneIntersection=function(e,t){var n=JSM.VectorNormalize(e.direction),r=e.start.x,i=e.start.y,s=e.start.z,o=e.start.x+n.x,u=e.start.y+n.y,a=e.start.z+n.z,f=t.a,l=t.b,c=t.c,h=t.d,p=new JSM.Coord(0,0,0),o=f*(r-o)+l*(i-u)+c*(s-a);return JSM.IsZero(o)?p:p=JSM.CoordAdd(e.start,JSM.VectorMultiply(n,(f*r+l*i+c*s+h)/o))};JSM.CoordPlaneSignedDistance=function(e,t){var n=t.a,r=t.b,i=t.c;return(n*e.x+r*e.y+i*e.z+t.d)/Math.sqrt(n*n+r*r+i*i)};JSM.CoordPlaneDistance=function(e,t){return Math.abs(JSM.CoordPlaneSignedDistance(e,t))};JSM.CoordPlaneSignedDirectionalDistance=function(e,t,n){var r=JSM.VectorNormalize(t);t=e.x;var i=e.y,s=e.z,o=n.a,u=n.b,a=n.c;n=n.d;var f=o*(t-(e.x+r.x))+u*(i-(e.y+r.y))+a*(s-(e.z+r.z));if(JSM.IsZero(f))return 0;r=JSM.CoordAdd(e,JSM.VectorMultiply(r,(o*t+u*i+a*s+n)/f));e=JSM.CoordDistance(e,r);JSM.IsNegative(o*t+u*i+a*s+n)&&(e=-e);return e};JSM.CoordPlaneDirectionalDistance=function(e,t,n){return Math.abs(JSM.CoordPlaneSignedDirectionalDistance(e,t,n))};JSM.ProjectCoordToPlane=function(e,t){var n=e.x,r=e.y,i=e.z,s=t.a,o=t.b,u=t.c,a=t.d,f=JSM.CoordPlaneDistance(e,t);JSM.IsGreater(s*n+o*r+u*i+a,0)&&(f=-f);n=JSM.VectorNormalize(new JSM.Coord(s,o,u));return JSM.CoordOffset(e,n,f)};JSM.Project=function(e,t,n,r,i,s,o,u,a){t=JSM.MatrixView(t,n,r);o=JSM.MatrixPerspective(i,s,o,u);i=new JSM.Coord(0,0,0);u=[];s=[];u[0]=e.x;u[1]=e.y;u[2]=e.z;u[3]=1;s=JSM.MatrixVectorMultiply(o,JSM.MatrixVectorMultiply(t,u));e=s[3];JSM.IsZero(e)?a=null:(s[0]=.5*(s[0]/e)+.5,s[1]=.5*(s[1]/e)+.5,s[2]=.5*(s[2]/e)+.5,s[0]=s[0]*a[2]+a[0],s[1]=s[1]*a[3]+a[1],i.x=s[0],i.y=s[1],i.z=s[2],a=i);return a};JSM.ConvexHull2D=function(e){function t(e,t){var n=e.length,r=0,i;for(i=1;i<n;i++)t==r?r=i:"Clockwise"==JSM.CoordTurnType2D(e[t],e[r],e[i])&&(r=i);return r}var n=[];if(3>e.length)return n;var r=function(e){var t=e.length,n=JSM.Inf,r=-1,i,s;for(i=0;i<t;i++)s=e[i].x,JSM.IsLower(s,n)&&(n=s,r=i);return r}(e),i=r,s;do n.push(i),i=s=t(e,i);while(s!=r);return n};JSM.ConvexHull3D=function(e){function t(){this.position=null}function n(){this.tri2=this.tri1=this.vert2=this.vert1=null}function r(){this.valid=this.edges=this.vertices=null}function i(e,n){var r=new t;r.position=n;e.vertices.push(r);return e.vertices.length-1}function s(e,t,r,i){var s=-1,o,u;for(o=0;o<e.edges.length;o++)if(u=e.edges[o],u.vert1==r&&u.vert2==i||u.vert1==i&&u.vert2==r){s=o;break}-1==s&&(s=new n,s.vert1=r,s.vert2=i,s.tri1=-1,s.tri2=-1,e.edges.push(s),s=e.edges.length-1);e=e.edges[s];e.tri1!=t&&e.tri2!=t&&(-1==e.tri1?e.tri1=t:-1==e.tri2&&(e.tri2=t));return s}function o(e,t,n,i){var o=e.triangles.length,u=s(e,o,t,n),a=s(e,o,n,i),o=s(e,o,i,t),f=new r;f.vertices=[t,n,i];f.edges=[u,a,o];f.valid=!0;e.triangles.push(f);return e.triangles.length-1}function u(e,t,n){e=e.edges[n];e.tri1==t?e.tri1=-1:e.tri2==t&&(e.tri2=-1)}function a(e,t,n,r,i){n=e.vertices[n].position;r=e.vertices[r].position;i=e.vertices[i].position;e=JSM.CoordSub(e.vertices[t].position,i);t=JSM.CoordSub(n,i);n=JSM.CoordSub(r,i);return JSM.VectorDot(e,JSM.VectorCross(t,n))/6}function f(e,t){var n=[],r,i;for(r=0;r<e.triangles.length;r++)i=e.triangles[r],i.valid?!JSM.IsLower(a(e,i.vertices[0],i.vertices[2],i.vertices[1],t),0)?n.push(!0):n.push(!1):n.push(!1);var s,f,l,c=[];for(r=0;r<n.length;r++)n[r]&&(i=e.triangles[r],i.valid&&(s=e.edges[i.edges[0]],f=e.edges[i.edges[1]],l=e.edges[i.edges[2]],s=-1==s.tri1||-1==s.tri2||n[s.tri1]!=n[s.tri2],f=-1==f.tri1||-1==f.tri2||n[f.tri1]!=n[f.tri2],l=-1==l.tri1||-1==l.tri2||n[l.tri1]!=n[l.tri2],s&&c.push([i.vertices[0],i.vertices[1],t]),f&&c.push([i.vertices[1],i.vertices[2],t]),l&&c.push([i.vertices[2],i.vertices[0],t])));for(r=0;r<n.length;r++)n[r]&&(i=e.triangles[r],i.valid&&(i=e,l=r,s=i.triangles[l],s.valid&&(u(i,l,s.edges[0]),u(i,l,s.edges[1]),u(i,l,s.edges[2]),s.valid=!1)));for(r=0;r<c.length;r++)n=c[r],o(e,n[0],n[1],n[2])}var l=[],c=e.length;if(4>c)return l;var h=new function(){this.vertices=[];this.edges=[];this.triangles=[]},p;for(p=0;p<c;p++)i(h,e[p]);(function(e){var t=-1,t=!JSM.IsLower(a(e,0,1,2,3),0)?o(e,0,1,2):o(e,0,2,1),t=e.triangles[t];o(e,t.vertices[0],t.vertices[2],3);o(e,t.vertices[2],t.vertices[1],3);o(e,t.vertices[1],t.vertices[0],3)})(h);for(p=4;p<c;p++)f(h,p);for(p=0;p<h.triangles.length;p++)e=h.triangles[p],e.valid&&l.push(e.vertices);return l};JSM.Polygon2D=function(){this.vertices=[]};JSM.Polygon2D.prototype.AddVertex=function(e,t){this.vertices.push(new JSM.Coord2D(e,t))};JSM.Polygon2D.prototype.GetVertex=function(e){return this.vertices[e]};JSM.Polygon2D.prototype.SetVertex=function(e,t,n){this.vertices[e].Set(t,n)};JSM.Polygon2D.prototype.VertexCount=function(){return this.vertices.length};JSM.Polygon2D.prototype.Clear=function(){this.vertices=[]};JSM.Polygon2D.prototype.Clone=function(){var e=new JSM.Polygon2D,t;for(t=0;t<this.vertices.length;t++)e.vertices.push(this.vertices[t].Clone());return e};JSM.ContourPolygon2D=function(){this.polygons=[]};JSM.ContourPolygon2D.prototype.AddVertex=function(e,t,n){void 0===this.polygons[e]&&(this.polygons[e]=new JSM.Polygon2D);this.polygons[e].AddVertex(t,n)};JSM.ContourPolygon2D.prototype.VertexCount=function(e){return void 0===this.polygons[e]?0:this.polygons[e].VertexCount()};JSM.ContourPolygon2D.prototype.GetVertex=function(e,t){return this.polygons[e].GetVertex(t)};JSM.ContourPolygon2D.prototype.SetVertex=function(e,t,n,r){this.polygons[e].SetVertex(t,n,r)};JSM.ContourPolygon2D.prototype.AddContour=function(){this.polygons.push(new JSM.Polygon2D)};JSM.ContourPolygon2D.prototype.ContourCount=function(){return this.polygons.length};JSM.ContourPolygon2D.prototype.GetContour=function(e){return this.polygons[e]};JSM.ContourPolygon2D.prototype.Clear=function(){this.polygons=[]};JSM.ContourPolygon2D.prototype.Clone=function(){var e=new JSM.ContourPolygon2D,t;for(t=0;t<this.polygons.length;t++)e.polygons.push(this.polygons[t].Clone());return e};JSM.Polygon=function(){this.vertices=[]};JSM.Polygon.prototype.AddVertex=function(e,t,n){this.vertices.push(new JSM.Coord(e,t,n))};JSM.Polygon.prototype.GetVertex=function(e){return this.vertices[e]};JSM.Polygon.prototype.SetVertex=function(e,t,n,r){this.vertices[e].Set(t,n,r)};JSM.Polygon.prototype.VertexCount=function(){return this.vertices.length};JSM.Polygon.prototype.Clear=function(){this.vertices=[]};JSM.Polygon.prototype.Clone=function(){var e=new JSM.Polygon,t;for(t=0;t<this.vertices.length;t++)e.vertices.push(this.vertices[t].Clone());return e};JSM.CreatePolygonFromVertices=function(e){var t=new JSM.Polygon2D,n,r;for(n=0;n<e.length;n++)r=e[n],t.AddVertex(r.x,r.y);return t};JSM.PolygonSignedArea2D=function(e){var t=e.VertexCount(),n=0,r,i,s;for(r=0;r<t;r++)i=e.GetVertex(r),s=e.GetVertex((r+1)%t),n+=i.x*s.y-s.x*i.y;return n/2};JSM.PolygonArea2D=function(e){return Math.abs(JSM.PolygonSignedArea2D(e))};JSM.PolygonOrientation2D=function(e){e=JSM.PolygonSignedArea2D(e);return JSM.IsPositive(e)?"CounterClockwise":JSM.IsNegative(e)?"Clockwise":"Invalid"};JSM.ChangePolygonOrientation2D=function(e){var t=e.Clone();e.Clear();var n,r;for(n=t.VertexCount()-1;0<=n;n--)r=t.GetVertex(n),e.AddVertex(r.x,r.y)};JSM.CreateCCWPolygonFromVertices=function(e){e=JSM.CreatePolygonFromVertices(e);"CounterClockwise"!=JSM.PolygonOrientation2D(e)&&JSM.ChangePolygonOrientation2D(e);return e};JSM.PolygonComplexity2D=function(e){var t=!1,n=!1,r=e.VertexCount(),i,s,o,u;for(i=0;i<r;i++)if(s=0===i?r-1:i-1,o=i,u=i===r-1?0:i+1,s=e.GetVertex(s),o=e.GetVertex(o),u=e.GetVertex(u),u=JSM.CoordTurnType2D(s,o,u),"CounterClockwise"===u?t=!0:"Clockwise"===u&&(n=!0),t&&n)return"Concave";return!t&&!n?"Invalid":"Convex"};JSM.CoordPolygonPosition2D=function(e,t){var n=t.VertexCount(),r,i,s;for(r=0;r<n;r++)if(i=t.GetVertex(r),s=t.GetVertex((r+1)%n),i=new JSM.Sector2D(i,s),"CoordOutsideOfSector"!==JSM.CoordSectorPosition2D(e,i))return"CoordOnPolygonEdge";var o=0,u;for(r=0;r<n;r++)u=Math.abs(t.GetVertex(r).x-e.x),JSM.IsGreater(u,o)&&(o=u);o=new JSM.Sector2D(e,new JSM.Coord2D(e.x+2*o,e.y));u=0;var a;for(r=0;r<n;r++)i=t.GetVertex(r),s=t.GetVertex((r+1)%n),i=new JSM.Sector2D(i,s),s=new JSM.Coord2D(0,0),a=JSM.SectorSectorPosition2D(o,i,s),"SectorsDontIntersects"!==a&&("SectorsIntersectsOnePoint"===a?u++:"SectorsIntersectsEndPoint"===a&&(JSM.CoordIsEqual2D(s,i.beg)?JSM.IsGreater(i.beg.y,i.end.y)&&u++:JSM.CoordIsEqual2D(s,i.end)&&JSM.IsLower(i.beg.y,i.end.y)&&u++));return 0===u%2?"CoordOutsideOfPolygon":"CoordInsideOfPolygon"};JSM.SectorIntersectsPolygon2D=function(e,t,n,r){var i=e.VertexCount(),s,o,u;for(s=0;s<i;s++)if(o=s,u=(s+1)%i,!(o==n||u==n||o==r||u==r))if(o=new JSM.Sector2D(e.GetVertex(o),e.GetVertex(u)),o=JSM.SectorSectorPosition2D(t,o),"SectorsDontIntersects"!==o)return!0;return!1};JSM.IsPolygonVertexVisible2D=function(e,t,n){if(t===n)return!1;var r=e.VertexCount();if(n===(0<t?t-1:r-1)||n===(t<r-1?t+1:0))return!1;r=new JSM.Sector2D(e.GetVertex(t),e.GetVertex(n));if(JSM.SectorIntersectsPolygon2D(e,r,t,n))return!1;t=JSM.MidCoord2D(r.beg,r.end);return"CoordInsideOfPolygon"!==JSM.CoordPolygonPosition2D(t,e)?!1:!0};JSM.CreatePolygonWithHole2D=function(e){var t=[],n=[],r=0,i;n.push(-1);for(i=0;i<e.length;i++)null===e[i]&&(n.push(i),r+=1);n.push(i);r+=1;for(i=0;i<r;i++){var s=i,o=n[s]+1,u=n[s+1];if(0===s){s=void 0;for(s=o;s<u;s++)t.push(s)}else{for(var o=void 0,o=new JSM.Polygon2D,u=new JSM.Polygon2D,a=void 0,f=void 0,f=void 0,a=0;a<t.length;a++)f=e[t[a]],o.AddVertex(f.x,f.y);for(var l=n[s]+1,c=n[s+1],a=l;a<c;a++)f=e[a],u.AddVertex(f.x,f.y);for(var h=null,p=void 0,d=void 0,v=void 0,a=0;a<o.VertexCount();a++){d=t[a];for(f=l;f<c;f++)if(v=f-l,p=new JSM.Sector(e[d],e[f]),!JSM.SectorIntersectsPolygon2D(o,p,a,-1)&&!JSM.SectorIntersectsPolygon2D(u,p,-1,v)){h=[d,f];break}if(null!==h)break}o=h;u=n[s]+1;s=n[s+1];a=[];c=l=void 0;for(l=0;l<t.length;l++)a[l]=t[l];t=[];h=f=void 0;for(l=0;l<a.length;l++)if(t.push(a[l]),a[l]==o[0]){c=o[1];f=!0;for(h=!1;!h;)t.push(c),!f&&c==o[1]&&(h=!0),f&&(f=!1),c=c<s-1?c+1:u;t.push(a[l])}}}return t};JSM.PolygonTriangulate2D=function(e){function t(){var e=[],t,n,r,i;for(t=0;t<o.length;t++)if(r=o[t],3===r.length)if("CounterClockwise"===f)e.push(r);else{i=[];for(n=r.length-1;0<=n;n--)i.push(s-r[n]-1);e.push(i)}return e}function n(e,t,n){if(t===n)return!1;var r=e.VertexCount(),i;if(!(i=(t<r-1?t+1:0)===n))i=(0<t?t-1:r-1)===n;return i?!1:JSM.IsPolygonVertexVisible2D(e,t,n)}function r(e,t,n){var r=e.length;if(3>=r)return!0;var i,s,u,a;for(i=0;2>i;i++){u=s=-1;0===i?(s=t,u=n):1===i&&(s=n,u=t);a=[];for(a.push(e[u]);s!==u;s=s<r-1?s+1:0)a.push(e[s]);o.push(a)}return!0}var i=e.Clone(),s=i.VertexCount();if(3>s)return[];var o=[],u=[],a;for(e=0;e<s;e++)u.push(e);o.push(u);if(3===s)return t();var u=JSM.PolygonComplexity2D(i),f=JSM.PolygonOrientation2D(i);if("Invalid"===u||"Invalid"===f)return[];if("CounterClockwise"!==f){var l,c,h;for(e=0;e<s/2;e++)l=e,c=s-e-1,h=i.vertices[l],i.vertices[l]=i.vertices[c],i.vertices[c]=h}if("Convex"===u){for(e=0;e<s-2;e++)i=[],i.push(0),i.push((e+1)%s),i.push((e+2)%s),o.push(i);return t()}var p;for(e=0;e<o.length;e++)if(l=o[e],c=l.length,3!==c){h=new JSM.Polygon2D;for(u=0;u<c;u++)a=i.GetVertex(l[u]),h.AddVertex(a.x,a.y);p=!1;for(u=0;u<c;u++){for(a=0;a<c;a++)if(n(h,u,a)){r(l,u,a);p=!0;break}if(p)break}}return t()};JSM.CheckTriangulation2D=function(e,t){var n=JSM.PolygonSignedArea2D(e),r=0,i,s,o,u,a;for(i=0;i<t.length;i++){o=t[i];if(3!==o.length)return!1;u=new JSM.Polygon2D;for(s=0;s<o.length;s++)a=e.GetVertex(o[s]),u.AddVertex(a.x,a.y);r+=JSM.PolygonSignedArea2D(u)}return!JSM.IsEqual(n,r)?!1:!0};JSM.CreatePolygonWithHole=function(e){var t=[],n;for(n=0;n<e.length;n++)null!==e[n]&&t.push(e[n]);var t=JSM.CalculateNormal(t),r=new JSM.Coord(0,0,0),i=[],s;for(n=0;n<e.length;n++)null!==e[n]?(s=JSM.GetCoord2DFromCoord(e[n],r,t),i.push(s)):i.push(null);return JSM.CreatePolygonWithHole2D(i)};JSM.PolygonTriangulate=function(e){var t=new JSM.Polygon2D,n=JSM.CalculateNormal(e.vertices),r=new JSM.Coord(0,0,0),i=e.VertexCount(),s,o;for(s=0;s<i;s++)o=JSM.GetCoord2DFromCoord(e.GetVertex(s),r,n),t.AddVertex(o.x,o.y);return JSM.PolygonTriangulate2D(t)};JSM.OffsetPolygonContour=function(e,t){var n=e.VertexCount(),r=JSM.CalculateNormal(e.vertices),i,s,o,u,a,f=new JSM.Polygon,l;for(l=0;l<n;l++)i=0===l?n-1:l-1,s=l,o=l===n-1?0:l+1,i=e.GetVertex(i),s=e.GetVertex(s),u=e.GetVertex(o),a=JSM.CoordSub(i,s),o=JSM.CoordSub(u,s),a=JSM.GetVectorsAngle(a,o)/2,"Clockwise"===JSM.CoordTurnType(i,s,u,r)&&(a=Math.PI-a),i=t/Math.sin(a),i=JSM.CoordOffset(s,o,i),i=JSM.CoordRotate(i,r,a,s),f.AddVertex(i.x,i.y,i.z);return f};JSM.CutPolygonWithPlane=function(e,t,n,r,i){function s(e,t,n,r,i){1==t?n.push(e):-1==t?r.push(e):i.push(e)}function o(e,t,n,r){function i(e,t){if(!(2>t.length)){for(var n=e.GetVertex(t[0]),r=e.GetVertex(t[1]),r=JSM.CoordSub(r,n),i=JSM.GetPlaneFromCoordAndDirection(n,r),s,r=[],n=0;n<t.length;n++)s=e.GetVertex(t[n]),r.push(JSM.CoordPlaneSignedDistance(s,i));for(n=0;n<t.length-1;n++)for(i=0;i<t.length-n-1;i++)if(JSM.IsGreater(r[i],r[i+1])){s=r;var o=i+1,u=s[i];s[i]=s[o];s[o]=u;s=t;o=i+1;u=s[i];s[i]=s[o];s[o]=u}}}function s(e,t,n,r,i,s){function o(e,t){e[e[t]]=-1;e[t]=-1}var u=[];(function(e,t,n){var r;for(r=0;r<e.VertexCount();r++)n.push(-1);for(r=0;r<t.length;r+=2){e=n;var i=t,s=r;e[i[s]]=i[s+1];e[i[s+1]]=i[s]}})(e,t,u);var a=0;s&&(a=t.length-1);for(var f=t[a],l=f,c=!1,h=0,p=new JSM.Polygon,d;;){c||(h=n[l],0!==h&&(c=!0));if(0<p.VertexCount()&&l==f)if(1==h?r.push(p):-1==h&&i.push(p),p=new JSM.Polygon,0<a&&a<t.length){l=f=t[a];continue}else break;d=e.GetVertex(l);p.AddVertex(d.x,d.y,d.z);-1!=u[l]?(a=s?a-2:a+2,l=u[l],o(u,l)):l=l<e.VertexCount()-1?l+1:0}}var o=[];(function(e,t){var n,r,i,s;for(n=0;n<e.length;n++)if(r=e[n],0===r){r=0<n?n-1:e.length-1;i=n<e.length-1?n+1:0;s=e[r];i=e[i];if(0!==i&&0===s){for(;0===e[r];)r=0<r?r-1:e.length-1;s=e[r]}(-1==s&&1==i||1==s&&-1==i)&&t.push(n)}})(t,o);0===o.length||0!==o.length%2||(i(e,o),s(e,o,t,n,r,!1),s(e,o,t,n,r,!0))}var u=new JSM.Polygon,a=[];t=function(e,t,n,r){function i(e,n,r,i,s){function o(e,n,r,i,s,o){var u=r[r.length-1];0!==u&&0!==o&&u!=o&&(i=e.GetVertex(i),e=e.GetVertex(s),e=new JSM.Line(e,JSM.CoordSub(e,i)),s=new JSM.Coord(0,0,0),"LineIntersectsPlane"==JSM.LinePlanePosition(e,t,s)&&(n.AddVertex(s.x,s.y,s.z),r.push(0)))}function u(e,t,n,r,i){e=e.GetVertex(r);t.AddVertex(e.x,e.y,e.z);n.push(i)}var a=0===n,f=n===e.VertexCount(),l;f?(n=0,l=e.VertexCount()-1):l=n-1;i=i[n];a||o(e,r,s,l,n,i);f||u(e,r,s,n,i);return i}var s=[],o=!1,u=!1,a,f,l;for(a=0;a<e.VertexCount();a++)f=e.GetVertex(a),f=JSM.CoordPlanePosition(f,t),l=0,"CoordInFrontOfPlane"==f?(l=1,u=!0):"CoordAtBackOfPlane"==f&&(l=-1,o=!0),s.push(l);if(o&&u)for(a=0;a<=e.VertexCount();a++)i(e,a,n,s,r);else{if(o)return-1;if(u)return 1}return 0}(e,t,u,a);0===u.VertexCount()&&0===a.length?s(e,t,n,r,i):o(u,a,n,r);return 0===n.length+r.length+i.length?!1:!0};JSM.BSPNode=function(){this.outside=this.inside=this.parent=this.plane=this.userData=this.polygon=null};JSM.BSPNode.prototype.IsLeaf=function(){return null===this.inside&&null===this.outside};JSM.BSPTree=function(){this.root=null};JSM.BSPTree.prototype.AddPolygon=function(e,t){null===this.root&&(this.root=this.GetNewNode());return this.AddPolygonToNode(this.root,e,t)};JSM.BSPTree.prototype.Traverse=function(e){this.TraverseNode(this.root,e)};JSM.BSPTree.prototype.TraverseNode=function(e,t){null!==e&&(t(e),this.TraverseNode(e.inside,t),this.TraverseNode(e.outside,t))};JSM.BSPTree.prototype.GetNodes=function(){var e=[];this.Traverse(function(t){e.push(t)});return e};JSM.BSPTree.prototype.NodeCount=function(){var e=0;this.Traverse(function(){e+=1});return e};JSM.BSPTree.prototype.AddPolygonToNode=function(e,t,n){if(3>t.VertexCount())return!1;var r;if(null===e.polygon){r=JSM.CalculateNormal(t.vertices);var i=JSM.GetPlaneFromCoordAndDirection(t.GetVertex(0),r);e.polygon=t;void 0!==n&&(e.userData=n);e.plane=i}else{r=[];var s=[],i=[];JSM.CutPolygonWithPlane(t,e.plane,s,r,i)&&(0<r.length&&this.AddInsidePolygonsToNode(e,r,n),0<s.length&&this.AddOutsidePolygonsToNode(e,s,n),0<i.length&&(r=JSM.CalculateNormal(t.vertices),0<JSM.VectorDot(r,e.plane.GetNormal())?this.AddInsidePolygonsToNode(e,i,n):this.AddOutsidePolygonsToNode(e,i,n)))}return!0};JSM.BSPTree.prototype.AddInsidePolygonsToNode=function(e,t,n){null===e.inside&&(e.inside=this.GetNewNode(),e.inside.parent=e);var r;for(r=0;r<t.length;r++)this.AddPolygonToNode(e.inside,t[r],n)};JSM.BSPTree.prototype.AddOutsidePolygonsToNode=function(e,t,n){null===e.outside&&(e.outside=this.GetNewNode(),e.outside.parent=e);var r;for(r=0;r<t.length;r++)this.AddPolygonToNode(e.outside,t[r],n)};JSM.BSPTree.prototype.GetNewNode=function(){return new JSM.BSPNode};JSM.ClipPolygonWithBSPTree=function(e,t,n,r,i,s){function o(e,t,n){if(null!==t){var r=[],i=[],s=[];JSM.CutPolygonWithPlane(e,t.plane,i,r,s)&&(0<r.length&&a(t,r,n),0<i.length&&f(t,i,n),0<s.length&&(e=JSM.CalculateNormal(e.vertices),0<JSM.VectorDot(e,t.plane.GetNormal())?a(t,s,!0):f(t,s,!0)))}}function u(e,t){var n;for(n=0;n<e.length;n++)t.push(e[n])}function a(e,t,n){if(null!==e.inside){e=e.inside;var i;for(i=0;i<t.length;i++)o(t[i],e,n)}else u(t,n?s:r)}function f(e,t,r){if(null!==e.outside){e=e.outside;var s;for(s=0;s<t.length;s++)o(t[s],e,r)}else u(t,r?i:n)}o(e,t.root,!1);return!0};JSM.GetGaussianCParameter=function(e,t,n,r){return Math.sqrt(-(Math.pow(e-n,2)/(2*Math.log(r/Math.abs(t)))))};JSM.GetGaussianValue=function(e,t,n,r){return t*Math.exp(-(Math.pow(e-n,2)/(2*Math.pow(r,2))))};JSM.GenerateCirclePoints=function(e,t,n){var r=[],i=2*Math.PI,s=2*Math.PI/t,o,u;for(o=0;o<t;o++)u=JSM.CylindricalToCartesian(e,0,i),void 0!==n&&null!==n&&(u=JSM.CoordAdd(u,n)),r.push(u),i+=s;return r};JSM.GetRuledMesh=function(e,t,n,r,i){if(e.length===t.length){var s=e.length-1,o=[],u=[],a;for(a=0;a<=s;a++)o.push(JSM.CoordSub(t[a],e[a])),u.push(JSM.CoordDistance(e[a],t[a]));var f,l;for(a=0;a<=s;a++){f=u[a]/n;for(t=0;t<=n;t++)l=JSM.CoordOffset(e[a],o[a],f*t),r.push(l)}for(a=0;a<s;a++)for(t=0;t<n;t++)e=a*(n+1)+t,r=e+1,o=e+n+1,u=o+1,e=[e,o,u,r],i.push(e)}};JSM.BodyVertex=function(e){this.position=e};JSM.BodyVertex.prototype.GetPosition=function(){return this.position};JSM.BodyVertex.prototype.SetPosition=function(e){this.position=e};JSM.BodyVertex.prototype.Clone=function(){return new JSM.BodyVertex(this.position.Clone())};JSM.BodyPolygon=function(e){this.vertices=e;this.curved=this.material=-1};JSM.BodyPolygon.prototype.AddVertexIndex=function(e){this.vertices.push(e)};JSM.BodyPolygon.prototype.GetVertexIndex=function(e){return this.vertices[e]};JSM.BodyPolygon.prototype.VertexIndexCount=function(){return this.vertices.length};JSM.BodyPolygon.prototype.HasMaterialIndex=function(){return-1!==this.material};JSM.BodyPolygon.prototype.GetMaterialIndex=function(){return this.material};JSM.BodyPolygon.prototype.SetMaterialIndex=function(e){this.material=e};JSM.BodyPolygon.prototype.HasCurveGroup=function(){return-1!==this.curved};JSM.BodyPolygon.prototype.GetCurveGroup=function(){return this.curved};JSM.BodyPolygon.prototype.SetCurveGroup=function(e){this.curved=e};JSM.BodyPolygon.prototype.InheritAttributes=function(e){this.material=e.material;this.curved=e.curved};JSM.BodyPolygon.prototype.Clone=function(){var e=new JSM.BodyPolygon([]),t;for(t=0;t<this.vertices.length;t++)e.vertices.push(this.vertices[t]);e.material=this.material;e.curved=this.curved;return e};JSM.Body=function(){this.vertices=[];this.polygons=[];this.SetCubicTextureProjection(new JSM.Coord(0,0,0),new JSM.Coord(1,0,0),new JSM.Coord(0,1,0),new JSM.Coord(0,0,1))};JSM.Body.prototype.AddVertex=function(e){this.vertices.push(e);return this.vertices.length-1};JSM.Body.prototype.AddPolygon=function(e){this.polygons.push(e);return this.polygons.length-1};JSM.Body.prototype.GetVertex=function(e){return this.vertices[e]};JSM.Body.prototype.GetVertexPosition=function(e){return this.vertices[e].position};JSM.Body.prototype.SetVertexPosition=function(e,t){this.vertices[e].position=t};JSM.Body.prototype.VertexCount=function(){return this.vertices.length};JSM.Body.prototype.GetPolygon=function(e){return this.polygons[e]};JSM.Body.prototype.PolygonCount=function(){return this.polygons.length};JSM.Body.prototype.SetPolygonsMaterialIndex=function(e){var t;for(t=0;t<this.polygons.length;t++)this.polygons[t].SetMaterialIndex(e)};JSM.Body.prototype.SetPolygonsCurveGroup=function(e){var t;for(t=0;t<this.polygons.length;t++)this.polygons[t].SetCurveGroup(e)};JSM.Body.prototype.GetTextureProjectionType=function(){return this.projection};JSM.Body.prototype.SetTextureProjectionType=function(e){this.projection=e};JSM.Body.prototype.GetTextureProjectionCoords=function(){return this.coords};JSM.Body.prototype.SetTextureProjectionCoords=function(e){this.coords=e};JSM.Body.prototype.SetPlanarTextureProjection=function(e,t,n){this.SetTextureProjectionType("Planar");this.SetTextureProjectionCoords(new JSM.CoordSystem(e,t,JSM.VectorCross(t,n),new JSM.Coord(0,0,0)))};JSM.Body.prototype.SetCubicTextureProjection=function(e,t,n,r){this.SetTextureProjectionType("Cubic");this.SetTextureProjectionCoords(new JSM.CoordSystem(e,t,n,r))};JSM.Body.prototype.SetCylindricalTextureProjection=function(e,t,n,r){this.SetTextureProjectionType("Cylindrical");this.SetTextureProjectionCoords(new JSM.CoordSystem(e,JSM.VectorSetLength(n,t),JSM.VectorSetLength(JSM.VectorCross(r,n),t),r))};JSM.Body.prototype.Transform=function(e){var t;for(t=0;t<this.vertices.length;t++)this.vertices[t].position=e.Apply(this.vertices[t].position);null!==this.coords&&(t=JSM.CoordSystemToAbsoluteCoords(this.coords),t.origo=e.Apply(t.origo),t.e1=e.Apply(t.e1),t.e2=e.Apply(t.e2),t.e3=e.Apply(t.e3),this.coords=JSM.CoordSystemToDirectionVectors(t))};JSM.Body.prototype.GetBoundingBox=function(){var e=new JSM.Coord(JSM.Inf,JSM.Inf,JSM.Inf),t=new JSM.Coord(-JSM.Inf,-JSM.Inf,-JSM.Inf),n,r;for(n=0;n<this.vertices.length;n++)r=this.vertices[n].position,e.x=JSM.Minimum(e.x,r.x),e.y=JSM.Minimum(e.y,r.y),e.z=JSM.Minimum(e.z,r.z),t.x=JSM.Maximum(t.x,r.x),t.y=JSM.Maximum(t.y,r.y),t.z=JSM.Maximum(t.z,r.z);return[e,t]};JSM.Body.prototype.GetCenter=function(){var e=this.GetBoundingBox();return JSM.MidCoord(e[0],e[1])};JSM.Body.prototype.GetBoundingSphereRadius=function(){var e=this.GetCenter(),t=0,n,r;for(n=0;n<this.vertices.length;n++)r=JSM.CoordDistance(e,this.vertices[n].position),JSM.IsGreater(r,t)&&(t=r);return t};JSM.Body.prototype.OffsetToOrigo=function(){var e=this.GetCenter(),e=JSM.VectorMultiply(e,-1),t;for(t=0;t<this.vertices.length;t++)this.vertices[t].position=JSM.CoordAdd(this.vertices[t].position,e)};JSM.Body.prototype.Merge=function(e){var t=this.vertices.length,n,r;for(n=0;n<e.VertexCount();n++)this.vertices.push(e.GetVertex(n).Clone());var i;for(n=0;n<e.PolygonCount();n++){i=e.GetPolygon(n).Clone();for(r=0;r<i.VertexIndexCount();r++)i.vertices[r]+=t;this.polygons.push(i)}};JSM.Body.prototype.Clear=function(){this.vertices=[];this.polygons=[];this.coords=this.projection=null};JSM.Model=function(){this.bodies=[]};JSM.Model.prototype.AddBody=function(e){this.bodies.push(e);return this.bodies.length-1};JSM.Model.prototype.GetBody=function(e){return this.bodies[e]};JSM.Model.prototype.BodyCount=function(){return this.bodies.length};JSM.Model.prototype.VertexCount=function(){var e=0,t;for(t=0;t<this.bodies.length;t++)e+=this.bodies[t].VertexCount();return e};JSM.Model.prototype.PolygonCount=function(){var e=0,t;for(t=0;t<this.bodies.length;t++)e+=this.bodies[t].PolygonCount();return e};JSM.HexColorToRGBComponents=function(e){for(var t=e.toString(16);6>t.length;)t="0"+t;e=parseInt(t.substr(0,2),16);var n=parseInt(t.substr(2,2),16),t=parseInt(t.substr(4,2),16);return[e,n,t]};JSM.HexColorToNormalizedRGBComponents=function(e){e=JSM.HexColorToRGBComponents(e);return[e[0]/255,e[1]/255,e[2]/255]};JSM.HexColorToRGBColor=function(e){return parseInt("0x"+e,16)};JSM.RGBComponentsToHexColor=function(e,t,n){function r(e){for(e=parseInt(e,10).toString(16);2>e.length;)e="0"+e;return e}e=r(e);t=r(t);n=r(n);return parseInt("0x"+e+t+n,16)};JSM.Light=function(e){var t=8355711,n=8355711,r=0,i=new JSM.Vector(1,0,0);void 0!==e&&null!==e&&(t=JSM.ValueOrDefault(e.ambient,t),n=JSM.ValueOrDefault(e.diffuse,n),r=JSM.ValueOrDefault(e.specular,r),i=JSM.ValueOrDefault(e.direction,i));this.ambient=t;this.diffuse=n;this.specular=r;this.direction=i};JSM.Material=function(e){var t=52224,n=52224,r=0,i=0,s=1,o=null,u=1,a=1;void 0!==e&&null!==e&&(t=JSM.ValueOrDefault(e.ambient,t),n=JSM.ValueOrDefault(e.diffuse,n),r=JSM.ValueOrDefault(e.specular,r),i=JSM.ValueOrDefault(e.shininess,i),s=JSM.ValueOrDefault(e.opacity,s),o=JSM.ValueOrDefault(e.texture,o),u=JSM.ValueOrDefault(e.textureWidth,u),a=JSM.ValueOrDefault(e.textureHeight,a));this.ambient=t;this.diffuse=n;this.specular=r;this.shininess=i;this.opacity=s;this.texture=o;this.textureWidth=u;this.textureHeight=a};JSM.Materials=function(){this.materials=[];this.defaultMaterial=new JSM.Material};JSM.Materials.prototype.GetMaterial=function(e){return 0>e||e>=this.materials.length?this.defaultMaterial:this.materials[e]};JSM.Materials.prototype.AddMaterial=function(e){this.materials.push(e)};JSM.Materials.prototype.GetDefaultMaterial=function(){return this.defaultMaterial};JSM.Materials.prototype.Count=function(){return this.materials.length};JSM.AddVertexToBody=function(e,t,n,r){e.AddVertex(new JSM.BodyVertex(new JSM.Coord(t,n,r)))};JSM.AddPolygonToBody=function(e,t){e.AddPolygon(new JSM.BodyPolygon(t))};JSM.CalculateBodyVertexToPolygon=function(e){var t=[],n,r;for(n=0;n<e.VertexCount();n++)t.push([]);var i;for(n=0;n<e.PolygonCount();n++){i=e.GetPolygon(n);for(r=0;r<i.VertexIndexCount();r++)t[i.GetVertexIndex(r)].push(n)}return t};JSM.CalculateBodyPolygonNormal=function(e,t){var n=e.GetPolygon(t),r=n.VertexIndexCount(),i=new JSM.Vector(0,0,0);if(3<=r){var s,o,u;for(s=0;s<r;s++)o=s,u=(s+1)%r,o=e.GetVertexPosition(n.GetVertexIndex(o)),u=e.GetVertexPosition(n.GetVertexIndex(u)),i.x+=(o.y-u.y)*(o.z+u.z),i.y+=(o.z-u.z)*(o.x+u.x),i.z+=(o.x-u.x)*(o.y+u.y)}return JSM.VectorNormalize(i)};JSM.CalculateBodyPolygonNormals=function(e){var t=[],n;for(n=0;n<e.PolygonCount();n++)t.push(JSM.CalculateBodyPolygonNormal(e,n));return t};JSM.CalculateBodyVertexNormals=function(e){var t=[],n=JSM.CalculateBodyPolygonNormals(e),r=null,i,s,o,u,a,f,l,c;for(i=0;i<e.PolygonCount();i++)if(u=e.GetPolygon(i),t[i]=[],u.HasCurveGroup()){null===r&&(r=JSM.CalculateBodyVertexToPolygon(e));for(s=0;s<u.VertexIndexCount();s++){a=new JSM.Vector(0,0,0);f=0;l=r[u.GetVertexIndex(s)];for(o=0;o<l.length;o++)c=e.GetPolygon(l[o]),c.GetCurveGroup()===u.GetCurveGroup()&&(a=JSM.CoordAdd(a,n[l[o]]),f++);a=JSM.VectorMultiply(a,1/f);a=JSM.VectorNormalize(a);t[i].push(a)}}else{o=n[i];for(s=0;s<u.VertexIndexCount();s++)t[i].push(new JSM.Vector(o.x,o.y,o.z))}return t};JSM.MakeBodyInsideOut=function(e){var t,n,r,i,s;for(t=0;t<e.PolygonCount();t++){r=e.GetPolygon(t);s=r.vertices.slice(0);i=s.length;r.vertices=[];for(n=0;n<i;n++)r.vertices.push(s[i-n-1])}};JSM.SoftMoveBodyVertex=function(e,t,n,r,i){t=e.GetVertex(t).position;var s=JSM.GetGaussianCParameter(n,i,0,1e-5),o,u,a;for(o=0;o<e.VertexCount();o++)u=JSM.CoordDistance(t,e.GetVertex(o).position),JSM.IsGreater(u,n)||(u=JSM.GetGaussianValue(u,i,0,s),a=e.GetVertex(o).position,e.GetVertex(o).position=JSM.CoordOffset(a,r,u))};JSM.CalculatePolygonCentroid=function(e,t){var n=e.GetPolygon(t),r=n.VertexIndexCount(),i=new JSM.Coord(0,0,0),s;for(s=0;s<r;s++)i=JSM.CoordAdd(i,e.GetVertexPosition(n.GetVertexIndex(s)));return i=JSM.VectorMultiply(i,1/r)};JSM.TriangulateWithCentroids=function(e){var t=new JSM.Body,n,r;for(n=0;n<e.VertexCount();n++)r=e.GetVertex(n).position,t.AddVertex(new JSM.BodyVertex(new JSM.Coord(r.x,r.y,r.z)));var i,s,o,u,a;for(n=0;n<e.PolygonCount();n++){r=JSM.CalculatePolygonCentroid(e,n);a=t.VertexCount();t.AddVertex(new JSM.BodyVertex(new JSM.Coord(r.x,r.y,r.z)));s=e.GetPolygon(n);o=s.VertexIndexCount();for(r=0;r<o;r++)i=s.GetVertexIndex(r),u=s.GetVertexIndex(r<o-1?r+1:0),i=new JSM.BodyPolygon([i,u,a]),i.material=s.material,i.curved=s.curved,t.AddPolygon(i)}return t};JSM.TriangulatePolygons=function(e){var t=new JSM.Body,n,r,i;for(n=0;n<e.VertexCount();n++)i=e.GetVertexPosition(n),t.AddVertex(new JSM.BodyVertex(new JSM.Coord(i.x,i.y,i.z)));var s,o;for(n=0;n<e.PolygonCount();n++){s=new JSM.Polygon;o=e.GetPolygon(n);for(r=0;r<o.VertexIndexCount();r++)i=e.GetVertexPosition(o.GetVertexIndex(r)),s.AddVertex(i.x,i.y,i.z);i=JSM.PolygonTriangulate(s);for(r=0;r<i.length;r++)s=i[r],s=new JSM.BodyPolygon([o.GetVertexIndex(s[0]),o.GetVertexIndex(s[1]),o.GetVertexIndex(s[2])]),s.InheritAttributes(o),t.AddPolygon(s)}return t};JSM.GenerateRandomMaterials=function(e,t,n){var r,i;for(r=0;r<e.PolygonCount();r++)i=void 0!==n&&n?JSM.SeededRandomInt(0,16777215,r+1):JSM.RandomInt(0,16777215),t.AddMaterial(new JSM.Material({ambient:i,diffuse:i})),i=t.Count()-1,e.GetPolygon(r).SetMaterialIndex(i)};JSM.VertInfo=function(){this.edges=[];this.pgons=[]};JSM.EdgeInfo=function(){this.pgon2=this.pgon1=this.vert2=this.vert1=-1};JSM.PolyEdgeInfo=function(){this.index=-1;this.reverse=!1};JSM.PgonInfo=function(){this.verts=[];this.pedges=[]};JSM.AdjacencyInfo=function(){this.verts=[];this.edges=[];this.pgons=[]};JSM.GetPolyEdgeStartVertex=function(e,t){return e.reverse?t.edges[e.index].vert2:t.edges[e.index].vert1};JSM.GetPolyEdgeEndVertex=function(e,t){return e.reverse?t.edges[e.index].vert1:t.edges[e.index].vert2};JSM.CalculateAdjacencyInfo=function(e){var t=new JSM.AdjacencyInfo,n,r,i;for(n=0;n<e.VertexCount();n++)r=new JSM.VertInfo,t.verts.push(r);var s,o,u,a,f;for(n=0;n<e.PolygonCount();n++){s=e.GetPolygon(n);i=new JSM.PgonInfo;o=s.VertexIndexCount();for(r=0;r<o;r++){u=s.GetVertexIndex(r);a=s.GetVertexIndex(r<o-1?r+1:0);f=u;var l=a;a=n;for(var c=new JSM.PolyEdgeInfo,h=void 0,p=void 0,h=0;h<t.edges.length;h++)p=t.edges[h],p.vert1===f&&p.vert2===l?(c.index=h,c.reverse=!1):p.vert1===l&&p.vert2===f&&(c.index=h,c.reverse=!0);-1===c.index?(h=new JSM.EdgeInfo,h.vert1=f,h.vert2=l,h.pgon1=a,h.pgon2=-1,t.edges.push(h),c.index=t.edges.length-1,c.reverse=!1):(f=t.edges[c.index],-1===f.pgon1?f.pgon1=a:f.pgon1!==a&&-1===f.pgon2&&(f.pgon2=a));f=c;i.verts.push(u);i.pedges.push(f);t.verts[u].edges.push(f.index);t.verts[u].pgons.push(n)}t.pgons.push(i)}return t};JSM.IsSolidBody=function(e){e=JSM.CalculateAdjacencyInfo(e);var t,n;for(t=0;t<e.edges.length;t++)if(n=e.edges[t],-1===n.pgon1||-1===n.pgon2)return!1;return!0};JSM.CheckSolidBody=function(e){e=JSM.CalculateAdjacencyInfo(e);var t,n,r,i,s,o,u,a;for(t=0;t<e.edges.length;t++){r=e.edges[t];if(-1===r.pgon1||-1===r.pgon2)return!1;o=e.pgons[r.pgon1];s=!1;for(n=0;n<o.pedges.length;n++)if(i=o.pedges[n],i.index==t){u=i.reverse;s=!0;break}if(!s)return!1;r=e.pgons[r.pgon2];s=!1;for(n=0;n<r.pedges.length;n++)if(i=r.pedges[n],i.index==t){a=i.reverse;s=!0;break}if(!s||u==a)return!1}return!0};JSM.CalculatePlanarTextureCoord=function(e,t){var n=new JSM.Coord2D(0,0),r=JSM.VectorNormalize(t.e1),i=JSM.VectorNormalize(t.e2),s=JSM.VectorCross(t.e1,t.e2),s=JSM.GetPlaneFromCoordAndDirection(t.origo,s),i=JSM.GetPlaneFromCoordAndDirection(t.origo,i),r=JSM.GetPlaneFromCoordAndDirection(t.origo,r),s=JSM.ProjectCoordToPlane(e,s);n.x=JSM.CoordPlaneSignedDistance(s,r);n.y=JSM.CoordPlaneSignedDistance(s,i);return n};JSM.CalculateCubicTextureCoord=function(e,t,n){var r=new JSM.Coord2D(0,0),i=JSM.VectorNormalize(n.e1),s=JSM.VectorNormalize(n.e2),o=JSM.VectorNormalize(n.e3),u=-1,a=0,f,l,c;for(f=0;3>f;f++)0===f?l=i:1===f?l=s:2===f&&(l=o),c=Math.abs(JSM.VectorDot(t,l)),JSM.IsGreater(c,a)&&(u=f,a=c);if(-1===u)return r;t=null;0===u?t=new JSM.CoordSystem(n.origo,s,o,new JSM.Coord(0,0,0)):1===u?t=new JSM.CoordSystem(n.origo,i,o,new JSM.Coord(0,0,0)):2===u&&(t=new JSM.CoordSystem(n.origo,i,s,new JSM.Coord(0,0,0)));return null===t?r:JSM.CalculatePlanarTextureCoord(e,t)};JSM.CalculateCylindricalTextureCoord=function(e,t,n){var r=new JSM.Coord2D(0,0),i=JSM.VectorNormalize(n.e3);if(JSM.VectorsAreCollinear(i,t))return r=JSM.CalculateCubicTextureCoord(e,t,n),[r,0];t=new JSM.Line(n.origo,i);var s=JSM.ProjectCoordToLine(e,t);t=JSM.CoordSignedDistance(n.origo,s,i);var o=JSM.VectorNormalize(n.e1);e=JSM.CoordSub(e,s);i=JSM.GetVectorsFullAngle(e,o,i);n=JSM.VectorLength(n.e1);r.x=i*n;r.y=t;return[r,i]};JSM.CalculatePolygonPlanarTextureCoords=function(e,t){var n=[],r=e.GetPolygon(t),i=e.GetTextureProjectionCoords(),s,o;for(s=0;s<r.VertexIndexCount();s++)o=e.GetVertexPosition(r.GetVertexIndex(s)),n.push(JSM.CalculatePlanarTextureCoord(o,i));return n};JSM.CalculatePolygonCubicTextureCoords=function(e,t,n){var r=[];t=e.GetPolygon(t);var i=e.GetTextureProjectionCoords(),s,o;for(s=0;s<t.VertexIndexCount();s++)o=e.GetVertexPosition(t.GetVertexIndex(s)),r.push(JSM.CalculateCubicTextureCoord(o,n,i));return r};JSM.CalculatePolygonCylindricalTextureCoords=function(e,t,n){var r=[],i=[],s=e.GetPolygon(t);t=e.GetTextureProjectionCoords();var o,u;for(o=0;o<s.VertexIndexCount();o++)u=e.GetVertexPosition(s.GetVertexIndex(o)),u=JSM.CalculateCylindricalTextureCoord(u,n,t),r.push(u[0]),i.push(u[1]);o=JSM.VectorNormalize(t.e3);if(JSM.VectorsAreCollinear(o,n))return r;e=!1;for(o=0;o<i.length;o++){for(n=o+1;n<i.length;n++)if(JSM.IsGreater(Math.abs(i[o]-i[n]),Math.PI)){e=!0;break}if(e)break}if(e){t=JSM.VectorLength(t.e1);for(o=0;o<i.length;o++)JSM.IsLower(i[o],Math.PI)&&(r[o].x=t*(i[o]+2*Math.PI))}return r};JSM.CalculateBodyPlanarTextureCoords=function(e){var t=[],n;for(n=0;n<e.PolygonCount();n++)t.push(JSM.CalculatePolygonPlanarTextureCoords(e,n));return t};JSM.CalculateBodyCubicTextureCoords=function(e){var t=[],n=JSM.CalculateBodyPolygonNormals(e),r,i;for(r=0;r<e.PolygonCount();r++)i=n[r],t.push(JSM.CalculatePolygonCubicTextureCoords(e,r,i));return t};JSM.CalculateBodyCylindricalTextureCoords=function(e){var t=[],n=JSM.CalculateBodyPolygonNormals(e),r,i;for(r=0;r<e.PolygonCount();r++)i=n[r],t.push(JSM.CalculatePolygonCylindricalTextureCoords(e,r,i));return t};JSM.CalculateBodyTextureCoords=function(e){var t=[],n=e.GetTextureProjectionType();"Planar"===n?t=JSM.CalculateBodyPlanarTextureCoords(e):"Cubic"===n?t=JSM.CalculateBodyCubicTextureCoords(e):"Cylindrical"===n&&(t=JSM.CalculateBodyCylindricalTextureCoords(e));return t};JSM.CutBodyByPlane=function(e,t){function n(e,t,n){function r(e){p.push(new JSM.Coord(h.x,h.y,h.z));d.push(e)}function i(n,r){v=JSM.VectorNormalize(JSM.CoordSub(e[r],e[n]));m=new JSM.Line(e[n],v);g=JSM.LinePlaneIntersection(m,t);p.push(new JSM.Coord(g.x,g.y,g.z));d.push(-1)}var s=void 0!==n&&null!==n,o=e.length,u=[],a=[],f=!1,l,c,h;for(l=0;l<o;l++)h=e[l],c=JSM.CoordPlanePosition(h,t),a.push("CoordAtBackOfPlane"!==c),0<l&&a[l-1]!==a[l]&&(f=!0);if(!f){if(!1===a[0])return u;for(l=0;l<o;l++)h=e[l],u.push(new JSM.Coord(h.x,h.y,h.z)),s&&n.push(l);return u}var p=[],d=[],v,m,g;for(l=0;l<o;l++)f=l-1,c=l,0===l&&(f=o-1),h=e[c],a[c]?(a[f]||i(f,c),r(c)):a[f]&&i(f,c);for(l=0;l<p.length;l++)o=p[l],a=u[u.length-1],0===l||!JSM.CoordIsEqual(a,o)?(u.push(new JSM.Coord(o.x,o.y,o.z)),s&&(o=d[l],n.push(o))):s&&(o=d[l],a=d[l-1],-1!==o?n[n.length-1]=o:-1!==a&&(n[n.length-1]=a));return u}function r(e){var t=-1,n;for(n=v;n<i.VertexCount();n++)if(JSM.CoordIsEqual(i.GetVertexPosition(n),e)){t=n;break}-1===t&&(t=i.AddVertex(new JSM.BodyVertex(new JSM.Coord(e.x,e.y,e.z))));return t}var i=new JSM.Body,s=[],o=[],u=[],a=[],f,l,c,h,p;for(f=0;f<e.PolygonCount();f++){c=e.GetPolygon(f);h=[];for(l=0;l<c.VertexIndexCount();l++)p=e.GetVertexPosition(c.GetVertexIndex(l)),h.push(new JSM.Coord(p.x,p.y,p.z));p=[];h=n(h,t,p);for(l=0;l<p.length;l++)-1!==p[l]&&(u[c.GetVertexIndex(p[l])]=!0);s.push(h);o.push(p)}var d;for(f=0;f<e.VertexCount();f++)u[f]&&(d=e.GetVertexPosition(f),a[f]=i.AddVertex(new JSM.BodyVertex(new JSM.Coord(d.x,d.y,d.z))));var v=i.VertexCount();for(f=0;f<e.PolygonCount();f++)if(c=e.GetPolygon(f),h=s[f],p=o[f],0!==p.length){u=[];for(l=0;l<p.length;l++)-1!==p[l]?u.push(a[c.GetVertexIndex(p[l])]):(d=h[l],u.push(r(d)));l=new JSM.BodyPolygon(u);l.InheritAttributes(c);i.AddPolygon(l)}return i};JSM.GenerateRectangle=function(e,t){var n=new JSM.Body,r=e/2,i=t/2;n.AddVertex(new JSM.BodyVertex(new JSM.Coord(-r,-i,0)));n.AddVertex(new JSM.BodyVertex(new JSM.Coord(r,-i,0)));n.AddVertex(new JSM.BodyVertex(new JSM.Coord(r,i,0)));n.AddVertex(new JSM.BodyVertex(new JSM.Coord(-r,i,0)));n.AddPolygon(new JSM.BodyPolygon([0,1,2,3]));n.SetCubicTextureProjection(new JSM.Coord(-r,-i,0),new JSM.Coord(1,0,0),new JSM.Coord(0,1,0),new JSM.Coord(0,0,1));return n};JSM.GenerateCuboid=function(e,t,n){var r=new JSM.Body;e/=2;t/=2;n/=2;r.AddVertex(new JSM.BodyVertex(new JSM.Coord(-e,-t,-n)));r.AddVertex(new JSM.BodyVertex(new JSM.Coord(e,-t,-n)));r.AddVertex(new JSM.BodyVertex(new JSM.Coord(e,-t,n)));r.AddVertex(new JSM.BodyVertex(new JSM.Coord(-e,-t,n)));r.AddVertex(new JSM.BodyVertex(new JSM.Coord(-e,t,-n)));r.AddVertex(new JSM.BodyVertex(new JSM.Coord(e,t,-n)));r.AddVertex(new JSM.BodyVertex(new JSM.Coord(e,t,n)));r.AddVertex(new JSM.BodyVertex(new JSM.Coord(-e,t,n)));r.AddPolygon(new JSM.BodyPolygon([0,1,2,3]));r.AddPolygon(new JSM.BodyPolygon([1,5,6,2]));r.AddPolygon(new JSM.BodyPolygon([5,4,7,6]));r.AddPolygon(new JSM.BodyPolygon([4,0,3,7]));r.AddPolygon(new JSM.BodyPolygon([0,4,5,1]));r.AddPolygon(new JSM.BodyPolygon([3,2,6,7]));r.SetCubicTextureProjection(new JSM.Coord(-e,-t,-n),new JSM.Coord(1,0,0),new JSM.Coord(0,1,0),new JSM.Coord(0,0,1));return r};JSM.GenerateCuboidSides=function(e,t,n,r){var i=new JSM.Body;e/=2;t/=2;n/=2;i.AddVertex(new JSM.BodyVertex(new JSM.Coord(-e,-t,-n)));i.AddVertex(new JSM.BodyVertex(new JSM.Coord(e,-t,-n)));i.AddVertex(new JSM.BodyVertex(new JSM.Coord(e,-t,n)));i.AddVertex(new JSM.BodyVertex(new JSM.Coord(-e,-t,n)));i.AddVertex(new JSM.BodyVertex(new JSM.Coord(-e,t,-n)));i.AddVertex(new JSM.BodyVertex(new JSM.Coord(e,t,-n)));i.AddVertex(new JSM.BodyVertex(new JSM.Coord(e,t,n)));i.AddVertex(new JSM.BodyVertex(new JSM.Coord(-e,t,n)));r[0]&&i.AddPolygon(new JSM.BodyPolygon([0,1,2,3]));r[1]&&i.AddPolygon(new JSM.BodyPolygon([1,5,6,2]));r[2]&&i.AddPolygon(new JSM.BodyPolygon([5,4,7,6]));r[3]&&i.AddPolygon(new JSM.BodyPolygon([4,0,3,7]));r[4]&&i.AddPolygon(new JSM.BodyPolygon([0,4,5,1]));r[5]&&i.AddPolygon(new JSM.BodyPolygon([3,2,6,7]));i.SetCubicTextureProjection(new JSM.Coord(-e,-t,-n),new JSM.Coord(1,0,0),new JSM.Coord(0,1,0),new JSM.Coord(0,0,1));return i};JSM.GenerateSegmentedRectangle=function(e,t,n,r){var i=new JSM.Body,s=e/2,o=t/2,u=e/n,a=t/r;(function(){var e,t,p;for(e=0;e<=r;e++)for(t=0;t<=n;t++)p=new JSM.Coord(t*u-s,e*a-o,0),i.AddVertex(new JSM.BodyVertex(p))})();(function(){var e,t,s,o,u,a;for(t=0;t<r;t++)for(e=0;e<n;e++)s=t*(n+1)+e,o=s+1,u=s+n+1,a=u+1,i.AddPolygon(new JSM.BodyPolygon([s,o,a,u]))})();return i};JSM.GenerateSegmentedCuboid=function(e,t,n,r){function i(e){var t=0;0<e&&e<=r&&(t=(r+1)*(r+1)+(e-1)*4*r);return t}function s(e){var t=[],n=i(e);if(0===e||e===r){for(e=0;e<=r;e++)t.push(n+e);for(e=1;e<=r;e++)t.push(n+(e+1)*r+e);for(e=r-1;0<=e;e--)t.push(n+(r+1)*r+e);for(e=r-1;0<e;e--)t.push(n+e*(r+1))}else if(0<e&&e<r){for(e=0;e<=r;e++)t.push(n+e);for(e=1;e<r;e++)t.push(n+r+2*e);for(e=r;0<=e;e--)t.push(n+3*r+e-1);for(e=r-1;0<e;e--)t.push(n+r+2*e-1)}return t}function o(e){var t,n,i=e*d;if(0===e||e===r)for(e=0;e<=r;e++)for(t=0;t<=r;t++)n=new JSM.Coord(t*h-f,e*p-l,i-c),a.AddVertex(new JSM.BodyVertex(n));else if(0<e&&e<r)for(e=0;e<=r;e++)for(t=0;t<=r;t++)if(0===e||e===r||0===t||t===r)n=new JSM.Coord(t*h-f,e*p-l,i-c),a.AddVertex(new JSM.BodyVertex(n))}function u(e){var t,n,s,o,u,f;if(0===e||e===r){var l=i(e);for(t=0;t<r;t++)for(n=0;n<r;n++)s=l+t*(r+1)+n,o=s+1,u=s+r+1,f=u+1,0===e?a.AddPolygon(new JSM.BodyPolygon([s,u,f,o])):a.AddPolygon(new JSM.BodyPolygon([s,o,f,u]))}if(0<e&&e<=r){n=v[e-1];e=v[e];for(t=0;t<4*r;t++)s=n[t],u=e[t],t<4*r-1?(o=n[t+1],f=e[t+1]):(o=n[0],f=e[0]),a.AddPolygon(new JSM.BodyPolygon([s,o,f,u]))}}var a=new JSM.Body,f=e/2,l=t/2,c=n/2,h=e/r,p=t/r,d=n/r;for(e=0;e<=r;e++)o(e);var v=[];for(e=0;e<=r;e++)v.push(s(e));for(e=0;e<=r;e++)u(e);return a};JSM.GenerateCircle=function(e,t){var n=new JSM.Body,r=JSM.GenerateCirclePoints(e,t),i;for(i=0;i<r.length;i++)n.AddVertex(new JSM.BodyVertex(r[i]));r=new JSM.BodyPolygon([]);for(i=0;i<t;i++)r.AddVertexIndex(i);n.AddPolygon(r);n.SetCylindricalTextureProjection(new JSM.Coord(0,0,0),e,new JSM.Coord(1,0,0),new JSM.Coord(0,0,1));return n};JSM.GenerateSphere=function(e,t,n){var r=new JSM.Body,i=2*t,s=r.AddVertex(new JSM.BodyVertex(JSM.SphericalToCartesian(e,0,0))),o=Math.PI/t,u=o,a,f,l;for(a=1;a<t;a++){for(f=l=0;f<i;f++)r.AddVertex(new JSM.BodyVertex(JSM.SphericalToCartesian(e,u,l))),l+=o;u+=o}e=r.AddVertex(new JSM.BodyVertex(JSM.SphericalToCartesian(-e,0,0)));var c,h;for(a=1;a<=t;a++)if(1===a){o=1;for(f=0;f<i;f++)u=o+f,l=u+1,f===i-1&&(l=o),u=new JSM.BodyPolygon([u,l,s]),n&&u.SetCurveGroup(0),r.AddPolygon(u)}else if(a<t){o=(a-1)*i+1;for(f=0;f<i;f++)u=o+f,l=u+1,c=u-i,h=c+1,f===i-1&&(l=o,h=o-i),u=new JSM.BodyPolygon([u,l,h,c]),n&&u.SetCurveGroup(0),r.AddPolygon(u)}else if(a===t){o=(a-2)*i+1;for(f=0;f<i;f++)u=o+f,l=u+1,f===i-1&&(l=o),u=new JSM.BodyPolygon([u,e,l]),n&&u.SetCurveGroup(0),r.AddPolygon(u)}r.SetCubicTextureProjection(new JSM.Coord(0,0,0),new JSM.Coord(1,0,0),new JSM.Coord(0,1,0),new JSM.Coord(0,0,1));return r};JSM.GenerateTriangulatedSphere=function(e,t,n){var r;r=new JSM.Body;var i=(1+Math.sqrt(5))/2;JSM.AddVertexToBody(r,0,1,+i);JSM.AddVertexToBody(r,0,1,-i);JSM.AddVertexToBody(r,0,-1,+i);JSM.AddVertexToBody(r,0,-1,-i);JSM.AddVertexToBody(r,1,+i,0);JSM.AddVertexToBody(r,1,-i,0);JSM.AddVertexToBody(r,-1,+i,0);JSM.AddVertexToBody(r,-1,-i,0);JSM.AddVertexToBody(r,+i,0,1);JSM.AddVertexToBody(r,-i,0,1);JSM.AddVertexToBody(r,+i,0,-1);JSM.AddVertexToBody(r,-i,0,-1);JSM.AddPolygonToBody(r,[0,2,8]);JSM.AddPolygonToBody(r,[0,4,6]);JSM.AddPolygonToBody(r,[0,6,9]);JSM.AddPolygonToBody(r,[0,8,4]);JSM.AddPolygonToBody(r,[0,9,2]);JSM.AddPolygonToBody(r,[1,3,11]);JSM.AddPolygonToBody(r,[1,4,10]);JSM.AddPolygonToBody(r,[1,6,4]);JSM.AddPolygonToBody(r,[1,10,3]);JSM.AddPolygonToBody(r,[1,11,6]);JSM.AddPolygonToBody(r,[2,5,8]);JSM.AddPolygonToBody(r,[2,7,5]);JSM.AddPolygonToBody(r,[2,9,7]);JSM.AddPolygonToBody(r,[3,5,7]);JSM.AddPolygonToBody(r,[3,7,11]);JSM.AddPolygonToBody(r,[3,10,5]);JSM.AddPolygonToBody(r,[4,8,10]);JSM.AddPolygonToBody(r,[6,11,9]);JSM.AddPolygonToBody(r,[5,10,8]);JSM.AddPolygonToBody(r,[7,9,11]);for(var i=JSM.VectorLength(r.GetVertexPosition(0)),s=e/i,o,u,i=0;i<r.VertexCount();i++)u=r.GetVertex(i),u.SetPosition(JSM.VectorMultiply(u.GetPosition(),s));for(var a,f,l,c,s=0;s<t;s++){o=r;r=new JSM.Body;u=JSM.CalculateAdjacencyInfo(o);for(i=0;i<u.verts.length;i++)a=o.GetVertexPosition(i),JSM.AddVertexToBody(r,a.x,a.y,a.z);a=[];for(i=0;i<u.edges.length;i++)f=u.edges[i],f=JSM.MidCoord(o.GetVertexPosition(f.vert1),o.GetVertexPosition(f.vert2)),f=JSM.VectorMultiply(JSM.VectorNormalize(f),e),a.push(r.AddVertex(new JSM.BodyVertex(f)));for(i=0;i<u.pgons.length;i++){f=u.pgons[i];l=[];for(o=0;o<f.pedges.length;o++)c=f.pedges[o],l.push(JSM.GetPolyEdgeStartVertex(c,u)),l.push(a[c.index]);JSM.AddPolygonToBody(r,[l[0],l[1],l[5]]);JSM.AddPolygonToBody(r,[l[1],l[2],l[3]]);JSM.AddPolygonToBody(r,[l[3],l[4],l[5]]);JSM.AddPolygonToBody(r,[l[1],l[3],l[5]])}}if(n)for(i=0;i<r.PolygonCount();i++)r.GetPolygon(i).SetCurveGroup(0);r.SetCubicTextureProjection(new JSM.Coord(0,0,0),new JSM.Coord(1,0,0),new JSM.Coord(0,1,0),new JSM.Coord(0,0,1));return r};JSM.GenerateCylinder=function(e,t,n,r,i){var s=new JSM.Body,o=2*Math.PI,u=2*Math.PI/n,a;for(a=0;a<n;a++)s.AddVertex(new JSM.BodyVertex(JSM.CylindricalToCartesian(e,t/2,o))),s.AddVertex(new JSM.BodyVertex(JSM.CylindricalToCartesian(e,-t/2,o))),o-=u;for(a=0;a<n;a++)o=2*a,u=o+2,a===n-1&&(u=0),o=new JSM.BodyPolygon([o,u,u+1,o+1]),i&&o.SetCurveGroup(0),s.AddPolygon(o);if(r){r=new JSM.BodyPolygon([]);i=new JSM.BodyPolygon([]);for(a=0;a<n;a++)r.AddVertexIndex(2*(n-a-1)),i.AddVertexIndex(2*a+1);s.AddPolygon(r);s.AddPolygon(i)}s.SetCylindricalTextureProjection(new JSM.Coord(0,0,-(t/2)),e,new JSM.Coord(1,0,0),new JSM.Coord(0,0,1));return s};JSM.GeneratePie=function(e,t,n,r,i,s){var o=new JSM.Body,u=n,a=n/(r-1);o.AddVertex(new JSM.BodyVertex(JSM.CylindricalToCartesian(0,t/2,0)));o.AddVertex(new JSM.BodyVertex(JSM.CylindricalToCartesian(0,-t/2,0)));for(n=0;n<r;n++)o.AddVertex(new JSM.BodyVertex(JSM.CylindricalToCartesian(e,t/2,u))),o.AddVertex(new JSM.BodyVertex(JSM.CylindricalToCartesian(e,-t/2,u))),u-=a;for(n=0;n<=r;n++)u=2*n,a=u+2,n===r&&(a=0),u=new JSM.BodyPolygon([u,a,a+1,u+1]),s&&0<n&&n<r&&u.SetCurveGroup(0),o.AddPolygon(u);if(i){i=new JSM.BodyPolygon([]);s=new JSM.BodyPolygon([]);for(n=0;n<=r;n++)i.AddVertexIndex(2*(r-n)),s.AddVertexIndex(2*n+1);o.AddPolygon(i);o.AddPolygon(s)}o.SetCylindricalTextureProjection(new JSM.Coord(0,0,-(t/2)),e,new JSM.Coord(1,0,0),new JSM.Coord(0,0,1));return o};JSM.GenerateCone=function(e,t,n,r,i,s){var o=new JSM.Body,u=JSM.IsZero(e),a=JSM.IsZero(t),f=2*Math.PI,l=2*Math.PI/r;u&&o.AddVertex(new JSM.BodyVertex(JSM.CylindricalToCartesian(0,n/2,0)));var c;for(c=0;c<r;c++)u||o.AddVertex(new JSM.BodyVertex(JSM.CylindricalToCartesian(e,n/2,f))),a||o.AddVertex(new JSM.BodyVertex(JSM.CylindricalToCartesian(t,-n/2,f))),f-=l;a&&o.AddVertex(new JSM.BodyVertex(JSM.CylindricalToCartesian(0,-n/2,0)));for(c=0;c<r;c++)u?(f=c+1,l=f+1,c===r-1&&(l=1),f=new JSM.BodyPolygon([0,l,f])):a?(f=c,l=f+1,c===r-1&&(l=0),f=new JSM.BodyPolygon([f,l,r])):(f=2*c,l=f+2,c===r-1&&(l=0),f=new JSM.BodyPolygon([f,l,l+1,f+1])),s&&f.SetCurveGroup(0),o.AddPolygon(f);if(i)if(u){s=new JSM.BodyPolygon([]);for(c=0;c<r;c++)s.AddVertexIndex(c+1);o.AddPolygon(s)}else if(a){i=new JSM.BodyPolygon([]);for(c=0;c<r;c++)i.AddVertexIndex(r-c-1);o.AddPolygon(i)}else{i=new JSM.BodyPolygon([]);s=new JSM.BodyPolygon([]);for(c=0;c<r;c++)i.AddVertexIndex(2*(r-c-1)),s.AddVertexIndex(2*c+1);o.AddPolygon(i);o.AddPolygon(s)}o.SetCylindricalTextureProjection(new JSM.Coord(0,0,-(n/2)),(e+t)/2,new JSM.Coord(1,0,0),new JSM.Coord(0,0,1));return o};JSM.GeneratePrism=function(e,t,n,r){var i=new JSM.Body,s=e.length,o;for(o=0;o<s;o++)i.AddVertex(new JSM.BodyVertex(e[o])),i.AddVertex(new JSM.BodyVertex(JSM.CoordOffset(e[o],t,n)));var u;for(o=0;o<s;o++)n=2*o,u=n+2,o===s-1&&(u=0),i.AddPolygon(new JSM.BodyPolygon([n,u,u+1,n+1]));if(r){r=new JSM.BodyPolygon([]);n=new JSM.BodyPolygon([]);for(o=0;o<s;o++)r.AddVertexIndex(2*o+1),n.AddVertexIndex(2*(s-o-1));i.AddPolygon(r);i.AddPolygon(n)}s=JSM.VectorNormalize(JSM.CoordSub(e[1],e[0]));e=new JSM.Coord(e[0].x,e[0].y,e[0].z);t=JSM.VectorNormalize(t);s=JSM.VectorCross(t,s);o=JSM.VectorCross(s,t);i.SetCubicTextureProjection(e,o,s,t);return i};JSM.GenerateCurvedPrism=function(e,t,n,r,i){n=JSM.GeneratePrism(e,n,r,i);if(void 0===t||null===t||e.length!=t.length)return n;for(r=0;r<e.length;r++)i=t[r],n.GetPolygon(r).SetCurveGroup(i);return n};JSM.GeneratePrismWithHole=function(e,t,n,r){function i(){var t=0,n=[],r;for(r=0;r<e.length;r++)null===e[r]&&(t+=1),n.push(r-t);var t=JSM.CreatePolygonWithHole(e),i=new JSM.Polygon,o;for(r=0;r<t.length;r++)o=e[t[r]],i.AddVertex(o.x,o.y,o.z);o=JSM.PolygonTriangulate(i);var u,a,l;for(r=0;r<o.length;r++){u=o[r];a=new JSM.BodyPolygon([]);l=new JSM.BodyPolygon([]);for(i=0;3>i;i++)a.AddVertexIndex(2*n[t[u[i]]]+1),l.AddVertexIndex(2*n[t[u[3-i-1]]]);s.AddPolygon(a);s.AddPolygon(l)}}var s=new JSM.Body;(function(){var r;for(r=0;r<e.length;r++)null!==e[r]&&(s.AddVertex(new JSM.BodyVertex(e[r])),s.AddVertex(new JSM.BodyVertex(JSM.CoordOffset(e[r],t,n))))})();(function(){var t=0,n=[];n.push(0);var r;for(r=0;r<e.length;r++)null===e[r]&&(n.push(r-t),t+=1);n.push(r-t);for(t=0;t<n.length-1;t++){var i=r=void 0,o=void 0,u=n[t],a=n[t+1];for(r=u;r<a;r++)i=2*r,o=i+2,r===a-1&&(o=2*u),s.AddPolygon(new JSM.BodyPolygon([i,o,o+1,i+1]))}})();r&&i();var o=JSM.VectorNormalize(JSM.CoordSub(e[1],e[0]));r=new JSM.Coord(e[0].x,e[0].y,e[0].z);var u=JSM.VectorNormalize(t),o=JSM.VectorCross(u,o),a=JSM.VectorCross(o,u);s.SetCubicTextureProjection(r,a,o,u);return s};JSM.GenerateCurvedPrismWithHole=function(e,t,n,r,i){n=JSM.GeneratePrismWithHole(e,n,r,i);if(void 0===t||null===t||e.length!=t.length)return n;r=0;var s;for(i=0;i<e.length;i++)s=t[i],null!==s&&(n.GetPolygon(r).SetCurveGroup(s),r++);return n};JSM.GeneratePrismShell=function(e,t,n,r,i){var s=new JSM.Body,o=e.length,u;for(u=0;u<o;u++)s.AddVertex(new JSM.BodyVertex(e[u]));u=new JSM.Polygon;u.vertices=e;r=JSM.OffsetPolygonContour(u,r).vertices;for(u=0;u<o;u++)s.AddVertex(new JSM.BodyVertex(r[u]));var a;for(u=0;u<o;u++)a=JSM.CoordOffset(e[u],t,n),s.AddVertex(new JSM.BodyVertex(a));for(u=0;u<o;u++)a=JSM.CoordOffset(r[u],t,n),s.AddVertex(new JSM.BodyVertex(a));var f;for(u=0;u<o;u++)n=u,r=n+1,a=n+2*o,f=a+1,u===o-1&&(r=0,f=2*o),s.AddPolygon(new JSM.BodyPolygon([n,r,f,a])),s.AddPolygon(new JSM.BodyPolygon([n+o,a+o,f+o,r+o]));if(i)for(u=0;u<o;u++)n=u,r=n+1,a=u+o,f=a+1,u===o-1&&(r=0,f=o),s.AddPolygon(new JSM.BodyPolygon([n,a,f,r])),s.AddPolygon(new JSM.BodyPolygon([n+2*o,r+2*o,f+2*o,a+2*o]));i=JSM.VectorNormalize(JSM.CoordSub(e[1],e[0]));e=new JSM.Coord(e[0].x,e[0].y,e[0].z);t=JSM.VectorNormalize(t);i=JSM.VectorCross(t,i);o=JSM.VectorCross(i,t);s.SetCubicTextureProjection(e,o,i,t);return s};JSM.GenerateCylinderShell=function(e,t,n,r,i,s){for(var o=new JSM.Vector(0,0,1),u=-t/2,a=[],f=2*Math.PI/r,l,c=0,c=0;c<r;c++)l=c*f,l=JSM.PolarToCartesian(e,l),a.push(new JSM.Coord(l.x,l.y,u));e=JSM.GeneratePrismShell(a,o,t,n,i);if(s)for(s=0;s<r;s++)e.GetPolygon(2*s).SetCurveGroup(0),e.GetPolygon(2*s+1).SetCurveGroup(0);return e};JSM.GenerateLineShell=function(e,t,n,r,i,s){var o=new JSM.Body,u=e.length,a=[],f,l,c,h,p,d;for(f=0;f<u;f++)0===f||f===u-1?p=Math.PI/2:(l=f-1,c=f,h=f+1,d=JSM.CoordSub(e[h],e[c]),p=JSM.CoordSub(e[l],e[c]),p=JSM.GetVectorsAngle(d,p)/2,"Clockwise"===JSM.CoordTurnType(e[l],e[c],e[h],t)&&(p=Math.PI-p)),a.push(p);d=new JSM.Vector(0,0,1);l=[];var v;for(f=0;f<u;f++)c=f,f===u-1?v=JSM.CoordSub(e[c-1],e[c]):(h=(f+1)%u,v=JSM.CoordSub(e[c],e[h])),p=a[c],h=r/Math.sin(p),h=JSM.CoordOffset(e[c],v,h),h=JSM.CoordRotate(h,d,-(Math.PI-p),e[c]),l.push(h);for(f=0;f<u;f++)o.AddVertex(new JSM.BodyVertex(e[f]));for(f=0;f<u;f++)o.AddVertex(new JSM.BodyVertex(l[f]));for(f=0;f<u;f++)c=JSM.CoordOffset(e[f],t,n),o.AddVertex(new JSM.BodyVertex(c));for(f=0;f<u;f++)c=JSM.CoordOffset(l[f],t,n),o.AddVertex(new JSM.BodyVertex(c));for(f=0;f<u-1;f++)c=f,h=c+1,n=c+2*u,r=n+1,o.AddPolygon(new JSM.BodyPolygon([c,h,r,n])),o.AddPolygon(new JSM.BodyPolygon([c+u,n+u,r+u,h+u]));i&&(c=0,o.AddPolygon(new JSM.BodyPolygon([c,c+2*u,c+3*u,c+u])),c=u-1,o.AddPolygon(new JSM.BodyPolygon([c,c+u,c+3*u,c+2*u])));if(s)for(f=0;f<u-1;f++)c=f,h=c+1,n=f+u,r=n+1,o.AddPolygon(new JSM.BodyPolygon([c,n,r,h])),o.AddPolygon(new JSM.BodyPolygon([c+2*u,h+2*u,r+2*u,n+2*u]));i=JSM.VectorNormalize(JSM.CoordSub(e[1],e[0]));e=new JSM.Coord(e[0].x,e[0].y,e[0].z);t=JSM.VectorNormalize(t);i=JSM.VectorCross(t,i);s=JSM.VectorCross(i,t);o.SetCubicTextureProjection(e,s,i,t);return o};JSM.GenerateTorus=function(e,t,n,r,i){var s=new JSM.Body,o=0,u=2*Math.PI/r,a=[],f,l;for(f=0;f<r;f++)l=JSM.PolarToCartesian(t,o),l=new JSM.Coord(l.x+e,0,l.y),a.push(l),o+=u;t=new JSM.Coord(0,0,1);o=new JSM.Coord(0,0,0);u=2*Math.PI/n;for(f=0;f<n;f++)for(e=0;e<r;e++)l=JSM.CoordRotate(a[e],t,f*u,o),s.AddVertex(new JSM.BodyVertex(l));for(f=0;f<n;f++){new JSM.BodyPolygon([]);for(e=0;e<r;e++)u=f*r+e,t=u+r,a=u+1,o=t+1,e===r-1&&(a=f*r,o=(f+1)*r),f===n-1&&(t=e,o=e+1,e===r-1&&(o=0)),u=new JSM.BodyPolygon([u,t,o,a]),i&&u.SetCurveGroup(0),s.AddPolygon(u)}s.SetCubicTextureProjection(new JSM.Coord(0,0,0),new JSM.Coord(1,0,0),new JSM.Coord(0,1,0),new JSM.Coord(0,0,1));return s};JSM.GeneratePolyTorus=function(e,t,n,r){var i=new JSM.Body,s=e.length,o=2*Math.PI/s,u=[],a;for(a=0;a<s;a++)o=e[a],o=new JSM.Coord(o.x+t,0,o.y),u.push(o);t=new JSM.Coord(0,0,1);var f=new JSM.Coord(0,0,0),o=2*Math.PI/n,l;for(a=0;a<n;a++)for(e=0;e<s;e++)l=JSM.CoordRotate(u[e],t,a*o,f),i.AddVertex(new JSM.BodyVertex(l));for(a=0;a<n;a++){new JSM.BodyPolygon([]);for(e=0;e<s;e++)u=a*s+e,t=u+s,o=u+1,f=t+1,e===s-1&&(o=a*s,f=(a+1)*s),a===n-1&&(t=e,f=e+1,e===s-1&&(f=0)),u=new JSM.BodyPolygon([u,t,f,o]),r&&u.SetCurveGroup(e),i.AddPolygon(u)}i.SetCubicTextureProjection(new JSM.Coord(0,0,0),new JSM.Coord(1,0,0),new JSM.Coord(0,1,0),new JSM.Coord(0,0,1));return i};JSM.GenerateRuledFromSectors=function(e,t,n,r,i){var s=new JSM.Body,o=[],u=[];JSM.GetSectorSegmentation(e,n,o);JSM.GetSectorSegmentation(t,n,u);t=[];e=[];JSM.GetRuledMesh(o,u,r,t,e);for(r=0;r<t.length;r++)s.AddVertex(new JSM.BodyVertex(t[r]));for(r=0;r<e.length;r++)o=e[r],o=new JSM.BodyPolygon(o),i&&o.SetCurveGroup(0),s.AddPolygon(o);s.SetCubicTextureProjection(new JSM.Coord(0,0,0),new JSM.Coord(1,0,0),new JSM.Coord(0,1,0),new JSM.Coord(0,0,1));return s};JSM.GenerateGrid=function(e,t,n,r,i){var s=new JSM.Sector(new JSM.Coord(0,0,0),new JSM.Coord(e,0,0));e=new JSM.Sector(new JSM.Coord(0,t,0),new JSM.Coord(e,t,0));return JSM.GenerateRuledFromSectors(s,e,n,r,i)};JSM.GenerateSquareGrid=function(e,t,n){return JSM.GenerateGrid(e,e,t,t,n)};JSM.GenerateRuledFromSectorsWithHeight=function(e,t,n,r,i,s){var o=new JSM.Body,u=[],a=[];JSM.GetSectorSegmentation(e,n,u);JSM.GetSectorSegmentation(t,n,a);t=[];e=[];JSM.GetRuledMesh(u,a,r,t,e);for(u=0;u<t.length;u++)o.AddVertex(new JSM.BodyVertex(t[u]));for(var f,u=0;u<e.length;u++)f=e[u],f=new JSM.BodyPolygon(f),i&&f.SetCurveGroup(0),o.AddPolygon(f);a=o.VertexCount();for(u=0;u<t.length;u++)f=t[u],f=new JSM.Coord(f.x,f.y,f.z),f.z-=s,o.AddVertex(new JSM.BodyVertex(f));for(u=0;u<e.length;u++){f=e[u];t=[];for(s=f.length-1;0<=s;s--)t.push(f[s]+a);f=new JSM.BodyPolygon(t);i&&f.SetCurveGroup(0);o.AddPolygon(f)}for(u=0;u<r;u++)i=u+a,s=i+1,e=i-a,t=e+1,f=new JSM.BodyPolygon([i,s,t,e]),o.AddPolygon(f);for(u=0;u<r;u++)i=u+n*(r+1)+a,s=i+1,e=i-a,t=e+1,f=new JSM.BodyPolygon([i,e,t,s]),o.AddPolygon(f);for(u=0;u<n;u++)i=u*(r+1)+a,s=i+r+1,e=i-a,t=e+r+1,f=new JSM.BodyPolygon([i,e,t,s]),o.AddPolygon(f);for(u=0;u<n;u++)i=(u+1)*r+u+a,s=i+r+1,e=i-a,t=e+r+1,f=new JSM.BodyPolygon([i,s,t,e]),o.AddPolygon(f);o.SetCubicTextureProjection(new JSM.Coord(0,0,0),new JSM.Coord(1,0,0),new JSM.Coord(0,1,0),new JSM.Coord(0,0,1));return o};JSM.GenerateRuledFromCoords=function(e,t,n,r){var i=new JSM.Body,s=[],o=[];JSM.GetRuledMesh(e,t,n,s,o);for(e=0;e<s.length;e++)i.AddVertex(new JSM.BodyVertex(s[e]));for(e=0;e<o.length;e++)s=o[e],s=new JSM.BodyPolygon(s),r&&s.SetCurveGroup(0),i.AddPolygon(s);i.SetCubicTextureProjection(new JSM.Coord(0,0,0),new JSM.Coord(1,0,0),new JSM.Coord(0,1,0),new JSM.Coord(0,0,1));return i};JSM.GenerateRevolved=function(e,t,n,r,i,s){var o=new JSM.Body,u=JSM.IsEqual(n,2*Math.PI),a=e.length,f=n/r;n=JSM.CoordSub(t.end,t.beg);var l,c,h;for(l=0;l<a;l++)for(c=0;c<=r;c++)u&&c===r||(h=JSM.CoordRotate(e[l],n,c*f,t.beg),o.AddVertex(new JSM.BodyVertex(h)));var p,d;for(l=0;l<a-1;l++)for(c=0;c<r;c++)f=l*(r+1)+c,h=f+r+1,p=f+1,d=h+1,u&&(f=l*r+c,h=f+r,p=f+1,d=h+1,c===r-1&&(p=l*r,d=(l+1)*r)),f=new JSM.BodyPolygon([f,p,d,h]),s&&f.SetCurveGroup(l),o.AddPolygon(f);if(u&&i){i=new JSM.BodyPolygon([]);s=new JSM.BodyPolygon([]);for(l=0;l<r;l++)i.AddVertexIndex(r*(a-1)+l),s.AddVertexIndex(r-l-1);o.AddPolygon(i);o.AddPolygon(s)}i=new JSM.Line(t.beg,JSM.VectorNormalize(n));for(l=r=0;l<a;l++)s=JSM.ProjectCoordToLine(e[l],i),r+=JSM.CoordDistance(s,e[l]);r/=a;t=new JSM.Coord(t.beg.x,t.beg.y,t.beg.z);a=JSM.VectorNormalize(n);n=new JSM.Line(t,n);n=JSM.ProjectCoordToLine(e[0],n);e=JSM.VectorNormalize(JSM.CoordSub(e[0],n));o.SetCylindricalTextureProjection(t,r,e,a);return o};JSM.GenerateTube=function(e,t){var n=new JSM.Body,r=e.length,i=e[0].length,s,o;for(o=0;o<i;o++)for(s=0;s<r;s++)n.AddVertex(new JSM.BodyVertex(e[s][o]));var u,a;for(o=0;o<r-1;o++)for(s=0;s<i;s++)u=o+r*s,a=u+r,s===i-1&&(a=o),n.AddPolygon(new JSM.BodyPolygon([u,a,a+1,u+1]));if(t){o=new JSM.BodyPolygon([]);u=new JSM.BodyPolygon([]);for(s=0;s<i;s++)o.AddVertexIndex(r*s+r-1);for(s=i-1;0<=s;s--)u.AddVertexIndex(r*s);n.AddPolygon(o);n.AddPolygon(u)}n.SetCubicTextureProjection(new JSM.Coord(0,0,0),new JSM.Coord(1,0,0),new JSM.Coord(0,1,0),new JSM.Coord(0,0,1));return n};JSM.GenerateFunctionSurface=function(e,t,n,r,i){var s=new JSM.Sector(new JSM.Coord(t.x,t.y,0),new JSM.Coord(n.x,t.y,0));t=new JSM.Sector(new JSM.Coord(t.x,n.y,0),new JSM.Coord(n.x,n.y,0));r=JSM.GenerateRuledFromSectors(s,t,r,r,i);for(i=0;i<r.VertexCount();i++)s=r.GetVertexPosition(i),s.z=e(s.x,s.y);r.SetCubicTextureProjection(new JSM.Coord(0,0,0),new JSM.Coord(1,0,0),new JSM.Coord(0,1,0),new JSM.Coord(0,0,1));return r};JSM.GenerateFunctionSurfaceSolid=function(e,t,n,r,i,s){var o=new JSM.Sector(new JSM.Coord(n.x,t.y,0),new JSM.Coord(t.x,t.y,0));t=new JSM.Sector(new JSM.Coord(n.x,n.y,0),new JSM.Coord(t.x,n.y,0));i=JSM.GenerateRuledFromSectorsWithHeight(o,t,r,r,i,s);o=(r+1)*(r+1);for(r=0;r<o;r++)s=i.GetVertexPosition(r),s.z=e(s.x,s.y);i.SetCubicTextureProjection(new JSM.Coord(0,0,0),new JSM.Coord(1,0,0),new JSM.Coord(0,1,0),new JSM.Coord(0,0,1));return i};JSM.Camera=function(e,t,n,r,i,s){this.eye=JSM.ValueOrDefault(e,new JSM.Coord(1,1,1));this.center=JSM.ValueOrDefault(t,new JSM.Coord(0,0,0));this.up=JSM.ValueOrDefault(n,new JSM.Vector(0,0,1));this.fieldOfView=JSM.ValueOrDefault(r,45);this.nearClippingPlane=JSM.ValueOrDefault(i,.1);this.farClippingPlane=JSM.ValueOrDefault(s,1e3)};JSM.Camera.prototype.Set=function(e,t,n,r,i,s){this.eye=e;this.center=t;this.up=n;this.fieldOfView=JSM.ValueOrDefault(r,45);this.nearClippingPlane=JSM.ValueOrDefault(i,.1);this.farClippingPlane=JSM.ValueOrDefault(s,1e3)};JSM.Camera.prototype.Clone=function(){var e=new JSM.Camera;e.eye=this.eye;e.center=this.center;e.up=this.up;e.fieldOfView=this.fieldOfView;e.nearClippingPlane=this.nearClippingPlane;e.farClippingPlane=this.farClippingPlane;return e};JSM.ExplodeBodyToTriangles=function(e,t,n){if(void 0===n||null===n)return!1;var r=JSM.CalculateBodyVertexNormals(e),i,s,o=!1;if(void 0!==t&&null!==t)for(i=0;i<t.Count();i++)if(null!==t.GetMaterial(i).texture){o=!0;break}var u,a;if(o){u=JSM.CalculateBodyTextureCoords(e);for(i=0;i<u.length;i++)if(s=e.GetPolygon(i),s.HasMaterialIndex()){a=t.GetMaterial(s.GetMaterialIndex());for(s=0;s<u[i].length;s++)u[i][s].x/=a.textureWidth,u[i][s].y/=-a.textureHeight}}var f=!0;void 0!==n.hasConvexPolygons&&null!==n.hasConvexPolygons&&(f=n.hasConvexPolygons);(function(e,t,n,r,i){function s(s,u){var a=t.GetMaterial(u);if(void 0!==i.onGeometryStart&&null!==i.onGeometryStart)i.onGeometryStart(a);var l;for(l=0;l<s.length;l++){var c=s[l],h=e.GetPolygon(c),p=h.VertexIndexCount();if(!(3>p)){var v=void 0,m=void 0,y=void 0,w=void 0,E=void 0,S=void 0,x=void 0,T=void 0,N=void 0,C=void 0;if(3==p||f)for(C=0;C<p-2;C++){if(v=e.GetVertex(h.GetVertexIndex(0)).position,m=e.GetVertex(h.GetVertexIndex((C+1)%p)).position,y=e.GetVertex(h.GetVertexIndex((C+2)%p)).position,w=n[c][0],E=n[c][(C+1)%p],S=n[c][(C+2)%p],N=T=x=null,o&&(x=r[c][0],T=r[c][(C+1)%p],N=r[c][(C+2)%p]),void 0!==i.onTriangle&&null!==i.onTriangle)i.onTriangle(v,m,y,w,E,S,x,T,N)}else{v=new JSM.Polygon;m=void 0;for(C=0;C<p;C++)m=e.GetVertex(h.vertices[C]),v.AddVertex(m.position.x,m.position.y,m.position.z);for(var C=JSM.CalculateBodyPolygonNormal(e,c),p=JSM.PolygonTriangulate(v,C),L=void 0,C=0;C<p.length;C++)if(L=p[C],v=e.GetVertex(h.GetVertexIndex(L[0])).position,m=e.GetVertex(h.GetVertexIndex(L[1])).position,y=e.GetVertex(h.GetVertexIndex(L[2])).position,w=n[c][L[0]],E=n[c][L[1]],S=n[c][L[2]],N=T=x=null,o&&(x=r[c][L[0]],T=r[c][L[1]],N=r[c][L[2]]),void 0!==i.onTriangle&&null!==i.onTriangle)i.onTriangle(v,m,y,w,E,S,x,T,N)}}}if(void 0!==i.onGeometryEnd&&null!==i.onGeometryEnd)i.onGeometryEnd(a)}var u,a=[],l=[];if(void 0===t||null===t)t=new JSM.Materials;for(u=0;u<t.Count();u++)a[u]=[];var c;for(u=0;u<e.PolygonCount();u++)c=e.GetPolygon(u),c.HasMaterialIndex()?(c=c.GetMaterialIndex(),a[c].push(u)):l.push(u);for(u=0;u<a.length;u++)c=a[u],0!==c.length&&s(c,u);0!==l.length&&s(l,-1)})(e,t,r,u,n);return!0};JSM.ExportBodyContentToStl=function(e,t,n){function r(e){o+=e+"\n"}function i(e,t,n,i){r("	facet normal "+e.x+" "+e.y+" "+e.z);r("		outer loop");r("			vertex "+t.x+" "+t.y+" "+t.z);r("			vertex "+n.x+" "+n.y+" "+n.z);r("			vertex "+i.x+" "+i.y+" "+i.z);r("		endloop");r("	endfacet")}function s(t){var r=e.GetPolygon(t),s=r.VertexIndexCount();if(!(3>s)){var o,u,f,l=null;if(3===s)l=JSM.CalculateBodyPolygonNormal(e,t),o=e.GetVertex(r.GetVertexIndex(0)).position,u=e.GetVertex(r.GetVertexIndex(1)).position,f=e.GetVertex(r.GetVertexIndex(2)).position,i(l,o,u,f);else if(o=!0,void 0!==n&&n&&(o=!1),l=JSM.CalculateBodyPolygonNormal(e,t),o){o=new JSM.Polygon;for(t=0;t<s;t++)u=e.GetVertex(r.vertices[t]),o.AddVertex(u.position.x,u.position.y,u.position.z);s=JSM.PolygonTriangulate(o,l);for(t=0;t<s.length;t++)f=s[t],o=e.GetVertex(r.GetVertexIndex(f[0])).position,u=e.GetVertex(r.GetVertexIndex(f[1])).position,f=e.GetVertex(r.GetVertexIndex(f[2])).position,i(l,o,u,f)}else for(t=0;t<s-2;t++)o=e.GetVertex(r.GetVertexIndex(0)).position,u=e.GetVertex(r.GetVertexIndex((t+1)%s)).position,f=e.GetVertex(r.GetVertexIndex((t+2)%s)).position,i(l,o,u,f)}}var o="";for(t=0;t<e.PolygonCount();t++)s(t);return o};JSM.ExportBodyToStl=function(e,t,n){e=""+("solid "+t+"\n")+JSM.ExportBodyContentToStl(e,t,n);return e+="endsolid "+t+"\n"};JSM.ExportModelToStl=function(e,t,n){var r;r=""+("solid "+t+"\n");var i,s;for(i=0;i<e.BodyCount();i++)s=e.GetBody(i),r+=JSM.ExportBodyContentToStl(s,t+(i+1).toString(),n);return r+("endsolid "+t+"\n")};JSM.ExportBodyContentToObj=function(e,t,n){function r(t){t=e.GetVertex(t).position;o+="v "+t.x+" "+t.y+" "+t.z+"\n"}function i(t){t=JSM.CalculateBodyPolygonNormal(e,t);o+="vn "+t.x+" "+t.y+" "+t.z+"\n"}function s(r){var i=e.GetPolygon(r);o+="f ";var s;for(s=0;s<i.VertexIndexCount();s++){var u=t+i.GetVertexIndex(s)+1+"//"+(n+r+1)+" ";o+=u}o+="\n"}var o="",u;for(u=0;u<e.VertexCount();u++)r(u);for(u=0;u<e.PolygonCount();u++)i(u);for(u=0;u<e.PolygonCount();u++)s(u);return o};JSM.ExportBodyToObj=function(e){return JSM.ExportBodyContentToObj(e,0,0)};JSM.ExportModelToObj=function(e){var t="",n=0,r=0,i,s;for(i=0;i<e.BodyCount();i++)s=e.GetBody(i),t+=JSM.ExportBodyContentToObj(s,n,r),n+=s.VertexCount(),r+=s.PolygonCount();return t};JSM.ExportMaterialsToGdl=function(e){function t(e,t){var r=JSM.HexColorToRGBComponents(e.diffuse);n+='define material "material'+t+'" 2, '+(r[0]/255+","+r[1]/255+","+r[2]/255)+" ! "+t+"\n"}var n="",r=!1;void 0!==e&&null!==e&&(r=!0);if(r){t(e.GetDefaultMaterial(),1);for(r=0;r<e.Count();r++)t(e.GetMaterial(r),r+2)}return n};JSM.ExportBodyGeometryToGdl=function(e,t){function n(e){if(200<e.length){var t=0,n,r;for(n=0;n<e.length;n++)r=e[n],u+=r,t++,200<t&&","==r&&(u+="\n",t=0)}else u+=e}function r(e){n(e+"\n")}function i(t){var n=e.GetVertex(t).position;r("vert "+n.x+", "+n.y+", "+n.z+" ! "+(t+1))}function s(t){var n=a.edges[t],i=0;-1!=n.pgon1&&-1!=n.pgon2&&e.GetPolygon(n.pgon1).HasCurveGroup()&&e.GetPolygon(n.pgon2).HasCurveGroup()&&e.GetPolygon(n.pgon1).GetCurveGroup()==e.GetPolygon(n.pgon2).GetCurveGroup()&&(i=2);r("edge "+(n.vert1+1)+", "+(n.vert2+1)+", -1, -1, "+i+" ! "+(t+1))}function o(i,s){var o=-1;t&&(o=e.GetPolygon(i).GetMaterialIndex()+2,o!=s&&r('set material "material'+o+'"'));var u=a.pgons[i],f=0;e.GetPolygon(i).HasCurveGroup()&&(f=2);n("pgon "+u.pedges.length+", 0, "+f+", ");var f="",l,h;for(l=0;l<u.pedges.length;l++)h=u.pedges[l],f=h.reverse?f+ -(h.index+1):f+(h.index+1),l<u.pedges.length-1&&(f+=", ");n(f);n(" ! "+(i+1));r("");return o}var u="";r("base");var a=JSM.CalculateAdjacencyInfo(e),f;for(f=0;f<a.verts.length;f++)i(f);for(f=0;f<a.edges.length;f++)s(f);var l=-1;for(f=0;f<a.pgons.length;f++)l=o(f,l);r("body -1");return u};JSM.ExportBodyToGdl=function(e,t){var n="",r=!1;void 0!==t&&null!==t&&(n+=JSM.ExportMaterialsToGdl(t),r=!0);return n+=JSM.ExportBodyGeometryToGdl(e,r)};JSM.ExportModelToGdl=function(e,t){var n="",r=!1;void 0!==t&&null!==t&&(n+=JSM.ExportMaterialsToGdl(t),r=!0);var i,s;for(i=0;i<e.BodyCount();i++)s=e.GetBody(i),n+=JSM.ExportBodyGeometryToGdl(s,r);return n};JSM.TriangleBody=function(e){this.name=e;this.vertices=[];this.normals=[];this.triangles=[]};JSM.TriangleBody.prototype.SetName=function(e){this.name=e};JSM.TriangleBody.prototype.GetName=function(){return this.name};JSM.TriangleBody.prototype.AddVertex=function(e,t,n){this.vertices.push(new JSM.Coord(e,t,n));return this.vertices.length-1};JSM.TriangleBody.prototype.GetVertex=function(e){return this.vertices[e]};JSM.TriangleBody.prototype.SetVertex=function(e,t,n,r){this.vertices[e]=new JSM.Coord(t,n,r)};JSM.TriangleBody.prototype.VertexCount=function(){return this.vertices.length};JSM.TriangleBody.prototype.AddNormal=function(e,t,n){this.normals.push(new JSM.Coord(e,t,n));return this.normals.length-1};JSM.TriangleBody.prototype.GetNormal=function(e){return this.normals[e]};JSM.TriangleBody.prototype.NormalCount=function(){return this.normals.length};JSM.TriangleBody.prototype.AddTriangle=function(e,t,n,r,i,s,o,u,a,f,l){this.triangles.push({v0:e,v1:t,v2:n,n0:r,n1:i,n2:s,u0:o,u1:u,u2:a,mat:f,curve:l});return this.triangles.length-1};JSM.TriangleBody.prototype.GetTriangle=function(e){return this.triangles[e]};JSM.TriangleBody.prototype.TriangleCount=function(){return this.triangles.length};JSM.TriangleBody.prototype.Finalize=function(e){function t(t,n,r,s){function o(e,t,n,r,i){var s=new JSM.Vector(0,0,0),o=0;n=e.GetTriangle(n);t=i[t];var u,a;for(i=0;i<t.length;i++)u=t[i],a=e.GetTriangle(u),n.curve==a.curve&&(s=JSM.CoordAdd(s,r[u]),o+=1);s=JSM.VectorMultiply(s,1/o);s=JSM.VectorNormalize(s);return e.AddNormal(s.x,s.y,s.z)}var u=t.triangles[i];void 0===u.mat&&(u.mat=e.AddDefaultMaterial());if(void 0===u.n0||void 0===u.n1||void 0===u.n2)void 0===u.curve||0===u.curve?(n=r[i],t=t.AddNormal(n.x,n.y,n.z),u.n0=t,u.n1=t,u.n2=t):(u.n0=o(t,u.v0,n,r,s),u.n1=o(t,u.v1,n,r,s),u.n2=o(t,u.v2,n,r,s))}var n=[],r={},i;for(i=0;i<this.vertices.length;i++)r[i]=[];var s,o;for(i=0;i<this.triangles.length;i++)s=this.triangles[i],o=JSM.CalculateTriangleNormal(this.vertices[s.v0],this.vertices[s.v1],this.vertices[s.v2]),n.push(o),r[s.v0].push(i),r[s.v1].push(i),r[s.v2].push(i);for(i=0;i<this.triangles.length;i++)t(this,i,n,r)};JSM.TriangleBody.prototype.Clone=function(){var e=new JSM.TriangleBody(this.name),t,n;for(t=0;t<this.vertices.length;t++)e.vertices.push(this.vertices[t].Clone());for(t=0;t<this.normals.length;t++)e.normals.push(this.normals[t].Clone());for(t=0;t<this.triangles.length;t++)n=this.triangles[t],e.triangles.push({v0:n.v0,v1:n.v1,v2:n.v2,n0:n.n0,n1:n.n1,n2:n.n2,u0:n.u0,u1:n.u1,u2:n.u2,mat:n.mat,curve:n.curve});return e};JSM.TriangleModel=function(){this.materials=[];this.bodies=[];this.defaultMaterial=-1};JSM.TriangleModel.prototype.AddMaterial=function(e,t,n,r,i){this.materials.push({name:e,ambient:t,diffuse:n,specular:r,opacity:i});return this.materials.length-1};JSM.TriangleModel.prototype.GetMaterial=function(e){return this.materials[e]};JSM.TriangleModel.prototype.AddDefaultMaterial=function(){-1==this.defaultMaterial&&(this.materials.push({name:"Default",ambient:{r:.5,g:.5,b:.5},diffuse:{r:.5,g:.5,b:.5},specular:{r:.1,g:.1,b:.1},opacity:1}),this.defaultMaterial=this.materials.length-1);return this.defaultMaterial};JSM.TriangleModel.prototype.GetDefaultMaterialIndex=function(){return this.AddDefaultMaterial()};JSM.TriangleModel.prototype.MaterialCount=function(){return this.materials.length};JSM.TriangleModel.prototype.AddBody=function(e){this.bodies.push(e);return this.bodies.length-1};JSM.TriangleModel.prototype.AddBodyToIndex=function(e,t){this.bodies.splice(t,0,e);return t};JSM.TriangleModel.prototype.GetBody=function(e){return this.bodies[e]};JSM.TriangleModel.prototype.BodyCount=function(){return this.bodies.length};JSM.TriangleModel.prototype.GetBody=function(e){return this.bodies[e]};JSM.TriangleModel.prototype.Finalize=function(){var e,t;for(e=0;e<this.bodies.length;e++)t=this.bodies[e],t.Finalize(this)};JSM.BinaryReader=function(e,t){this.arrayBuffer=e;this.dataView=new DataView(e);this.isLittleEndian=t;this.position=0};JSM.BinaryReader.prototype.GetPosition=function(){return this.position};JSM.BinaryReader.prototype.GetByteLength=function(){return this.arrayBuffer.byteLength};JSM.BinaryReader.prototype.Skip=function(e){this.position+=e};JSM.BinaryReader.prototype.End=function(){return this.position>=this.arrayBuffer.byteLength};JSM.BinaryReader.prototype.ReadBoolean=function(){var e=this.dataView.getInt8(this.position,this.isLittleEndian);this.position+=1;return e?!0:!1};JSM.BinaryReader.prototype.ReadCharacter=function(){var e=this.dataView.getInt8(this.position,this.isLittleEndian);this.position+=1;return e};JSM.BinaryReader.prototype.ReadUnsignedCharacter=function(){var e=this.dataView.getUint8(this.position,this.isLittleEndian);this.position+=1;return e};JSM.BinaryReader.prototype.ReadInteger16=function(){var e=this.dataView.getInt16(this.position,this.isLittleEndian);this.position+=2;return e};JSM.BinaryReader.prototype.ReadUnsignedInteger16=function(){var e=this.dataView.getUint16(this.position,this.isLittleEndian);this.position+=2;return e};JSM.BinaryReader.prototype.ReadInteger32=function(){var e=this.dataView.getInt32(this.position,this.isLittleEndian);this.position+=4;return e};JSM.BinaryReader.prototype.ReadUnsignedInteger32=function(){var e=this.dataView.getUint32(this.position,this.isLittleEndian);this.position+=4;return e};JSM.BinaryReader.prototype.ReadFloat32=function(){var e=this.dataView.getFloat32(this.position,this.isLittleEndian);this.position+=4;return e};JSM.BinaryReader.prototype.ReadDouble64=function(){var e=this.dataView.getFloat64(this.position,this.isLittleEndian);this.position+=8;return e};JSM.GetArrayBufferFromURL=function(e,t){var n=new XMLHttpRequest;n.open("GET",e,!0);n.responseType="arraybuffer";n.onload=function(){var e=n.response;e&&t(e)};n.send(null)};JSM.GetArrayBufferFromFile=function(e,t){var n=new FileReader;n.onloadend=function(e){e.target.readyState==FileReader.DONE&&t(e.target.result)};n.readAsArrayBuffer(e)};JSM.GetStringBufferFromURL=function(e,t){var n=new XMLHttpRequest;n.open("GET",e,!0);n.responseType="text";n.onload=function(){var e=n.response;e&&t(e)};n.send(null)};JSM.LoadMultipleBuffers=function(e,t,n,r,i){n>=e.length?i(t):r(e[n],function(s){t.push(s);JSM.LoadMultipleBuffers(e,t,n+1,r,i)})};JSM.GetStringBufferFromFile=function(e,t){var n=new FileReader;n.onloadend=function(e){e.target.readyState==FileReader.DONE&&t(e.target.result)};n.readAsText(e)};JSM.GetStringBuffersFromURLList=function(e,t){JSM.LoadMultipleBuffers(e,[],0,JSM.GetStringBufferFromURL,function(e){t(e)})};JSM.GetStringBuffersFromFileList=function(e,t){JSM.LoadMultipleBuffers(e,[],0,JSM.GetStringBufferFromFile,function(e){t(e)})};JSM.ConvertTriangleModelToJsonData=function(e){function t(e,t,n){var r=[],i=e.MaterialCount(),s;for(e=0;e<t.VertexCount();e++)s=t.GetVertex(e),n.vertices.push(s.x,s.y,s.z);for(e=0;e<t.NormalCount();e++)s=t.GetNormal(e),n.normals.push(s.x,s.y,s.z);n.uvs.push(0,0);for(e=0;e<i;e++)r.push([]);for(e=0;e<t.TriangleCount();e++)s=t.GetTriangle(e),void 0===s.mat||0>s.mat||s.mat>=i||r[s.mat].push(e);var o,u;for(e=0;e<r.length;e++)if(o=r[e],0!==o.length){u={material:e,parameters:[]};for(i=0;i<o.length;i++)s=t.GetTriangle(o[i]),u.parameters.push(s.v0,s.v1,s.v2,s.n0,s.n1,s.n2,0,0,0);n.triangles.push(u)}}var n={version:1,materials:[],meshes:[]};(function(e,t){var n,r;for(n=0;n<e.MaterialCount();n++)r=e.GetMaterial(n),t.push({name:r.name,ambient:[r.ambient.r,r.ambient.g,r.ambient.b],diffuse:[r.diffuse.r,r.diffuse.g,r.diffuse.b],specular:[r.specular.r,r.specular.g,r.specular.b],opacity:r.opacity})})(e,n.materials);var r,i,s;for(r=0;r<e.BodyCount();r++)i=e.GetBody(r),0!==i.TriangleCount()&&(s={name:i.GetName(),vertices:[],normals:[],uvs:[],triangles:[]},t(e,i,s),n.meshes.push(s));return n};JSM.MergeJsonDataMeshes=function(e){function t(e,t,n){function r(e,t,n){var r=t.material,u=n[r];void 0===u&&(e.triangles.push({material:r,parameters:[]}),u=e.triangles.length-1,n[r]=u);e=e.triangles[u].parameters;for(n=0;n<t.parameters.length;n+=9)e.push(t.parameters[n]+i,t.parameters[n+1]+i,t.parameters[n+2]+i,t.parameters[n+3]+s,t.parameters[n+4]+s,t.parameters[n+5]+s,t.parameters[n+6]+o,t.parameters[n+7]+o,t.parameters[n+8]+o)}var i=e.vertices.length/3,s=e.normals.length/3,o=e.uvs.length/2;(function(e,t){var n;for(n=0;n<t.vertices.length;n++)e.vertices.push(t.vertices[n]);for(n=0;n<t.normals.length;n++)e.normals.push(t.normals[n]);for(n=0;n<t.uvs.length;n++)e.uvs.push(t.uvs[n])})(e,t);var u,a;for(u=0;u<t.triangles.length;u++)a=t.triangles[u],r(e,a,n)}var n={version:e.version,materials:e.materials,meshes:[]},r={name:"Merged",vertices:[],normals:[],uvs:[],triangles:[]},i={},s,o;for(s=0;s<e.meshes.length;s++)o=e.meshes[s],t(r,o,i);n.meshes.push(r);return n};JSM.Read3dsFile=function(e,t){function D(e,n){if(void 0!==t.onLog&&null!==t.onLog)t.onLog(e,n)}function P(e){for(var t="",n=0,r=0;64>r;){n=e.ReadCharacter();if(0===n)break;t+=String.fromCharCode(n);r+=1}return t}function H(e){var t=[],n;for(n=0;3>n;n++)t[n]=e.ReadFloat32();return t}function B(e,t,n){for(;e.GetPosition()<=t-6;){var r=e,i=n,s=r.ReadUnsignedInteger16(),r=r.ReadUnsignedInteger32();i(s,r)}}var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_;if(void 0===t||null===t)t={};n=15677;r=45055;i=40960;s=40976;o=40992;u=41008;a=41024;f=41040;l=16;c=17;h=18;p=19;d=48;v=49;m=16384;g=16640;y=17920;b=18176;w=16656;E=16672;S=16736;x=16688;T=16720;N=45056;C=45058;k=45072;L=45075;A=45088;O=45089;M=45090;_=45104;(function(e){function j(e,t,n){var r={};t=e.GetPosition()+n-6;var i=!1;B(e,t,function(t,n){t==c?i||(r.r=e.ReadUnsignedCharacter()/255,r.g=e.ReadUnsignedCharacter()/255,r.b=e.ReadUnsignedCharacter()/255):t==h?(r.r=e.ReadUnsignedCharacter()/255,r.g=e.ReadUnsignedCharacter()/255,r.b=e.ReadUnsignedCharacter()/255,i=!0):t==l?i||(r.r=e.ReadFloat32(),r.g=e.ReadFloat32(),r.b=e.ReadFloat32()):t==p?(r.r=e.ReadFloat32(),r.g=e.ReadFloat32(),r.b=e.ReadFloat32(),i=!0):e.Skip(n-6)});return r}function R(e,t,n){var r=0;t=e.GetPosition()+n-6;B(e,t,function(t,n){t==d?r=e.ReadUnsignedInteger16()/100:t==v?r=e.ReadFloat32():e.Skip(n-6)});return r}function U(e,n,r){D("Read material chunk ("+n.toString(16)+", "+r+")",2);var l={},c=e.GetPosition()+r-6;B(e,c,function(t,c){t==i?(D("Read material name chunk ("+n.toString(16)+", "+r+")",3),l.name=P(e)):t==s?(D("Read material ambient chunk ("+n.toString(16)+", "+r+")",3),l.ambient=j(e,t,c)):t==o?(D("Read material diffuse chunk ("+n.toString(16)+", "+r+")",3),l.diffuse=j(e,t,c)):t==u?(D("Read material specular chunk ("+n.toString(16)+", "+r+")",3),l.specular=j(e,t,c)):t==a?(D("Read material shininess chunk ("+n.toString(16)+", "+r+")",3),l.shininess=R(e,t,c)):t==f?(D("Read material transparency chunk ("+n.toString(16)+", "+r+")",3),l.transparency=R(e,t,c)):(D("Skip chunk ("+t.toString(16)+", "+c+")",3),e.Skip(c-6))});if(void 0!==t.onMaterial&&null!==t.onMaterial)t.onMaterial(l)}function W(e,n,r){D("Read faces chunk ("+n.toString(16)+", "+r+")",4);n=e.GetPosition()+r-6;var i=e.ReadUnsignedInteger16(),s,o,u,a;for(r=0;r<i;r++)if(s=e.ReadUnsignedInteger16(),o=e.ReadUnsignedInteger16(),u=e.ReadUnsignedInteger16(),a=e.ReadUnsignedInteger16(),void 0!==t.onFace&&null!==t.onFace)t.onFace(s,o,u,a);B(e,n,function(n,r){if(n==x){D("Read face materials chunk ("+n.toString(16)+", "+r+")",5);var s=P(e),o=e.ReadUnsignedInteger16(),u,a;for(u=0;u<o;u++)if(a=e.ReadUnsignedInteger16(),void 0!==t.onFaceMaterial&&null!==t.onFaceMaterial)t.onFaceMaterial(a,s)}else if(n==T){D("Read face smoothing groups chunk ("+n.toString(16)+", "+r+")",5);for(s=0;s<i;s++)if(o=e.ReadUnsignedInteger32(),void 0!==t.onFaceSmoothingGroup&&null!==t.onFaceSmoothingGroup)t.onFaceSmoothingGroup(s,o)}else D("Skip chunk ("+n.toString(16)+", "+r+")",5),e.Skip(r-6)})}function X(e,n,r,i){D("Read mesh chunk ("+n+", "+r.toString(16)+", "+i+")",3);if(void 0!==t.onMesh&&null!==t.onMesh)t.onMesh(n);n=e.GetPosition()+i-6;B(e,n,function(n,r){if(n==w){D("Read vertices chunk ("+n.toString(16)+", "+r+")",4);var i=e.ReadUnsignedInteger16(),s,o,u,a;for(s=0;s<i;s++)if(o=e.ReadFloat32(),u=e.ReadFloat32(),a=e.ReadFloat32(),void 0!==t.onVertex&&null!==t.onVertex)t.onVertex(o,u,a)}else if(n==E)W(e,n,r);else if(n==S){D("Read transformation chunk ("+n.toString(16)+", "+r+")",4);i=[];for(s=0;4>s;s++){for(o=0;3>o;o++)i.push(e.ReadFloat32());3>s?i.push(0):i.push(1)}if(void 0!==t.onTransformation&&null!==t.onTransformation)t.onTransformation(i)}else D("Skip chunk ("+n.toString(16)+", "+r+")",4),e.Skip(r-6)})}function V(e,t,n){D("Read object chunk ("+t.toString(16)+", "+n+")",2);t=e.GetPosition()+n-6;var r=P(e);B(e,t,function(t,n){t==g?X(e,r,t,n):(t==y?D("Skip light chunk ("+r+", "+t.toString(16)+", "+n+")",3):t==b?D("Skip camera chunk ("+r+", "+t.toString(16)+", "+n+")",3):D("Skip chunk ("+t.toString(16)+", "+n+")",3),e.Skip(n-6))})}function $(e,t,n){D("Read editor chunk ("+t.toString(16)+", "+n+")",1);t=e.GetPosition()+n-6;B(e,t,function(t,n){t==r?U(e,t,n):t==m?V(e,t,n):(D("Skip chunk ("+t.toString(16)+", "+n+")",2),e.Skip(n-6))})}function Q(e,n,r){function i(e,t){var n=[];e.Skip(10);var r,i,s,o=e.ReadInteger32();for(r=0;r<o;r++)e.ReadInteger32(),i=e.ReadUnsignedInteger16(),0!==i&&e.ReadFloat32(),t==O?(s=e.ReadFloat32(),i=H(e),i[3]=s):i=H(e),n.push(i);return n}D("Read object node chunk ("+n.toString(16)+", "+r+")",2);var s={name:"",nodeId:-1,flags:-1,userId:-1,pivot:[0,0,0],positions:[],rotations:[],scales:[]};n=e.GetPosition()+r-6;B(e,n,function(t,n){t==k?(s.name=P(e),s.flags=e.ReadUnsignedInteger32(),s.userId=e.ReadUnsignedInteger16()):t==L?s.pivot=H(e):t==A?s.positions=i(e,A):t==O?s.rotations=i(e,O):t==M?s.scales=i(e,M):t==_?s.nodeId=e.ReadUnsignedInteger16():(D("Skip chunk ("+t.toString(16)+", "+n+")",3),e.Skip(n-6))});if(void 0!==t.onObjectNode&&null!==t.onObjectNode)t.onObjectNode(s)}function Y(e,t,n){D("Read keyframe chunk ("+t.toString(16)+", "+n+")",1);t=e.GetPosition()+n-6;B(e,t,function(t,n){t==C?Q(e,t,n):(D("Skip chunk ("+t.toString(16)+", "+n+")",2),e.Skip(n-6))})}function Z(e,t,r){D("Read main chunk ("+t.toString(16)+", "+r+")",0);t=e.GetPosition()+r-6;B(e,t,function(t,r){t==n?$(e,t,r):t==N?Y(e,t,r):(D("Skip chunk ("+t.toString(16)+", "+r+")",1),e.Skip(r-6))})}var et=e.GetByteLength();B(e,et,function(t,n){19789==t?Z(e,t,n):(D("Skip chunk ("+t.toString(16)+", "+n+")",0),e.Skip(n-6))})})(new JSM.BinaryReader(e,!0))};JSM.Convert3dsToJsonData=function(e){var t=new JSM.TriangleModel,n=null,r={},i={},s={nodes:[],nodeIdToIndex:{}};JSM.Read3dsFile(e,{onMaterial:function(e){function n(e){return void 0===e||null===e?{r:0,g:0,b:0}:e}var i=t.AddMaterial(e.name,n(e.ambient),n(e.diffuse),n(e.specular),void 0===e.transparency||null===e.transparency?1:1-e.transparency);void 0===r[e.name]&&(r[e.name]=i)},onMesh:function(e){var r=t.AddBody(new JSM.TriangleBody(e));n=t.GetBody(r);n.meshData={faceToMaterial:{},faceToSmoothingGroup:{},objectNodes:[],transformation:null};i[e]=r},onTransformation:function(e){null!==n&&(n.meshData.transformation=e)},onObjectNode:function(e){var n=s.nodes.length;s.nodes.push(e);s.nodeIdToIndex[e.nodeId]=n;e=i[e.name];void 0!==e&&t.GetBody(e).meshData.objectNodes.push(n)},onVertex:function(e,t,r){null!==n&&n.AddVertex(e,t,r)},onFace:function(e,t,r){null!==n&&n.AddTriangle(e,t,r)},onFaceMaterial:function(e,t){null!==n&&(n.meshData.faceToMaterial[e]=t)},onFaceSmoothingGroup:function(e,t){null!==n&&(n.meshData.faceToSmoothingGroup[e]=t)}});(function(e,t,n){function r(e,t,n){function r(e,t){var n=t[0],r=t[1],i=t[2],s;for(s=0;4>s;s++)e[0+s]*=n,e[4+s]*=r,e[8+s]*=i;return e}function i(e,t){var n=t[0],r=t[1],i=t[2],s;for(s=0;3>s;s++)e[12+s]+=e[0+s]*n+e[4+s]*r+e[8+s]*i;return e}function s(e,t){var n,r;for(n=0;n<e.VertexCount();n++)r=e.GetVertex(n),r=JSM.ApplyTransformation(t,r),e.SetVertex(n,r.x,r.y,r.z)}function o(e,t,n){var i=JSM.MatrixDeterminant(t);JSM.IsNegative(i)&&(t=JSM.MatrixClone(t),r(t,[-1,1,1]),n=JSM.MatrixMultiply(n,t),s(e,n))}function u(e,t){if(void 0!==e.matrix)return e.matrix;var n=JSM.MatrixIdentity(),s;s=0===e.positions.length?[0,0,0]:e.positions[0];n=i(n,s);if(0===e.rotations.length)s=[0,0,0,0];else{s=e.rotations[0];var o=[0,0,0,1],a=Math.sqrt(s[0]*s[0]+s[1]*s[1]+s[2]*s[2]);JSM.IsPositive(a)&&(o=-.5*s[3],a=Math.sin(o)/a,o=[a*s[0],a*s[1],a*s[2],Math.cos(o)]);s=o}s=JSM.MatrixRotationQuaternion(s);n=JSM.MatrixMultiply(s,n);s=0===e.scales.length?[0,0,0,0]:e.scales[0];n=r(n,s);65535!=e.userId&&(s=t.nodeIdToIndex[e.userId],void 0!==s&&(s=u(t.nodes[s],t),n=JSM.MatrixMultiply(n,s)));return e.matrix=n}var a=e.meshData;a=void 0===a||null===a?null:a.transformation;if(null!==a){var f=null,f=null!==t?u(t,n):a;n=JSM.MatrixClone(f);f=JSM.MatrixClone(a);a=JSM.MatrixInvert(f);null!==a&&(o(e,f,a),t=void 0===t||null===t?[0,0,0]:t.pivot,i(n,[-t[0],-t[1],-t[2]]),t=JSM.MatrixMultiply(a,n),s(e,t))}}function i(e,t,n,i){r(e,t,i);t=e.meshData;var s,o;for(i=0;i<e.TriangleCount();i++)s=e.GetTriangle(i),o=t.faceToMaterial[i],void 0!==o&&(o=n[o],void 0!==o&&(s.mat=o)),o=t.faceToSmoothingGroup[i],void 0!==o&&(s.curve=o)}function s(e,t,n,r){t=t.Clone();t.SetName(t.GetName()+" ("+r+")");n<e.BodyCount()?e.AddBodyToIndex(t,n):e.AddBody(t);return t}var o,u,a,f,l,c,h;for(o=0;o<t.BodyCount();o++)if(a=t.GetBody(o),f=a.meshData,0===f.objectNodes.length)i(a,null,n,e);else{c=e.nodes[f.objectNodes[0]];for(u=1;u<f.objectNodes.length;u++)l=e.nodes[f.objectNodes[u]],h=s(t,a,o+1,u+1),h.meshData=a.meshData,i(h,l,n,e),o+=1;i(a,c,n,e)}})(s,t,r);t.Finalize();return JSM.ConvertTriangleModelToJsonData(t)};JSM.ReadObjFile=function(e,t){function n(e){e=e.split("\n");var r,i;for(r=0;r<e.length;r++){var s=i=e[r].trim();if(0!==s.length&&"#"!=s[0]&&(i=s.split(/\s+/),!(0===i.length||"#"==i[0][0]))){var o=void 0,o=void 0;if("g"==i[0]){if(!(2>i.length)){s="";for(o=1;o<i.length;o++)s+=i[o],o<i.length-1&&(s+=" ");if(void 0!==t.onMesh&&null!==t.onMesh)t.onMesh(s)}}else if("v"==i[0]){if(!(4>i.length)&&(o=parseFloat(i[1]),s=parseFloat(i[2]),i=parseFloat(i[3]),void 0!==t.onVertex&&null!==t.onVertex))t.onVertex(o,s,i)}else if("vn"==i[0]){if(!(4>i.length)&&(o=parseFloat(i[1]),s=parseFloat(i[2]),i=parseFloat(i[3]),void 0!==t.onNormal&&null!==t.onNormal))t.onNormal(o,s,i)}else if("f"==i[0]){if(!(4>i.length)){for(var s=[],u=[],a=void 0,o=1;o<i.length;o++)a=i[o].split("/"),s.push(parseInt(a[0],10)-1),2<a.length&&0<a[2].length&&u.push(parseInt(a[2],10)-1);if(void 0!==t.onFace&&null!==t.onFace)t.onFace(s,u)}}else if("usemtl"==i[0]){if(!(2>i.length)&&void 0!==t.onUseMaterial&&null!==t.onUseMaterial)t.onUseMaterial(i[1])}else if("newmtl"==i[0]){if(!(2>i.length)&&void 0!==t.onNewMaterial&&null!==t.onNewMaterial)t.onNewMaterial(i[1])}else if("Ka"==i[0]||"Kd"==i[0]||"Ks"==i[0]){if(!(4>i.length)&&(o=parseFloat(i[1]),s=parseFloat(i[2]),u=parseFloat(i[3]),void 0!==t.onMaterialComponent&&null!==t.onMaterialComponent))t.onMaterialComponent(i[0],o,s,u)}else if("Ka"==i[0]||"Kd"==i[0]||"Ks"==i[0]){if(!(4>i.length)&&(o=parseFloat(i[1]),s=parseFloat(i[2]),u=parseFloat(i[3]),void 0!==t.onMaterialComponent&&null!==t.onMaterialComponent))t.onMaterialComponent(i[0],o,s,u)}else"mtllib"==i[0]&&!(2>i.length)&&(i=s.indexOf("mtllib")+6,o=s.substr(i,s.length-i).trim(),i=o.trim(),i=void 0!==t.onFileRequested&&null!==t.onFileRequested?t.onFileRequested(i):null,null!==i&&n(i))}}}n(e)};JSM.ConvertObjToJsonData=function(e,t){var n=new JSM.TriangleModel,r=n.AddBody(new JSM.TriangleBody("Default")),i=n.GetBody(r),s={},o=null,u=null,a=[],f=[];JSM.ReadObjFile(e,{onNewMaterial:function(e){var t=n.AddMaterial(e,{r:1,g:0,b:0},{r:1,g:0,b:0},{r:0,g:0,b:0},1);o=n.GetMaterial(t);s[e]=t},onMaterialComponent:function(e,t,n,r){null!==o&&("Ka"==e?(e=o.ambient,e.r=t,e.g=n,e.b=r):"Kd"==e?(e=o.diffuse,e.r=t,e.g=n,e.b=r):"Ks"==e&&(e=o.specular,e.r=t,e.g=n,e.b=r))},onUseMaterial:function(e){e=s[e];void 0!==e&&(u=e)},onMesh:function(e){e=n.AddBody(new JSM.TriangleBody(e));i=n.GetBody(e)},onVertex:function(e,t,n){a.push(new JSM.Coord(e,t,n))},onNormal:function(e,t,n){f.push(new JSM.Coord(e,t,n))},onFace:function(e,t){var n,r,s=e.length==t.length,o=e.length;for(n=0;n<o-2;n++)r=i.AddTriangle(e[0],e[(n+1)%o],e[(n+2)%o]),r=i.GetTriangle(r),s&&(r.n0=t[0],r.n1=t[(n+1)%o],r.n2=t[(n+2)%o]),null!==u&&(r.mat=u)},onFileRequested:function(e){return void 0!==t.onFileRequested&&null!==t.onFileRequested?t.onFileRequested(e):null}});(function(e,t,n){function r(e,t,n,r,i){if(void 0!==n){var s=r[n];if(void 0!==s)return s;t=t[n];0===i?s=e.AddVertex(t.x,t.y,t.z):1===i&&(s=e.AddNormal(t.x,t.y,t.z));return r[n]=s}}var i,s,o,u,a,f;for(i=0;i<e.BodyCount();i++){o=e.GetBody(i);a={};f={};for(s=0;s<o.TriangleCount();s++)u=o.GetTriangle(s),u.v0=r(o,t,u.v0,a,0),u.v1=r(o,t,u.v1,a,0),u.v2=r(o,t,u.v2,a,0),u.n0=r(o,n,u.n0,f,1),u.n1=r(o,n,u.n1,f,1),u.n2=r(o,n,u.n2,f,1)}})(n,a,f);n.Finalize();return JSM.ConvertTriangleModelToJsonData(n)};JSM.ReadBinaryStlFile=function(e,t){function n(e){var t=[],n;for(n=0;3>n;n++)t[n]=e.ReadFloat32();return t}var r=new JSM.BinaryReader(e,!0);r.Skip(80);var i=r.ReadUnsignedInteger32(),s,o,u,a,f;for(s=0;s<i;s++)if(f=n(r),o=n(r),u=n(r),a=n(r),r.Skip(2),void 0!==t.onFace&&null!==t.onFace)t.onFace(o,u,a,f)};JSM.ReadAsciiStlFile=function(e,t){function n(e,n){var r=e[n].trim();if(0===r.length)return n+1;r=r.split(/\s+/);if(0===r.length)return n+1;if("solid"!=r[0]&&"facet"==r[0]&&"normal"==r[1]){if(5>r.length)return-1;var r=[parseFloat(r[2]),parseFloat(r[3]),parseFloat(r[4])],i=[],s,o;for(s=n+1;s<e.length&&3>i.length;s++)if(o=e[s].trim(),0!==o.length&&(o=o.split(/\s+/),0!==o.length&&"vertex"==o[0]))if(4>o.length)break;else o=[parseFloat(o[1]),parseFloat(o[2]),parseFloat(o[3])],i.push(o);s+=1;if(3!=i.length)return-1;if(void 0!==t.onFace&&null!==t.onFace)t.onFace(i[0],i[1],i[2],r);return s}return n+1}for(var r=0,i=e.split("\n");r<i.length&&-1!=r;)r=n(i,r)};JSM.ConvertStlToJsonData=function(e){var t=new JSM.TriangleModel,n=t.AddBody(new JSM.TriangleBody("Default")),r=t.GetBody(n);(function(e){var t=e.byteLength;if(84>t)return!1;e=new JSM.BinaryReader(e,!0);e.Skip(80);e=e.ReadUnsignedInteger32();return t!=50*e+84?!1:!0})(e)?JSM.ReadBinaryStlFile(e,{onFace:function(e,t,n,i){e=r.AddVertex(e[0],e[1],e[2]);t=r.AddVertex(t[0],t[1],t[2]);n=r.AddVertex(n[0],n[1],n[2]);i=JSM.VectorNormalize(new JSM.Vector(i[0],i[1],i[2]));i=r.AddNormal(i.x,i.y,i.z);r.AddTriangle(e,t,n,i,i,i)}}):(e=String.fromCharCode.apply(null,new Uint8Array(e)),JSM.ReadAsciiStlFile(e,{onFace:function(e,t,n,i){e=r.AddVertex(e[0],e[1],e[2]);t=r.AddVertex(t[0],t[1],t[2]);n=r.AddVertex(n[0],n[1],n[2]);i=JSM.VectorNormalize(new JSM.Vector(i[0],i[1],i[2]));i=r.AddNormal(i.x,i.y,i.z);r.AddTriangle(e,t,n,i,i,i)}}));t.Finalize();return JSM.ConvertTriangleModelToJsonData(t)};JSM.ImportFileList=function(){this.descriptors=null};JSM.ImportFileList.prototype.Init=function(e){this.descriptors=[];var t,n;for(t=0;t<e.length;t++)n=e[t],n={originalObject:n,originalFileName:n.name,fileName:n.name.toUpperCase(),extension:this.GetFileExtension(n.name)},this.descriptors.push(n)};JSM.ImportFileList.prototype.GetFileDescriptor=function(e){return this.descriptors[e]};JSM.ImportFileList.prototype.GetMainFileIndex=function(e){var t;for(e=0;e<this.descriptors.length;e++)if(t=this.descriptors[e],this.IsSupportedExtension(t.extension))return e;return-1};JSM.ImportFileList.prototype.GetFileIndexByName=function(e){var t,n;for(t=0;t<this.descriptors.length;t++)if(n=this.descriptors[t],n.fileName==e.toUpperCase())return t;return-1};JSM.ImportFileList.prototype.IsSupportedExtension=function(e){return".3DS"==e||".OBJ"==e||".STL"==e?!0:!1};JSM.ImportFileList.prototype.GetFileExtension=function(e){var t=e.lastIndexOf(".");if(-1==t)return"";e=e.substr(t);return e=e.toUpperCase()};JSM.ConvertFileListToJsonData=function(e,t){function n(e,n){if(void 0!==t.onReady&&null!==t.onReady)t.onReady(e,n)}var r=new JSM.ImportFileList;r.Init(e);var i=r.GetMainFileIndex();if(-1===i){if(void 0!==t.onError&&null!==t.onError)t.onError()}else{var s=r.GetFileDescriptor(i),o={main:s.originalFileName,requested:[],missing:[]};".3DS"==s.extension?JSM.GetArrayBufferFromFile(s.originalObject,function(e){e=JSM.Convert3dsToJsonData(e);n(o,e)}):".OBJ"==s.extension?JSM.GetStringBuffersFromFileList(e,function(e){var t=JSM.ConvertObjToJsonData(e[i],{onFileRequested:function(t){var n=r.GetFileIndexByName(t);if(-1==n)return o.missing.push(t),null;o.requested.push(t);return e[n]}});n(o,t)}):".STL"==s.extension&&JSM.GetArrayBufferFromFile(s.originalObject,function(e){e=JSM.ConvertStlToJsonData(e);n(o,e)})}};JSM.GenerateSolidWithRadius=function(e,t){var n=new JSM.Body,r=!0;"Tetrahedron"===e?n=JSM.GenerateTetrahedron():"Hexahedron"===e?n=JSM.GenerateHexahedron():"Octahedron"===e?n=JSM.GenerateOctahedron():"Dodecahedron"===e?n=JSM.GenerateDodecahedron():"Icosahedron"===e?n=JSM.GenerateIcosahedron():"TruncatedTetrahedron"===e?n=JSM.GenerateTruncatedTetrahedron():"Cuboctahedron"===e?n=JSM.GenerateCuboctahedron():"TruncatedCube"===e?n=JSM.GenerateTruncatedCube():"TruncatedOctahedron"===e?n=JSM.GenerateTruncatedOctahedron():"Rhombicuboctahedron"===e?n=JSM.GenerateRhombicuboctahedron():"TruncatedCuboctahedron"===e?n=JSM.GenerateTruncatedCuboctahedron():"SnubCube"===e?n=JSM.GenerateSnubCube():"Icosidodecahedron"===e?n=JSM.GenerateIcosidodecahedron():"TruncatedDodecahedron"===e?n=JSM.GenerateTruncatedDodecahedron():"TruncatedIcosahedron"===e?n=JSM.GenerateTruncatedIcosahedron():"Rhombicosidodecahedron"===e?n=JSM.GenerateRhombicosidodecahedron():"TruncatedIcosidodecahedron"===e?n=JSM.GenerateTruncatedIcosidodecahedron():"SnubDodecahedron"===e?n=JSM.GenerateSnubDodecahedron():"TetrakisHexahedron"===e?(n=JSM.GenerateTetrakisHexahedron(),r=!1):"RhombicDodecahedron"===e?(n=JSM.GenerateRhombicDodecahedron(),r=!1):"PentakisDodecahedron"===e?(n=JSM.GeneratePentakisDodecahedron(),r=!1):"SmallStellatedDodecahedron"===e?(n=JSM.GenerateSmallStellatedDodecahedron(),r=!1):"GreatDodecahedron"===e?(n=JSM.GenerateGreatDodecahedron(),r=!1):"SmallTriambicIcosahedron"===e?(n=JSM.GenerateSmallTriambicIcosahedron(),r=!1):"GreatStellatedDodecahedron"===e?(n=JSM.GenerateGreatStellatedDodecahedron(),r=!1):"SmallTriakisOctahedron"===e?(n=JSM.GenerateSmallTriakisOctahedron(),r=!1):"StellaOctangula"===e?(n=JSM.GenerateStellaOctangula(),r=!1):"TriakisTetrahedron"===e&&(n=JSM.GenerateTriakisTetrahedron(),r=!1);if(0<n.VertexCount()){var i=0;if(r)i=JSM.VectorLength(n.GetVertexPosition(0));else for(var s,r=0;r<n.VertexCount();r++)s=JSM.VectorLength(n.GetVertexPosition(r)),JSM.IsGreater(s,i)&&(i=s);i=t/i;for(r=0;r<n.VertexCount();r++)s=n.GetVertex(r),s.SetPosition(JSM.VectorMultiply(s.GetPosition(),i))}return n};JSM.GenerateTetrahedron=function(){var e=new JSM.Body;e.AddVertex(new JSM.BodyVertex(new JSM.Coord(1,1,1)));e.AddVertex(new JSM.BodyVertex(new JSM.Coord(-1,-1,1)));e.AddVertex(new JSM.BodyVertex(new JSM.Coord(-1,1,-1)));e.AddVertex(new JSM.BodyVertex(new JSM.Coord(1,-1,-1)));e.AddPolygon(new JSM.BodyPolygon([0,1,3]));e.AddPolygon(new JSM.BodyPolygon([0,2,1]));e.AddPolygon(new JSM.BodyPolygon([0,3,2]));e.AddPolygon(new JSM.BodyPolygon([1,2,3]));return e};JSM.GenerateHexahedron=function(){var e=new JSM.Body;JSM.AddVertexToBody(e,1,1,1);JSM.AddVertexToBody(e,1,1,-1);JSM.AddVertexToBody(e,1,-1,1);JSM.AddVertexToBody(e,-1,1,1);JSM.AddVertexToBody(e,1,-1,-1);JSM.AddVertexToBody(e,-1,1,-1);JSM.AddVertexToBody(e,-1,-1,1);JSM.AddVertexToBody(e,-1,-1,-1);JSM.AddPolygonToBody(e,[0,1,5,3]);JSM.AddPolygonToBody(e,[0,2,4,1]);JSM.AddPolygonToBody(e,[0,3,6,2]);JSM.AddPolygonToBody(e,[1,4,7,5]);JSM.AddPolygonToBody(e,[2,6,7,4]);JSM.AddPolygonToBody(e,[3,5,7,6]);return e};JSM.GenerateOctahedron=function(){var e=new JSM.Body;JSM.AddVertexToBody(e,1,0,0);JSM.AddVertexToBody(e,-1,0,0);JSM.AddVertexToBody(e,0,1,0);JSM.AddVertexToBody(e,0,-1,0);JSM.AddVertexToBody(e,0,0,1);JSM.AddVertexToBody(e,0,0,-1);JSM.AddPolygonToBody(e,[0,2,4]);JSM.AddPolygonToBody(e,[0,3,5]);JSM.AddPolygonToBody(e,[0,4,3]);JSM.AddPolygonToBody(e,[0,5,2]);JSM.AddPolygonToBody(e,[1,2,5]);JSM.AddPolygonToBody(e,[1,3,4]);JSM.AddPolygonToBody(e,[1,4,2]);JSM.AddPolygonToBody(e,[1,5,3]);return e};JSM.GenerateDodecahedron=function(){var e=new JSM.Body,t=(1+Math.sqrt(5))/2,n=1/t;JSM.AddVertexToBody(e,1,1,1);JSM.AddVertexToBody(e,1,1,-1);JSM.AddVertexToBody(e,1,-1,1);JSM.AddVertexToBody(e,-1,1,1);JSM.AddVertexToBody(e,1,-1,-1);JSM.AddVertexToBody(e,-1,1,-1);JSM.AddVertexToBody(e,-1,-1,1);JSM.AddVertexToBody(e,-1,-1,-1);JSM.AddVertexToBody(e,0,+n,+t);JSM.AddVertexToBody(e,0,+n,-t);JSM.AddVertexToBody(e,0,-n,+t);JSM.AddVertexToBody(e,0,-n,-t);JSM.AddVertexToBody(e,+n,+t,0);JSM.AddVertexToBody(e,+n,-t,0);JSM.AddVertexToBody(e,-n,+t,0);JSM.AddVertexToBody(e,-n,-t,0);JSM.AddVertexToBody(e,+t,0,+n);JSM.AddVertexToBody(e,-t,0,+n);JSM.AddVertexToBody(e,+t,0,-n);JSM.AddVertexToBody(e,-t,0,-n);JSM.AddPolygonToBody(e,[0,8,10,2,16]);JSM.AddPolygonToBody(e,[0,16,18,1,12]);JSM.AddPolygonToBody(e,[0,12,14,3,8]);JSM.AddPolygonToBody(e,[1,9,5,14,12]);JSM.AddPolygonToBody(e,[1,18,4,11,9]);JSM.AddPolygonToBody(e,[2,10,6,15,13]);JSM.AddPolygonToBody(e,[2,13,4,18,16]);JSM.AddPolygonToBody(e,[3,14,5,19,17]);JSM.AddPolygonToBody(e,[3,17,6,10,8]);JSM.AddPolygonToBody(e,[4,13,15,7,11]);JSM.AddPolygonToBody(e,[5,9,11,7,19]);JSM.AddPolygonToBody(e,[6,17,19,7,15]);return e};JSM.GenerateIcosahedron=function(){var e=new JSM.Body,t=(1+Math.sqrt(5))/2;JSM.AddVertexToBody(e,0,1,+t);JSM.AddVertexToBody(e,0,1,-t);JSM.AddVertexToBody(e,0,-1,+t);JSM.AddVertexToBody(e,0,-1,-t);JSM.AddVertexToBody(e,1,+t,0);JSM.AddVertexToBody(e,1,-t,0);JSM.AddVertexToBody(e,-1,+t,0);JSM.AddVertexToBody(e,-1,-t,0);JSM.AddVertexToBody(e,+t,0,1);JSM.AddVertexToBody(e,-t,0,1);JSM.AddVertexToBody(e,+t,0,-1);JSM.AddVertexToBody(e,-t,0,-1);JSM.AddPolygonToBody(e,[0,2,8]);JSM.AddPolygonToBody(e,[0,4,6]);JSM.AddPolygonToBody(e,[0,6,9]);JSM.AddPolygonToBody(e,[0,8,4]);JSM.AddPolygonToBody(e,[0,9,2]);JSM.AddPolygonToBody(e,[1,3,11]);JSM.AddPolygonToBody(e,[1,4,10]);JSM.AddPolygonToBody(e,[1,6,4]);JSM.AddPolygonToBody(e,[1,10,3]);JSM.AddPolygonToBody(e,[1,11,6]);JSM.AddPolygonToBody(e,[2,5,8]);JSM.AddPolygonToBody(e,[2,7,5]);JSM.AddPolygonToBody(e,[2,9,7]);JSM.AddPolygonToBody(e,[3,5,7]);JSM.AddPolygonToBody(e,[3,7,11]);JSM.AddPolygonToBody(e,[3,10,5]);JSM.AddPolygonToBody(e,[4,8,10]);JSM.AddPolygonToBody(e,[6,11,9]);JSM.AddPolygonToBody(e,[5,10,8]);JSM.AddPolygonToBody(e,[7,9,11]);return e};JSM.GenerateTruncatedTetrahedron=function(){var e=new JSM.Body;JSM.AddVertexToBody(e,1,1,3);JSM.AddVertexToBody(e,1,-1,-3);JSM.AddVertexToBody(e,-1,-1,3);JSM.AddVertexToBody(e,-1,1,-3);JSM.AddVertexToBody(e,1,3,1);JSM.AddVertexToBody(e,1,-3,-1);JSM.AddVertexToBody(e,-1,-3,1);JSM.AddVertexToBody(e,-1,3,-1);JSM.AddVertexToBody(e,3,1,1);JSM.AddVertexToBody(e,3,-1,-1);JSM.AddVertexToBody(e,-3,-1,1);JSM.AddVertexToBody(e,-3,1,-1);JSM.AddPolygonToBody(e,[0,8,4]);JSM.AddPolygonToBody(e,[1,9,5]);JSM.AddPolygonToBody(e,[2,10,6]);JSM.AddPolygonToBody(e,[3,11,7]);JSM.AddPolygonToBody(e,[0,2,6,5,9,8]);JSM.AddPolygonToBody(e,[0,4,7,11,10,2]);JSM.AddPolygonToBody(e,[1,3,7,4,8,9]);JSM.AddPolygonToBody(e,[1,5,6,10,11,3]);return e};JSM.GenerateCuboctahedron=function(){var e=new JSM.Body;JSM.AddVertexToBody(e,1,1,0);JSM.AddVertexToBody(e,1,-1,0);JSM.AddVertexToBody(e,-1,-1,0);JSM.AddVertexToBody(e,-1,1,0);JSM.AddVertexToBody(e,1,0,1);JSM.AddVertexToBody(e,1,0,-1);JSM.AddVertexToBody(e,-1,0,1);JSM.AddVertexToBody(e,-1,0,-1);JSM.AddVertexToBody(e,0,1,1);JSM.AddVertexToBody(e,0,-1,-1);JSM.AddVertexToBody(e,0,-1,1);JSM.AddVertexToBody(e,0,1,-1);JSM.AddPolygonToBody(e,[0,5,11]);JSM.AddPolygonToBody(e,[0,8,4]);JSM.AddPolygonToBody(e,[1,4,10]);JSM.AddPolygonToBody(e,[1,9,5]);JSM.AddPolygonToBody(e,[2,7,9]);JSM.AddPolygonToBody(e,[2,10,6]);JSM.AddPolygonToBody(e,[3,6,8]);JSM.AddPolygonToBody(e,[3,11,7]);JSM.AddPolygonToBody(e,[0,4,1,5]);JSM.AddPolygonToBody(e,[0,11,3,8]);JSM.AddPolygonToBody(e,[1,10,2,9]);JSM.AddPolygonToBody(e,[2,6,3,7]);JSM.AddPolygonToBody(e,[4,8,6,10]);JSM.AddPolygonToBody(e,[5,9,7,11]);return e};JSM.GenerateTruncatedCube=function(){var e=new JSM.Body,t=Math.sqrt(2)-1;JSM.AddVertexToBody(e,1,1,+t);JSM.AddVertexToBody(e,1,1,-t);JSM.AddVertexToBody(e,1,-1,+t);JSM.AddVertexToBody(e,-1,1,+t);JSM.AddVertexToBody(e,1,-1,-t);JSM.AddVertexToBody(e,-1,1,-t);JSM.AddVertexToBody(e,-1,-1,+t);JSM.AddVertexToBody(e,-1,-1,-t);JSM.AddVertexToBody(e,1,+t,1);JSM.AddVertexToBody(e,1,+t,-1);JSM.AddVertexToBody(e,1,-t,1);JSM.AddVertexToBody(e,-1,+t,1);JSM.AddVertexToBody(e,1,-t,-1);JSM.AddVertexToBody(e,-1,+t,-1);JSM.AddVertexToBody(e,-1,-t,1);JSM.AddVertexToBody(e,-1,-t,-1);JSM.AddVertexToBody(e,+t,1,1);JSM.AddVertexToBody(e,+t,1,-1);JSM.AddVertexToBody(e,+t,-1,1);JSM.AddVertexToBody(e,-t,1,1);JSM.AddVertexToBody(e,+t,-1,-1);JSM.AddVertexToBody(e,-t,1,-1);JSM.AddVertexToBody(e,-t,-1,1);JSM.AddVertexToBody(e,-t,-1,-1);JSM.AddPolygonToBody(e,[0,16,8]);JSM.AddPolygonToBody(e,[1,9,17]);JSM.AddPolygonToBody(e,[2,10,18]);JSM.AddPolygonToBody(e,[3,11,19]);JSM.AddPolygonToBody(e,[4,20,12]);JSM.AddPolygonToBody(e,[5,21,13]);JSM.AddPolygonToBody(e,[6,22,14]);JSM.AddPolygonToBody(e,[7,15,23]);JSM.AddPolygonToBody(e,[0,1,17,21,5,3,19,16]);JSM.AddPolygonToBody(e,[0,8,10,2,4,12,9,1]);JSM.AddPolygonToBody(e,[2,18,22,6,7,23,20,4]);JSM.AddPolygonToBody(e,[3,5,13,15,7,6,14,11]);JSM.AddPolygonToBody(e,[8,16,19,11,14,22,18,10]);JSM.AddPolygonToBody(e,[9,12,20,23,15,13,21,17]);return e};JSM.GenerateTruncatedOctahedron=function(){var e=new JSM.Body;JSM.AddVertexToBody(e,0,1,2);JSM.AddVertexToBody(e,0,1,-2);JSM.AddVertexToBody(e,0,-1,2);JSM.AddVertexToBody(e,0,-1,-2);JSM.AddVertexToBody(e,0,2,1);JSM.AddVertexToBody(e,0,-2,1);JSM.AddVertexToBody(e,0,2,-1);JSM.AddVertexToBody(e,0,-2,-1);JSM.AddVertexToBody(e,1,0,2);JSM.AddVertexToBody(e,1,0,-2);JSM.AddVertexToBody(e,-1,0,2);JSM.AddVertexToBody(e,-1,0,-2);JSM.AddVertexToBody(e,1,2,0);JSM.AddVertexToBody(e,1,-2,0);JSM.AddVertexToBody(e,-1,2,0);JSM.AddVertexToBody(e,-1,-2,0);JSM.AddVertexToBody(e,2,0,1);JSM.AddVertexToBody(e,-2,0,1);JSM.AddVertexToBody(e,2,0,-1);JSM.AddVertexToBody(e,-2,0,-1);JSM.AddVertexToBody(e,2,1,0);JSM.AddVertexToBody(e,-2,1,0);JSM.AddVertexToBody(e,2,-1,0);JSM.AddVertexToBody(e,-2,-1,0);JSM.AddPolygonToBody(e,[0,10,2,8]);JSM.AddPolygonToBody(e,[1,9,3,11]);JSM.AddPolygonToBody(e,[4,12,6,14]);JSM.AddPolygonToBody(e,[5,15,7,13]);JSM.AddPolygonToBody(e,[16,22,18,20]);JSM.AddPolygonToBody(e,[17,21,19,23]);JSM.AddPolygonToBody(e,[0,4,14,21,17,10]);JSM.AddPolygonToBody(e,[0,8,16,20,12,4]);JSM.AddPolygonToBody(e,[1,6,12,20,18,9]);JSM.AddPolygonToBody(e,[1,11,19,21,14,6]);JSM.AddPolygonToBody(e,[2,5,13,22,16,8]);JSM.AddPolygonToBody(e,[2,10,17,23,15,5]);JSM.AddPolygonToBody(e,[3,7,15,23,19,11]);JSM.AddPolygonToBody(e,[3,9,18,22,13,7]);return e};JSM.GenerateRhombicuboctahedron=function(){var e=new JSM.Body,t=1+Math.sqrt(2);JSM.AddVertexToBody(e,1,1,+t);JSM.AddVertexToBody(e,1,1,-t);JSM.AddVertexToBody(e,1,-1,+t);JSM.AddVertexToBody(e,-1,1,+t);JSM.AddVertexToBody(e,1,-1,-t);JSM.AddVertexToBody(e,-1,1,-t);JSM.AddVertexToBody(e,-1,-1,+t);JSM.AddVertexToBody(e,-1,-1,-t);JSM.AddVertexToBody(e,1,+t,1);JSM.AddVertexToBody(e,1,+t,-1);JSM.AddVertexToBody(e,1,-t,1);JSM.AddVertexToBody(e,-1,+t,1);JSM.AddVertexToBody(e,1,-t,-1);JSM.AddVertexToBody(e,-1,+t,-1);JSM.AddVertexToBody(e,-1,-t,1);JSM.AddVertexToBody(e,-1,-t,-1);JSM.AddVertexToBody(e,+t,1,1);JSM.AddVertexToBody(e,+t,1,-1);JSM.AddVertexToBody(e,+t,-1,1);JSM.AddVertexToBody(e,-t,1,1);JSM.AddVertexToBody(e,+t,-1,-1);JSM.AddVertexToBody(e,-t,1,-1);JSM.AddVertexToBody(e,-t,-1,1);JSM.AddVertexToBody(e,-t,-1,-1);JSM.AddPolygonToBody(e,[0,16,8]);JSM.AddPolygonToBody(e,[1,9,17]);JSM.AddPolygonToBody(e,[2,10,18]);JSM.AddPolygonToBody(e,[3,11,19]);JSM.AddPolygonToBody(e,[4,20,12]);JSM.AddPolygonToBody(e,[5,21,13]);JSM.AddPolygonToBody(e,[6,22,14]);JSM.AddPolygonToBody(e,[7,15,23]);JSM.AddPolygonToBody(e,[0,2,18,16]);JSM.AddPolygonToBody(e,[0,3,6,2]);JSM.AddPolygonToBody(e,[0,8,11,3]);JSM.AddPolygonToBody(e,[1,4,7,5]);JSM.AddPolygonToBody(e,[1,5,13,9]);JSM.AddPolygonToBody(e,[1,17,20,4]);JSM.AddPolygonToBody(e,[2,6,14,10]);JSM.AddPolygonToBody(e,[3,19,22,6]);JSM.AddPolygonToBody(e,[4,12,15,7]);JSM.AddPolygonToBody(e,[5,7,23,21]);JSM.AddPolygonToBody(e,[8,9,13,11]);JSM.AddPolygonToBody(e,[8,16,17,9]);JSM.AddPolygonToBody(e,[10,12,20,18]);JSM.AddPolygonToBody(e,[10,14,15,12]);JSM.AddPolygonToBody(e,[11,13,21,19]);JSM.AddPolygonToBody(e,[14,22,23,15]);JSM.AddPolygonToBody(e,[16,18,20,17]);JSM.AddPolygonToBody(e,[19,21,23,22]);return e};JSM.GenerateTruncatedCuboctahedron=function(){var e=new JSM.Body,t=1+Math.sqrt(2),n=1+2*Math.sqrt(2);JSM.AddVertexToBody(e,1,+t,+n);JSM.AddVertexToBody(e,1,+t,-n);JSM.AddVertexToBody(e,1,-t,+n);JSM.AddVertexToBody(e,-1,+t,+n);JSM.AddVertexToBody(e,1,-t,-n);JSM.AddVertexToBody(e,-1,+t,-n);JSM.AddVertexToBody(e,-1,-t,+n);JSM.AddVertexToBody(e,-1,-t,-n);JSM.AddVertexToBody(e,1,+n,+t);JSM.AddVertexToBody(e,1,-n,+t);JSM.AddVertexToBody(e,1,+n,-t);JSM.AddVertexToBody(e,-1,+n,+t);JSM.AddVertexToBody(e,1,-n,-t);JSM.AddVertexToBody(e,-1,-n,+t);JSM.AddVertexToBody(e,-1,+n,-t);JSM.AddVertexToBody(e,-1,-n,-t);JSM.AddVertexToBody(e,+t,1,+n);JSM.AddVertexToBody(e,+t,1,-n);JSM.AddVertexToBody(e,-t,1,+n);JSM.AddVertexToBody(e,+t,-1,+n);JSM.AddVertexToBody(e,-t,1,-n);JSM.AddVertexToBody(e,+t,-1,-n);JSM.AddVertexToBody(e,-t,-1,+n);JSM.AddVertexToBody(e,-t,-1,-n);JSM.AddVertexToBody(e,+t,+n,1);JSM.AddVertexToBody(e,+t,-n,1);JSM.AddVertexToBody(e,-t,+n,1);JSM.AddVertexToBody(e,+t,+n,-1);JSM.AddVertexToBody(e,-t,-n,1);JSM.AddVertexToBody(e,+t,-n,-1);JSM.AddVertexToBody(e,-t,+n,-1);JSM.AddVertexToBody(e,-t,-n,-1);JSM.AddVertexToBody(e,+n,1,+t);JSM.AddVertexToBody(e,-n,1,+t);JSM.AddVertexToBody(e,+n,1,-t);JSM.AddVertexToBody(e,+n,-1,+t);JSM.AddVertexToBody(e,-n,1,-t);JSM.AddVertexToBody(e,-n,-1,+t);JSM.AddVertexToBody(e,+n,-1,-t);JSM.AddVertexToBody(e,-n,-1,-t);JSM.AddVertexToBody(e,+n,+t,1);JSM.AddVertexToBody(e,-n,+t,1);JSM.AddVertexToBody(e,+n,-t,1);JSM.AddVertexToBody(e,+n,+t,-1);JSM.AddVertexToBody(e,-n,-t,1);JSM.AddVertexToBody(e,-n,+t,-1);JSM.AddVertexToBody(e,+n,-t,-1);JSM.AddVertexToBody(e,-n,-t,-1);JSM.AddPolygonToBody(e,[0,8,11,3]);JSM.AddPolygonToBody(e,[1,5,14,10]);JSM.AddPolygonToBody(e,[2,6,13,9]);JSM.AddPolygonToBody(e,[4,12,15,7]);JSM.AddPolygonToBody(e,[16,19,35,32]);JSM.AddPolygonToBody(e,[17,34,38,21]);JSM.AddPolygonToBody(e,[18,33,37,22]);JSM.AddPolygonToBody(e,[23,39,36,20]);JSM.AddPolygonToBody(e,[24,40,43,27]);JSM.AddPolygonToBody(e,[25,29,46,42]);JSM.AddPolygonToBody(e,[26,30,45,41]);JSM.AddPolygonToBody(e,[28,44,47,31]);JSM.AddPolygonToBody(e,[0,16,32,40,24,8]);JSM.AddPolygonToBody(e,[1,10,27,43,34,17]);JSM.AddPolygonToBody(e,[2,9,25,42,35,19]);JSM.AddPolygonToBody(e,[3,11,26,41,33,18]);JSM.AddPolygonToBody(e,[4,21,38,46,29,12]);JSM.AddPolygonToBody(e,[5,20,36,45,30,14]);JSM.AddPolygonToBody(e,[6,22,37,44,28,13]);JSM.AddPolygonToBody(e,[7,15,31,47,39,23]);JSM.AddPolygonToBody(e,[0,3,18,22,6,2,19,16]);JSM.AddPolygonToBody(e,[1,17,21,4,7,23,20,5]);JSM.AddPolygonToBody(e,[8,24,27,10,14,30,26,11]);JSM.AddPolygonToBody(e,[9,13,28,31,15,12,29,25]);JSM.AddPolygonToBody(e,[32,35,42,46,38,34,43,40]);JSM.AddPolygonToBody(e,[33,41,45,36,39,47,44,37]);return e};JSM.GenerateSnubCube=function(){var e=new JSM.Body,t=1/3*(Math.pow(17+3*Math.sqrt(33),1/3)-Math.pow(-17+3*Math.sqrt(33),1/3)-1),n=1/t;JSM.AddVertexToBody(e,1,+t,-n);JSM.AddVertexToBody(e,1,-t,+n);JSM.AddVertexToBody(e,-1,+t,+n);JSM.AddVertexToBody(e,-1,-t,-n);JSM.AddVertexToBody(e,+t,-n,1);JSM.AddVertexToBody(e,-t,+n,1);JSM.AddVertexToBody(e,+t,+n,-1);JSM.AddVertexToBody(e,-t,-n,-1);JSM.AddVertexToBody(e,-n,1,+t);JSM.AddVertexToBody(e,+n,1,-t);JSM.AddVertexToBody(e,+n,-1,+t);JSM.AddVertexToBody(e,-n,-1,-t);JSM.AddVertexToBody(e,1,+n,+t);JSM.AddVertexToBody(e,1,-n,-t);JSM.AddVertexToBody(e,-1,+n,-t);JSM.AddVertexToBody(e,-1,-n,+t);JSM.AddVertexToBody(e,+t,1,+n);JSM.AddVertexToBody(e,-t,1,-n);JSM.AddVertexToBody(e,-t,-1,+n);JSM.AddVertexToBody(e,+t,-1,-n);JSM.AddVertexToBody(e,+n,+t,1);JSM.AddVertexToBody(e,-n,-t,1);JSM.AddVertexToBody(e,+n,-t,-1);JSM.AddVertexToBody(e,-n,+t,-1);JSM.AddPolygonToBody(e,[0,6,9]);JSM.AddPolygonToBody(e,[0,9,22]);JSM.AddPolygonToBody(e,[0,17,6]);JSM.AddPolygonToBody(e,[0,22,19]);JSM.AddPolygonToBody(e,[1,4,10]);JSM.AddPolygonToBody(e,[1,10,20]);JSM.AddPolygonToBody(e,[1,18,4]);JSM.AddPolygonToBody(e,[1,20,16]);JSM.AddPolygonToBody(e,[2,5,8]);JSM.AddPolygonToBody(e,[2,8,21]);JSM.AddPolygonToBody(e,[2,16,5]);JSM.AddPolygonToBody(e,[2,21,18]);JSM.AddPolygonToBody(e,[3,7,11]);JSM.AddPolygonToBody(e,[3,11,23]);JSM.AddPolygonToBody(e,[3,19,7]);JSM.AddPolygonToBody(e,[3,23,17]);JSM.AddPolygonToBody(e,[4,13,10]);JSM.AddPolygonToBody(e,[4,18,15]);JSM.AddPolygonToBody(e,[5,14,8]);JSM.AddPolygonToBody(e,[5,16,12]);JSM.AddPolygonToBody(e,[6,12,9]);JSM.AddPolygonToBody(e,[6,17,14]);JSM.AddPolygonToBody(e,[7,15,11]);JSM.AddPolygonToBody(e,[7,19,13]);JSM.AddPolygonToBody(e,[8,14,23]);JSM.AddPolygonToBody(e,[9,12,20]);JSM.AddPolygonToBody(e,[10,13,22]);JSM.AddPolygonToBody(e,[11,15,21]);JSM.AddPolygonToBody(e,[12,16,20]);JSM.AddPolygonToBody(e,[13,19,22]);JSM.AddPolygonToBody(e,[14,17,23]);JSM.AddPolygonToBody(e,[15,18,21]);JSM.AddPolygonToBody(e,[0,19,3,17]);JSM.AddPolygonToBody(e,[1,16,2,18]);JSM.AddPolygonToBody(e,[4,15,7,13]);JSM.AddPolygonToBody(e,[5,12,6,14]);JSM.AddPolygonToBody(e,[8,23,11,21]);JSM.AddPolygonToBody(e,[9,20,10,22]);return e};JSM.GenerateIcosidodecahedron=function(){var e=new JSM.Body,t=(1+Math.sqrt(5))/2,n=t/2,r=(1+t)/2;JSM.AddVertexToBody(e,0,0,+t);JSM.AddVertexToBody(e,0,0,-t);JSM.AddVertexToBody(e,0,+t,0);JSM.AddVertexToBody(e,0,-t,0);JSM.AddVertexToBody(e,+t,0,0);JSM.AddVertexToBody(e,-t,0,0);JSM.AddVertexToBody(e,.5,+n,+r);JSM.AddVertexToBody(e,.5,+n,-r);JSM.AddVertexToBody(e,.5,-n,+r);JSM.AddVertexToBody(e,-.5,+n,+r);JSM.AddVertexToBody(e,.5,-n,-r);JSM.AddVertexToBody(e,-.5,+n,-r);JSM.AddVertexToBody(e,-.5,-n,+r);JSM.AddVertexToBody(e,-.5,-n,-r);JSM.AddVertexToBody(e,+n,+r,.5);JSM.AddVertexToBody(e,+n,-r,.5);JSM.AddVertexToBody(e,-n,+r,.5);JSM.AddVertexToBody(e,+n,+r,-.5);JSM.AddVertexToBody(e,-n,-r,.5);JSM.AddVertexToBody(e,+n,-r,-.5);JSM.AddVertexToBody(e,-n,+r,-.5);JSM.AddVertexToBody(e,-n,-r,-.5);JSM.AddVertexToBody(e,+r,.5,+n);JSM.AddVertexToBody(e,-r,.5,+n);JSM.AddVertexToBody(e,+r,.5,-n);JSM.AddVertexToBody(e,+r,-.5,+n);JSM.AddVertexToBody(e,-r,.5,-n);JSM.AddVertexToBody(e,-r,-.5,+n);JSM.AddVertexToBody(e,+r,-.5,-n);JSM.AddVertexToBody(e,-r,-.5,-n);JSM.AddPolygonToBody(e,[0,6,9]);JSM.AddPolygonToBody(e,[0,12,8]);JSM.AddPolygonToBody(e,[1,10,13]);JSM.AddPolygonToBody(e,[1,11,7]);JSM.AddPolygonToBody(e,[2,14,17]);JSM.AddPolygonToBody(e,[2,20,16]);JSM.AddPolygonToBody(e,[3,18,21]);JSM.AddPolygonToBody(e,[3,19,15]);JSM.AddPolygonToBody(e,[4,22,25]);JSM.AddPolygonToBody(e,[4,28,24]);JSM.AddPolygonToBody(e,[5,26,29]);JSM.AddPolygonToBody(e,[5,27,23]);JSM.AddPolygonToBody(e,[6,22,14]);JSM.AddPolygonToBody(e,[7,17,24]);JSM.AddPolygonToBody(e,[8,15,25]);JSM.AddPolygonToBody(e,[9,16,23]);JSM.AddPolygonToBody(e,[10,28,19]);JSM.AddPolygonToBody(e,[11,26,20]);JSM.AddPolygonToBody(e,[12,27,18]);JSM.AddPolygonToBody(e,[13,21,29]);JSM.AddPolygonToBody(e,[0,8,25,22,6]);JSM.AddPolygonToBody(e,[0,9,23,27,12]);JSM.AddPolygonToBody(e,[1,7,24,28,10]);JSM.AddPolygonToBody(e,[1,13,29,26,11]);JSM.AddPolygonToBody(e,[2,16,9,6,14]);JSM.AddPolygonToBody(e,[2,17,7,11,20]);JSM.AddPolygonToBody(e,[3,15,8,12,18]);JSM.AddPolygonToBody(e,[3,21,13,10,19]);JSM.AddPolygonToBody(e,[4,24,17,14,22]);JSM.AddPolygonToBody(e,[4,25,15,19,28]);JSM.AddPolygonToBody(e,[5,23,16,20,26]);JSM.AddPolygonToBody(e,[5,29,21,18,27]);return e};JSM.GenerateTruncatedDodecahedron=function(){var e=new JSM.Body,t=(1+Math.sqrt(5))/2,n=1/t,r=2+t,i=2*t,s=Math.pow(t,2);JSM.AddVertexToBody(e,0,+n,+r);JSM.AddVertexToBody(e,0,+n,-r);JSM.AddVertexToBody(e,0,-n,+r);JSM.AddVertexToBody(e,0,-n,-r);JSM.AddVertexToBody(e,+r,0,+n);JSM.AddVertexToBody(e,-r,0,+n);JSM.AddVertexToBody(e,+r,0,-n);JSM.AddVertexToBody(e,-r,0,-n);JSM.AddVertexToBody(e,+n,+r,0);JSM.AddVertexToBody(e,+n,-r,0);JSM.AddVertexToBody(e,-n,+r,0);JSM.AddVertexToBody(e,-n,-r,0);JSM.AddVertexToBody(e,+n,+t,+i);JSM.AddVertexToBody(e,+n,+t,-i);JSM.AddVertexToBody(e,+n,-t,+i);JSM.AddVertexToBody(e,-n,+t,+i);JSM.AddVertexToBody(e,+n,-t,-i);JSM.AddVertexToBody(e,-n,+t,-i);JSM.AddVertexToBody(e,-n,-t,+i);JSM.AddVertexToBody(e,-n,-t,-i);JSM.AddVertexToBody(e,+i,+n,+t);JSM.AddVertexToBody(e,+i,+n,-t);JSM.AddVertexToBody(e,+i,-n,+t);JSM.AddVertexToBody(e,-i,+n,+t);JSM.AddVertexToBody(e,+i,-n,-t);JSM.AddVertexToBody(e,-i,+n,-t);JSM.AddVertexToBody(e,-i,-n,+t);JSM.AddVertexToBody(e,-i,-n,-t);JSM.AddVertexToBody(e,+t,+i,+n);JSM.AddVertexToBody(e,+t,+i,-n);JSM.AddVertexToBody(e,+t,-i,+n);JSM.AddVertexToBody(e,-t,+i,+n);JSM.AddVertexToBody(e,+t,-i,-n);JSM.AddVertexToBody(e,-t,+i,-n);JSM.AddVertexToBody(e,-t,-i,+n);JSM.AddVertexToBody(e,-t,-i,-n);JSM.AddVertexToBody(e,+t,2,+s);JSM.AddVertexToBody(e,+t,2,-s);JSM.AddVertexToBody(e,+t,-2,+s);JSM.AddVertexToBody(e,-t,2,+s);JSM.AddVertexToBody(e,+t,-2,-s);JSM.AddVertexToBody(e,-t,2,-s);JSM.AddVertexToBody(e,-t,-2,+s);JSM.AddVertexToBody(e,-t,-2,-s);JSM.AddVertexToBody(e,+s,+t,2);JSM.AddVertexToBody(e,+s,+t,-2);JSM.AddVertexToBody(e,+s,-t,2);JSM.AddVertexToBody(e,-s,+t,2);JSM.AddVertexToBody(e,+s,-t,-2);JSM.AddVertexToBody(e,-s,+t,-2);JSM.AddVertexToBody(e,-s,-t,2);JSM.AddVertexToBody(e,-s,-t,-2);JSM.AddVertexToBody(e,2,+s,+t);JSM.AddVertexToBody(e,2,+s,-t);JSM.AddVertexToBody(e,2,-s,+t);JSM.AddVertexToBody(e,-2,+s,+t);JSM.AddVertexToBody(e,2,-s,-t);JSM.AddVertexToBody(e,-2,+s,-t);JSM.AddVertexToBody(e,-2,-s,+t);JSM.AddVertexToBody(e,-2,-s,-t);JSM.AddPolygonToBody(e,[0,12,15]);JSM.AddPolygonToBody(e,[1,17,13]);JSM.AddPolygonToBody(e,[2,18,14]);JSM.AddPolygonToBody(e,[3,16,19]);JSM.AddPolygonToBody(e,[4,20,22]);JSM.AddPolygonToBody(e,[5,26,23]);JSM.AddPolygonToBody(e,[6,24,21]);JSM.AddPolygonToBody(e,[7,25,27]);JSM.AddPolygonToBody(e,[8,28,29]);JSM.AddPolygonToBody(e,[9,32,30]);JSM.AddPolygonToBody(e,[10,33,31]);JSM.AddPolygonToBody(e,[11,34,35]);JSM.AddPolygonToBody(e,[36,44,52]);JSM.AddPolygonToBody(e,[37,53,45]);JSM.AddPolygonToBody(e,[38,54,46]);JSM.AddPolygonToBody(e,[39,55,47]);JSM.AddPolygonToBody(e,[40,48,56]);JSM.AddPolygonToBody(e,[41,49,57]);JSM.AddPolygonToBody(e,[42,50,58]);JSM.AddPolygonToBody(e,[43,59,51]);JSM.AddPolygonToBody(e,[0,2,14,38,46,22,20,44,36,12]);JSM.AddPolygonToBody(e,[0,15,39,47,23,26,50,42,18,2]);JSM.AddPolygonToBody(e,[1,3,19,43,51,27,25,49,41,17]);JSM.AddPolygonToBody(e,[1,13,37,45,21,24,48,40,16,3]);JSM.AddPolygonToBody(e,[4,6,21,45,53,29,28,52,44,20]);JSM.AddPolygonToBody(e,[4,22,46,54,30,32,56,48,24,6]);JSM.AddPolygonToBody(e,[5,7,27,51,59,35,34,58,50,26]);JSM.AddPolygonToBody(e,[5,23,47,55,31,33,57,49,25,7]);JSM.AddPolygonToBody(e,[8,10,31,55,39,15,12,36,52,28]);JSM.AddPolygonToBody(e,[8,29,53,37,13,17,41,57,33,10]);JSM.AddPolygonToBody(e,[9,11,35,59,43,19,16,40,56,32]);JSM.AddPolygonToBody(e,[9,30,54,38,14,18,42,58,34,11]);return e};JSM.GenerateTruncatedIcosahedron=function(){var e=new JSM.Body,t=(1+Math.sqrt(5))/2,n=3*t,r=1+2*t,i=2+t,s=2*t;JSM.AddVertexToBody(e,0,1,+n);JSM.AddVertexToBody(e,0,1,-n);JSM.AddVertexToBody(e,0,-1,+n);JSM.AddVertexToBody(e,0,-1,-n);JSM.AddVertexToBody(e,1,+n,0);JSM.AddVertexToBody(e,1,-n,0);JSM.AddVertexToBody(e,-1,+n,0);JSM.AddVertexToBody(e,-1,-n,0);JSM.AddVertexToBody(e,+n,0,1);JSM.AddVertexToBody(e,-n,0,1);JSM.AddVertexToBody(e,+n,0,-1);JSM.AddVertexToBody(e,-n,0,-1);JSM.AddVertexToBody(e,2,+r,+t);JSM.AddVertexToBody(e,2,+r,-t);JSM.AddVertexToBody(e,2,-r,+t);JSM.AddVertexToBody(e,-2,+r,+t);JSM.AddVertexToBody(e,2,-r,-t);JSM.AddVertexToBody(e,-2,+r,-t);JSM.AddVertexToBody(e,-2,-r,+t);JSM.AddVertexToBody(e,-2,-r,-t);JSM.AddVertexToBody(e,+r,+t,2);JSM.AddVertexToBody(e,+r,-t,2);JSM.AddVertexToBody(e,-r,+t,2);JSM.AddVertexToBody(e,+r,+t,-2);JSM.AddVertexToBody(e,-r,-t,2);JSM.AddVertexToBody(e,+r,-t,-2);JSM.AddVertexToBody(e,-r,+t,-2);JSM.AddVertexToBody(e,-r,-t,-2);JSM.AddVertexToBody(e,+t,2,+r);JSM.AddVertexToBody(e,-t,2,+r);JSM.AddVertexToBody(e,+t,2,-r);JSM.AddVertexToBody(e,+t,-2,+r);JSM.AddVertexToBody(e,-t,2,-r);JSM.AddVertexToBody(e,-t,-2,+r);JSM.AddVertexToBody(e,+t,-2,-r);JSM.AddVertexToBody(e,-t,-2,-r);JSM.AddVertexToBody(e,1,+i,+s);JSM.AddVertexToBody(e,1,+i,-s);JSM.AddVertexToBody(e,1,-i,+s);JSM.AddVertexToBody(e,-1,+i,+s);JSM.AddVertexToBody(e,1,-i,-s);JSM.AddVertexToBody(e,-1,+i,-s);JSM.AddVertexToBody(e,-1,-i,+s);JSM.AddVertexToBody(e,-1,-i,-s);JSM.AddVertexToBody(e,+i,+s,1);JSM.AddVertexToBody(e,+i,-s,1);JSM.AddVertexToBody(e,-i,+s,1);JSM.AddVertexToBody(e,+i,+s,-1);JSM.AddVertexToBody(e,-i,-s,1);JSM.AddVertexToBody(e,+i,-s,-1);JSM.AddVertexToBody(e,-i,+s,-1);JSM.AddVertexToBody(e,-i,-s,-1);JSM.AddVertexToBody(e,+s,1,+i);JSM.AddVertexToBody(e,-s,1,+i);JSM.AddVertexToBody(e,+s,1,-i);JSM.AddVertexToBody(e,+s,-1,+i);JSM.AddVertexToBody(e,-s,1,-i);JSM.AddVertexToBody(e,-s,-1,+i);JSM.AddVertexToBody(e,+s,-1,-i);JSM.AddVertexToBody(e,-s,-1,-i);JSM.AddPolygonToBody(e,[0,28,36,39,29]);JSM.AddPolygonToBody(e,[1,32,41,37,30]);JSM.AddPolygonToBody(e,[2,33,42,38,31]);JSM.AddPolygonToBody(e,[3,34,40,43,35]);JSM.AddPolygonToBody(e,[4,12,44,47,13]);JSM.AddPolygonToBody(e,[5,16,49,45,14]);JSM.AddPolygonToBody(e,[6,17,50,46,15]);JSM.AddPolygonToBody(e,[7,18,48,51,19]);JSM.AddPolygonToBody(e,[8,20,52,55,21]);JSM.AddPolygonToBody(e,[9,24,57,53,22]);JSM.AddPolygonToBody(e,[10,25,58,54,23]);JSM.AddPolygonToBody(e,[11,26,56,59,27]);JSM.AddPolygonToBody(e,[0,2,31,55,52,28]);JSM.AddPolygonToBody(e,[0,29,53,57,33,2]);JSM.AddPolygonToBody(e,[1,3,35,59,56,32]);JSM.AddPolygonToBody(e,[1,30,54,58,34,3]);JSM.AddPolygonToBody(e,[4,6,15,39,36,12]);JSM.AddPolygonToBody(e,[4,13,37,41,17,6]);JSM.AddPolygonToBody(e,[5,7,19,43,40,16]);JSM.AddPolygonToBody(e,[5,14,38,42,18,7]);JSM.AddPolygonToBody(e,[8,10,23,47,44,20]);JSM.AddPolygonToBody(e,[8,21,45,49,25,10]);JSM.AddPolygonToBody(e,[9,11,27,51,48,24]);JSM.AddPolygonToBody(e,[9,22,46,50,26,11]);JSM.AddPolygonToBody(e,[12,36,28,52,20,44]);JSM.AddPolygonToBody(e,[13,47,23,54,30,37]);JSM.AddPolygonToBody(e,[14,45,21,55,31,38]);JSM.AddPolygonToBody(e,[15,46,22,53,29,39]);JSM.AddPolygonToBody(e,[16,40,34,58,25,49]);JSM.AddPolygonToBody(e,[17,41,32,56,26,50]);JSM.AddPolygonToBody(e,[18,42,33,57,24,48]);JSM.AddPolygonToBody(e,[19,51,27,59,35,43]);return e};JSM.GenerateRhombicosidodecahedron=function(){var e=new JSM.Body,t=(1+Math.sqrt(5))/2,n=Math.pow(t,2),r=Math.pow(t,3),i=2*t,s=2+t;JSM.AddVertexToBody(e,1,1,+r);JSM.AddVertexToBody(e,1,1,-r);JSM.AddVertexToBody(e,1,-1,+r);JSM.AddVertexToBody(e,-1,1,+r);JSM.AddVertexToBody(e,1,-1,-r);JSM.AddVertexToBody(e,-1,1,-r);JSM.AddVertexToBody(e,-1,-1,+r);JSM.AddVertexToBody(e,-1,-1,-r);JSM.AddVertexToBody(e,+r,1,1);JSM.AddVertexToBody(e,+r,1,-1);JSM.AddVertexToBody(e,+r,-1,1);JSM.AddVertexToBody(e,-r,1,1);JSM.AddVertexToBody(e,+r,-1,-1);JSM.AddVertexToBody(e,-r,1,-1);JSM.AddVertexToBody(e,-r,-1,1);JSM.AddVertexToBody(e,-r,-1,-1);JSM.AddVertexToBody(e,1,+r,1);JSM.AddVertexToBody(e,1,+r,-1);JSM.AddVertexToBody(e,1,-r,1);JSM.AddVertexToBody(e,-1,+r,1);JSM.AddVertexToBody(e,1,-r,-1);JSM.AddVertexToBody(e,-1,+r,-1);JSM.AddVertexToBody(e,-1,-r,1);JSM.AddVertexToBody(e,-1,-r,-1);JSM.AddVertexToBody(e,+n,+t,+i);JSM.AddVertexToBody(e,+n,+t,-i);JSM.AddVertexToBody(e,+n,-t,+i);JSM.AddVertexToBody(e,-n,+t,+i);JSM.AddVertexToBody(e,+n,-t,-i);JSM.AddVertexToBody(e,-n,+t,-i);JSM.AddVertexToBody(e,-n,-t,+i);JSM.AddVertexToBody(e,-n,-t,-i);JSM.AddVertexToBody(e,+i,+n,+t);JSM.AddVertexToBody(e,+i,+n,-t);JSM.AddVertexToBody(e,+i,-n,+t);JSM.AddVertexToBody(e,-i,+n,+t);JSM.AddVertexToBody(e,+i,-n,-t);JSM.AddVertexToBody(e,-i,+n,-t);JSM.AddVertexToBody(e,-i,-n,+t);JSM.AddVertexToBody(e,-i,-n,-t);JSM.AddVertexToBody(e,+t,+i,+n);JSM.AddVertexToBody(e,+t,+i,-n);JSM.AddVertexToBody(e,+t,-i,+n);JSM.AddVertexToBody(e,-t,+i,+n);JSM.AddVertexToBody(e,+t,-i,-n);JSM.AddVertexToBody(e,-t,+i,-n);JSM.AddVertexToBody(e,-t,-i,+n);JSM.AddVertexToBody(e,-t,-i,-n);JSM.AddVertexToBody(e,+s,0,+n);JSM.AddVertexToBody(e,+s,0,-n);JSM.AddVertexToBody(e,-s,0,+n);JSM.AddVertexToBody(e,-s,0,-n);JSM.AddVertexToBody(e,+n,+s,0);JSM.AddVertexToBody(e,-n,+s,0);JSM.AddVertexToBody(e,+n,-s,0);JSM.AddVertexToBody(e,-n,-s,0);JSM.AddVertexToBody(e,0,+n,+s);JSM.AddVertexToBody(e,0,-n,+s);JSM.AddVertexToBody(e,0,+n,-s);JSM.AddVertexToBody(e,0,-n,-s);JSM.AddPolygonToBody(e,[0,56,3]);JSM.AddPolygonToBody(e,[1,5,58]);JSM.AddPolygonToBody(e,[2,6,57]);JSM.AddPolygonToBody(e,[4,59,7]);JSM.AddPolygonToBody(e,[8,48,10]);JSM.AddPolygonToBody(e,[9,12,49]);JSM.AddPolygonToBody(e,[11,14,50]);JSM.AddPolygonToBody(e,[13,51,15]);JSM.AddPolygonToBody(e,[16,52,17]);JSM.AddPolygonToBody(e,[18,20,54]);JSM.AddPolygonToBody(e,[19,21,53]);JSM.AddPolygonToBody(e,[22,55,23]);JSM.AddPolygonToBody(e,[24,32,40]);JSM.AddPolygonToBody(e,[25,41,33]);JSM.AddPolygonToBody(e,[26,42,34]);JSM.AddPolygonToBody(e,[27,43,35]);JSM.AddPolygonToBody(e,[28,36,44]);JSM.AddPolygonToBody(e,[29,37,45]);JSM.AddPolygonToBody(e,[30,38,46]);JSM.AddPolygonToBody(e,[31,47,39]);JSM.AddPolygonToBody(e,[0,3,6,2]);JSM.AddPolygonToBody(e,[0,24,40,56]);JSM.AddPolygonToBody(e,[1,4,7,5]);JSM.AddPolygonToBody(e,[1,58,41,25]);JSM.AddPolygonToBody(e,[2,57,42,26]);JSM.AddPolygonToBody(e,[3,56,43,27]);JSM.AddPolygonToBody(e,[4,28,44,59]);JSM.AddPolygonToBody(e,[5,29,45,58]);JSM.AddPolygonToBody(e,[6,30,46,57]);JSM.AddPolygonToBody(e,[7,59,47,31]);JSM.AddPolygonToBody(e,[8,10,12,9]);JSM.AddPolygonToBody(e,[8,32,24,48]);JSM.AddPolygonToBody(e,[9,49,25,33]);JSM.AddPolygonToBody(e,[10,48,26,34]);JSM.AddPolygonToBody(e,[11,13,15,14]);JSM.AddPolygonToBody(e,[11,50,27,35]);JSM.AddPolygonToBody(e,[12,36,28,49]);JSM.AddPolygonToBody(e,[13,37,29,51]);JSM.AddPolygonToBody(e,[14,38,30,50]);JSM.AddPolygonToBody(e,[15,51,31,39]);JSM.AddPolygonToBody(e,[16,17,21,19]);JSM.AddPolygonToBody(e,[16,40,32,52]);JSM.AddPolygonToBody(e,[17,52,33,41]);JSM.AddPolygonToBody(e,[18,22,23,20]);JSM.AddPolygonToBody(e,[18,54,34,42]);JSM.AddPolygonToBody(e,[19,53,35,43]);JSM.AddPolygonToBody(e,[20,44,36,54]);JSM.AddPolygonToBody(e,[21,45,37,53]);JSM.AddPolygonToBody(e,[22,46,38,55]);JSM.AddPolygonToBody(e,[23,55,39,47]);JSM.AddPolygonToBody(e,[0,2,26,48,24]);JSM.AddPolygonToBody(e,[1,25,49,28,4]);JSM.AddPolygonToBody(e,[3,27,50,30,6]);JSM.AddPolygonToBody(e,[5,7,31,51,29]);JSM.AddPolygonToBody(e,[8,9,33,52,32]);JSM.AddPolygonToBody(e,[10,34,54,36,12]);JSM.AddPolygonToBody(e,[11,35,53,37,13]);JSM.AddPolygonToBody(e,[14,15,39,55,38]);JSM.AddPolygonToBody(e,[16,19,43,56,40]);JSM.AddPolygonToBody(e,[17,41,58,45,21]);JSM.AddPolygonToBody(e,[18,42,57,46,22]);JSM.AddPolygonToBody(e,[20,23,47,59,44]);return e};JSM.GenerateTruncatedIcosidodecahedron=function(){var e=new JSM.Body,t=(1+Math.sqrt(5))/2,n=1/t,r=3+t,i=2/t,s=1+2*t,o=Math.pow(t,2),u=-1+3*t,a=-1+2*t,f=2+t,l=2*t;JSM.AddVertexToBody(e,+n,+n,+r);JSM.AddVertexToBody(e,+n,+n,-r);JSM.AddVertexToBody(e,+n,-n,+r);JSM.AddVertexToBody(e,-n,+n,+r);JSM.AddVertexToBody(e,+n,-n,-r);JSM.AddVertexToBody(e,-n,+n,-r);JSM.AddVertexToBody(e,-n,-n,+r);JSM.AddVertexToBody(e,-n,-n,-r);JSM.AddVertexToBody(e,+n,+r,+n);JSM.AddVertexToBody(e,+n,-r,+n);JSM.AddVertexToBody(e,-n,+r,+n);JSM.AddVertexToBody(e,+n,+r,-n);JSM.AddVertexToBody(e,-n,-r,+n);JSM.AddVertexToBody(e,+n,-r,-n);JSM.AddVertexToBody(e,-n,+r,-n);JSM.AddVertexToBody(e,-n,-r,-n);JSM.AddVertexToBody(e,+r,+n,+n);JSM.AddVertexToBody(e,-r,+n,+n);JSM.AddVertexToBody(e,+r,+n,-n);JSM.AddVertexToBody(e,+r,-n,+n);JSM.AddVertexToBody(e,-r,+n,-n);JSM.AddVertexToBody(e,-r,-n,+n);JSM.AddVertexToBody(e,+r,-n,-n);JSM.AddVertexToBody(e,-r,-n,-n);JSM.AddVertexToBody(e,+i,+t,+s);JSM.AddVertexToBody(e,+i,+t,-s);JSM.AddVertexToBody(e,+i,-t,+s);JSM.AddVertexToBody(e,-i,+t,+s);JSM.AddVertexToBody(e,+i,-t,-s);JSM.AddVertexToBody(e,-i,+t,-s);JSM.AddVertexToBody(e,-i,-t,+s);JSM.AddVertexToBody(e,-i,-t,-s);JSM.AddVertexToBody(e,+t,+s,+i);JSM.AddVertexToBody(e,+t,-s,+i);JSM.AddVertexToBody(e,-t,+s,+i);JSM.AddVertexToBody(e,+t,+s,-i);JSM.AddVertexToBody(e,-t,-s,+i);JSM.AddVertexToBody(e,+t,-s,-i);JSM.AddVertexToBody(e,-t,+s,-i);JSM.AddVertexToBody(e,-t,-s,-i);JSM.AddVertexToBody(e,+s,+i,+t);JSM.AddVertexToBody(e,-s,+i,+t);JSM.AddVertexToBody(e,+s,+i,-t);JSM.AddVertexToBody(e,+s,-i,+t);JSM.AddVertexToBody(e,-s,+i,-t);JSM.AddVertexToBody(e,-s,-i,+t);JSM.AddVertexToBody(e,+s,-i,-t);JSM.AddVertexToBody(e,-s,-i,-t);JSM.AddVertexToBody(e,+n,+o,+u);JSM.AddVertexToBody(e,+n,+o,-u);JSM.AddVertexToBody(e,+n,-o,+u);JSM.AddVertexToBody(e,-n,+o,+u);JSM.AddVertexToBody(e,+n,-o,-u);JSM.AddVertexToBody(e,-n,+o,-u);JSM.AddVertexToBody(e,-n,-o,+u);JSM.AddVertexToBody(e,-n,-o,-u);JSM.AddVertexToBody(e,+o,+u,+n);JSM.AddVertexToBody(e,+o,-u,+n);JSM.AddVertexToBody(e,-o,+u,+n);JSM.AddVertexToBody(e,+o,+u,-n);JSM.AddVertexToBody(e,-o,-u,+n);JSM.AddVertexToBody(e,+o,-u,-n);JSM.AddVertexToBody(e,-o,+u,-n);JSM.AddVertexToBody(e,-o,-u,-n);JSM.AddVertexToBody(e,+u,+n,+o);JSM.AddVertexToBody(e,-u,+n,+o);JSM.AddVertexToBody(e,+u,+n,-o);JSM.AddVertexToBody(e,+u,-n,+o);JSM.AddVertexToBody(e,-u,+n,-o);JSM.AddVertexToBody(e,-u,-n,+o);JSM.AddVertexToBody(e,+u,-n,-o);JSM.AddVertexToBody(e,-u,-n,-o);JSM.AddVertexToBody(e,+a,2,+f);JSM.AddVertexToBody(e,+a,2,-f);JSM.AddVertexToBody(e,+a,-2,+f);JSM.AddVertexToBody(e,-a,2,+f);JSM.AddVertexToBody(e,+a,-2,-f);JSM.AddVertexToBody(e,-a,2,-f);JSM.AddVertexToBody(e,-a,-2,+f);JSM.AddVertexToBody(e,-a,-2,-f);JSM.AddVertexToBody(e,2,+f,+a);JSM.AddVertexToBody(e,2,-f,+a);JSM.AddVertexToBody(e,-2,+f,+a);JSM.AddVertexToBody(e,2,+f,-a);JSM.AddVertexToBody(e,-2,-f,+a);JSM.AddVertexToBody(e,2,-f,-a);JSM.AddVertexToBody(e,-2,+f,-a);JSM.AddVertexToBody(e,-2,-f,-a);JSM.AddVertexToBody(e,+f,+a,2);JSM.AddVertexToBody(e,-f,+a,2);JSM.AddVertexToBody(e,+f,+a,-2);JSM.AddVertexToBody(e,+f,-a,2);JSM.AddVertexToBody(e,-f,+a,-2);JSM.AddVertexToBody(e,-f,-a,2);JSM.AddVertexToBody(e,+f,-a,-2);JSM.AddVertexToBody(e,-f,-a,-2);JSM.AddVertexToBody(e,+t,3,+l);JSM.AddVertexToBody(e,+t,3,-l);JSM.AddVertexToBody(e,+t,-3,+l);JSM.AddVertexToBody(e,-t,3,+l);JSM.AddVertexToBody(e,+t,-3,-l);JSM.AddVertexToBody(e,-t,3,-l);JSM.AddVertexToBody(e,-t,-3,+l);JSM.AddVertexToBody(e,-t,-3,-l);JSM.AddVertexToBody(e,3,+l,+t);JSM.AddVertexToBody(e,3,-l,+t);JSM.AddVertexToBody(e,-3,+l,+t);JSM.AddVertexToBody(e,3,+l,-t);JSM.AddVertexToBody(e,-3,-l,+t);JSM.AddVertexToBody(e,3,-l,-t);JSM.AddVertexToBody(e,-3,+l,-t);JSM.AddVertexToBody(e,-3,-l,-t);JSM.AddVertexToBody(e,+l,+t,3);JSM.AddVertexToBody(e,-l,+t,3);JSM.AddVertexToBody(e,+l,+t,-3);JSM.AddVertexToBody(e,+l,-t,3);JSM.AddVertexToBody(e,-l,+t,-3);JSM.AddVertexToBody(e,-l,-t,3);JSM.AddVertexToBody(e,+l,-t,-3);JSM.AddVertexToBody(e,-l,-t,-3);JSM.AddPolygonToBody(e,[0,3,6,2]);JSM.AddPolygonToBody(e,[1,4,7,5]);JSM.AddPolygonToBody(e,[8,11,14,10]);JSM.AddPolygonToBody(e,[9,12,15,13]);JSM.AddPolygonToBody(e,[16,19,22,18]);JSM.AddPolygonToBody(e,[17,20,23,21]);JSM.AddPolygonToBody(e,[24,72,96,48]);JSM.AddPolygonToBody(e,[25,49,97,73]);JSM.AddPolygonToBody(e,[26,50,98,74]);JSM.AddPolygonToBody(e,[27,51,99,75]);JSM.AddPolygonToBody(e,[28,76,100,52]);JSM.AddPolygonToBody(e,[29,77,101,53]);JSM.AddPolygonToBody(e,[30,78,102,54]);JSM.AddPolygonToBody(e,[31,55,103,79]);JSM.AddPolygonToBody(e,[32,80,104,56]);JSM.AddPolygonToBody(e,[33,57,105,81]);JSM.AddPolygonToBody(e,[34,58,106,82]);JSM.AddPolygonToBody(e,[35,59,107,83]);JSM.AddPolygonToBody(e,[36,84,108,60]);JSM.AddPolygonToBody(e,[37,85,109,61]);JSM.AddPolygonToBody(e,[38,86,110,62]);JSM.AddPolygonToBody(e,[39,63,111,87]);JSM.AddPolygonToBody(e,[40,88,112,64]);JSM.AddPolygonToBody(e,[41,65,113,89]);JSM.AddPolygonToBody(e,[42,66,114,90]);JSM.AddPolygonToBody(e,[43,67,115,91]);JSM.AddPolygonToBody(e,[44,92,116,68]);JSM.AddPolygonToBody(e,[45,93,117,69]);JSM.AddPolygonToBody(e,[46,94,118,70]);JSM.AddPolygonToBody(e,[47,71,119,95]);JSM.AddPolygonToBody(e,[0,24,48,51,27,3]);JSM.AddPolygonToBody(e,[1,5,29,53,49,25]);JSM.AddPolygonToBody(e,[2,6,30,54,50,26]);JSM.AddPolygonToBody(e,[4,28,52,55,31,7]);JSM.AddPolygonToBody(e,[8,32,56,59,35,11]);JSM.AddPolygonToBody(e,[9,13,37,61,57,33]);JSM.AddPolygonToBody(e,[10,14,38,62,58,34]);JSM.AddPolygonToBody(e,[12,36,60,63,39,15]);JSM.AddPolygonToBody(e,[16,40,64,67,43,19]);JSM.AddPolygonToBody(e,[17,21,45,69,65,41]);JSM.AddPolygonToBody(e,[18,22,46,70,66,42]);JSM.AddPolygonToBody(e,[20,44,68,71,47,23]);JSM.AddPolygonToBody(e,[72,112,88,104,80,96]);JSM.AddPolygonToBody(e,[73,97,83,107,90,114]);JSM.AddPolygonToBody(e,[74,98,81,105,91,115]);JSM.AddPolygonToBody(e,[75,99,82,106,89,113]);JSM.AddPolygonToBody(e,[76,118,94,109,85,100]);JSM.AddPolygonToBody(e,[78,117,93,108,84,102]);JSM.AddPolygonToBody(e,[79,103,87,111,95,119]);JSM.AddPolygonToBody(e,[86,101,77,116,92,110]);JSM.AddPolygonToBody(e,[0,2,26,74,115,67,64,112,72,24]);JSM.AddPolygonToBody(e,[1,25,73,114,66,70,118,76,28,4]);JSM.AddPolygonToBody(e,[3,27,75,113,65,69,117,78,30,6]);JSM.AddPolygonToBody(e,[5,7,31,79,119,71,68,116,77,29]);JSM.AddPolygonToBody(e,[8,10,34,82,99,51,48,96,80,32]);JSM.AddPolygonToBody(e,[9,33,81,98,50,54,102,84,36,12]);JSM.AddPolygonToBody(e,[11,35,83,97,49,53,101,86,38,14]);JSM.AddPolygonToBody(e,[13,15,39,87,103,55,52,100,85,37]);JSM.AddPolygonToBody(e,[16,18,42,90,107,59,56,104,88,40]);JSM.AddPolygonToBody(e,[17,41,89,106,58,62,110,92,44,20]);JSM.AddPolygonToBody(e,[19,43,91,105,57,61,109,94,46,22]);JSM.AddPolygonToBody(e,[21,23,47,95,111,63,60,108,93,45]);return e};JSM.GenerateSnubDodecahedron=function(){var e=new JSM.Body,t=(1+Math.sqrt(5))/2,n=Math.pow(t/2+.5*Math.sqrt(t-5/27),1/3)+Math.pow(t/2-.5*Math.sqrt(t-5/27),1/3),r=n-1/n,i=n*t+Math.pow(t,2)+t/n,n=2*r,s=2*i,o=r+i/t+t,u=-(r*t)+i+1/t,a=r/t+i*t-1,f=-(r/t)+i*t+1,l=-r+i/t-t,c=r*t+i-1/t,h=-(r/t)+i*t-1,p=r-i/t-t,d=r*t+i+1/t,v=r+i/t-t,m=r*t-i+1/t,t=r/t+i*t+1;JSM.AddVertexToBody(e,+n,2,-s);JSM.AddVertexToBody(e,+n,-2,+s);JSM.AddVertexToBody(e,-n,2,+s);JSM.AddVertexToBody(e,-n,-2,-s);JSM.AddVertexToBody(e,2,-s,+n);JSM.AddVertexToBody(e,-2,+s,+n);JSM.AddVertexToBody(e,2,+s,-n);JSM.AddVertexToBody(e,-2,-s,-n);JSM.AddVertexToBody(e,-s,+n,2);JSM.AddVertexToBody(e,+s,+n,-2);JSM.AddVertexToBody(e,+s,-n,2);JSM.AddVertexToBody(e,-s,-n,-2);JSM.AddVertexToBody(e,+o,+u,-a);JSM.AddVertexToBody(e,+o,-u,+a);JSM.AddVertexToBody(e,-o,+u,+a);JSM.AddVertexToBody(e,-o,-u,-a);JSM.AddVertexToBody(e,+u,-a,+o);JSM.AddVertexToBody(e,-u,+a,+o);JSM.AddVertexToBody(e,+u,+a,-o);JSM.AddVertexToBody(e,-u,-a,-o);JSM.AddVertexToBody(e,-a,+o,+u);JSM.AddVertexToBody(e,+a,+o,-u);JSM.AddVertexToBody(e,+a,-o,+u);JSM.AddVertexToBody(e,-a,-o,-u);JSM.AddVertexToBody(e,+f,+l,-c);JSM.AddVertexToBody(e,+f,-l,+c);JSM.AddVertexToBody(e,-f,+l,+c);JSM.AddVertexToBody(e,-f,-l,-c);JSM.AddVertexToBody(e,+l,-c,+f);JSM.AddVertexToBody(e,-l,+c,+f);JSM.AddVertexToBody(e,+l,+c,-f);JSM.AddVertexToBody(e,-l,-c,-f);JSM.AddVertexToBody(e,-c,+f,+l);JSM.AddVertexToBody(e,+c,+f,-l);JSM.AddVertexToBody(e,+c,-f,+l);JSM.AddVertexToBody(e,-c,-f,-l);JSM.AddVertexToBody(e,+h,+p,-d);JSM.AddVertexToBody(e,+h,-p,+d);JSM.AddVertexToBody(e,-h,+p,+d);JSM.AddVertexToBody(e,-h,-p,-d);JSM.AddVertexToBody(e,+p,-d,+h);JSM.AddVertexToBody(e,-p,+d,+h);JSM.AddVertexToBody(e,+p,+d,-h);JSM.AddVertexToBody(e,-p,-d,-h);JSM.AddVertexToBody(e,-d,+h,+p);JSM.AddVertexToBody(e,+d,+h,-p);JSM.AddVertexToBody(e,+d,-h,+p);JSM.AddVertexToBody(e,-d,-h,-p);JSM.AddVertexToBody(e,+v,+m,-t);JSM.AddVertexToBody(e,+v,-m,+t);JSM.AddVertexToBody(e,-v,+m,+t);JSM.AddVertexToBody(e,-v,-m,-t);JSM.AddVertexToBody(e,+m,-t,+v);JSM.AddVertexToBody(e,-m,+t,+v);JSM.AddVertexToBody(e,+m,+t,-v);JSM.AddVertexToBody(e,-m,-t,-v);JSM.AddVertexToBody(e,-t,+v,+m);JSM.AddVertexToBody(e,+t,+v,-m);JSM.AddVertexToBody(e,+t,-v,+m);JSM.AddVertexToBody(e,-t,-v,-m);JSM.AddPolygonToBody(e,[0,3,51]);JSM.AddPolygonToBody(e,[0,30,12]);JSM.AddPolygonToBody(e,[0,48,3]);JSM.AddPolygonToBody(e,[0,51,30]);JSM.AddPolygonToBody(e,[1,2,50]);JSM.AddPolygonToBody(e,[1,28,13]);JSM.AddPolygonToBody(e,[1,49,2]);JSM.AddPolygonToBody(e,[1,50,28]);JSM.AddPolygonToBody(e,[2,29,14]);JSM.AddPolygonToBody(e,[2,49,29]);JSM.AddPolygonToBody(e,[3,31,15]);JSM.AddPolygonToBody(e,[3,48,31]);JSM.AddPolygonToBody(e,[4,7,55]);JSM.AddPolygonToBody(e,[4,34,16]);JSM.AddPolygonToBody(e,[4,52,7]);JSM.AddPolygonToBody(e,[4,55,34]);JSM.AddPolygonToBody(e,[5,6,54]);JSM.AddPolygonToBody(e,[5,32,17]);JSM.AddPolygonToBody(e,[5,53,6]);JSM.AddPolygonToBody(e,[5,54,32]);JSM.AddPolygonToBody(e,[6,33,18]);JSM.AddPolygonToBody(e,[6,53,33]);JSM.AddPolygonToBody(e,[7,35,19]);JSM.AddPolygonToBody(e,[7,52,35]);JSM.AddPolygonToBody(e,[8,11,59]);JSM.AddPolygonToBody(e,[8,26,20]);JSM.AddPolygonToBody(e,[8,56,11]);JSM.AddPolygonToBody(e,[8,59,26]);JSM.AddPolygonToBody(e,[9,10,58]);JSM.AddPolygonToBody(e,[9,24,21]);JSM.AddPolygonToBody(e,[9,57,10]);JSM.AddPolygonToBody(e,[9,58,24]);JSM.AddPolygonToBody(e,[10,25,22]);JSM.AddPolygonToBody(e,[10,57,25]);JSM.AddPolygonToBody(e,[11,27,23]);JSM.AddPolygonToBody(e,[11,56,27]);JSM.AddPolygonToBody(e,[12,18,21]);JSM.AddPolygonToBody(e,[12,21,24]);JSM.AddPolygonToBody(e,[12,30,18]);JSM.AddPolygonToBody(e,[13,16,22]);JSM.AddPolygonToBody(e,[13,22,25]);JSM.AddPolygonToBody(e,[13,28,16]);JSM.AddPolygonToBody(e,[14,17,20]);JSM.AddPolygonToBody(e,[14,20,26]);JSM.AddPolygonToBody(e,[14,29,17]);JSM.AddPolygonToBody(e,[15,19,23]);JSM.AddPolygonToBody(e,[15,23,27]);JSM.AddPolygonToBody(e,[15,31,19]);JSM.AddPolygonToBody(e,[16,34,22]);JSM.AddPolygonToBody(e,[17,32,20]);JSM.AddPolygonToBody(e,[18,33,21]);JSM.AddPolygonToBody(e,[19,35,23]);JSM.AddPolygonToBody(e,[24,58,36]);JSM.AddPolygonToBody(e,[25,57,37]);JSM.AddPolygonToBody(e,[26,59,38]);JSM.AddPolygonToBody(e,[27,56,39]);JSM.AddPolygonToBody(e,[28,50,40]);JSM.AddPolygonToBody(e,[29,49,41]);JSM.AddPolygonToBody(e,[30,51,42]);JSM.AddPolygonToBody(e,[31,48,43]);JSM.AddPolygonToBody(e,[32,54,44]);JSM.AddPolygonToBody(e,[33,53,45]);JSM.AddPolygonToBody(e,[34,55,46]);JSM.AddPolygonToBody(e,[35,52,47]);JSM.AddPolygonToBody(e,[36,43,48]);JSM.AddPolygonToBody(e,[36,46,43]);JSM.AddPolygonToBody(e,[36,58,46]);JSM.AddPolygonToBody(e,[37,41,49]);JSM.AddPolygonToBody(e,[37,45,41]);JSM.AddPolygonToBody(e,[37,57,45]);JSM.AddPolygonToBody(e,[38,40,50]);JSM.AddPolygonToBody(e,[38,47,40]);JSM.AddPolygonToBody(e,[38,59,47]);JSM.AddPolygonToBody(e,[39,42,51]);JSM.AddPolygonToBody(e,[39,44,42]);JSM.AddPolygonToBody(e,[39,56,44]);JSM.AddPolygonToBody(e,[40,47,52]);JSM.AddPolygonToBody(e,[41,45,53]);JSM.AddPolygonToBody(e,[42,44,54]);JSM.AddPolygonToBody(e,[43,46,55]);JSM.AddPolygonToBody(e,[0,12,24,36,48]);JSM.AddPolygonToBody(e,[1,13,25,37,49]);JSM.AddPolygonToBody(e,[2,14,26,38,50]);JSM.AddPolygonToBody(e,[3,15,27,39,51]);JSM.AddPolygonToBody(e,[4,16,28,40,52]);JSM.AddPolygonToBody(e,[5,17,29,41,53]);JSM.AddPolygonToBody(e,[6,18,30,42,54]);JSM.AddPolygonToBody(e,[7,19,31,43,55]);JSM.AddPolygonToBody(e,[8,20,32,44,56]);JSM.AddPolygonToBody(e,[9,21,33,45,57]);JSM.AddPolygonToBody(e,[10,22,34,46,58]);JSM.AddPolygonToBody(e,[11,23,35,47,59]);return e};JSM.AddCumulatedPolygonToBody=function(e,t,n){var r=new JSM.Coord(0,0,0),i=new JSM.Vector(0,0,0),s=r,o=[],u;for(u=0;u<t.length;u++)o.push(e.GetVertexPosition(t[u]));u=JSM.CalculateCentroid(o);o=JSM.CalculateNormal(o);s.Set(u.x,u.y,u.z);i.Set(o.x,o.y,o.z);r=JSM.CoordOffset(r,i,n);n=e.VertexCount();JSM.AddVertexToBody(e,r.x,r.y,r.z);r=t.length;for(i=0;i<r;i++)s=t[i],o=t[i<r-1?i+1:0],JSM.AddPolygonToBody(e,[s,o,n])};JSM.GenerateCumulatedTetrahedron=function(e){var t=new JSM.Body;t.AddVertex(new JSM.BodyVertex(new JSM.Coord(1,1,1)));t.AddVertex(new JSM.BodyVertex(new JSM.Coord(-1,-1,1)));t.AddVertex(new JSM.BodyVertex(new JSM.Coord(-1,1,-1)));t.AddVertex(new JSM.BodyVertex(new JSM.Coord(1,-1,-1)));e*=2*Math.sqrt(2);JSM.AddCumulatedPolygonToBody(t,[0,1,3],e);JSM.AddCumulatedPolygonToBody(t,[0,2,1],e);JSM.AddCumulatedPolygonToBody(t,[0,3,2],e);JSM.AddCumulatedPolygonToBody(t,[1,2,3],e);return t};JSM.GenerateCumulatedHexahedron=function(e){var t=new JSM.Body;JSM.AddVertexToBody(t,1,1,1);JSM.AddVertexToBody(t,1,1,-1);JSM.AddVertexToBody(t,1,-1,1);JSM.AddVertexToBody(t,-1,1,1);JSM.AddVertexToBody(t,1,-1,-1);JSM.AddVertexToBody(t,-1,1,-1);JSM.AddVertexToBody(t,-1,-1,1);JSM.AddVertexToBody(t,-1,-1,-1);e*=2;JSM.AddCumulatedPolygonToBody(t,[0,1,5,3],e);JSM.AddCumulatedPolygonToBody(t,[0,2,4,1],e);JSM.AddCumulatedPolygonToBody(t,[0,3,6,2],e);JSM.AddCumulatedPolygonToBody(t,[1,4,7,5],e);JSM.AddCumulatedPolygonToBody(t,[2,6,7,4],e);JSM.AddCumulatedPolygonToBody(t,[3,5,7,6],e);return t};JSM.GenerateCumulatedOctahedron=function(e){var t=new JSM.Body;JSM.AddVertexToBody(t,1,0,0);JSM.AddVertexToBody(t,-1,0,0);JSM.AddVertexToBody(t,0,1,0);JSM.AddVertexToBody(t,0,-1,0);JSM.AddVertexToBody(t,0,0,1);JSM.AddVertexToBody(t,0,0,-1);e*=Math.sqrt(2);JSM.AddCumulatedPolygonToBody(t,[0,2,4],e);JSM.AddCumulatedPolygonToBody(t,[0,3,5],e);JSM.AddCumulatedPolygonToBody(t,[0,4,3],e);JSM.AddCumulatedPolygonToBody(t,[0,5,2],e);JSM.AddCumulatedPolygonToBody(t,[1,2,5],e);JSM.AddCumulatedPolygonToBody(t,[1,3,4],e);JSM.AddCumulatedPolygonToBody(t,[1,4,2],e);JSM.AddCumulatedPolygonToBody(t,[1,5,3],e);return t};JSM.GenerateCumulatedDodecahedron=function(e){var t=new JSM.Body,n=(1+Math.sqrt(5))/2,r=1/n;JSM.AddVertexToBody(t,1,1,1);JSM.AddVertexToBody(t,1,1,-1);JSM.AddVertexToBody(t,1,-1,1);JSM.AddVertexToBody(t,-1,1,1);JSM.AddVertexToBody(t,1,-1,-1);JSM.AddVertexToBody(t,-1,1,-1);JSM.AddVertexToBody(t,-1,-1,1);JSM.AddVertexToBody(t,-1,-1,-1);JSM.AddVertexToBody(t,0,+r,+n);JSM.AddVertexToBody(t,0,+r,-n);JSM.AddVertexToBody(t,0,-r,+n);JSM.AddVertexToBody(t,0,-r,-n);JSM.AddVertexToBody(t,+r,+n,0);JSM.AddVertexToBody(t,+r,-n,0);JSM.AddVertexToBody(t,-r,+n,0);JSM.AddVertexToBody(t,-r,-n,0);JSM.AddVertexToBody(t,+n,0,+r);JSM.AddVertexToBody(t,-n,0,+r);JSM.AddVertexToBody(t,+n,0,-r);JSM.AddVertexToBody(t,-n,0,-r);e*=Math.sqrt(5)-1;JSM.AddCumulatedPolygonToBody(t,[0,8,10,2,16],e);JSM.AddCumulatedPolygonToBody(t,[0,16,18,1,12],e);JSM.AddCumulatedPolygonToBody(t,[0,12,14,3,8],e);JSM.AddCumulatedPolygonToBody(t,[1,9,5,14,12],e);JSM.AddCumulatedPolygonToBody(t,[1,18,4,11,9],e);JSM.AddCumulatedPolygonToBody(t,[2,10,6,15,13],e);JSM.AddCumulatedPolygonToBody(t,[2,13,4,18,16],e);JSM.AddCumulatedPolygonToBody(t,[3,14,5,19,17],e);JSM.AddCumulatedPolygonToBody(t,[3,17,6,10,8],e);JSM.AddCumulatedPolygonToBody(t,[4,13,15,7,11],e);JSM.AddCumulatedPolygonToBody(t,[5,9,11,7,19],e);JSM.AddCumulatedPolygonToBody(t,[6,17,19,7,15],e);return t};JSM.GenerateCumulatedIcosahedron=function(e){var t=new JSM.Body,n=(1+Math.sqrt(5))/2;JSM.AddVertexToBody(t,0,1,+n);JSM.AddVertexToBody(t,0,1,-n);JSM.AddVertexToBody(t,0,-1,+n);JSM.AddVertexToBody(t,0,-1,-n);JSM.AddVertexToBody(t,1,+n,0);JSM.AddVertexToBody(t,1,-n,0);JSM.AddVertexToBody(t,-1,+n,0);JSM.AddVertexToBody(t,-1,-n,0);JSM.AddVertexToBody(t,+n,0,1);JSM.AddVertexToBody(t,-n,0,1);JSM.AddVertexToBody(t,+n,0,-1);JSM.AddVertexToBody(t,-n,0,-1);e*=2;JSM.AddCumulatedPolygonToBody(t,[0,2,8],e);JSM.AddCumulatedPolygonToBody(t,[0,4,6],e);JSM.AddCumulatedPolygonToBody(t,[0,6,9],e);JSM.AddCumulatedPolygonToBody(t,[0,8,4],e);JSM.AddCumulatedPolygonToBody(t,[0,9,2],e);JSM.AddCumulatedPolygonToBody(t,[1,3,11],e);JSM.AddCumulatedPolygonToBody(t,[1,4,10],e);JSM.AddCumulatedPolygonToBody(t,[1,6,4],e);JSM.AddCumulatedPolygonToBody(t,[1,10,3],e);JSM.AddCumulatedPolygonToBody(t,[1,11,6],e);JSM.AddCumulatedPolygonToBody(t,[2,5,8],e);JSM.AddCumulatedPolygonToBody(t,[2,7,5],e);JSM.AddCumulatedPolygonToBody(t,[2,9,7],e);JSM.AddCumulatedPolygonToBody(t,[3,5,7],e);JSM.AddCumulatedPolygonToBody(t,[3,7,11],e);JSM.AddCumulatedPolygonToBody(t,[3,10,5],e);JSM.AddCumulatedPolygonToBody(t,[4,8,10],e);JSM.AddCumulatedPolygonToBody(t,[6,11,9],e);JSM.AddCumulatedPolygonToBody(t,[5,10,8],e);JSM.AddCumulatedPolygonToBody(t,[7,9,11],e);return t};JSM.GenerateTetrakisHexahedron=function(){return JSM.GenerateCumulatedHexahedron(.25)};JSM.GenerateRhombicDodecahedron=function(){return JSM.GenerateCumulatedHexahedron(.5)};JSM.GeneratePentakisDodecahedron=function(){var e=Math.sqrt((65+22*Math.sqrt(5))/5)/19;return JSM.GenerateCumulatedDodecahedron(e)};JSM.GenerateSmallStellatedDodecahedron=function(){var e=Math.sqrt((5+2*Math.sqrt(5))/5);return JSM.GenerateCumulatedDodecahedron(e)};JSM.GenerateGreatDodecahedron=function(){var e=Math.sqrt(3)*(Math.sqrt(5)-3)/6;return JSM.GenerateCumulatedIcosahedron(e)};JSM.GenerateSmallTriambicIcosahedron=function(){var e=Math.sqrt(15)/15;return JSM.GenerateCumulatedIcosahedron(e)};JSM.GenerateGreatStellatedDodecahedron=function(){var e=Math.sqrt(3)*(3+Math.sqrt(5))/6;return JSM.GenerateCumulatedIcosahedron(e)};JSM.GenerateSmallTriakisOctahedron=function(){var e=Math.sqrt(3)-2*Math.sqrt(6)/3;return JSM.GenerateCumulatedOctahedron(e)};JSM.GenerateStellaOctangula=function(){var e=Math.sqrt(6)/3;return JSM.GenerateCumulatedOctahedron(e)};JSM.GenerateTriakisTetrahedron=function(){var e=Math.sqrt(6)/15;return JSM.GenerateCumulatedTetrahedron(e)};JSM.LegoDimensions=function(){this.legoWidth=.78;this.legoSmallHeight=.32;this.legoLargeHeight=.96;this.legoWallWidth=.16;this.legoCylinderWidth=.5;this.legoCylinderHeight=.17;this.legoBottomSmallCylinderWidth=.3;this.legoBottomLargeCylinderWidth=.6;this.legoBottomLargeCylinderWallWidth=.1};JSM.GenerateLegoBrick=function(e,t,n,r,i,s,o){function u(e,t){var n,r;for(n=0;n<e.VertexCount();n++)r=e.GetVertex(n),r.position=JSM.CoordAdd(r.position,t)}var a=new JSM.LegoDimensions,f=new JSM.Vector(0,0,1),l=a.legoWidth,c=a.legoLargeHeight;n||(c=a.legoSmallHeight);n=a.legoWallWidth;var h=a.legoCylinderWidth,p=a.legoCylinderHeight,d=a.legoBottomSmallCylinderWidth,v=a.legoBottomLargeCylinderWidth,m=a.legoBottomLargeCylinderWallWidth,g=[];g.push(new JSM.Coord(0,0,0));g.push(new JSM.Coord(l*e,0,0));g.push(new JSM.Coord(l*e,l*t,0));g.push(new JSM.Coord(0,l*t,0));var a=new JSM.Body,y=JSM.GeneratePrismShell(g,f,c-n,n,!0);a.Merge(y);for(y=0;4>y;y++)g[y].z=c-n;y=JSM.GeneratePrism(g,f,n,!0);a.Merge(y);if(r)for(y=0;y<e;y++)for(g=0;g<t;g++)r=new JSM.Coord(l*y+l/2,l*g+l/2,c+p/2),f=JSM.GenerateCylinder(h/2,p,s,!0,o),u(f,r),a.Merge(f);if(i)if(1===e&&1<t||1===t&&1<e){i=t;h=!0;e>t&&(i=e,h=!1);for(y=0;y<i-1;y++)r=h?new JSM.Coord(l/2,l*(y+1),(c-n)/2):new JSM.Coord(l*(y+1),l/2,(c-n)/2),f=JSM.GenerateCylinder(d/2,c-n,s,!0,o),u(f,r),a.Merge(f)}else if(1<e&&1<t)for(y=0;y<e-1;y++)for(g=0;g<t-1;g++)r=new JSM.Coord(l*(y+1),l*(g+1),(c-n)/2),f=JSM.GenerateCylinderShell(v/2,c-n,m,s,!0,o),u(f,r),a.Merge(f);a.SetCubicTextureProjection(new JSM.Coord(0,0,0),new JSM.Coord(1,0,0),new JSM.Coord(0,1,0),new JSM.Coord(0,0,1));return a};JSM.GenerateConvexHullBody=function(e){var t=new JSM.Body,n=JSM.ConvexHull3D(e),r={},i,s,o,u;for(i=0;i<n.length;i++){o=n[i];for(s=0;s<o.length;s++)u=o[s],u in r||(r[u]=t.VertexCount(),t.AddVertex(new JSM.BodyVertex(e[u])))}for(i=0;i<n.length;i++){o=n[i];e=[];for(s=0;s<o.length;s++)u=o[s],e.push(r[u]);t.AddPolygon(new JSM.BodyPolygon(e))}return t};JSM.GenerateSuperShape=function(e,t,n,r,i,s,o,u,a,f,l,c,h,p){function d(e){var t=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z),n=Math.asin(e.z/t);e=Math.atan2(e.y,e.x);return[t,n,e]}function v(e,t,n,r,i,s,o){t=Math.abs(Math.cos(r*e/4)/t);e=Math.abs(Math.sin(r*e/4)/n);return Math.pow(Math.pow(t,s)+Math.pow(e,o),-1/i)}function m(h,p){var d=new JSM.Coord(0,0,0),m=v(h,o,u,a,f,l,c),g=v(p,e,t,n,r,i,s);d.x=g*Math.cos(p)*m*Math.cos(h);d.y=g*Math.sin(p)*m*Math.cos(h);d.z=m*Math.sin(h);return d}h=JSM.GenerateSphere(1,h,p);var g,y;for(p=0;p<h.VertexCount();p++)g=h.GetVertex(p),y=g.position,y=d(y),y=m(y[1],y[2]),g.SetPosition(y);return h};JSM.OrderPolygons=function(e,t,n){var r=[],i=[],s=[],o=[],u=[],a=[],f=[],l=e.PolygonCount(),c,h;for(c=0;c<l;c++){a.push(c);f.push([]);for(h=0;h<l;h++)f[c].push(null)}(function(){var a=JSM.VectorNormalize(JSM.CoordSub(n,t)),a=JSM.GetPlaneFromCoordAndDirection(t,a),f,l,c,h,p,v;for(f=0;f<e.PolygonCount();f++){p=JSM.Inf;v=-JSM.Inf;c=e.GetPolygon(f);for(l=0;l<c.VertexIndexCount();l++)h=e.GetVertexPosition(c.GetVertexIndex(l)),h=JSM.CoordPlaneDistance(h,a),JSM.IsLower(h,p)&&(p=h),JSM.IsGreater(h,v)&&(v=h);r.push(p);i.push(v);l=e.GetPolygon(f);c=new JSM.Coord(0,0,0);v=p=void 0;for(p=0;p<l.VertexIndexCount();p++)v=e.GetVertexPosition(l.GetVertexIndex(p)),c=JSM.CoordAdd(c,v);l=c=JSM.VectorMultiply(c,1/l.VertexIndexCount());c=JSM.CoordPlaneDistance(l,a);s.push(l);o.push(c);c=JSM.CalculateBodyPolygonNormal(e,f);p=JSM.VectorNormalize(JSM.CoordSub(l,t));p=JSM.VectorDot(c,p);JSM.IsGreaterOrEqual(p,0)&&(c=JSM.VectorMultiply(c,-1));l=JSM.GetPlaneFromCoordAndDirection(l,c);u.push(l)}})();(function(){var e=a.length,t,n;for(t=0;t<e-1;t++)for(n=0;n<e-t-1;n++){var r;r=a[n];var s=a[n+1];r=JSM.IsLower(i[r],i[s])?!0:JSM.IsEqual(i[r],i[s])&&JSM.IsLower(o[r],o[s])?!0:!1;if(r){r=a;var s=n+1,u=r[n];r[n]=r[s];r[s]=u}}})();(function(){var t=a.length,n,s;for(n=0;n<t-1;n++)for(s=0;s<t-n-1;s++){var o;o=a[s];var l=a[s+1];if(null!==f[o][l])o=f[o][l];else{var c;if(c=JSM.IsLowerOrEqual(r[o],i[l])){var h=l;c=u[o];for(var p=u[h],v=void 0,m=void 0,g=!0,y=e.GetPolygon(o),v=0;v<y.VertexIndexCount();v++)if(m=e.GetVertexPosition(y.GetVertexIndex(v)),"CoordInFrontOfPlane"===JSM.CoordPlanePosition(m,p)){g=!1;break}if(g)c=!1;else{p=!0;h=e.GetPolygon(h);for(v=0;v<h.VertexIndexCount();v++)if(m=e.GetVertexPosition(h.GetVertexIndex(v)),"CoordAtBackOfPlane"===JSM.CoordPlanePosition(m,c)){p=!1;break}c=p?!1:!0}}o=c?f[o][l]=!0:f[o][l]=!1}o&&(o=a,l=s+1,c=o[s],o[s]=o[l],o[l]=c)}})();return a};JSM.CanvasDrawer=function(e){this.canvas=e;this.context=this.canvas.getContext("2d")};JSM.CanvasDrawer.prototype.GetWidth=function(){return this.canvas.width};JSM.CanvasDrawer.prototype.GetHeight=function(){return this.canvas.height};JSM.CanvasDrawer.prototype.BeginPath=function(){this.context.beginPath()};JSM.CanvasDrawer.prototype.EndPath=function(){this.context.stroke()};JSM.CanvasDrawer.prototype.Clear=function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height);this.context.fillStyle="#ffffff";this.context.fillRect(0,0,this.canvas.width,this.canvas.height)};JSM.CanvasDrawer.prototype.DrawLine=function(e,t){this.context.moveTo(e.x,this.canvas.height-e.y);this.context.lineTo(t.x,this.canvas.height-t.y)};JSM.CanvasDrawer.prototype.DrawPolygon=function(e,t){var n=this.context,r=JSM.HexColorToRGBComponents(t);n.fillStyle="rgb("+r[0]+","+r[1]+","+r[2]+")";this.context.beginPath();for(var i,n=0;n<e.VertexCount();n++)r=e.GetVertex(n),0===n?this.context.moveTo(r.x,this.canvas.height-r.y):this.context.lineTo(r.x,this.canvas.height-r.y);this.context.closePath();this.context.fill();this.BeginPath();for(n=0;n<e.VertexCount();n++)r=e.GetVertex(n),i=e.GetVertex(n<e.VertexCount()-1?n+1:0),this.DrawLine(r,i);this.EndPath()};JSM.SVGDrawer=function(e){this.svgObject=e;this.svgNameSpace="http://www.w3.org/2000/svg"};JSM.SVGDrawer.prototype.GetWidth=function(){return this.svgObject.getAttribute("width")};JSM.SVGDrawer.prototype.GetHeight=function(){return this.svgObject.getAttribute("height")};JSM.SVGDrawer.prototype.BeginPath=function(){};JSM.SVGDrawer.prototype.EndPath=function(){};JSM.SVGDrawer.prototype.Clear=function(){for(;this.svgObject.lastChild;)this.svgObject.removeChild(this.svgObject.lastChild)};JSM.SVGDrawer.prototype.DrawLine=function(e,t){var n=document.createElementNS(this.svgNameSpace,"line"),r=this.GetHeight();n.setAttributeNS(null,"stroke","black");n.setAttributeNS(null,"x1",e.x);n.setAttributeNS(null,"y1",r-e.y);n.setAttributeNS(null,"x2",t.x);n.setAttributeNS(null,"y2",r-t.y);this.svgObject.appendChild(n)};JSM.SVGDrawer.prototype.DrawPolygon=function(e,t){var n="",r=this.GetHeight(),i,s;for(i=0;i<e.VertexCount();i++)s=e.GetVertex(i),n=n+s.x+", "+(r-s.y),i<e.VertexCount()-1&&(n+=", ");r=document.createElementNS(this.svgNameSpace,"polygon");r.setAttributeNS(null,"points",n);r.setAttributeNS(null,"fill",function(e){e=JSM.HexColorToRGBComponents(e);return"rgb("+e[0]+","+e[1]+","+e[2]+")"}(t));r.setAttributeNS(null,"fill-opacity","1.0");r.setAttributeNS(null,"stroke","black");this.svgObject.appendChild(r)};JSM.DrawProjectedBody=function(e,t,n,r,i,s){function o(t){var n=new JSM.Polygon2D,r,i,s;for(r=0;r<t.VertexIndexCount();r++)i=e.GetVertexPosition(t.GetVertexIndex(r)),s=JSM.Project(i,a,f,l,c*JSM.DegRad,h,p,d,v),i=s.x,s=s.y,n.AddVertex(i,s);return n}i&&s.Clear();i=s.GetWidth();var u=s.GetHeight(),a=n.eye,f=n.center,l=n.up,c=n.fieldOfView,h=i/u,p=n.nearClippingPlane,d=n.farClippingPlane,v=[0,0,i,u];if("HiddenLinePainter"==r){u=JSM.OrderPolygons(e,a,f);if(void 0===t||null===t)t=new JSM.Materials;for(n=0;n<u.length;n++)i=e.GetPolygon(u[n]),r=o(i),i=i.GetMaterialIndex(),i=t.GetMaterial(i).diffuse,s.DrawPolygon(r,i)}else if("HiddenLineFrontFacing"==r){if(void 0===t||null===t)t=new JSM.Materials;for(n=0;n<e.PolygonCount();n++)i=e.GetPolygon(n),r=o(i),"CounterClockwise"==JSM.PolygonOrientation2D(r)&&(i=i.GetMaterialIndex(),i=t.GetMaterial(i).diffuse,s.DrawPolygon(r,i))}else if("Wireframe"==r){var m,g,y;s.BeginPath();var b=[];for(n=0;n<e.PolygonCount();n++){g=m=null;i=e.GetPolygon(n);u=i.VertexIndexCount();for(t=0;t<=u;t++)y=i.GetVertexIndex(t%u),r=e.GetVertexPosition(y),r=JSM.Project(r,a,f,l,c*JSM.DegRad,h,p,d,v),null!==m&&null!==g&&void 0===b[[g,y]]&&(s.DrawLine(m,r),b[[g,y]]=!0,b[[y,g]]=!0),g=y,m=r}s.EndPath()}return!0};JSM.CatmullClarkSubdivisionOneIteration=function(e){var t=new JSM.Body,n=JSM.CalculateAdjacencyInfo(e);(function(){var r,i;for(r=0;r<n.verts.length;r++)i=e.GetVertex(r).position,t.AddVertex(new JSM.BodyVertex(new JSM.Coord(i.x,i.y,i.z)))})();var r=[];(function(){var i,s,o,u,f;for(i=0;i<n.pgons.length;i++){o=n.pgons[i];f=new JSM.Coord(0,0,0);for(s=0;s<o.verts.length;s++)u=e.GetVertex(o.verts[s]).position,f=JSM.CoordAdd(f,u);f=JSM.VectorMultiply(f,1/o.verts.length);r.push(t.AddVertex(new JSM.BodyVertex(f)))}})();var i=[];(function(){var s,o,u,f,l;for(s=0;s<n.edges.length;s++){u=n.edges[s];f=new JSM.Coord(0,0,0);f=JSM.CoordAdd(f,JSM.VectorMultiply(e.GetVertex(u.vert1).position,.25));f=JSM.CoordAdd(f,JSM.VectorMultiply(e.GetVertex(u.vert2).position,.25));for(o=0;2>o;o++)l=0===o?u.pgon1:u.pgon2,-1===l&&(l=0===o?u.pgon2:u.pgon1),l=t.GetVertex(r[l]).position,f=JSM.CoordAdd(f,JSM.VectorMultiply(l,.25));i.push(t.AddVertex(new JSM.BodyVertex(f)))}})();(function(){var i=[],s,o,u,f;for(u=0;u<n.edges.length;u++)s=n.edges[u],o=JSM.MidCoord(e.GetVertex(s.vert1).position,e.GetVertex(s.vert2).position),i.push(o);var l,h,p;for(u=0;u<n.verts.length;u++){l=n.verts[u];p=new JSM.Coord(0,0,0);s=new JSM.Coord(0,0,0);h=1/l.pgons.length;for(f=0;f<l.pgons.length;f++)o=t.GetVertex(r[l.pgons[f]]).position,p=JSM.CoordAdd(p,JSM.VectorMultiply(o,h));h=1/l.edges.length;for(f=0;f<l.edges.length;f++)o=i[l.edges[f]],s=JSM.CoordAdd(s,JSM.VectorMultiply(o,h));l=l.edges.length;f=t.GetVertex(u).position;f.x=(p.x+2*s.x+(l-3)*f.x)/l;f.y=(p.y+2*s.y+(l-3)*f.y)/l;f.z=(p.z+2*s.z+(l-3)*f.z)/l}})();(function(){var s,o,u,f,l,h,p,v;for(h=0;h<n.pgons.length;h++){v=n.pgons[h];s=v.verts.length;for(p=0;p<s;p++)o=v.pedges[p],u=v.pedges[(p+1)%s],f=r[h],o=i[o.index],l=JSM.GetPolyEdgeStartVertex(u,n),u=i[u.index],f=new JSM.BodyPolygon([f,o,l,u]),u=e.GetPolygon(h),f.material=u.material,f.curved=u.curved,t.AddPolygon(f)}})();return t};JSM.CatmullClarkSubdivision=function(e,t){var n=e,r;for(r=0;r<t;r++)n=JSM.CatmullClarkSubdivisionOneIteration(n);return n};JSM.SvgToModel=function(e,t,n){function r(e,t){function n(e,t,n,r,i,s){e=e.createSVGPoint();e.x=i;e.y=s;r=e.matrixTransform(r.getCTM());e=new JSM.Coord2D(r.x,r.y);i=new JSM.Coord2D(i,s);s=t.VertexCount(n);if(0<s&&JSM.CoordIsEqual2DWithEps(t.GetVertex(n,s-1),e,.1))return i;t.AddVertex(n,r.x,r.y);return i}function r(e,t,r,i,s,o,u){var a=document.createElementNS("http://www.w3.org/2000/svg","path"),f="M "+i.x+" "+i.y+" ",l,c,h,p,d;for(l=0;l<s.length;l++)if(c=s[l],c.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS||c.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL)h=c.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS?"C":"c",f+=h+" "+c.x1+" "+c.y1+" "+c.x2+" "+c.y2+" "+c.x+" "+c.y+" ";else if(c.pathSegType==SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS||c.pathSegType==SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL)h=c.pathSegType==SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS?"Q":"q",f+=h+" "+c.x1+" "+c.y1+" "+c.x+" "+c.y+" ";else if(c.pathSegType==SVGPathSeg.PATHSEG_ARC_ABS||c.pathSegType==SVGPathSeg.PATHSEG_ARC_REL)h=c.pathSegType==SVGPathSeg.PATHSEG_ARC_ABS?"A":"a",p=c.largeArcFlag?1:0,d=c.sweepFlag?1:0,f+=h+" "+c.r1+" "+c.r2+" "+c.angle+" "+p+" "+d+" "+c.x+" "+c.y+" ";else if(c.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS||c.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL)h=c.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS?"S":"s",f+=h+" "+c.x2+" "+c.y2+" "+c.x+" "+c.y+" ";a.setAttributeNS(null,"d",f);f=a.getTotalLength();s=0;0<r&&(s=parseInt(f/r,10));3>s&&(s=3);r=f/s;for(f=1;f<=s;f++)i=a.getPointAtLength(f*r),i=n(e,o,u,t,i.x,i.y);return i}function i(e,t){var n=e.VertexCount(t);if(0!==n){var r=e.GetVertex(t,0),n=e.GetVertex(t,n-1);JSM.CoordIsEqual2DWithEps(r,n,.1)&&e.GetContour(t).vertices.pop()}}function s(e,t){return 0<e.VertexCount(t)?(i(e,t),e.AddContour(),t+1):t}var o=new JSM.ContourPolygon2D,u=document.createElementNS("http://www.w3.org/2000/svg","svg"),a;if(e instanceof SVGPathElement){var f=new JSM.Coord2D(0,0),l=new JSM.Coord2D(0,0),c=t;e.hasAttribute("segmentlength")&&(c=parseFloat(e.getAttribute("segmentlength")));var h,p,d=0;for(a=0;a<e.pathSegList.numberOfItems;a++)if(h=e.pathSegList.getItem(a),h.pathSegType!=SVGPathSeg.PATHSEG_CLOSEPATH)if(h.pathSegType==SVGPathSeg.PATHSEG_MOVETO_ABS)d=s(o,d),f=n(u,o,d,e,h.x,h.y),l=f.Clone();else if(h.pathSegType==SVGPathSeg.PATHSEG_MOVETO_REL)d=s(o,d),f=n(u,o,d,e,l.x+h.x,l.y+h.y),l=f.Clone();else if(h.pathSegType==SVGPathSeg.PATHSEG_LINETO_ABS)f=n(u,o,d,e,h.x,h.y);else if(h.pathSegType==SVGPathSeg.PATHSEG_LINETO_REL)f=n(u,o,d,e,f.x+h.x,f.y+h.y);else if(h.pathSegType==SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS)f=n(u,o,d,e,h.x,f.y);else if(h.pathSegType==SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS)f=n(u,o,d,e,f.x,h.y);else if(h.pathSegType==SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL)f=n(u,o,d,e,f.x+h.x,f.y);else if(h.pathSegType==SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL)f=n(u,o,d,e,f.x,f.y+h.y);else if(h.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS||h.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL||h.pathSegType==SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS||h.pathSegType==SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL||h.pathSegType==SVGPathSeg.PATHSEG_ARC_ABS||h.pathSegType==SVGPathSeg.PATHSEG_ARC_REL||h.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS||h.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL){p=[];if(h.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS||h.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL){for(;a<e.pathSegList.numberOfItems;a++){h=e.pathSegList.getItem(a);if(!(h.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS||h.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL))break;p.push(h)}a-=1}else p.push(h);f=r(u,e,c,f,p,o,d)}i(o,d)}else if(e instanceof SVGRectElement)n(u,o,0,e,e.x.baseVal.value,e.y.baseVal.value),n(u,o,0,e,e.x.baseVal.value+e.width.baseVal.value,e.y.baseVal.value),n(u,o,0,e,e.x.baseVal.value+e.width.baseVal.value,e.y.baseVal.value+e.height.baseVal.value),n(u,o,0,e,e.x.baseVal.value,e.y.baseVal.value+e.height.baseVal.value);else if(e instanceof SVGPolygonElement)for(a=0;a<e.points.numberOfItems;a++)f=e.points.getItem(a),n(u,o,0,e,f.x,f.y);o.color=function(e){for(var t="";null!==e&&void 0!==e&&0===t.length;)t=e.getAttribute("fill"),null===t&&(t=e.style.fill),e=e.parentElement;e=0;if(0===t.length)return e;if("#"==t[0])e=JSM.HexColorToRGBColor(t.substring(1));else{var n=t.indexOf("("),r=t.indexOf(")");if(-1==n||-1==r)return e;t=t.substring(n+1,r).split(", ");if(3!=t.length)return e;e=JSM.RGBComponentsToHexColor(t[0],t[1],t[2])}return e}(e);return o}function i(e,t){function n(e,t){var n=[],r,i;if("Clockwise"==t)for(r=0;r<e.VertexCount();r++)i=e.GetVertex(r),n.push(new JSM.Coord(i.x,0,-i.y));else for(r=e.VertexCount()-1;0<=r;r--)i=e.GetVertex(r),n.push(new JSM.Coord(i.x,0,-i.y));return n}function r(e,t,n){e.push(null);var r;if("CounterClockwise"==n)for(n=0;n<t.VertexCount();n++)r=t.GetVertex(n),e.push(new JSM.Coord(r.x,0,-r.y));else for(n=t.VertexCount()-1;0<=n;n--)r=t.GetVertex(n),e.push(new JSM.Coord(r.x,0,-r.y))}var i=[],s=new JSM.Vector(0,-1,0),o,u;u=e.ContourCount();if(1==u)u=JSM.PolygonOrientation2D(e.GetContour(0)),o=n(e.GetContour(0),u),o=JSM.GeneratePrism(o,s,t,!0),i.push(o);else if(1<u){u=JSM.PolygonOrientation2D(e.GetContour(0));var a=n(e.GetContour(0),u),f=!1,l;for(l=1;l<e.ContourCount();l++)o=JSM.PolygonOrientation2D(e.GetContour(l)),o==u?(o=n(e.GetContour(l),u),o=JSM.GeneratePrism(o,s,t,!0),i.push(o)):(r(a,e.GetContour(l),o),f=!0);o=f?JSM.GeneratePrismWithHole(a,s,t,!0):JSM.GeneratePrism(a,s,t,!0);i.push(o)}s=new JSM.Material({ambient:e.color,diffuse:e.color});return[i,s]}var s=new JSM.Model,o=new JSM.Materials;n=function(e,t){function n(e,t,n){e=e.getElementsByTagName(t);for(t=0;t<e.length;t++)n.push(e[t])}var i=[],s=[];n(e,"path",s);n(e,"rect",s);n(e,"polygon",s);var o=t;e.hasAttribute("segmentlength")&&(o=parseFloat(e.getAttribute("segmentlength")));var u,a;for(u=0;u<s.length;u++)a=r(s[u],o),i.push(a);return i}(e,n);e.hasAttribute("modelheight")&&(t=parseFloat(e.getAttribute("modelheight")));var u,a,f;for(e=0;e<n.length;e++){u=i(n[e],t);a=u[0];u=u[1];o.AddMaterial(u);for(u=0;u<a.length;u++)f=a[u],f.SetPolygonsMaterialIndex(o.Count()-1),s.AddBody(f)}return[s,o]};JSM.BSPPolygonUserData=function(){this.material=this.id=null};JSM.AddBodyToBSPTree=function(e,t,n){var r,i,s;for(r=0;r<e.PolygonCount();r++){s=new JSM.BSPPolygonUserData;s.id=n;i=e;var o=s,u=i.GetPolygon(r);o.material=u.GetMaterialIndex();for(var o=new JSM.Polygon,a=void 0,f=void 0,a=0;a<u.VertexIndexCount();a++)f=i.GetVertexPosition(u.GetVertexIndex(a)),o.AddVertex(f.x,f.y,f.z);i=o;t.AddPolygon(i,s)}};JSM.BooleanOperation=function(e,t,n){function r(e,t,n){function r(e){t.AddVertex(new JSM.BodyVertex(e));return t.VertexCount()-1}var i=new JSM.BodyPolygon([]),s;if(n)for(n=e.VertexCount()-1;0<=n;n--)s=r(e.GetVertex(n)),i.AddVertexIndex(s);else for(n=0;n<e.VertexCount();n++)s=r(e.GetVertex(n)),i.AddVertexIndex(s);void 0!==e.userData&&i.SetMaterialIndex(e.userData.material);t.AddPolygon(i)}function i(e,t,n){var i;for(i=0;i<e.length;i++)r(e[i],t,n)}function s(e,t,n,r,i,s){function o(e,t){var n;for(n=0;n<e.length;n++)e[n].userData=t}var u,a;for(u=0;u<e.length;u++)a=e[u],JSM.ClipPolygonWithBSPTree(a.polygon,t,n,r,i,s),o(n,a.userData),o(r,a.userData),o(i,a.userData),o(s,a.userData)}var o=new JSM.BSPTree,u=new JSM.BSPTree;JSM.AddBodyToBSPTree(t,o,"a");JSM.AddBodyToBSPTree(n,u,"b");t=new JSM.Body;n=[];var a=[],f=[],l=[];s(o.GetNodes(),u,n,a,f,l);var c=[],h=[],p=[];s(u.GetNodes(),o,c,h,p,[]);"Union"==e?(i(n,t,!1),i(f,t,!1),i(l,t,!1),i(c,t,!1),i(p,t,!1)):"Difference"==e?(i(n,t,!1),i(f,t,!1),i(h,t,!0)):"Intersection"==e&&(i(a,t,!1),i(l,t,!1),i(h,t,!1));return t};JSM.GenerateSurface=function(e,t,n,r,i,s,o,u){var a=new JSM.Body,f=e[0],l=t[0],c=(e[1]-e[0])/n,h=(t[1]-t[0])/r;(function(){var e,t,i,s;for(e=0;e<=r;e++)for(t=0;t<=n;t++)i=f+t*c,s=l+e*h,i=o(e,t,i,s,u),a.AddVertex(new JSM.BodyVertex(i))})();(function(){var e,t,o,u,f,l;for(t=0;t<r;t++)for(e=0;e<n;e++)o=t*(n+1)+e,u=o+1,f=o+n+1,l=f+1,i?(u=new JSM.BodyPolygon([o,u,l]),s&&u.SetCurveGroup(0),a.AddPolygon(u),u=new JSM.BodyPolygon([o,l,f])):u=new JSM.BodyPolygon([o,u,l,f]),s&&u.SetCurveGroup(0),a.AddPolygon(u)})();return a};JSM.SurfaceControlPoints=function(e,t){this.n=e;this.m=t;this.points=[];var n,r;for(n=0;n<=this.n;n++){this.points.push([]);for(r=0;r<=this.m;r++)this.points[n].push(new JSM.Coord(0,0,0))}};JSM.SurfaceControlPoints.prototype.GetNValue=function(){return this.n};JSM.SurfaceControlPoints.prototype.GetMValue=function(){return this.m};JSM.SurfaceControlPoints.prototype.GetControlPoint=function(e,t){return this.points[e][t]};JSM.SurfaceControlPoints.prototype.InitPlanar=function(e,t){var n=e/this.n,r=t/this.m,i,s,o;for(i=0;i<=this.n;i++)for(s=0;s<=this.m;s++)o=this.points[i][s],o.x=i*n,o.y=s*r};JSM.GenerateBezierSurface=function(e,t,n,r){return JSM.GenerateSurface([0,1],[0,1],t,n,!1,r,function(e,t,n,r,i){function s(e,t,n){var r=1,i=JSM.Minimum(e,t-e),s;for(s=0;s<i;s++)r*=t-s,r/=s+1;return r*Math.pow(n,e)*Math.pow(1-n,t-e)}var o,u,a,f=i.GetNValue(),l=i.GetMValue();o=new JSM.Coord(0,0,0);for(e=0;e<=f;e++){u=new JSM.Coord(0,0,0);for(t=0;t<=l;t++)a=s(e,f,n)*s(t,l,r),a=JSM.VectorMultiply(i.GetControlPoint(e,t),a),u=JSM.CoordAdd(u,a);o=JSM.CoordAdd(o,u)}return o},e)};JSM.RenderMaterial=function(e,t,n,r,i,s,o){this.ambient=e;this.diffuse=t;this.specular=n;this.shininess=r;this.texture=i;this.textureWidth=s;this.textureHeight=o;this.textureImage=this.textureBuffer=null;this.textureLoaded=!1};JSM.RenderMaterial.prototype.HasTexture=function(){return null!==this.texture&&this.textureLoaded};JSM.RenderMaterial.prototype.Compile=function(e,t){if(null!==this.texture){var n=this;this.textureBuffer=e.createTexture();this.textureImage=new Image;this.textureImage.src=this.texture;this.textureImage.onload=function(){e.bindTexture(e.TEXTURE_2D,n.textureBuffer);e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n.textureImage);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR);e.generateMipmap(e.TEXTURE_2D);e.bindTexture(e.TEXTURE_2D,null);n.textureLoaded=!0;void 0!==t&&null!==t&&t()}}};JSM.RenderGeometry=function(){this.transformation=new JSM.Transformation;this.uvBuffer=this.normalBuffer=this.vertexBuffer=this.uvArray=this.normalArray=this.vertexArray=this.material=null};JSM.RenderGeometry.prototype.SetMaterial=function(e){this.material=e};JSM.RenderGeometry.prototype.GetMaterial=function(){return this.material};JSM.RenderGeometry.prototype.SetVertexArray=function(e){this.vertexArray=new Float32Array(e)};JSM.RenderGeometry.prototype.SetNormalArray=function(e){this.normalArray=new Float32Array(e)};JSM.RenderGeometry.prototype.SetUVArray=function(e){this.uvArray=new Float32Array(e)};JSM.RenderGeometry.prototype.GetTransformation=function(){return this.transformation};JSM.RenderGeometry.prototype.GetTransformationMatrix=function(){return this.transformation.matrix};JSM.RenderGeometry.prototype.SetTransformation=function(e){this.transformation=e};JSM.RenderGeometry.prototype.GetVertexBuffer=function(){return this.vertexBuffer};JSM.RenderGeometry.prototype.GetNormalBuffer=function(){return this.normalBuffer};JSM.RenderGeometry.prototype.GetUVBuffer=function(){return this.uvBuffer};JSM.RenderGeometry.prototype.VertexCount=function(){return parseInt(this.vertexArray.length/3,10)};JSM.RenderGeometry.prototype.GetVertex=function(e){return new JSM.Coord(this.vertexArray[3*e],this.vertexArray[3*e+1],this.vertexArray[3*e+2])};JSM.RenderGeometry.prototype.GetTransformedVertex=function(e){e=this.GetVertex(e);return this.transformation.Apply(e)};JSM.RenderGeometry.prototype.Compile=function(e,t){this.material.Compile(e,t);this.vertexBuffer=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer);e.bufferData(e.ARRAY_BUFFER,this.vertexArray,e.STATIC_DRAW);this.vertexBuffer.itemSize=3;this.vertexBuffer.numItems=parseInt(this.vertexArray.length/3,10);this.normalBuffer=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,this.normalBuffer);e.bufferData(e.ARRAY_BUFFER,this.normalArray,e.STATIC_DRAW);this.normalBuffer.itemSize=3;this.normalBuffer.numItems=parseInt(this.normalArray.length/3,10);null!==this.uvArray&&(this.uvBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.uvBuffer),e.bufferData(e.ARRAY_BUFFER,this.uvArray,e.STATIC_DRAW),this.uvBuffer.itemSize=2,this.uvBuffer.numItems=parseInt(this.uvArray.length/2,10))};JSM.Renderer=function(){this.geometries=this.light=this.camera=this.texShader=this.shader=this.context=this.canvas=null};JSM.Renderer.prototype.Init=function(e,t,n){return!this.InitContext(e)||!this.InitView(t,n)||!this.InitShaders()||!this.InitBuffers()?!1:!0};JSM.Renderer.prototype.InitContext=function(e){if(!window.WebGLRenderingContext)return!1;this.canvas=document.getElementById(e);if(null===this.canvas||void 0===this.canvas.getContext)return!1;this.context=this.canvas.getContext("webgl")||this.canvas.getContext("experimental-webgl");if(null===this.context)return!1;this.context.viewportWidth=this.canvas.width;this.context.viewportHeight=this.canvas.height;this.context.viewport(0,0,this.context.viewportWidth,this.context.viewportHeight);this.context.clearColor(1,1,1,1);this.context.enable(this.context.DEPTH_TEST);this.context.depthFunc(this.context.LEQUAL);this.context.enable(this.context.BLEND);this.context.blendEquation(this.context.FUNC_ADD);this.context.blendFunc(this.context.SRC_ALPHA,this.context.ONE_MINUS_SRC_ALPHA);return!0};JSM.Renderer.prototype.InitShaders=function(){function e(e,t,n){n=e.createShader(n);e.shaderSource(n,t);e.compileShader(n);return!e.getShaderParameter(n,e.COMPILE_STATUS)?null:n}function t(t,n,r){n=e(t,n,t.FRAGMENT_SHADER);r=e(t,r,t.VERTEX_SHADER);if(null===n||null===r)return null;var i=t.createProgram();t.attachShader(i,r);t.attachShader(i,n);t.linkProgram(i);return!t.getProgramParameter(i,t.LINK_STATUS)?null:i}function n(e){var t="";e&&(t="#define USETEXTURE");return[t,"uniform highp vec3 uPolygonAmbientColor;\nuniform highp vec3 uPolygonDiffuseColor;\nuniform highp vec3 uPolygonSpecularColor;\nuniform highp float uPolygonShininess;\nuniform highp vec3 uLightAmbientColor;\nuniform highp vec3 uLightDiffuseColor;\nuniform highp vec3 uLightSpecularColor;\nvarying highp vec3 vVertex;\nvarying highp vec3 vNormal;\nvarying highp vec3 vLight;\n#ifdef USETEXTURE\nvarying highp vec2 vUV;\nuniform sampler2D uSampler;\n#endif\nvoid main (void) {\n	highp vec3 N = normalize (vNormal);\n	if (!gl_FrontFacing) {\n		N = -N;\n	}\n	highp vec3 L = normalize (-vLight);\n	highp vec3 E = normalize (-vVertex);\n	highp vec3 R = normalize (-reflect (L, N));\n	highp vec3 ambientComponent = uPolygonAmbientColor * uLightAmbientColor;\n	highp vec3 diffuseComponent = uPolygonDiffuseColor * uLightDiffuseColor * max (dot (N, L), 0.0);\n	highp vec3 specularComponent = uPolygonSpecularColor * uLightSpecularColor * pow (max (dot (R, E), 0.0), uPolygonShininess);\n#ifdef USETEXTURE\n	highp vec3 textureColor = texture2D (uSampler, vec2 (vUV.s, vUV.t)).xyz;\n	ambientComponent = textureColor * ambientComponent;\n	diffuseComponent = textureColor * diffuseComponent;\n	specularComponent = textureColor * specularComponent;\n#endif\n	ambientComponent = clamp (ambientComponent, 0.0, 1.0);\n	diffuseComponent = clamp (diffuseComponent, 0.0, 1.0);\n	specularComponent = clamp (specularComponent, 0.0, 1.0);\n	gl_FragColor = vec4 (ambientComponent + diffuseComponent + specularComponent, 1.0);\n}"].join("\n")}function r(e){var t="";e&&(t="#define USETEXTURE");return[t,"attribute highp vec3 aVertexPosition;\nattribute highp vec3 aVertexNormal;\nuniform highp mat4 uViewMatrix;\nuniform highp mat4 uModelViewMatrix;\nuniform highp mat4 uProjectionMatrix;\nuniform highp vec3 uLightDirection;\nvarying highp vec3 vVertex;\nvarying highp vec3 vNormal;\nvarying highp vec3 vLight;\n#ifdef USETEXTURE\nattribute highp vec2 aVertexUV;\nvarying highp vec2 vUV;\n#endif\nvoid main (void) {\n	vVertex = vec3 (uModelViewMatrix * vec4 (aVertexPosition, 1.0));\n	vNormal = normalize (vec3 (uModelViewMatrix * vec4 (aVertexNormal, 0.0)));\n	vLight = normalize (vec3 (uViewMatrix * vec4 (uLightDirection, 0.0)));\n#ifdef USETEXTURE\n	vUV = aVertexUV;\n#endif\n	gl_Position = uProjectionMatrix * vec4 (vVertex, 1.0);\n}"].join("\n")}function i(e,t){t.vertexPositionAttribute=e.getAttribLocation(t,"aVertexPosition");t.vertexNormalAttribute=e.getAttribLocation(t,"aVertexNormal");t.lightAmbientColorUniform=e.getUniformLocation(t,"uLightAmbientColor");t.lightDiffuseColorUniform=e.getUniformLocation(t,"uLightDiffuseColor");t.lightSpecularColorUniform=e.getUniformLocation(t,"uLightSpecularColor");t.lightDirectionUniform=e.getUniformLocation(t,"uLightDirection");t.vMatrixUniform=e.getUniformLocation(t,"uViewMatrix");t.mvMatrixUniform=e.getUniformLocation(t,"uModelViewMatrix");t.pMatrixUniform=e.getUniformLocation(t,"uProjectionMatrix");t.polygonAmbientColorUniform=e.getUniformLocation(t,"uPolygonAmbientColor");t.polygonDiffuseColorUniform=e.getUniformLocation(t,"uPolygonDiffuseColor");t.polygonSpecularColorUniform=e.getUniformLocation(t,"uPolygonSpecularColor");t.polygonShininessUniform=e.getUniformLocation(t,"uPolygonShininess")}this.shader=function(e){var s=n(!1),o=r(!1),s=t(e,s,o);if(null===s)return null;e.useProgram(s);i(e,s);return s}(this.context);if(null===this.shader)return!1;this.texShader=function(e){var s=n(!0),o=r(!0),s=t(e,s,o);if(null===s)return null;e.useProgram(s);i(e,s);s.vertexUVAttribute=e.getAttribLocation(s,"aVertexUV");s.samplerUniform=e.getUniformLocation(s,"uSampler");return s}(this.context);return null===this.texShader?!1:!0};JSM.Renderer.prototype.InitBuffers=function(){this.geometries=[];return!0};JSM.Renderer.prototype.InitView=function(e,t){this.camera=JSM.ValueOrDefault(e,new JSM.Camera);if(!this.camera)return!1;this.light=JSM.ValueOrDefault(t,new JSM.Light);return!this.light?!1:!0};JSM.Renderer.prototype.SetClearColor=function(e,t,n){this.context.clearColor(e,t,n,1)};JSM.Renderer.prototype.AddGeometries=function(e){var t,n;for(t=0;t<e.length;t++)n=e[t],n.Compile(this.context,this.Render.bind(this)),this.geometries.push(n)};JSM.Renderer.prototype.RemoveGeometries=function(){this.geometries=[]};JSM.Renderer.prototype.Resize=function(){this.context.viewportWidth=this.canvas.width;this.context.viewportHeight=this.canvas.height;this.context.viewport(0,0,this.context.viewportWidth,this.context.viewportHeight)};JSM.Renderer.prototype.Render=function(){this.context.clear(this.context.COLOR_BUFFER_BIT|this.context.DEPTH_BUFFER_BIT);var e=JSM.MatrixPerspective(this.camera.fieldOfView*JSM.DegRad,this.context.viewportWidth/this.context.viewportHeight,this.camera.nearClippingPlane,this.camera.farClippingPlane),t=JSM.MatrixView(this.camera.eye,this.camera.center,this.camera.up),n=JSM.MatrixIdentity(),r=JSM.HexColorToNormalizedRGBComponents(this.light.ambient),i=JSM.HexColorToNormalizedRGBComponents(this.light.diffuse),s=JSM.HexColorToNormalizedRGBComponents(this.light.specular);this.light.direction=JSM.VectorNormalize(JSM.CoordSub(this.camera.center,this.camera.eye));var o,u,a,f,l,c;for(o=0;o<this.geometries.length;o++)l=this.geometries[o],n=l.GetMaterial().HasTexture()?this.texShader:this.shader,c!=n&&(c=n,this.context.useProgram(c),this.context.uniformMatrix4fv(c.pMatrixUniform,!1,e),this.context.uniformMatrix4fv(c.vMatrixUniform,!1,t),this.context.uniform3f(c.lightDirectionUniform,this.light.direction.x,this.light.direction.y,this.light.direction.z),this.context.uniform3f(c.lightAmbientColorUniform,r[0],r[1],r[2]),this.context.uniform3f(c.lightDiffuseColorUniform,i[0],i[1],i[2]),this.context.uniform3f(c.lightSpecularColorUniform,s[0],s[1],s[2])),n=l.material.ambient,u=l.material.diffuse,a=l.material.specular,f=l.material.shininess,this.context.uniform3f(c.polygonAmbientColorUniform,n[0],n[1],n[2]),this.context.uniform3f(c.polygonDiffuseColorUniform,u[0],u[1],u[2]),this.context.uniform3f(c.polygonSpecularColorUniform,a[0],a[1],a[2]),this.context.uniform1f(c.polygonShininessUniform,f),c==this.texShader&&(n=l.GetUVBuffer(),this.context.activeTexture(this.context.TEXTURE0),this.context.bindTexture(this.context.TEXTURE_2D,l.material.textureBuffer),this.context.bindBuffer(this.context.ARRAY_BUFFER,n),this.context.vertexAttribPointer(c.vertexUVAttribute,n.itemSize,this.context.FLOAT,!1,0,0),this.context.enableVertexAttribArray(c.vertexUVAttribute),this.context.uniform1i(c.samplerUniform,0)),n=JSM.MatrixMultiply(l.GetTransformationMatrix(),t),this.context.uniformMatrix4fv(c.mvMatrixUniform,!1,n),n=l.GetVertexBuffer(),this.context.bindBuffer(this.context.ARRAY_BUFFER,n),this.context.enableVertexAttribArray(c.vertexPositionAttribute),this.context.vertexAttribPointer(c.vertexPositionAttribute,n.itemSize,this.context.FLOAT,!1,0,0),l=l.GetNormalBuffer(),this.context.bindBuffer(this.context.ARRAY_BUFFER,l),this.context.enableVertexAttribArray(c.vertexNormalAttribute),this.context.vertexAttribPointer(c.vertexNormalAttribute,l.itemSize,this.context.FLOAT,!1,0,0),this.context.drawArrays(this.context.TRIANGLES,0,n.numItems)};JSM.PointCloudRenderer=function(){this.pointSize=this.points=this.camera=this.shader=this.context=this.canvas=null};JSM.PointCloudRenderer.prototype.Init=function(e,t){return!this.InitContext(e)||!this.InitShaders()||!this.InitBuffers()||!this.InitView(t)?!1:!0};JSM.PointCloudRenderer.prototype.InitContext=function(e){if(!window.WebGLRenderingContext)return!1;this.canvas=document.getElementById(e);if(null===this.canvas||void 0===this.canvas.getContext)return!1;this.context=this.canvas.getContext("experimental-webgl");if(null===this.context)return!1;this.context.viewportWidth=this.canvas.width;this.context.viewportHeight=this.canvas.height;this.context.clearColor(1,1,1,1);this.context.enable(this.context.DEPTH_TEST);return!0};JSM.PointCloudRenderer.prototype.InitShaders=function(){function e(e,t,n){n=e.createShader(n);e.shaderSource(n,t);e.compileShader(n);return!e.getShaderParameter(n,e.COMPILE_STATUS)?null:n}var t=e(this.context,"varying highp vec3 vColor;\nvoid main (void) {\n	gl_FragColor = vec4 (vColor, 1.0);\n}",this.context.FRAGMENT_SHADER),n=e(this.context,"attribute highp vec3 aVertexPosition;\nattribute highp vec3 aVertexColor;\nuniform highp mat4 uViewMatrix;\nuniform highp mat4 uProjectionMatrix;\nuniform highp float uPointSize;\nvarying highp vec3 vColor;\nvoid main (void) {\n	vColor = aVertexColor;\n	gl_PointSize = uPointSize;\n	gl_Position = uProjectionMatrix * uViewMatrix * vec4 (aVertexPosition, 1.0);\n}",this.context.VERTEX_SHADER);if(null===t||null===n)return!1;this.shader=this.context.createProgram();this.context.attachShader(this.shader,n);this.context.attachShader(this.shader,t);this.context.linkProgram(this.shader);if(!this.context.getProgramParameter(this.shader,this.context.LINK_STATUS))return!1;this.context.useProgram(this.shader);this.shader.vertexPositionAttribute=this.context.getAttribLocation(this.shader,"aVertexPosition");this.context.enableVertexAttribArray(this.shader.vertexPositionAttribute);this.shader.vertexColorAttribute=this.context.getAttribLocation(this.shader,"aVertexColor");this.context.enableVertexAttribArray(this.shader.vertexColorAttribute);this.shader.pMatrixUniform=this.context.getUniformLocation(this.shader,"uProjectionMatrix");this.shader.vMatrixUniform=this.context.getUniformLocation(this.shader,"uViewMatrix");this.shader.pointSizeUniform=this.context.getUniformLocation(this.shader,"uPointSize");return!0};JSM.PointCloudRenderer.prototype.InitBuffers=function(){this.points=[];this.pointSize=1;return!0};JSM.PointCloudRenderer.prototype.InitView=function(e){this.camera=JSM.ValueOrDefault(e,new JSM.Camera);return!this.camera?!1:!0};JSM.PointCloudRenderer.prototype.SetClearColor=function(e,t,n){this.context.clearColor(e,t,n,1)};JSM.PointCloudRenderer.prototype.SetPointSize=function(e){this.pointSize=e};JSM.PointCloudRenderer.prototype.AddPoints=function(e,t){var n=this.context.createBuffer(),r=new Float32Array(e);this.context.bindBuffer(this.context.ARRAY_BUFFER,n);this.context.bufferData(this.context.ARRAY_BUFFER,r,this.context.STATIC_DRAW);n.itemSize=3;n.numItems=parseInt(r.length/3,10);var i=this.context.createBuffer(),s=new Float32Array(t);this.context.bindBuffer(this.context.ARRAY_BUFFER,i);this.context.bufferData(this.context.ARRAY_BUFFER,s,this.context.STATIC_DRAW);i.itemSize=3;i.numItems=parseInt(s.length/3,10);this.points.push({pointArray:r,pointBuffer:n,colorBuffer:i})};JSM.PointCloudRenderer.prototype.RemovePoints=function(){this.points=[]};JSM.PointCloudRenderer.prototype.Resize=function(){this.context.viewportWidth=this.canvas.width;this.context.viewportHeight=this.canvas.height};JSM.PointCloudRenderer.prototype.Render=function(){this.context.viewport(0,0,this.context.viewportWidth,this.context.viewportHeight);this.context.clear(this.context.COLOR_BUFFER_BIT|this.context.DEPTH_BUFFER_BIT);var e=JSM.MatrixPerspective(this.camera.fieldOfView*JSM.DegRad,this.context.viewportWidth/this.context.viewportHeight,this.camera.nearClippingPlane,this.camera.farClippingPlane);this.context.uniformMatrix4fv(this.shader.pMatrixUniform,!1,e);e=JSM.MatrixView(this.camera.eye,this.camera.center,this.camera.up);this.context.uniformMatrix4fv(this.shader.vMatrixUniform,!1,e);this.context.uniform1f(this.shader.pointSizeUniform,this.pointSize);for(var t,n,e=0;e<this.points.length;e++)t=this.points[e].pointBuffer,n=this.points[e].colorBuffer,this.context.bindBuffer(this.context.ARRAY_BUFFER,t),this.context.vertexAttribPointer(this.shader.vertexPositionAttribute,t.itemSize,this.context.FLOAT,!1,0,0),this.context.bindBuffer(this.context.ARRAY_BUFFER,n),this.context.vertexAttribPointer(this.shader.vertexColorAttribute,n.itemSize,this.context.FLOAT,!1,0,0),this.context.drawArrays(this.context.POINTS,0,t.numItems)};JSM.ConvertBodyToRenderGeometries=function(e,t){var n=[],r=null,i=null,s=null,o=null;JSM.ExplodeBodyToTriangles(e,t,{hasConvexPolygons:!1,onGeometryStart:function(e){i=[];s=[];o=[];var t=JSM.HexColorToNormalizedRGBComponents(e.ambient),u=JSM.HexColorToNormalizedRGBComponents(e.diffuse),a=JSM.HexColorToNormalizedRGBComponents(e.specular);e=new JSM.RenderMaterial(t,u,a,e.shininess,e.texture,e.textureWidth,e.textureHeight);r=new JSM.RenderGeometry;r.SetMaterial(e);n.push(r)},onGeometryEnd:function(e){r.SetVertexArray(i);r.SetNormalArray(s);null!==e.texture&&r.SetUVArray(o)},onTriangle:function(e,t,n,r,u,a,l,c,h){i.push(e.x,e.y,e.z);i.push(t.x,t.y,t.z);i.push(n.x,n.y,n.z);s.push(r.x,r.y,r.z);s.push(u.x,u.y,u.z);s.push(a.x,a.y,a.z);null!==l&&null!==c&&null!==h&&(o.push(l.x,l.y),o.push(c.x,c.y),o.push(h.x,h.y))}});return n};JSM.ConvertModelToRenderGeometries=function(e,t){var n=[],r,i;for(r=0;r<e.BodyCount();r++){i=e.GetBody(r);var s=JSM.ConvertBodyToRenderGeometries(i,t,n);for(i=0;i<s.length;i++)n.push(s[i])}return n};JSM.JSONFileLoader=function(e){this.onReady=e};JSM.JSONFileLoader.prototype.Load=function(e){var t=this,n=new XMLHttpRequest;n.overrideMimeType("application/json");n.open("GET",e,!0);n.onreadystatechange=function(){4==n.readyState&&t.OnReady(n.responseText)};n.send(null)};JSM.JSONFileLoader.prototype.OnReady=function(e){null!==this.onReady&&(e=JSON.parse(e),this.onReady(e))};JSM.Mouse=function(){this.down=!1;this.button=0;this.alt=this.ctrl=this.shift=!1;this.diffY=this.diffX=this.currY=this.currX=this.prevY=this.prevX=0};JSM.Mouse.prototype.Down=function(e,t){var n=e;void 0===n&&(n=window.event);this.down=!0;this.button=e.which;this.shift=e.shiftKey;this.ctrl=e.ctrlKey;this.alt=e.altKey;this.SetCurrent(n,t);this.prevX=this.currX;this.prevY=this.currY};JSM.Mouse.prototype.Move=function(e,t){var n=e;void 0===n&&(n=window.event);this.shift=e.shiftKey;this.ctrl=e.ctrlKey;this.alt=e.altKey;this.SetCurrent(n,t);this.diffX=this.currX-this.prevX;this.diffY=this.currY-this.prevY;this.prevX=this.currX;this.prevY=this.currY};JSM.Mouse.prototype.Up=function(e,t){var n=e;void 0===n&&(n=window.event);this.down=!1;this.SetCurrent(n,t)};JSM.Mouse.prototype.Out=function(e,t){var n=e;void 0===n&&(n=window.event);this.down=!1;this.SetCurrent(n,t)};JSM.Mouse.prototype.SetCurrent=function(e,t){this.currX=e.clientX;this.currY=e.clientY;void 0!==t&&void 0!==t.offsetLeft&&void 0!==t.offsetTop&&(this.currX-=t.offsetLeft,this.currY-=t.offsetTop)};JSM.Touch=function(){this.down=!1;this.diffY=this.diffX=this.currY=this.currX=this.prevY=this.prevX=0};JSM.Touch.prototype.Start=function(e,t){if(0!==e.touches.length){var n=e.touches[0];this.down=!0;this.SetCurrent(n,t);this.prevX=this.currX;this.prevY=this.currY}};JSM.Touch.prototype.Move=function(e,t){0!==e.touches.length&&(this.SetCurrent(e.touches[0],t),this.diffX=this.currX-this.prevX,this.diffY=this.currY-this.prevY,this.prevX=this.currX,this.prevY=this.currY)};JSM.Touch.prototype.End=function(e,t){if(0!==e.touches.length){var n=e.touches[0];this.down=!1;this.SetCurrent(n,t)}};JSM.Touch.prototype.SetCurrent=function(e,t){this.currX=e.pageX;this.currY=e.pageY;void 0!==t&&void 0!==t.offsetLeft&&void 0!==t.offsetTop&&(this.currX=e.pageX-t.offsetLeft,this.currY=e.pageY-t.offsetTop)};JSM.Navigation=function(){this.orbitCenter=this.cameraEnableZoom=this.cameraEnablePan=this.cameraEnableOrbit=this.cameraFixUp=this.touch=this.mouse=this.resizeCallback=this.drawCallback=this.camera=this.canvas=null};JSM.Navigation.prototype.Init=function(e,t,n,r){this.canvas=e;this.camera=t;this.drawCallback=n;this.resizeCallback=r;this.mouse=new JSM.Mouse;this.touch=new JSM.Touch;this.cameraEnableZoom=this.cameraEnablePan=this.cameraEnableOrbit=this.cameraFixUp=!0;this.orbitCenter=this.camera.center.Clone();var i=this;document.addEventListener&&(document.addEventListener("mousemove",function(e){i.OnMouseMove(e)}),document.addEventListener("mouseup",function(e){i.OnMouseUp(e)}));this.canvas.addEventListener&&(this.canvas.addEventListener("mousedown",function(e){i.OnMouseDown(e)},!1),this.canvas.addEventListener("DOMMouseScroll",function(e){i.OnMouseWheel(e)},!1),this.canvas.addEventListener("mousewheel",function(e){i.OnMouseWheel(e)},!1),this.canvas.addEventListener("touchstart",function(e){i.OnTouchStart(e)},!1),this.canvas.addEventListener("touchmove",function(e){i.OnTouchMove(e)},!1),this.canvas.addEventListener("touchend",function(e){i.OnTouchEnd(e)},!1),this.canvas.addEventListener("contextmenu",function(e){i.OnContextMenu(e)},!1));window.addEventListener&&window.addEventListener("resize",function(e){i.OnResize(e)},!1);return!0};JSM.Navigation.prototype.SetCamera=function(e,t,n){this.camera.Set(e,t,n);this.orbitCenter=this.camera.center.Clone()};JSM.Navigation.prototype.EnableFixUp=function(e){this.cameraFixUp=e};JSM.Navigation.prototype.EnableOrbit=function(e){this.cameraEnableOrbit=e};JSM.Navigation.prototype.EnablePan=function(e){this.cameraEnablePan=e};JSM.Navigation.prototype.EnableZoom=function(e){this.cameraEnableZoom=e};JSM.Navigation.prototype.SetOrbitCenter=function(e){this.orbitCenter=e};JSM.Navigation.prototype.FitInWindow=function(e,t){var n=JSM.CoordSub(this.camera.center,e);this.camera.center=e;this.camera.eye=JSM.CoordSub(this.camera.eye,n);var n=JSM.VectorNormalize(JSM.CoordSub(this.camera.eye,this.camera.center)),r=this.camera.fieldOfView/2;this.canvas.width<this.canvas.height&&(r=r*this.canvas.width/this.canvas.height);r=t/Math.sin(r*JSM.DegRad);this.camera.eye=JSM.CoordOffset(this.camera.center,n,r);this.orbitCenter=this.camera.center.Clone()};JSM.Navigation.prototype.Orbit=function(e,t){var n=e*JSM.DegRad,r=t*JSM.DegRad,i=JSM.VectorNormalize(JSM.CoordSub(this.camera.center,this.camera.eye)),s=JSM.VectorNormalize(JSM.VectorCross(i,this.camera.up)),o=!JSM.CoordIsEqual(this.orbitCenter,this.camera.center);this.cameraFixUp?(i=JSM.GetVectorsAngle(i,this.camera.up)+r,JSM.IsGreater(i,0)&&JSM.IsLower(i,Math.PI)&&(this.camera.eye=JSM.CoordRotate(this.camera.eye,s,-r,this.orbitCenter),o&&(this.camera.center=JSM.CoordRotate(this.camera.center,s,-r,this.orbitCenter))),this.camera.eye=JSM.CoordRotate(this.camera.eye,this.camera.up,-n,this.orbitCenter),o&&(this.camera.center=JSM.CoordRotate(this.camera.center,this.camera.up,-n,this.orbitCenter))):(i=JSM.VectorNormalize(JSM.VectorCross(s,i)),this.camera.eye=JSM.CoordRotate(this.camera.eye,s,-r,this.orbitCenter),this.camera.eye=JSM.CoordRotate(this.camera.eye,i,-n,this.orbitCenter),o&&(this.camera.center=JSM.CoordRotate(this.camera.center,s,-r,this.orbitCenter),this.camera.center=JSM.CoordRotate(this.camera.center,i,-n,this.orbitCenter)),this.camera.up=i)};JSM.Navigation.prototype.Pan=function(e,t){var n=JSM.VectorNormalize(JSM.CoordSub(this.camera.center,this.camera.eye)),r=JSM.VectorNormalize(JSM.VectorCross(n,this.camera.up)),n=JSM.VectorNormalize(JSM.VectorCross(r,n));this.camera.eye=JSM.CoordOffset(this.camera.eye,r,-e);this.camera.center=JSM.CoordOffset(this.camera.center,r,-e);this.camera.eye=JSM.CoordOffset(this.camera.eye,n,t);this.camera.center=JSM.CoordOffset(this.camera.center,n,t)};JSM.Navigation.prototype.Zoom=function(e){var t=JSM.CoordSub(this.camera.center,this.camera.eye),n=JSM.VectorLength(t);if(e&&.1>n)return 0;n*=.1;e||(n*=-1);this.camera.eye=JSM.CoordOffset(this.camera.eye,t,n)};JSM.Navigation.prototype.DrawCallback=function(){void 0!==this.drawCallback&&null!==this.drawCallback&&this.drawCallback()};JSM.Navigation.prototype.ResizeCallback=function(){void 0!==this.resizeCallback&&null!==this.resizeCallback&&this.resizeCallback()};JSM.Navigation.prototype.OnMouseDown=function(e){e.preventDefault();this.mouse.Down(e,this.canvas)};JSM.Navigation.prototype.OnMouseMove=function(e){e.preventDefault();this.mouse.Move(e,this.canvas);this.mouse.down&&(e=0,1==this.mouse.button?this.cameraEnableOrbit&&(e=.5,this.Orbit(this.mouse.diffX*e,this.mouse.diffY*e),this.DrawCallback()):3==this.mouse.button&&this.cameraEnablePan&&(e=.001*JSM.CoordDistance(this.camera.eye,this.camera.center),this.Pan(this.mouse.diffX*e,this.mouse.diffY*e),this.DrawCallback()))};JSM.Navigation.prototype.OnMouseUp=function(e){e.preventDefault();this.mouse.Up(e,this.canvas)};JSM.Navigation.prototype.OnMouseOut=function(e){e.preventDefault();this.mouse.Out(e,this.canvas)};JSM.Navigation.prototype.OnMouseWheel=function(e){e.preventDefault();if(this.cameraEnableZoom){null===e&&(e=window.event);var t=0;e.detail?t=-e.detail:e.wheelDelta&&(t=e.wheelDelta/40);this.Zoom(0<t);this.DrawCallback()}};JSM.Navigation.prototype.OnTouchStart=function(e){e.preventDefault();this.touch.Start(e,this.canvas)};JSM.Navigation.prototype.OnTouchMove=function(e){e.preventDefault();this.touch.Move(e,this.canvas);this.touch.down&&this.cameraEnableOrbit&&(this.Orbit(.5*this.touch.diffX,.5*this.touch.diffY),this.DrawCallback())};JSM.Navigation.prototype.OnTouchEnd=function(e){e.preventDefault();this.touch.End(e,this.canvas)};JSM.Navigation.prototype.OnContextMenu=function(e){e.preventDefault()};JSM.Navigation.prototype.OnResize=function(e){e.preventDefault();this.ResizeCallback()};JSM.SoftwareViewer=function(){this.navigation=this.drawMode=this.drawer=this.bodies=this.camera=this.canvas=null};JSM.SoftwareViewer.prototype.Start=function(e,t){return!this.InitCanvas(e)||!this.InitCamera(t)?!1:!0};JSM.SoftwareViewer.prototype.InitCanvas=function(e){this.bodies=[];this.canvas=document.getElementById(e);if(!this.canvas)return!1;this.canvas instanceof HTMLCanvasElement?this.drawer=new JSM.CanvasDrawer(this.canvas):this.canvas instanceof SVGSVGElement&&(this.drawer=new JSM.SVGDrawer(this.canvas));if(!this.drawer)return!1;this.drawMode="Wireframe";return!0};JSM.SoftwareViewer.prototype.InitCamera=function(e){this.camera=JSM.ValueOrDefault(e,new JSM.Camera);if(!this.camera)return!1;this.navigation=new JSM.Navigation;return!this.navigation.Init(this.canvas,this.camera,this.Draw.bind(this),this.Resize.bind(this))?!1:!0};JSM.SoftwareViewer.prototype.AddBody=function(e,t){this.bodies.push([e,t])};JSM.SoftwareViewer.prototype.RemoveBodies=function(){this.bodies=[]};JSM.SoftwareViewer.prototype.FitInWindow=function(){var e=this.GetCenter(),t=this.GetBoundingSphereRadius(e);this.navigation.FitInWindow(e,t);this.Draw()};JSM.SoftwareViewer.prototype.GetCenter=function(){var e=this.GetBoundingBox();return JSM.MidCoord(e[0],e[1])};JSM.SoftwareViewer.prototype.GetBoundingBox=function(){var e=new JSM.Coord(JSM.Inf,JSM.Inf,JSM.Inf),t=new JSM.Coord(-JSM.Inf,-JSM.Inf,-JSM.Inf),n,r,i,s;for(n=0;n<this.bodies.length;n++){i=this.bodies[n][0];for(r=0;r<i.VertexCount();r++)s=i.GetVertex(r),e.x=JSM.Minimum(e.x,s.position.x),e.y=JSM.Minimum(e.y,s.position.y),e.z=JSM.Minimum(e.z,s.position.z),t.x=JSM.Maximum(t.x,s.position.x),t.y=JSM.Maximum(t.y,s.position.y),t.z=JSM.Maximum(t.z,s.position.z)}return[e,t]};JSM.SoftwareViewer.prototype.GetBoundingSphereRadius=function(e){if(void 0===e||null===e)e=this.GetCenter();var t=0,n,r,i,s;for(n=0;n<this.bodies.length;n++){i=this.bodies[n][0];for(r=0;r<i.VertexCount();r++)s=i.GetVertex(r),s=JSM.CoordDistance(e,s.position),JSM.IsGreater(s,t)&&(t=s)}return t};JSM.SoftwareViewer.prototype.Resize=function(){this.Draw()};JSM.SoftwareViewer.prototype.Draw=function(){var e,t;this.drawer.Clear();for(e=0;e<this.bodies.length;e++)t=this.bodies[e],JSM.DrawProjectedBody(t[0],t[1],this.camera,this.drawMode,!1,this.drawer);return!0};JSM.SpriteViewer=function(){this.navigation=this.projected=this.points=this.callbacks=this.camera=this.canvas=null};JSM.SpriteViewer.prototype.Start=function(e,t,n){return!this.InitCanvas(e)||!this.InitCamera(t)||!this.InitCallbacks(n)?!1:!0};JSM.SpriteViewer.prototype.InitCanvas=function(e){this.points=[];this.canvas=document.getElementById(e);return!this.canvas?!1:!0};JSM.SpriteViewer.prototype.InitCamera=function(e){this.camera=JSM.ValueOrDefault(e,new JSM.Camera);if(!this.camera)return!1;this.navigation=new JSM.Navigation;return!this.navigation.Init(this.canvas,this.camera,this.Draw.bind(this))?!1:!0};JSM.SpriteViewer.prototype.InitCallbacks=function(e){this.callbacks={onPointDraw:null};void 0!==e&&(void 0!==e.onDrawStart&&(this.callbacks.onDrawStart=e.onDrawStart),void 0!==e.onPointDraw&&(this.callbacks.onPointDraw=e.onPointDraw),void 0!==e.onDrawEnd&&(this.callbacks.onDrawEnd=e.onDrawEnd));return!0};JSM.SpriteViewer.prototype.AddPoint=function(e){this.points.push(e)};JSM.SpriteViewer.prototype.RemovePoints=function(){this.points=[]};JSM.SpriteViewer.prototype.Resize=function(){this.Draw()};JSM.SpriteViewer.prototype.NearestPointUnderPosition=function(e,t,n){t=new JSM.Coord2D(t,n);n=-1;var r=JSM.Inf,i,s,o;for(i=0;i<this.projected.length;i++)s=this.projected[i],o=JSM.CoordDistance2D(new JSM.Coord2D(s.position.x,s.position.y),t),JSM.IsLower(o,e)&&JSM.IsLower(o,r)&&(n=s.originalIndex,r=o);return n};JSM.SpriteViewer.prototype.NearestPointUnderMouse=function(e){return this.NearestPointUnderPosition(e,this.navigation.mouse.currX,this.navigation.mouse.currY)};JSM.SpriteViewer.prototype.NearestPointUnderTouch=function(e){return this.NearestPointUnderPosition(e,this.navigation.touch.currX,this.navigation.touch.currY)};JSM.SpriteViewer.prototype.FitInWindow=function(){var e=this.GetCenter(),t=this.GetBoundingSphereRadius(e);this.navigation.FitInWindow(e,t);this.Draw()};JSM.SpriteViewer.prototype.GetCenter=function(){var e=this.GetBoundingBox();return JSM.MidCoord(e[0],e[1])};JSM.SpriteViewer.prototype.GetBoundingBox=function(){var e=new JSM.Coord(JSM.Inf,JSM.Inf,JSM.Inf),t=new JSM.Coord(-JSM.Inf,-JSM.Inf,-JSM.Inf),n,r;for(n=0;n<this.points.length;n++)r=this.points[n],e.x=JSM.Minimum(e.x,r.x),e.y=JSM.Minimum(e.y,r.y),e.z=JSM.Minimum(e.z,r.z),t.x=JSM.Maximum(t.x,r.x),t.y=JSM.Maximum(t.y,r.y),t.z=JSM.Maximum(t.z,r.z);return[e,t]};JSM.SpriteViewer.prototype.GetBoundingSphereRadius=function(e){if(void 0===e||null===e)e=this.GetCenter();var t=0,n,r;for(n=0;n<this.points.length;n++)r=this.points[n],r=JSM.CoordDistance(e,r),JSM.IsGreater(r,t)&&(t=r);return t};JSM.SpriteViewer.prototype.Draw=function(){if(null!==this.callbacks.onDrawStart)this.callbacks.onDrawStart(this.canvas);var e=this.canvas.width/this.canvas.height,t=[0,0,this.canvas.width,this.canvas.height];this.projected=[];var n,r;for(n=0;n<this.points.length;n++)r=this.points[n],r=JSM.Project(r,this.camera.eye,this.camera.center,this.camera.up,this.camera.fieldOfView*JSM.DegRad,e,this.camera.nearClippingPlane,this.camera.farClippingPlane,t),r.y=this.canvas.height-r.y,null!==r&&this.projected.push({position:r,originalIndex:n});this.projected.sort(function(e,t){return e.position.z>t.position.z?-1:e.position.z<t.position.z?1:0});for(n=0;n<this.projected.length;n++)if(null!==this.callbacks.onPointDraw)this.callbacks.onPointDraw(this.canvas,this.projected[n].originalIndex,this.projected[n].position);if(null!==this.callbacks.onDrawEnd)this.callbacks.onDrawEnd(this.canvas);return!0};JSM.Viewer=function(){this.navigation=this.renderer=this.canvas=null};JSM.Viewer.prototype.Init=function(e,t,n){return!this.InitRenderer(e,t,n)||!this.InitNavigation()?!1:!0};JSM.Viewer.prototype.InitRenderer=function(e,t,n){this.renderer=new JSM.Renderer;return!this.renderer.Init(e,t,n)?!1:!0};JSM.Viewer.prototype.InitNavigation=function(){this.navigation=new JSM.Navigation;return!this.navigation.Init(this.renderer.canvas,this.renderer.camera,this.Draw.bind(this),this.Resize.bind(this))?!1:!0};JSM.Viewer.prototype.SetClearColor=function(e,t,n){this.renderer.SetClearColor(e,t,n);this.Draw()};JSM.Viewer.prototype.AddGeometries=function(e){this.renderer.AddGeometries(e);this.Draw()};JSM.Viewer.prototype.RemoveGeometries=function(){this.renderer.RemoveGeometries();this.Draw()};JSM.Viewer.prototype.FitInWindow=function(){var e=this.GetCenter(),t=this.GetBoundingSphereRadius(e);this.navigation.FitInWindow(e,t);this.Draw()};JSM.Viewer.prototype.GetCenter=function(){var e=this.GetBoundingBox();return JSM.MidCoord(e[0],e[1])};JSM.Viewer.prototype.GetBoundingBox=function(){var e=new JSM.Coord(JSM.Inf,JSM.Inf,JSM.Inf),t=new JSM.Coord(-JSM.Inf,-JSM.Inf,-JSM.Inf),n,r,i,s;for(n=0;n<this.renderer.geometries.length;n++){i=this.renderer.geometries[n];for(r=0;r<i.VertexCount();r+=1)s=i.GetTransformedVertex(r),e.x=JSM.Minimum(e.x,s.x),e.y=JSM.Minimum(e.y,s.y),e.z=JSM.Minimum(e.z,s.z),t.x=JSM.Maximum(t.x,s.x),t.y=JSM.Maximum(t.y,s.y),t.z=JSM.Maximum(t.z,s.z)}return[e,t]};JSM.Viewer.prototype.GetBoundingSphereRadius=function(e){if(void 0===e||null===e)e=this.GetCenter();var t=0,n,r,i,s;for(n=0;n<this.renderer.geometries.length;n++){i=this.renderer.geometries[n];for(r=0;r<i.VertexCount();r+=1)s=i.GetTransformedVertex(r),s=JSM.CoordDistance(e,s),JSM.IsGreater(s,t)&&(t=s)}return t};JSM.Viewer.prototype.Resize=function(){this.renderer.Resize();this.Draw()};JSM.Viewer.prototype.Draw=function(){this.renderer.Render()};JSM.PointCloudViewer=function(){this.navigation=this.renderer=this.canvas=null};JSM.PointCloudViewer.prototype.Init=function(e,t){return!this.InitRenderer(e,t)||!this.InitNavigation()?!1:!0};JSM.PointCloudViewer.prototype.InitRenderer=function(e,t){this.renderer=new JSM.PointCloudRenderer;return!this.renderer.Init(e,t)?!1:!0};JSM.PointCloudViewer.prototype.InitNavigation=function(){this.navigation=new JSM.Navigation;return!this.navigation.Init(this.renderer.canvas,this.renderer.camera,this.Draw.bind(this),this.Resize.bind(this))?!1:!0};JSM.PointCloudViewer.prototype.SetClearColor=function(e,t,n){this.renderer.SetClearColor(e,t,n)};JSM.PointCloudViewer.prototype.SetPointSize=function(e){this.renderer.SetPointSize(e)};JSM.PointCloudViewer.prototype.AddPoints=function(e,t){this.renderer.AddPoints(e,t)};JSM.PointCloudViewer.prototype.RemovePoints=function(){this.renderer.RemovePoints()};JSM.PointCloudViewer.prototype.FitInWindow=function(){var e=this.GetCenter(),t=this.GetBoundingSphereRadius(e);this.navigation.FitInWindow(e,t);this.Draw()};JSM.PointCloudViewer.prototype.GetCenter=function(){var e=this.GetBoundingBox();return JSM.MidCoord(e[0],e[1])};JSM.PointCloudViewer.prototype.GetBoundingBox=function(){var e=new JSM.Coord(JSM.Inf,JSM.Inf,JSM.Inf),t=new JSM.Coord(-JSM.Inf,-JSM.Inf,-JSM.Inf),n,r,i,s;for(n=0;n<this.renderer.points.length;n++){i=this.renderer.points[n].pointArray;for(r=0;r<i.length;r+=3)s=new JSM.Coord(i[r],i[r+1],i[r+2]),e.x=JSM.Minimum(e.x,s.x),e.y=JSM.Minimum(e.y,s.y),e.z=JSM.Minimum(e.z,s.z),t.x=JSM.Maximum(t.x,s.x),t.y=JSM.Maximum(t.y,s.y),t.z=JSM.Maximum(t.z,s.z)}return[e,t]};JSM.PointCloudViewer.prototype.GetBoundingSphereRadius=function(e){if(void 0===e||null===e)e=this.GetCenter();var t=0,n,r,i,s;for(n=0;n<this.renderer.points.length;n++){i=this.renderer.points[n].pointArray;for(r=0;r<i.length;r+=3)s=new JSM.Coord(i[r],i[r+1],i[r+2]),s=JSM.CoordDistance(e,s),JSM.IsGreater(s,t)&&(t=s)}return t};JSM.PointCloudViewer.prototype.Resize=function(){this.renderer.Resize();this.Draw()};JSM.PointCloudViewer.prototype.Draw=function(){this.renderer.Render()};JSM.ConvertBodyToThreeMeshes=function(e,t,n){var r={textureLoadedCallback:null,hasConvexPolygons:!1,doubleSided:!0};void 0!==n&&null!==n&&(r.textureLoadedCallback=JSM.ValueOrDefault(n.textureLoadedCallback,r.textureLoadedCallback),r.hasConvexPolygons=JSM.ValueOrDefault(n.hasConvexPolygons,r.hasConvexPolygons),r.doubleSided=JSM.ValueOrDefault(n.doubleSided,r.doubleSided));var i=[],s=null;JSM.ExplodeBodyToTriangles(e,t,{hasConvexPolygons:r.hasConvexPolygons,onGeometryStart:function(){s=new THREE.Geometry},onGeometryEnd:function(e){var t=null!==e.texture,n=1!==e.opacity,o=new THREE.MeshPhongMaterial({ambient:e.ambient,color:e.diffuse,specular:e.specular});r.doubleSided&&(o.side=THREE.DoubleSide);n&&(o.opacity=e.opacity,o.transparent=!0);t&&(e=THREE.ImageUtils.loadTexture(e.texture,new THREE.UVMapping,function(){null!==r.textureLoadedCallback&&r.textureLoadedCallback()}),e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.RepeatWrapping,o.map=e);s.computeFaceNormals();o=new THREE.Mesh(s,o);i.push(o)},onTriangle:function(e,t,n,r,i,o,u,a,l){var c=s.vertices.length;s.vertices.push(new THREE.Vector3(e.x,e.y,e.z));s.vertices.push(new THREE.Vector3(t.x,t.y,t.z));s.vertices.push(new THREE.Vector3(n.x,n.y,n.z));e=new THREE.Face3(c+0,c+1,c+2);s.faces.push(e);null!==r&&null!==i&&null!==o&&(e=[],e.push(new THREE.Vector3(r.x,r.y,r.z)),e.push(new THREE.Vector3(i.x,i.y,i.z)),e.push(new THREE.Vector3(o.x,o.y,o.z)),s.faces[s.faces.length-1].vertexNormals=e);null!==u&&null!==a&&null!==l&&(r=[],r.push(new THREE.Vector2(u.x,-u.y)),r.push(new THREE.Vector2(a.x,-a.y)),r.push(new THREE.Vector2(l.x,-l.y)),s.faceVertexUvs[0].push(r))}});return i};JSM.ConvertModelToThreeMeshes=function(e,t,n){var r=[],i=[],s,o;for(s=0;s<e.BodyCount();s++){i=e.GetBody(s);i=JSM.ConvertBodyToThreeMeshes(i,t,n);for(o=0;o<i.length;o++)r.push(i[o])}return r};JSM.ConvertJSONDataToThreeMeshes=function(e,t,n){function r(e,n){function r(e){var r=e.parameters,l=s[e.material];e=l.texture;var c=l.offset,p=l.scale,d=new THREE.Color,v=new THREE.Color,m=new THREE.Color;d.setRGB(l.ambient[0],l.ambient[1],l.ambient[2]);v.setRGB(l.diffuse[0],l.diffuse[1],l.diffuse[2]);m.setRGB(l.specular[0],l.specular[1],l.specular[2]);void 0!==e&&(d.setRGB(1,1,1),v.setRGB(1,1,1),m.setRGB(1,1,1),void 0===c&&(c=[0,0]),void 0===p&&(p=[1,1]));d=new THREE.MeshPhongMaterial({ambient:v.getHex(),color:v.getHex(),specular:m.getHex(),side:THREE.DoubleSide});1!==l.opacity&&(d.opacity=l.opacity,d.transparent=!0);void 0!==e&&(l=THREE.ImageUtils.loadTexture(e,new THREE.UVMapping,function(){void 0!==t&&null!==t&&t()}),l.wrapS=THREE.RepeatWrapping,l.wrapT=THREE.RepeatWrapping,d.map=l);var l=new THREE.Geometry,y,w,E,S,x,T,N,C,k,L;for(L=0;L<r.length;L+=9)y=3*r[L+0],w=3*r[L+1],E=3*r[L+2],S=3*r[L+3],x=3*r[L+4],T=3*r[L+5],v=2*r[L+6],m=2*r[L+7],N=2*r[L+8],C=l.vertices.length,k=l.faces.length,l.vertices.push(new THREE.Vector3(o[y+0],o[y+1],o[y+2])),l.vertices.push(new THREE.Vector3(o[w+0],o[w+1],o[w+2])),l.vertices.push(new THREE.Vector3(o[E+0],o[E+1],o[E+2])),l.faces.push(new THREE.Face3(C+0,C+1,C+2)),y=[],y.push(new THREE.Vector3(u[S+0],u[S+1],u[S+2])),y.push(new THREE.Vector3(u[x+0],u[x+1],u[x+2])),y.push(new THREE.Vector3(u[T+0],u[T+1],u[T+2])),l.faces[k].vertexNormals=y,void 0!==e&&(S=[],S.push(new THREE.Vector2(c[0]+a[v+0]*p[0],c[1]+a[v+1]*p[1])),S.push(new THREE.Vector2(c[0]+a[m+0]*p[0],c[1]+a[m+1]*p[1])),S.push(new THREE.Vector2(c[0]+a[N+0]*p[0],c[1]+a[N+1]*p[1])),l.faceVertexUvs[0].push(S));r=new THREE.Mesh(l,d);r.originalJsonIndex=n;i.push(r)}var o=e.vertices;if(void 0!==o){var u=e.normals;if(void 0!==u){var a=e.uvs;if(void 0!==a){var l=e.triangles,c;for(c=0;c<l.length;c++)r(l[c])}}}}var i=[],s=e.materials;if(void 0===s)return i;var o=e.meshes;if(void 0===o)return i;var u=0;JSM.AsyncRunTask(function(){r(o[u],u);u+=1;return!0},n,o.length,0,i);return i};JSM.JSONFileConverter=function(e,t){this.onReady=e;this.onTextureLoaded=t};JSM.JSONFileConverter.prototype.Convert=function(e){(new JSM.JSONFileLoader(this.OnReady.bind(this))).Load(e)};JSM.JSONFileConverter.prototype.OnReady=function(e){null!==this.onReady&&(e=JSM.ConvertJSONDataToThreeMeshes(e,this.onTextureLoaded),this.onReady(e))};JSM.ThreeViewer=function(){this.enableDraw=this.drawLoop=this.settings=this.navigation=this.cameraMove=this.runAfterRender=this.runBeforeRender=this.directionalLight=this.ambientLight=this.renderer=this.camera=this.scene=this.canvas=null};JSM.ThreeViewer.prototype.Start=function(e,t){if(!this.IsWebGLEnabled()||!this.InitSettings(t)||!this.InitThree(e)||!this.InitCamera(t)||!this.InitLights())return!1;this.drawLoop=!1;this.enableDraw=!0;this.DrawIfNeeded();return!0};JSM.ThreeViewer.prototype.IsWebGLEnabled=function(){return!window.WebGLRenderingContext||!document.createElement("canvas").getContext("experimental-webgl")?!1:!0};JSM.ThreeViewer.prototype.InitSettings=function(e){this.settings={cameraEyePosition:new JSM.Coord(1,1,1),cameraCenterPosition:new JSM.Coord(0,0,0),cameraUpVector:new JSM.Coord(0,0,1),lightAmbientColor:[.5,.5,.5],lightDiffuseColor:[.5,.5,.5]};void 0!==e&&(void 0!==e.cameraEyePosition&&(this.settings.cameraEyePosition=JSM.CoordFromArray(e.cameraEyePosition)),void 0!==e.cameraCenterPosition&&(this.settings.cameraCenterPosition=JSM.CoordFromArray(e.cameraCenterPosition)),void 0!==e.cameraUpVector&&(this.settings.cameraUpVector=JSM.CoordFromArray(e.cameraUpVector)),void 0!==e.lightAmbientColor&&(this.settings.lightAmbientColor=e.lightAmbientColor),void 0!==e.lightDiffuseColor&&(this.settings.lightDiffuseColor=e.lightDiffuseColor));return!0};JSM.ThreeViewer.prototype.InitThree=function(e){this.canvas=document.getElementById(e);if(!this.canvas||!this.canvas.getContext)return!1;this.scene=new THREE.Scene;if(!this.scene)return!1;this.renderer=new THREE.WebGLRenderer({canvas:this.canvas,antialias:!0});if(!this.renderer)return!1;this.renderer.setClearColor(new THREE.Color(16777215));this.renderer.setSize(this.canvas.width,this.canvas.height);return!0};JSM.ThreeViewer.prototype.InitCamera=function(e){this.cameraMove=new JSM.Camera(JSM.CoordFromArray(e.cameraEyePosition),JSM.CoordFromArray(e.cameraCenterPosition),JSM.CoordFromArray(e.cameraUpVector),e.fieldOfView,e.nearClippingPlane,e.farClippingPlane);if(!this.cameraMove)return!1;this.navigation=new JSM.Navigation;if(!this.navigation.Init(this.canvas,this.cameraMove,this.DrawIfNeeded.bind(this),this.Resize.bind(this)))return!1;this.camera=new THREE.PerspectiveCamera(this.cameraMove.fieldOfView,this.canvas.width/this.canvas.height,this.cameraMove.nearClippingPlane,this.cameraMove.farClippingPlane);if(!this.camera)return!1;this.scene.add(this.camera);return!0};JSM.ThreeViewer.prototype.InitLights=function(){var e=new THREE.Color,t=new THREE.Color;e.setRGB(this.settings.lightAmbientColor[0],this.settings.lightAmbientColor[1],this.settings.lightAmbientColor[2]);t.setRGB(this.settings.lightDiffuseColor[0],this.settings.lightDiffuseColor[1],this.settings.lightDiffuseColor[2]);this.ambientLight=new THREE.AmbientLight(e.getHex());if(!this.ambientLight)return!1;this.scene.add(this.ambientLight);this.directionalLight=new THREE.DirectionalLight(t.getHex());if(!this.directionalLight)return!1;e=(new THREE.Vector3).subVectors(this.cameraMove.eye,this.cameraMove.center);this.directionalLight.position.set(e.x,e.y,e.z);this.scene.add(this.directionalLight);return!0};JSM.ThreeViewer.prototype.SetRunBeforeRender=function(e){this.runBeforeRender=e};JSM.ThreeViewer.prototype.SetRunAfterRender=function(e){this.runAfterRender=e};JSM.ThreeViewer.prototype.SetClearColor=function(e){this.renderer.setClearColor(new THREE.Color(e));this.DrawIfNeeded()};JSM.ThreeViewer.prototype.AddMesh=function(e){this.scene.add(e);this.DrawIfNeeded()};JSM.ThreeViewer.prototype.AddMeshes=function(e){var t;for(t=0;t<e.length;t++)this.scene.add(e[t]);this.DrawIfNeeded()};JSM.ThreeViewer.prototype.MeshCount=function(){var e=0;this.scene.traverse(function(t){t instanceof THREE.Mesh&&(e+=1)});return e};JSM.ThreeViewer.prototype.VertexCount=function(){var e=0;this.scene.traverse(function(t){t instanceof THREE.Mesh&&(e+=t.geometry.vertices.length)});return e};JSM.ThreeViewer.prototype.FaceCount=function(){var e=0;this.scene.traverse(function(t){t instanceof THREE.Mesh&&(e+=t.geometry.faces.length)});return e};JSM.ThreeViewer.prototype.GetMesh=function(e){var t=null,n=0,r;for(r=0;r<this.scene.children.length;r++)if(t=this.scene.children[r],t instanceof THREE.Mesh){if(n==e)return t;n+=1}return null};JSM.ThreeViewer.prototype.RemoveMesh=function(e){this.scene.remove(e);this.DrawIfNeeded()};JSM.ThreeViewer.prototype.RemoveMeshes=function(){var e,t;for(t=0;t<this.scene.children.length;t++)e=this.scene.children[t],e instanceof THREE.Mesh&&(this.scene.remove(e),t--);this.DrawIfNeeded()};JSM.ThreeViewer.prototype.RemoveLastMesh=function(){var e=null;this.scene.traverse(function(t){t instanceof THREE.Mesh&&(e=t)});null!==e&&this.scene.remove(e);this.DrawIfNeeded()};JSM.ThreeViewer.prototype.SetCamera=function(e,t,n){this.navigation.SetCamera(e,t,n);this.navigation.SetOrbitCenter(t.Clone());this.DrawIfNeeded()};JSM.ThreeViewer.prototype.Resize=function(){this.camera.aspect=this.canvas.width/this.canvas.height;this.camera.updateProjectionMatrix();this.renderer.setSize(this.canvas.width,this.canvas.height);this.DrawIfNeeded()};JSM.ThreeViewer.prototype.FitInWindow=function(){if(0!==this.MeshCount()){var e=this.GetCenter(),t=this.GetBoundingSphereRadius(e);this.navigation.FitInWindow(e,t);this.DrawIfNeeded()}};JSM.ThreeViewer.prototype.AdjustClippingPlanes=function(e){var t=this.GetCenter();this.GetBoundingSphereRadius(t)<e?(this.camera.near=.1,this.camera.far=1e3):(this.camera.near=10,this.camera.far=1e6);this.camera.updateProjectionMatrix();this.Draw()};JSM.ThreeViewer.prototype.GetCenter=function(){var e=this.GetBoundingBox();return JSM.MidCoord(e[0],e[1])};JSM.ThreeViewer.prototype.GetBoundingBox=function(){var e=new JSM.Coord(JSM.Inf,JSM.Inf,JSM.Inf),t=new JSM.Coord(-JSM.Inf,-JSM.Inf,-JSM.Inf),n,r;this.scene.traverse(function(i){if(i instanceof THREE.Mesh){n=i.geometry;var s;for(s=0;s<n.vertices.length;s++)r=n.vertices[s].clone(),r.add(i.position),e.x=JSM.Minimum(e.x,r.x),e.y=JSM.Minimum(e.y,r.y),e.z=JSM.Minimum(e.z,r.z),t.x=JSM.Maximum(t.x,r.x),t.y=JSM.Maximum(t.y,r.y),t.z=JSM.Maximum(t.z,r.z)}});return[e,t]};JSM.ThreeViewer.prototype.GetBoundingSphereRadius=function(e){if(void 0===e||null===e)e=this.GetCenter();var t=0,n,r,i;this.scene.traverse(function(s){if(s instanceof THREE.Mesh){n=s.geometry;var o;for(o=0;o<n.vertices.length;o++)r=n.vertices[o].clone(),r.add(s.position),i=JSM.CoordDistance(e,new JSM.Coord(r.x,r.y,r.z)),JSM.IsGreater(i,t)&&(t=i)}});return t};JSM.ThreeViewer.prototype.GetObjectsUnderPosition=function(e,t){var n=2*(e/this.canvas.width)-1,r=2*-(t/this.canvas.height)+1,i=new THREE.Projector,s=this.camera.position,n=new THREE.Vector3(n,r,.5);i.unprojectVector(n,this.camera);n.sub(s);n.normalize();return(new THREE.Raycaster(s,n)).intersectObjects(this.scene.children)};JSM.ThreeViewer.prototype.GetObjectsUnderMouse=function(){return this.GetObjectsUnderPosition(this.navigation.mouse.currX,this.navigation.mouse.currY)};JSM.ThreeViewer.prototype.GetObjectsUnderTouch=function(){return this.GetObjectsUnderPosition(this.navigation.touch.currX,this.navigation.touch.currY)};JSM.ThreeViewer.prototype.ProjectVector=function(e,t,n){var r=this.canvas.width/2,i=this.canvas.height/2,s=new THREE.Projector;e=new THREE.Vector3(e,t,n);s.projectVector(e,this.camera);e.x=e.x*r+r;e.y=-(e.y*i)+i;return e};JSM.ThreeViewer.prototype.EnableDraw=function(e){this.enableDraw=e};JSM.ThreeViewer.prototype.Draw=function(){if(this.enableDraw){null!==this.runBeforeRender&&this.runBeforeRender();this.camera.position.set(this.cameraMove.eye.x,this.cameraMove.eye.y,this.cameraMove.eye.z);this.camera.up.set(this.cameraMove.up.x,this.cameraMove.up.y,this.cameraMove.up.z);this.camera.lookAt(new THREE.Vector3(this.cameraMove.center.x,this.cameraMove.center.y,this.cameraMove.center.z));var e=(new THREE.Vector3).subVectors(this.cameraMove.eye,this.cameraMove.center);this.directionalLight.position.set(e.x,e.y,e.z);this.renderer.render(this.scene,this.camera);null!==this.runAfterRender&&this.runAfterRender();this.drawLoop&&requestAnimationFrame(this.Draw.bind(this))}};JSM.ThreeViewer.prototype.DrawIfNeeded=function(){this.drawLoop||this.Draw()};JSM.ThreeViewer.prototype.StartDrawLoop=function(){this.drawLoop=!0;this.Draw()}